(self.webpackChunkmonitoreo=self.webpackChunkmonitoreo||[]).push([[45],{4828:(nd,Hi,ot)=>{"use strict";ot.r(Hi);var Pt=ot(8239),ts=ot(3394),Se=ot(3203),h=ot(3854),Ki=(ot(8026),ot(5422),ot(3910));function Be(){return window}function ii(){return(ii=(0,Pt.Z)(function*(P,D,F){var G;const{BuildInfo:Z}=Be();(0,Se.ap)(D.sessionId,"AuthEvent did not contain a session ID");const de=yield Me(D.sessionId),fe={};return(0,Se.aq)()?fe.ibi=Z.packageName:(0,Se.ar)()?fe.apn=Z.packageName:(0,Se.as)(P,"operation-not-supported-in-this-environment"),Z.displayName&&(fe.appDisplayName=Z.displayName),fe.sessionId=de,(0,Se.at)(P,F,D.type,void 0,null!==(G=D.eventId)&&void 0!==G?G:void 0,fe)})).apply(this,arguments)}function Er(){return(Er=(0,Pt.Z)(function*(P){const{BuildInfo:D}=Be(),F={};(0,Se.aq)()?F.iosBundleId=D.packageName:(0,Se.ar)()?F.androidPackageName=D.packageName:(0,Se.as)(P,"operation-not-supported-in-this-environment"),yield(0,Se.au)(P,F)})).apply(this,arguments)}function kn(){return(kn=(0,Pt.Z)(function*(P,D,F){const{cordova:G}=Be();let Z=()=>{};try{yield new Promise((de,fe)=>{let oe=null;function ge(){var Te;de();const it=null===(Te=G.plugins.browsertab)||void 0===Te?void 0:Te.close;"function"==typeof it&&it(),"function"==typeof(null==F?void 0:F.close)&&F.close()}function Ie(){oe||(oe=window.setTimeout(()=>{fe((0,Se.av)(P,"redirect-cancelled-by-user"))},2e3))}function Ge(){"visible"===(null==document?void 0:document.visibilityState)&&Ie()}D.addPassiveListener(ge),document.addEventListener("resume",Ie,!1),(0,Se.ar)()&&document.addEventListener("visibilitychange",Ge,!1),Z=()=>{D.removePassiveListener(ge),document.removeEventListener("resume",Ie,!1),document.removeEventListener("visibilitychange",Ge,!1),oe&&window.clearTimeout(oe)}})}finally{Z()}})).apply(this,arguments)}function Me(P){return dn.apply(this,arguments)}function dn(){return(dn=(0,Pt.Z)(function*(P){const D=gn(P),F=yield crypto.subtle.digest("SHA-256",D);return Array.from(new Uint8Array(F)).map(Z=>Z.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function gn(P){if((0,Se.ap)(/[0-9a-zA-Z]+/.test(P),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(P);const D=new ArrayBuffer(P.length),F=new Uint8Array(D);for(let G=0;G<P.length;G++)F[G]=P.charCodeAt(G);return F}class nn extends Se.az{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(D=>{this.resolveInialized=D})}addPassiveListener(D){this.passiveListeners.add(D)}removePassiveListener(D){this.passiveListeners.delete(D)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(D){return this.resolveInialized(),this.passiveListeners.forEach(F=>F(D)),super.onEvent(D)}initialized(){var D=this;return(0,Pt.Z)(function*(){yield D.initPromise})()}}function Ir(P){return Kn.apply(this,arguments)}function Kn(){return(Kn=(0,Pt.Z)(function*(P){const D=yield Xn()._get(Qe(P));return D&&(yield Xn()._remove(Qe(P))),D})).apply(this,arguments)}function qs(){const P=[],D="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let F=0;F<20;F++){const G=Math.floor(Math.random()*D.length);P.push(D.charAt(G))}return P.join("")}function Xn(){return(0,Se.ax)(Se.b)}function Qe(P){return(0,Se.ay)("authEvent",P.config.apiKey,P.name)}function qt(P){if(!(null==P?void 0:P.includes("?")))return{};const[D,...F]=P.split("?");return(0,h.zd)(F.join("?"))}function fr(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,Se.av)("no-auth-event")}}function gi(){var P;return(null===(P=null==self?void 0:self.location)||void 0===P?void 0:P.protocol)||null}function Yn(P=(0,h.z$)()){return!("file:"!==gi()&&"ionic:"!==gi()||!P.toLowerCase().match(/iphone|ipad|ipod|android/))}function Yi(){try{const P=self.localStorage,D=Se.aG();if(P)return P.setItem(D,"1"),P.removeItem(D),!function(P=(0,h.z$)()){return(0,h.w1)()&&11===(null==document?void 0:document.documentMode)||function(P=(0,h.z$)()){return/Edge\/\d+/.test(P)}(P)}()||(0,h.hl)()}catch(P){return rr()&&(0,h.hl)()}return!1}function rr(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function zi(){return("http:"===gi()||"https:"===gi()||(0,h.ru)()||Yn())&&!((0,h.b$)()||(0,h.UG)())&&Yi()&&!rr()}function At(){return Yn()&&"undefined"!=typeof document}function Wt(){return(Wt=(0,Pt.Z)(function*(){return!!At()&&new Promise(P=>{const D=setTimeout(()=>{P(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(D),P(!0)})})})).apply(this,arguments)}const yn={LOCAL:"local",NONE:"none",SESSION:"session"},Dt=Se.aw,rn="persistence";function sr(P){return un.apply(this,arguments)}function un(){return(un=(0,Pt.Z)(function*(P){yield P._initializationPromise;const D=Ei(),F=Se.ay(rn,P.config.apiKey,P.name);(null==D?void 0:D.sessionStorage)&&D.sessionStorage.setItem(F,P._getPersistence())})).apply(this,arguments)}function Ei(){return"undefined"!=typeof window?window:null}const is=Se.aw;class Ri{constructor(){this.browserResolver=Se.ax(Se.k),this.cordovaResolver=Se.ax(class{constructor(){this._redirectPersistence=Se.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Se.aA}_initialize(D){var F=this;return(0,Pt.Z)(function*(){const G=D._key();let Z=F.eventManagers.get(G);return Z||(Z=new nn(D),F.eventManagers.set(G,Z),F.attachCallbackListeners(D,Z)),Z})()}_openPopup(D){(0,Se.as)(D,"operation-not-supported-in-this-environment")}_openRedirect(D,F,G,Z){var de=this;return(0,Pt.Z)(function*(){!function(P){var D,F,G,Z,de,fe,oe,ge,Ie,Ge;const Te=Be();(0,Se.aw)("function"==typeof(null===(D=null==Te?void 0:Te.universalLinks)||void 0===D?void 0:D.subscribe),P,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,Se.aw)(void 0!==(null===(F=null==Te?void 0:Te.BuildInfo)||void 0===F?void 0:F.packageName),P,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,Se.aw)("function"==typeof(null===(de=null===(Z=null===(G=null==Te?void 0:Te.cordova)||void 0===G?void 0:G.plugins)||void 0===Z?void 0:Z.browsertab)||void 0===de?void 0:de.openUrl),P,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,Se.aw)("function"==typeof(null===(ge=null===(oe=null===(fe=null==Te?void 0:Te.cordova)||void 0===fe?void 0:fe.plugins)||void 0===oe?void 0:oe.browsertab)||void 0===ge?void 0:ge.isAvailable),P,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,Se.aw)("function"==typeof(null===(Ge=null===(Ie=null==Te?void 0:Te.cordova)||void 0===Ie?void 0:Ie.InAppBrowser)||void 0===Ge?void 0:Ge.open),P,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(D);const fe=yield de._initialize(D);yield fe.initialized(),fe.resetRedirect(),(0,Se.aB)(),yield de._originValidation(D);const oe=function(P,D,F=null){return{type:D,eventId:F,urlResponse:null,sessionId:qs(),postBody:null,tenantId:P.tenantId,error:(0,Se.av)(P,"no-auth-event")}}(D,G,Z);yield function(P,D){return Xn()._set(Qe(P),D)}(D,oe);const ge=yield function(P,D,F){return ii.apply(this,arguments)}(D,oe,F),Ie=yield function(P){const{cordova:D}=Be();return new Promise(F=>{D.plugins.browsertab.isAvailable(G=>{let Z=null;G?D.plugins.browsertab.openUrl(P):Z=D.InAppBrowser.open(P,(0,Se.ao)()?"_blank":"_system","location=yes"),F(Z)})})}(ge);return function(P,D,F){return kn.apply(this,arguments)}(D,fe,Ie)})()}_isIframeWebStorageSupported(D,F){throw new Error("Method not implemented.")}_originValidation(D){const F=D._key();return this.originValidationPromises[F]||(this.originValidationPromises[F]=function(P){return Er.apply(this,arguments)}(D)),this.originValidationPromises[F]}attachCallbackListeners(D,F){const{universalLinks:G,handleOpenURL:Z,BuildInfo:de}=Be(),fe=setTimeout((0,Pt.Z)(function*(){yield Ir(D),F.onEvent(fr())}),500),oe=function(){var Ge=(0,Pt.Z)(function*(Te){clearTimeout(fe);const it=yield Ir(D);let pe=null;it&&(null==Te?void 0:Te.url)&&(pe=function(P,D){var F,G;const Z=function(P){const D=qt(P),F=D.link?decodeURIComponent(D.link):void 0,G=qt(F).link,Z=D.deep_link_id?decodeURIComponent(D.deep_link_id):void 0;return qt(Z).link||Z||G||F||P}(D);if(Z.includes("/__/auth/callback")){const de=qt(Z),fe=de.firebaseError?function(P){try{return JSON.parse(P)}catch(D){return null}}(decodeURIComponent(de.firebaseError)):null,oe=null===(G=null===(F=null==fe?void 0:fe.code)||void 0===F?void 0:F.split("auth/"))||void 0===G?void 0:G[1],ge=oe?(0,Se.av)(oe):null;return ge?{type:P.type,eventId:P.eventId,tenantId:P.tenantId,error:ge,urlResponse:null,sessionId:null,postBody:null}:{type:P.type,eventId:P.eventId,tenantId:P.tenantId,sessionId:P.sessionId,urlResponse:Z,postBody:null}}return null}(it,Te.url)),F.onEvent(pe||fr())});return function(it){return Ge.apply(this,arguments)}}();void 0!==G&&"function"==typeof G.subscribe&&G.subscribe(null,oe);const ge=Z,Ie=`${de.packageName.toLowerCase()}://`;Be().handleOpenURL=function(){var Ge=(0,Pt.Z)(function*(Te){if(Te.toLowerCase().startsWith(Ie)&&oe({url:Te}),"function"==typeof ge)try{ge(Te)}catch(it){console.error(it)}});return function(Te){return Ge.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=Se.a,this._completeRedirectFn=Se.aA}_initialize(D){var F=this;return(0,Pt.Z)(function*(){return yield F.selectUnderlyingResolver(),F.assertedUnderlyingResolver._initialize(D)})()}_openPopup(D,F,G,Z){var de=this;return(0,Pt.Z)(function*(){return yield de.selectUnderlyingResolver(),de.assertedUnderlyingResolver._openPopup(D,F,G,Z)})()}_openRedirect(D,F,G,Z){var de=this;return(0,Pt.Z)(function*(){return yield de.selectUnderlyingResolver(),de.assertedUnderlyingResolver._openRedirect(D,F,G,Z)})()}_isIframeWebStorageSupported(D,F){this.assertedUnderlyingResolver._isIframeWebStorageSupported(D,F)}_originValidation(D){return this.assertedUnderlyingResolver._originValidation(D)}get _shouldInitProactively(){return At()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return is(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var D=this;return(0,Pt.Z)(function*(){if(D.underlyingResolver)return;const F=yield function(){return Wt.apply(this,arguments)}();D.underlyingResolver=F?D.cordovaResolver:D.browserResolver})()}}function ho(P){return P.unwrap()}function Gs(P){return mr(P)}function mr(P){const{_tokenResponse:D}=P instanceof h.ZR?P.customData:P;if(!D)return null;if(!(P instanceof h.ZR)&&"temporaryProof"in D&&"phoneNumber"in D)return Se.P.credentialFromResult(P);const F=D.providerId;if(!F||F===Se.o.PASSWORD)return null;let G;switch(F){case Se.o.GOOGLE:G=Se.N;break;case Se.o.FACEBOOK:G=Se.M;break;case Se.o.GITHUB:G=Se.Q;break;case Se.o.TWITTER:G=Se.V;break;default:const{oauthIdToken:Z,oauthAccessToken:de,oauthTokenSecret:fe,pendingToken:oe,nonce:ge}=D;return de||fe||Z||oe?oe?F.startsWith("saml.")?Se.aJ._create(F,oe):Se.I._fromParams({providerId:F,signInMethod:F,pendingToken:oe,idToken:Z,accessToken:de}):new Se.T(F).credential({idToken:Z,accessToken:de,rawNonce:ge}):null}return P instanceof h.ZR?G.credentialFromError(P):G.credentialFromResult(P)}function Bn(P,D){return D.catch(F=>{throw F instanceof h.ZR&&function(P,D){var F;const G=null===(F=D.customData)||void 0===F?void 0:F._tokenResponse;if("auth/multi-factor-auth-required"===D.code)D.resolver=new Pr(P,Se.am(P,D));else if(G){const Z=mr(D),de=D;Z&&(de.credential=Z,de.tenantId=G.tenantId||void 0,de.email=G.email||void 0,de.phoneNumber=G.phoneNumber||void 0)}}(P,F),F}).then(F=>{const Z=F.user;return{operationType:F.operationType,credential:Gs(F),additionalUserInfo:Se.ak(F),user:Fi.getOrCreate(Z)}})}function qr(P,D){return si.apply(this,arguments)}function si(){return(si=(0,Pt.Z)(function*(P,D){const F=yield D;return{verificationId:F.verificationId,confirm:G=>Bn(P,F.confirm(G))}})).apply(this,arguments)}class Pr{constructor(D,F){this.resolver=F,this.auth=D.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(D){return Bn(ho(this.auth),this.resolver.resolveSignIn(D))}}class Fi{constructor(D){this._delegate=D,this.multiFactor=Se.an(D)}static getOrCreate(D){return Fi.USER_MAP.has(D)||Fi.USER_MAP.set(D,new Fi(D)),Fi.USER_MAP.get(D)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(D){return this._delegate.getIdTokenResult(D)}getIdToken(D){return this._delegate.getIdToken(D)}linkAndRetrieveDataWithCredential(D){return this.linkWithCredential(D)}linkWithCredential(D){var F=this;return(0,Pt.Z)(function*(){return Bn(F.auth,Se.Y(F._delegate,D))})()}linkWithPhoneNumber(D,F){var G=this;return(0,Pt.Z)(function*(){return qr(G.auth,Se.l(G._delegate,D,F))})()}linkWithPopup(D){var F=this;return(0,Pt.Z)(function*(){return Bn(F.auth,Se.d(F._delegate,D,Ri))})()}linkWithRedirect(D){var F=this;return(0,Pt.Z)(function*(){return yield sr(Se.aC(F.auth)),Se.g(F._delegate,D,Ri)})()}reauthenticateAndRetrieveDataWithCredential(D){return this.reauthenticateWithCredential(D)}reauthenticateWithCredential(D){var F=this;return(0,Pt.Z)(function*(){return Bn(F.auth,Se.Z(F._delegate,D))})()}reauthenticateWithPhoneNumber(D,F){return qr(this.auth,Se.r(this._delegate,D,F))}reauthenticateWithPopup(D){return Bn(this.auth,Se.e(this._delegate,D,Ri))}reauthenticateWithRedirect(D){var F=this;return(0,Pt.Z)(function*(){return yield sr(Se.aC(F.auth)),Se.h(F._delegate,D,Ri)})()}sendEmailVerification(D){return Se.aa(this._delegate,D)}unlink(D){var F=this;return(0,Pt.Z)(function*(){return yield Se.aj(F._delegate,D),F})()}updateEmail(D){return Se.af(this._delegate,D)}updatePassword(D){return Se.ag(this._delegate,D)}updatePhoneNumber(D){return Se.u(this._delegate,D)}updateProfile(D){return Se.ae(this._delegate,D)}verifyBeforeUpdateEmail(D,F){return Se.ab(this._delegate,D,F)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Fi.USER_MAP=new WeakMap;const Qi=Se.aw;let Gr=(()=>{class P{constructor(F,G){if(this.app=F,G.isInitialized())return this._delegate=G.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:Z}=F.options;Qi(Z,"invalid-api-key",{appName:F.name});let de=[Se.K];if("undefined"!=typeof window){de=function(P,D){const F=Ei();if(!(null==F?void 0:F.sessionStorage))return[];const G=Se.ay(rn,P,D);switch(F.sessionStorage.getItem(G)){case yn.NONE:return[Se.K];case yn.LOCAL:return[Se.i,Se.a];case yn.SESSION:return[Se.a];default:return[]}}(Z,F.name);for(const oe of[Se.i,Se.b,Se.a])de.includes(oe)||de.push(oe)}Qi(Z,"invalid-api-key",{appName:F.name});const fe="undefined"!=typeof window?Ri:void 0;this._delegate=G.initialize({options:{persistence:de,popupRedirectResolver:fe}}),this._delegate._updateErrorMap(Se.z),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Fi.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(F){this._delegate.languageCode=F}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(F){this._delegate.tenantId=F}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(F,G){Se.E(this._delegate,F,G)}applyActionCode(F){return Se.a1(this._delegate,F)}checkActionCode(F){return Se.a2(this._delegate,F)}confirmPasswordReset(F,G){return Se.a0(this._delegate,F,G)}createUserWithEmailAndPassword(F,G){var Z=this;return(0,Pt.Z)(function*(){return Bn(Z._delegate,Se.a4(Z._delegate,F,G))})()}fetchProvidersForEmail(F){return this.fetchSignInMethodsForEmail(F)}fetchSignInMethodsForEmail(F){return Se.a9(this._delegate,F)}isSignInWithEmailLink(F){return Se.a7(this._delegate,F)}getRedirectResult(){var F=this;return(0,Pt.Z)(function*(){Qi(zi(),F._delegate,"operation-not-supported-in-this-environment");const G=yield Se.j(F._delegate,Ri);return G?Bn(F._delegate,Promise.resolve(G)):{credential:null,user:null}})()}addFrameworkForLogging(F){!function(P,D){(0,Se.aC)(P)._logFramework(D)}(this._delegate,F)}onAuthStateChanged(F,G,Z){const{next:de,error:fe,complete:oe}=rs(F,G,Z);return this._delegate.onAuthStateChanged(de,fe,oe)}onIdTokenChanged(F,G,Z){const{next:de,error:fe,complete:oe}=rs(F,G,Z);return this._delegate.onIdTokenChanged(de,fe,oe)}sendSignInLinkToEmail(F,G){return Se.a6(this._delegate,F,G)}sendPasswordResetEmail(F,G){return Se.$(this._delegate,F,G||void 0)}setPersistence(F){var G=this;return(0,Pt.Z)(function*(){let Z;switch(function(P,D){Dt(Object.values(yn).includes(D),P,"invalid-persistence-type"),(0,h.b$)()?Dt(D!==yn.SESSION,P,"unsupported-persistence-type"):(0,h.UG)()?Dt(D===yn.NONE,P,"unsupported-persistence-type"):rr()?Dt(D===yn.NONE||D===yn.LOCAL&&(0,h.hl)(),P,"unsupported-persistence-type"):Dt(D===yn.NONE||Yi(),P,"unsupported-persistence-type")}(G._delegate,F),F){case yn.SESSION:Z=Se.a;break;case yn.LOCAL:Z=(yield Se.ax(Se.i)._isAvailable())?Se.i:Se.b;break;case yn.NONE:Z=Se.K;break;default:return Se.as("argument-error",{appName:G._delegate.name})}return G._delegate.setPersistence(Z)})()}signInAndRetrieveDataWithCredential(F){return this.signInWithCredential(F)}signInAnonymously(){return Bn(this._delegate,Se.W(this._delegate))}signInWithCredential(F){return Bn(this._delegate,Se.X(this._delegate,F))}signInWithCustomToken(F){return Bn(this._delegate,Se._(this._delegate,F))}signInWithEmailAndPassword(F,G){return Bn(this._delegate,Se.a5(this._delegate,F,G))}signInWithEmailLink(F,G){return Bn(this._delegate,Se.a8(this._delegate,F,G))}signInWithPhoneNumber(F,G){return qr(this._delegate,Se.s(this._delegate,F,G))}signInWithPopup(F){var G=this;return(0,Pt.Z)(function*(){return Qi(zi(),G._delegate,"operation-not-supported-in-this-environment"),Bn(G._delegate,Se.c(G._delegate,F,Ri))})()}signInWithRedirect(F){var G=this;return(0,Pt.Z)(function*(){return Qi(zi(),G._delegate,"operation-not-supported-in-this-environment"),yield sr(G._delegate),Se.f(G._delegate,F,Ri)})()}updateCurrentUser(F){return this._delegate.updateCurrentUser(F)}verifyPasswordResetCode(F){return Se.a3(this._delegate,F)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return P.Persistence=yn,P})();function rs(P,D,F){let G=P;"function"!=typeof P&&({next:G,error:D,complete:F}=P);const Z=G;return{next:fe=>Z(fe&&Fi.getOrCreate(fe)),error:D,complete:F}}class Si{constructor(){this.providerId="phone",this._delegate=new Se.P(ho(ts.Z.auth()))}static credential(D,F){return Se.P.credential(D,F)}verifyPhoneNumber(D,F){return this._delegate.verifyPhoneNumber(D,F)}unwrap(){return this._delegate}}Si.PHONE_SIGN_IN_METHOD=Se.P.PHONE_SIGN_IN_METHOD,Si.PROVIDER_ID=Se.P.PROVIDER_ID;const ss=Se.aw;var P;(P=ts.Z).INTERNAL.registerComponent(new Ki.wA("auth-compat",D=>{const F=D.getProvider("app-compat").getImmediate(),G=D.getProvider("auth");return new Gr(F,G)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Se.A.EMAIL_SIGNIN,PASSWORD_RESET:Se.A.PASSWORD_RESET,RECOVER_EMAIL:Se.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Se.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Se.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Se.A.VERIFY_EMAIL}},EmailAuthProvider:Se.L,FacebookAuthProvider:Se.M,GithubAuthProvider:Se.Q,GoogleAuthProvider:Se.N,OAuthProvider:Se.T,SAMLAuthProvider:Se.U,PhoneAuthProvider:Si,PhoneMultiFactorGenerator:Se.m,RecaptchaVerifier:class{constructor(D,F,G=ts.Z.app()){var Z;ss(null===(Z=G.options)||void 0===Z?void 0:Z.apiKey,"invalid-api-key",{appName:G.name}),this._delegate=new Se.R(D,F,G.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Se.V,Auth:Gr,AuthCredential:Se.G,Error:h.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),P.registerVersion("@firebase/auth-compat","0.2.1")},2958:function(nd){nd.exports=function(){"use strict";var Hi,ot,Pt;function ts(h,Ee){if(Hi)if(ot){var Dn="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+Hi+")(sharedChunk); ("+ot+")(sharedChunk); self.onerror = null;",Ki={};Hi(Ki),Pt=Ee(Ki),"undefined"!=typeof window&&(Pt.workerUrl=window.URL.createObjectURL(new Blob([Dn],{type:"text/javascript"})))}else ot=Ee;else Hi=Ee}return ts(0,function(h){var Dn=Ki;function Ki(r,t,s,l){this.cx=3*r,this.bx=3*(s-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=l,this.p2x=s,this.p2y=l}Ki.prototype.sampleCurveX=function(r){return((this.ax*r+this.bx)*r+this.cx)*r},Ki.prototype.sampleCurveY=function(r){return((this.ay*r+this.by)*r+this.cy)*r},Ki.prototype.sampleCurveDerivativeX=function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},Ki.prototype.solveCurveX=function(r,t){var s,l,u,m,g;for(void 0===t&&(t=1e-6),u=r,g=0;g<8;g++){if(m=this.sampleCurveX(u)-r,Math.abs(m)<t)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=m/x}if((u=r)<(s=0))return s;if(u>(l=1))return l;for(;s<l;){if(m=this.sampleCurveX(u),Math.abs(m-r)<t)return u;r>m?s=u:l=u,u=.5*(l-s)+s}return u},Ki.prototype.solve=function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))};var Be=ae;function ae(r,t){this.x=r,this.y=t}ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,s=r.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),s=Math.sin(r),l=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=l,this},_rotateAround:function(r,t){var s=Math.cos(r),l=Math.sin(r),u=t.y+l*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-l*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ae.convert=function(r){return r instanceof ae?r:Array.isArray(r)?new ae(r[0],r[1]):r};var at="undefined"!=typeof self?self:{};const ii=Math.pow(2,53)-1,_s=Math.PI/180,Er=180/Math.PI;function mi(r){return r*_s}const Ur=[[0,0],[1,0],[1,1],[0,1]];function kn(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,s=t*r;return 4*(r<.5?s:3*(r-t)+s-.75)}function pr(r,t,s,l){const u=new Dn(r,t,s,l);return function(m){return u.solve(m)}}const Me=pr(.25,.1,.25,1);function dn(r,t,s){return Math.min(s,Math.max(t,r))}function gn(r,t,s){const l=s-t,u=((r-t)%l+l)%l+t;return u===t?s:u}function Sr(r,t,s){if(!r.length)return s(null,[]);let l=r.length;const u=new Array(r.length);let m=null;r.forEach((g,x)=>{t(g,(w,E)=>{w&&(m=w),u[x]=E,0==--l&&s(m,u)})})}function nn(r){const t=[];for(const s in r)t.push(r[s]);return t}function Tt(r,...t){for(const s of t)for(const l in s)r[l]=s[l];return r}let Xi=1;function Ir(){return Xi++}function Kn(){return function r(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Mt(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function qs(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Xn(r,t){r.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function Qe(r,t){return-1!==r.indexOf(t,r.length-t.length)}function bi(r,t,s){const l={};for(const u in r)l[u]=t.call(s||this,r[u],u,r);return l}function ut(r,t,s){const l={};for(const u in r)t.call(s||this,r[u],u,r)&&(l[u]=r[u]);return l}function qt(r){return Array.isArray(r)?r.map(qt):"object"==typeof r&&r?bi(r,qt):r}const Ti={};function Qt(r){Ti[r]||("undefined"!=typeof console&&console.warn(r),Ti[r]=!0)}function ir(r,t,s){return(s.y-r.y)*(t.x-r.x)>(t.y-r.y)*(s.x-r.x)}function fr(r){let t=0;for(let s,l,u=0,m=r.length,g=m-1;u<m;g=u++)s=r[u],l=r[g],t+=(l.x-s.x)*(s.y+l.y);return t}function Ar(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ns(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,u,m)=>{const g=u||m;return t[l]=!g||g.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let Cr,pt,gi,zn=null;function Yn(r){if(null==zn){const t=r.navigator?r.navigator.userAgent:null;zn=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return zn}function Fn(r){try{const t=at[r];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(t){return!1}}const ri={now:()=>void 0!==gi?gi:at.performance.now(),setNow(r){gi=r},restoreNow(){gi=void 0},frame(r){const t=at.requestAnimationFrame(r);return{cancel:()=>at.cancelAnimationFrame(t)}},getImageData(r,t=0){const s=at.document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return s.width=r.width,s.height=r.height,l.drawImage(r,0,0,r.width,r.height),l.getImageData(-t,-t,r.width+2*t,r.height+2*t)},resolveURL:r=>(Cr||(Cr=at.document.createElement("a")),Cr.href=r,Cr.href),get devicePixelRatio(){return at.devicePixelRatio},get prefersReducedMotion(){return!!at.matchMedia&&(null==pt&&(pt=at.matchMedia("(prefers-reduced-motion: reduce)")),pt.matches)}};let kr;const Et={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==kr){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{kr=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):r}catch(t){kr=r}}return kr},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Yi={supported:!1,testSupport:function(r){!At&&zi&&(Li?Wt(r):rr=r)}};let rr,zi,At=!1,Li=!1;function Wt(r){const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,zi),r.isContextLost())return;Yi.supported=!0}catch(s){}r.deleteTexture(t),At=!0}at.document&&(zi=at.document.createElement("img"),zi.onload=function(){rr&&Wt(rr),rr=null,Li=!0},zi.onerror=function(){At=!0,rr=null},zi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const yn="01",Dt="NO_ACCESS_TOKEN";function rn(r){return 0===r.indexOf("mapbox:")}function Mr(r){return Et.API_URL_REGEX.test(r)}const sr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function un(r){const t=r.match(sr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Vr(r){const t=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${t}`}function Ei(r){if(!r)return null;const t=r.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(at.atob(t[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class is{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Ei(Et.ACCESS_TOKEN);let l="";return l=s&&s.u?at.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(u,m)=>String.fromCharCode(Number("0x"+m)))):Et.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const t=Fn("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(t)try{const u=at.localStorage.getItem(s);u&&(this.eventData=JSON.parse(u));const m=at.localStorage.getItem(l);m&&(this.anonId=m)}catch(u){Qt("Unable to read from LocalStorage")}}saveEventData(){const t=Fn("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(t)try{at.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&at.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(u){Qt("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,l,u){if(!Et.EVENTS_URL)return;const m=un(Et.EVENTS_URL);m.params.push(`access_token=${u||Et.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.4.1",skuId:yn,userId:this.anonId},x=s?Tt(g,s):g,w={url:Vr(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=D(w,E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(u)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const Ri=new class extends is{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,t){Et.EVENTS_URL&&Et.ACCESS_TOKEN&&Array.isArray(r)&&r.some(s=>rn(s)||Mr(s))&&this.queueRequest(Date.now(),t)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ei(Et.ACCESS_TOKEN),s=t?t.u:Et.ACCESS_TOKEN;let l=s!==this.eventData.tokenU;qs(this.anonId)||(this.anonId=Kn(),l=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),g=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||m.getDate()!==g.getDate()}else l=!0;if(!l)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=u,this.eventData.tokenU=s)},r)}},ho=Ri.postTurnstileEvent.bind(Ri),or=new class extends is{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,t,s,l){this.skuToken=t,this.errorCb=l,Et.EVENTS_URL&&(s||Et.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},s):this.errorCb(new Error(Dt)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),qs(this.anonId)||(this.anonId=Kn()),this.postEvent(s,{skuToken:this.skuToken},l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},r))}},Gs=or.postMapLoadEvent.bind(or),js=new class extends is{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,t,s,l){if(!Et.API_URL||!Et.SESSION_PATH)return;const u=un(Et.API_URL+Et.SESSION_PATH);u.params.push(`sku=${t||""}`),u.params.push(`access_token=${l||Et.ACCESS_TOKEN||""}`);const m={url:Vr(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=F(m,g=>{this.pendingRequest=null,s(g),this.saveEventData(),this.processRequests(l)})}getSessionAPI(r,t,s,l){this.skuToken=t,this.errorCb=l,Et.SESSION_PATH&&Et.API_URL&&(s||Et.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},s):this.errorCb(new Error(Dt)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},r)}},mr=js.getSessionAPI.bind(js),Bn=new Set,qr="mapbox-tiles";let si,Pr,Fi=500,Qi=50;function Gr(){at.caches&&!si&&(si=at.caches.open(qr))}function rs(r){const t=r.indexOf("?");return t<0?r:r.slice(0,t)}let Si=1/0;const ss={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ss);class $s extends Error{constructor(t,s,l){401===s&&Mr(l)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Dr=Ar()?()=>self.worker&&self.worker.referrer:()=>("blob:"===at.location.protocol?at.parent:at).location.href,H=function(r,t){if(!(/^file:/.test(s=r.url)||/^file:/.test(Dr())&&!/^\w+:/.test(s))){if(at.fetch&&at.Request&&at.AbortController&&at.Request.prototype.hasOwnProperty("signal"))return function(l,u){const m=new at.AbortController,g=new at.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Dr(),signal:m.signal});let x=!1,w=!1;const E=(I=g.url).indexOf("sku=")>0&&Mr(I);var I;"json"===l.type&&g.headers.set("Accept","application/json");const z=(B,j,X)=>{if(w)return;if(B&&"SecurityError"!==B.message&&Qt(B),j&&X)return R(j);const ie=Date.now();at.fetch(g).then(he=>{if(he.ok){const ye=E?he.clone():null;return R(he,ye,ie)}return u(new $s(he.statusText,he.status,l.url))}).catch(he=>{20!==he.code&&u(new Error(he.message))})},R=(B,j,X)=>{("arrayBuffer"===l.type?B.arrayBuffer():"json"===l.type?B.json():B.text()).then(ie=>{w||(j&&X&&function(he,ye,_e){if(Gr(),!si)return;const ve={status:ye.status,statusText:ye.statusText,headers:new at.Headers};ye.headers.forEach((xe,Oe)=>ve.headers.set(Oe,xe));const we=ns(ye.headers.get("Cache-Control")||"");we["no-store"]||(we["max-age"]&&ve.headers.set("Expires",new Date(_e+1e3*we["max-age"]).toUTCString()),new Date(ve.headers.get("Expires")).getTime()-_e<42e4||function(xe,Oe){if(void 0===Pr)try{new Response(new ReadableStream),Pr=!0}catch(qe){Pr=!1}Pr?Oe(xe.body):xe.blob().then(Oe)}(ye,xe=>{const Oe=new at.Response(xe,ve);Gr(),si&&si.then(qe=>qe.put(rs(he.url),Oe)).catch(qe=>Qt(qe.message))}))}(g,j,X),x=!0,u(null,ie,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(ie=>{w||u(new Error(ie.message))})};return E?function(B,j){if(Gr(),!si)return j(null);const X=rs(B.url);si.then(ie=>{ie.match(X).then(he=>{const ye=function(_e){if(!_e)return!1;const ve=new Date(_e.headers.get("Expires")||0),we=ns(_e.headers.get("Cache-Control")||"");return ve>Date.now()&&!we["no-cache"]}(he);ie.delete(X),ye&&ie.put(X,he.clone()),j(null,he,ye)}).catch(j)}).catch(j)}(g,z):z(null,null),{cancel:()=>{w=!0,x||m.abort()}}}(r,t);if(Ar()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,t,void 0,!0)}var s;return function(l,u){const m=new at.XMLHttpRequest;m.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(m.responseType="arraybuffer");for(const g in l.headers)m.setRequestHeader(g,l.headers[g]);return"json"===l.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===l.credentials,m.onerror=()=>{u(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let g=m.response;if("json"===l.type)try{g=JSON.parse(m.response)}catch(x){return u(x)}u(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else u(new $s(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}}(r,t)},P=function(r,t){return H(Tt(r,{type:"arrayBuffer"}),t)},D=function(r,t){return H(Tt(r,{method:"POST"}),t)},F=function(r,t){return H(Tt(r,{method:"GET"}),t)};function G(r){const t=at.document.createElement("a");return t.href=r,t.protocol===at.document.location.protocol&&t.host===at.document.location.host}const Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let de,fe;de=[],fe=0;const oe=function(r,t){if(Yi.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),fe>=Et.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:r,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return de.push(m),m}fe++;let s=!1;const l=()=>{if(!s)for(s=!0,fe--;de.length&&fe<Et.MAX_PARALLEL_IMAGE_REQUESTS;){const m=de.shift(),{requestParameters:g,callback:x,cancelled:w}=m;w||(m.cancel=oe(g,x).cancel)}},u=P(r,(m,g,x,w)=>{l(),m?t(m):g&&(at.createImageBitmap?function(E,I){const z=new at.Blob([new Uint8Array(E)],{type:"image/png"});at.createImageBitmap(z).then(R=>{I(null,R)}).catch(R=>{I(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,I)=>t(E,I,x,w)):function(E,I){const z=new at.Image,R=at.URL;z.onload=()=>{I(null,z),R.revokeObjectURL(z.src),z.onload=null,at.requestAnimationFrame(()=>{z.src=Z})},z.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new at.Blob([new Uint8Array(E)],{type:"image/png"});z.src=E.byteLength?R.createObjectURL(B):Z}(g,(E,I)=>t(E,I,x,w)))});return{cancel:()=>{u.cancel(),l()}}};function ge(r,t,s){s[r]&&-1!==s[r].indexOf(t)||(s[r]=s[r]||[],s[r].push(t))}function Ie(r,t,s){if(s&&s[r]){const l=s[r].indexOf(t);-1!==l&&s[r].splice(l,1)}}class Ge{constructor(t,s={}){Tt(this,s),this.type=t}}class Te extends Ge{constructor(t,s={}){super("error",Tt({error:t},s))}}class it{on(t,s){return this._listeners=this._listeners||{},ge(t,s,this._listeners),this}off(t,s){return Ie(t,s,this._listeners),Ie(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},ge(t,s,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,s){"string"==typeof t&&(t=new Ge(t,s||{}));const l=t.type;if(this.listens(l)){t.target=this;const u=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of u)x.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of m)Ie(l,x,this._oneTimeListeners),x.call(this,t);const g=this._eventedParent;g&&(Tt(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Te&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class be{constructor(t,s,l,u){this.message=(t?`${t}: `:"")+l,u&&(this.identifier=u),null!=s&&s.__line__&&(this.line=s.__line__)}}function mt(r){const t=r.value;return t?[new be(r.key,t,"constants have been deprecated as of v8")]:[]}function Ct(r,...t){for(const s of t)for(const l in s)r[l]=s[l];return r}function vt(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Yt(r){if(Array.isArray(r))return r.map(Yt);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const s in r)t[s]=Yt(r[s]);return t}return vt(r)}class Ot extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class sn{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[l,u]of s)this.bindings[l]=u}concat(t){return new sn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const zr={kind:"null"},je={kind:"number"},lt={kind:"string"},St={kind:"boolean"},gr={kind:"color"},Ii={kind:"object"},zt={kind:"value"},xa={kind:"collator"},wa={kind:"formatted"},Go={kind:"resolvedImage"};function Bi(r,t){return{kind:"array",itemType:r,N:t}}function pn(r){if("array"===r.kind){const t=pn(r.itemType);return"number"==typeof r.N?`array<${t}, ${r.N}>`:"value"===r.itemType.kind?"array":`array<${t}>`}return r.kind}const Fl=[zr,je,lt,St,gr,wa,Ii,Bi(zt),Go];function os(r,t){if("error"===t.kind)return null;if("array"===r.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!os(r.itemType,t.itemType))&&("number"!=typeof r.N||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if("value"===r.kind)for(const s of Fl)if(!os(s,t))return null}return`Expected ${pn(r)} but found ${pn(t)} instead.`}function tl(r,t){return t.some(s=>s.kind===r.kind)}function jr(r,t){return t.some(s=>"null"===s?null===r:"array"===s?Array.isArray(r):"object"===s?r&&!Array.isArray(r)&&"object"==typeof r:s===typeof r)}function po(r){var t={exports:{}};return r(t,t.exports),t.exports}var yi=po(function(r,t){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(x){return(x=Math.round(x))<0?0:x>255?255:x}function u(x){return l("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function m(x){return(w="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:w>1?1:w;var w}function g(x,w,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?x+(w-x)*E*6:2*E<1?w:3*E<2?x+(w-x)*(2/3-E)*6:x}try{t.parseCSSColor=function(x){var w,E=x.replace(/ /g,"").toLowerCase();if(E in s)return s[E].slice();if("#"===E[0])return 4===E.length?(w=parseInt(E.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:7===E.length&&(w=parseInt(E.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var I=E.indexOf("("),z=E.indexOf(")");if(-1!==I&&z+1===E.length){var R=E.substr(0,I),B=E.substr(I+1,z-(I+1)).split(","),j=1;switch(R){case"rgba":if(4!==B.length)return null;j=m(B.pop());case"rgb":return 3!==B.length?null:[u(B[0]),u(B[1]),u(B[2]),j];case"hsla":if(4!==B.length)return null;j=m(B.pop());case"hsl":if(3!==B.length)return null;var X=(parseFloat(B[0])%360+360)%360/360,ie=m(B[1]),he=m(B[2]),ye=he<=.5?he*(ie+1):he+ie-he*ie,_e=2*he-ye;return[l(255*g(_e,ye,X+1/3)),l(255*g(_e,ye,X)),l(255*g(_e,ye,X-1/3)),j];default:return null}}return null}}catch(x){}});class $t{constructor(t,s,l,u=1){this.r=t,this.g=s,this.b=l,this.a=u}static parse(t){if(!t)return;if(t instanceof $t)return t;if("string"!=typeof t)return;const s=yi.parseCSSColor(t);return s?new $t(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[t,s,l,u]=this.toArray();return`rgba(${Math.round(t)},${Math.round(s)},${Math.round(l)},${u})`}toArray(){const{r:t,g:s,b:l,a:u}=this;return 0===u?[0,0,0,0]:[255*t/u,255*s/u,255*l/u,u]}}$t.black=new $t(0,0,0,1),$t.white=new $t(1,1,1,1),$t.transparent=new $t(0,0,0,0),$t.red=new $t(1,0,0,1),$t.blue=new $t(0,0,1,1);class ba{constructor(t,s,l){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class xt{constructor(t,s,l,u,m){this.text=t,this.image=s,this.scale=l,this.fontStack=u,this.textColor=m}}class oi{constructor(t){this.sections=t}static fromString(t){return new oi([new xt(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof oi?t:oi.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const s of this.sections){if(s.image){t.push(["image",s.image.name]);continue}t.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toArray())),t.push(l)}return t}}class yr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new yr({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Bl(r,t,s,l){return"number"==typeof r&&r>=0&&r<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[r,t,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[r,t,s,l]:[r,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function jo(r){if(null===r||"string"==typeof r||"boolean"==typeof r||"number"==typeof r||r instanceof $t||r instanceof ba||r instanceof oi||r instanceof yr)return!0;if(Array.isArray(r)){for(const t of r)if(!jo(t))return!1;return!0}if("object"==typeof r){for(const t in r)if(!jo(r[t]))return!1;return!0}return!1}function Tn(r){if(null===r)return zr;if("string"==typeof r)return lt;if("boolean"==typeof r)return St;if("number"==typeof r)return je;if(r instanceof $t)return gr;if(r instanceof ba)return xa;if(r instanceof oi)return wa;if(r instanceof yr)return Go;if(Array.isArray(r)){const t=r.length;let s;for(const l of r){const u=Tn(l);if(s){if(s===u)continue;s=zt;break}s=u}return Bi(s||zt,t)}return Ii}function fo(r){const t=typeof r;return null===r?"":"string"===t||"number"===t||"boolean"===t?String(r):r instanceof $t||r instanceof oi||r instanceof yr?r.toString():JSON.stringify(r)}class mo{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(2!==t.length)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!jo(t[1]))return s.error("invalid value");const l=t[1];let u=Tn(l);const m=s.expectedType;return"array"!==u.kind||0!==u.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(u=m),new mo(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof $t?["rgba"].concat(this.value.toArray()):this.value instanceof oi?this.value.serialize():this.value}}class En{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const nl={string:lt,number:je,boolean:St,object:Ii};class _r{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let l,u=1;const m=t[0];if("array"===m){let x,w;if(t.length>2){const E=t[1];if("string"!=typeof E||!(E in nl)||"object"===E)return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=nl[E],u++}else x=zt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=t[2],u++}l=Bi(x,w)}else l=nl[m];const g=[];for(;u<t.length;u++){const x=s.parse(t[u],u,zt);if(!x)return null;g.push(x)}return new _r(l,g)}evaluate(t){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(t);if(!os(this.type,Tn(l)))return l;if(s===this.args.length-1)throw new En(`Expected value to be of type ${pn(this.type)}, but found ${pn(Tn(l))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,s=[t.kind];if("array"===t.kind){const l=t.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){s.push(l.kind);const u=t.N;("number"==typeof u||this.args.length>1)&&s.push(u)}}return s.concat(this.args.map(l=>l.serialize()))}}class $r{constructor(t){this.type=wa,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&"object"==typeof l)return s.error("First argument must be an image or text section.");const u=[];let m=!1;for(let g=1;g<=t.length-1;++g){const x=t[g];if(m&&"object"==typeof x&&!Array.isArray(x)){m=!1;let w=null;if(x["font-scale"]&&(w=s.parse(x["font-scale"],1,je),!w))return null;let E=null;if(x["text-font"]&&(E=s.parse(x["text-font"],1,Bi(lt)),!E))return null;let I=null;if(x["text-color"]&&(I=s.parse(x["text-color"],1,gr),!I))return null;const z=u[u.length-1];z.scale=w,z.font=E,z.textColor=I}else{const w=s.parse(t[g],1,zt);if(!w)return null;const E=w.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new $r(u)}evaluate(t){return new oi(this.sections.map(s=>{const l=s.content.evaluate(t);return Tn(l)===Go?new xt("",l,null,null,null):new xt(fo(l),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const s of this.sections){t.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),t.push(l)}return t}}class Ta{constructor(t){this.type=Go,this.input=t}static parse(t,s){if(2!==t.length)return s.error("Expected two arguments.");const l=s.parse(t[1],1,lt);return l?new Ta(l):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),l=yr.fromString(s);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(s)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const vs={"to-boolean":St,"to-color":gr,"to-number":je,"to-string":lt};class xs{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[0];if(("to-boolean"===l||"to-string"===l)&&2!==t.length)return s.error("Expected one argument.");const u=vs[l],m=[];for(let g=1;g<t.length;g++){const x=s.parse(t[g],g,zt);if(!x)return null;m.push(x)}return new xs(u,m)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let s,l;for(const u of this.args){if(s=u.evaluate(t),l=null,s instanceof $t)return s;if("string"==typeof s){const m=t.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Bl(s[0],s[1],s[2],s[3]),!l))return new $t(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new En(l||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const l of this.args){if(s=l.evaluate(t),null===s)return 0;const u=Number(s);if(!isNaN(u))return u}throw new En(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?oi.fromString(fo(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?yr.fromString(fo(this.args[0].evaluate(t))):fo(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new $r([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ta(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}const Ea=["Unknown","Point","LineString","Polygon"];class il{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ea[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=$t.parse(t)),s}}class on{constructor(t,s,l,u){this.name=t,this.type=s,this._evaluate=l,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){const l=t[0],u=on.definitions[l];if(!u)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=g.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,I]of x){w=new Ts(s.registry,s.path,null,s.scope);const z=[];let R=!1;for(let B=1;B<t.length;B++){const j=t[B],X=Array.isArray(E)?E[B-1]:E.type,ie=w.parse(j,1+z.length,X);if(!ie){R=!0;break}z.push(ie)}if(!R)if(Array.isArray(E)&&E.length!==z.length)w.error(`Expected ${E.length} arguments, but found ${z.length} instead.`);else{for(let B=0;B<z.length;B++){const j=Array.isArray(E)?E[B]:E.type,X=z[B];w.concat(B+1).checkSubtype(j,X.type)}if(0===w.errors.length)return new on(l,m,I,z)}}if(1===x.length)s.errors.push(...w.errors);else{const E=(x.length?x:g).map(([z])=>{return R=z,Array.isArray(R)?`(${R.map(pn).join(", ")})`:`(${pn(R.type)}...)`;var R}).join(" | "),I=[];for(let z=1;z<t.length;z++){const R=s.parse(t[z],1+I.length);if(!R)return null;I.push(pn(R.type))}s.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(t,s){on.definitions=s;for(const l in s)t[l]=on}}class Sa{constructor(t,s,l){this.type=xa,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(2!==t.length)return s.error("Expected one argument.");const l=t[1];if("object"!=typeof l||Array.isArray(l))return s.error("Collator options argument must be an object.");const u=s.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,St);if(!u)return null;const m=s.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,St);if(!m)return null;let g=null;return l.locale&&(g=s.parse(l.locale,1,lt),!g)?null:new Sa(u,m,g)}evaluate(t){return new ba(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const ar=8192;function $o(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Ia(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Ol(r,t){const s=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(s*u*ar),Math.round(l*u*ar)]}function vc(r,t,s){const l=r[0]-t[0],u=r[1]-t[1],m=r[0]-s[0],g=r[1]-s[1];return l*g-m*u==0&&l*m<=0&&u*g<=0}function Aa(r,t){let s=!1;for(let g=0,x=t.length;g<x;g++){const w=t[g];for(let E=0,I=w.length;E<I-1;E++){if(vc(r,w[E],w[E+1]))return!1;(u=w[E])[1]>(l=r)[1]!=(m=w[E+1])[1]>l[1]&&l[0]<(m[0]-u[0])*(l[1]-u[1])/(m[1]-u[1])+u[0]&&(s=!s)}}var l,u,m;return s}function ws(r,t){for(let s=0;s<t.length;s++)if(Aa(r,t[s]))return!0;return!1}function rl(r,t,s,l){const u=l[0]-s[0],m=l[1]-s[1],g=(r[0]-s[0])*m-u*(r[1]-s[1]),x=(t[0]-s[0])*m-u*(t[1]-s[1]);return g>0&&x<0||g<0&&x>0}function Nl(r,t,s){for(const E of s)for(let I=0;I<E.length-1;++I)if((x=[(g=E[I+1])[0]-(m=E[I])[0],g[1]-m[1]])[0]*(w=[(u=t)[0]-(l=r)[0],u[1]-l[1]])[1]-x[1]*w[0]!=0&&rl(l,u,m,g)&&rl(m,g,l,u))return!0;var l,u,m,g,x,w;return!1}function sl(r,t){for(let s=0;s<r.length;++s)if(!Aa(r[s],t))return!1;for(let s=0;s<r.length-1;++s)if(Nl(r[s],r[s+1],t))return!1;return!0}function ol(r,t){for(let s=0;s<t.length;s++)if(sl(r,t[s]))return!0;return!1}function Oi(r,t,s){const l=[];for(let u=0;u<r.length;u++){const m=[];for(let g=0;g<r[u].length;g++){const x=Ol(r[u][g],s);$o(t,x),m.push(x)}l.push(m)}return l}function al(r,t,s){const l=[];for(let u=0;u<r.length;u++){const m=Oi(r[u],t,s);l.push(m)}return l}function Ul(r,t,s,l){if(r[0]<s[0]||r[0]>s[2]){const u=.5*l;let m=r[0]-s[0]>u?-l:s[0]-r[0]>u?l:0;0===m&&(m=r[0]-s[2]>u?-l:s[2]-r[0]>u?l:0),r[0]+=m}$o(t,r)}function go(r,t,s,l){const u=Math.pow(2,l.z)*ar,m=[l.x*ar,l.y*ar],g=[];for(const x of r)for(const w of x){const E=[w.x+m[0],w.y+m[1]];Ul(E,t,s,u),g.push(E)}return g}function bs(r,t,s,l){const u=Math.pow(2,l.z)*ar,m=[l.x*ar,l.y*ar],g=[];for(const w of r){const E=[];for(const I of w){const z=[I.x+m[0],I.y+m[1]];$o(t,z),E.push(z)}g.push(E)}if(t[2]-t[0]<=u/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of g)for(const E of w)Ul(E,t,s,u)}var x;return g}class as{constructor(t,s){this.type=St,this.geojson=t,this.geometries=s}static parse(t,s){if(2!==t.length)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(jo(t[1])){const l=t[1];if("FeatureCollection"===l.type)for(let u=0;u<l.features.length;++u){const m=l.features[u].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new as(l,l.features[u].geometry)}else if("Feature"===l.type){const u=l.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new as(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new as(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(s,l){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if("Polygon"===l.type){const x=Oi(l.coordinates,m,g),w=go(s.geometry(),u,m,g);if(!Ia(u,m))return!1;for(const E of w)if(!Aa(E,x))return!1}if("MultiPolygon"===l.type){const x=al(l.coordinates,m,g),w=go(s.geometry(),u,m,g);if(!Ia(u,m))return!1;for(const E of w)if(!ws(E,x))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(s,l){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if("Polygon"===l.type){const x=Oi(l.coordinates,m,g),w=bs(s.geometry(),u,m,g);if(!Ia(u,m))return!1;for(const E of w)if(!sl(E,x))return!1}if("MultiPolygon"===l.type){const x=al(l.coordinates,m,g),w=bs(s.geometry(),u,m,g);if(!Ia(u,m))return!1;for(const E of w)if(!ol(E,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Zo(r){if(r instanceof on&&("get"===r.name&&1===r.args.length||"feature-state"===r.name||"has"===r.name&&1===r.args.length||"properties"===r.name||"geometry-type"===r.name||"id"===r.name||/^filter-/.test(r.name))||r instanceof as)return!1;let t=!0;return r.eachChild(s=>{t&&!Zo(s)&&(t=!1)}),t}function Wo(r){if(r instanceof on&&"feature-state"===r.name)return!1;let t=!0;return r.eachChild(s=>{t&&!Wo(s)&&(t=!1)}),t}function Gt(r,t){if(r instanceof on&&t.indexOf(r.name)>=0)return!1;let s=!0;return r.eachChild(l=>{s&&!Gt(l,t)&&(s=!1)}),s}class Ho{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(2!==t.length||"string"!=typeof t[1])return s.error("'var' expression requires exactly one string literal argument.");const l=t[1];return s.scope.has(l)?new Ho(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ts{constructor(t,s=[],l,u=new sn,m=[]){this.registry=t,this.path=s,this.key=s.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=m,this.expectedType=l}parse(t,s,l,u,m={}){return s?this.concat(s,l,u)._parse(t,m):this._parse(t,m)}_parse(t,s){function l(u,m,g){return"assert"===g?new _r(m,[u]):"coerce"===g?new xs(m,[u]):u}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[u];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,w=g.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==w.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(x,w))return null}else g=l(g,x,s.typeAnnotation||"coerce");else g=l(g,x,s.typeAnnotation||"assert")}if(!(g instanceof mo)&&"resolvedImage"!==g.type.kind&&ll(g)){const x=new il;try{g=new mo(g.type,g.evaluate(x))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,l){const u="number"==typeof t?this.path.concat(t):this.path,m=l?this.scope.concat(l):this.scope;return new Ts(this.registry,u,s||null,m,this.errors)}error(t,...s){const l=`${this.key}${s.map(u=>`[${u}]`).join("")}`;this.errors.push(new Ot(l,t))}checkSubtype(t,s){const l=os(t,s);return l&&this.error(l),l}}function ll(r){if(r instanceof Ho)return ll(r.boundExpression);if(r instanceof on&&"error"===r.name||r instanceof Sa||r instanceof as)return!1;const t=r instanceof xs||r instanceof _r;let s=!0;return r.eachChild(l=>{s=t?s&&ll(l):s&&l instanceof mo}),!!s&&Zo(r)&&Gt(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function Zr(r,t){const s=r.length-1;let l,u,m=0,g=s,x=0;for(;m<=g;)if(x=Math.floor((m+g)/2),l=r[x],u=r[x+1],l<=t){if(x===s||t<u)return x;m=x+1}else{if(!(l>t))throw new En("Input is not a number.");g=x-1}return 0}class Es{constructor(t,s,l){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[u,m]of l)this.labels.push(u),this.outputs.push(m)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(t[1],1,je);if(!l)return null;const u=[];let m=null;s.expectedType&&"value"!==s.expectedType.kind&&(m=s.expectedType);for(let g=1;g<t.length;g+=2){const x=1===g?-1/0:t[g],w=t[g+1],E=g,I=g+1;if("number"!=typeof x)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const z=s.parse(w,I,m);if(!z)return null;m=m||z.type,u.push([x,z])}return new Es(m,l,u)}evaluate(t){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(t);const u=this.input.evaluate(t);if(u<=s[0])return l[0].evaluate(t);const m=s.length;return u>=s[m-1]?l[m-1].evaluate(t):l[Zr(s,u)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}function Nt(r,t,s){return r*(1-s)+t*s}var yo=Object.freeze({__proto__:null,number:Nt,color:function(r,t,s){return new $t(Nt(r.r,t.r,s),Nt(r.g,t.g,s),Nt(r.b,t.b,s),Nt(r.a,t.a,s))},array:function(r,t,s){return r.map((l,u)=>Nt(l,t[u],s))}});const Zs=4/29,_o=6/29,Ss=3*_o*_o,xc=Math.PI/180,wc=180/Math.PI;function Is(r){return r>.008856451679035631?Math.pow(r,1/3):r/Ss+Zs}function Lr(r){return r>_o?r*r*r:Ss*(r-Zs)}function vo(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function xo(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function wo(r){const t=xo(r.r),s=xo(r.g),l=xo(r.b),u=Is((.4124564*t+.3575761*s+.1804375*l)/.95047),m=Is((.2126729*t+.7151522*s+.072175*l)/1);return{l:116*m-16,a:500*(u-m),b:200*(m-Is((.0193339*t+.119192*s+.9503041*l)/1.08883)),alpha:r.a}}function Vl(r){let t=(r.l+16)/116,s=isNaN(r.a)?t:t+r.a/500,l=isNaN(r.b)?t:t-r.b/200;return t=1*Lr(t),s=.95047*Lr(s),l=1.08883*Lr(l),new $t(vo(3.2404542*s-1.5371385*t-.4985314*l),vo(-.969266*s+1.8760108*t+.041556*l),vo(.0556434*s-.2040259*t+1.0572252*l),r.alpha)}function Sn(r,t,s){const l=t-r;return r+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const As={forward:wo,reverse:Vl,interpolate:function(r,t,s){return{l:Nt(r.l,t.l,s),a:Nt(r.a,t.a,s),b:Nt(r.b,t.b,s),alpha:Nt(r.alpha,t.alpha,s)}}},Xo={forward:function(r){const{l:t,a:s,b:l}=wo(r),u=Math.atan2(l,s)*wc;return{h:u<0?u+360:u,c:Math.sqrt(s*s+l*l),l:t,alpha:r.a}},reverse:function(r){const t=r.h*xc,s=r.c;return Vl({l:r.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:r.alpha})},interpolate:function(r,t,s){return{h:Sn(r.h,t.h,s),c:Nt(r.c,t.c,s),l:Nt(r.l,t.l,s),alpha:Nt(r.alpha,t.alpha,s)}}};var bc=Object.freeze({__proto__:null,lab:As,hcl:Xo});class Ai{constructor(t,s,l,u,m){this.type=t,this.operator=s,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[g,x]of m)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(t,s,l,u){let m=0;if("exponential"===t.name)m=bo(s,t.base,l,u);else if("linear"===t.name)m=bo(s,1,l,u);else if("cubic-bezier"===t.name){const g=t.controlPoints;m=new Dn(g[0],g[1],g[2],g[3]).solve(bo(s,1,l,u))}return m}static parse(t,s){let[l,u,m,...g]=t;if(!Array.isArray(u)||0===u.length)return s.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const E=u[1];if("number"!=typeof E)return s.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if("cubic-bezier"!==u[0])return s.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(4!==E.length||E.some(I=>"number"!=typeof I||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,je),!m)return null;const x=[];let w=null;"interpolate-hcl"===l||"interpolate-lab"===l?w=gr:s.expectedType&&"value"!==s.expectedType.kind&&(w=s.expectedType);for(let E=0;E<g.length;E+=2){const I=g[E],z=g[E+1],R=E+3,B=E+4;if("number"!=typeof I)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(x.length&&x[x.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const j=s.parse(z,B,w);if(!j)return null;w=w||j.type,x.push([I,j])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Ai(w,l,u,m,x):s.error(`Type ${pn(w)} is not interpolatable.`)}evaluate(t){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(t);const u=this.input.evaluate(t);if(u<=s[0])return l[0].evaluate(t);const m=s.length;if(u>=s[m-1])return l[m-1].evaluate(t);const g=Zr(s,u),x=Ai.interpolationFactor(this.interpolation,u,s[g],s[g+1]),w=l[g].evaluate(t),E=l[g+1].evaluate(t);return"interpolate"===this.operator?yo[this.type.kind.toLowerCase()](w,E,x):"interpolate-hcl"===this.operator?Xo.reverse(Xo.interpolate(Xo.forward(w),Xo.forward(E),x)):As.reverse(As.interpolate(As.forward(w),As.forward(E),x))}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,t,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function bo(r,t,s,l){const u=l-s,m=r-s;return 0===u?0:1===t?m/u:(Math.pow(t,m)-1)/(Math.pow(t,u)-1)}class cl{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let l=null;const u=s.expectedType;u&&"value"!==u.kind&&(l=u);const m=[];for(const x of t.slice(1)){const w=s.parse(x,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,m.push(w)}const g=u&&m.some(x=>os(u,x.type));return new cl(g?zt:l,m)}evaluate(t){let s,l=null,u=0;for(const m of this.args)if(u++,l=m.evaluate(t),l&&l instanceof yr&&!l.available&&(s||(s=l.name),l=null,u===this.args.length&&(l=s)),null!==l)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class Yo{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if("string"!=typeof g)return s.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=s.parse(t[m+1],m+1);if(!x)return null;l.push([g,x])}const u=s.parse(t[t.length-1],t.length-1,s.expectedType,l);return u?new Yo(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[s,l]of this.bindings)t.push(s,l.serialize());return t.push(this.result.serialize()),t}}class ql{constructor(t,s,l){this.type=t,this.index=s,this.input=l}static parse(t,s){if(3!==t.length)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,je),u=s.parse(t[2],2,Bi(s.expectedType||zt));return l&&u?new ql(u.type.itemType,l,u):null}evaluate(t){const s=this.index.evaluate(t),l=this.input.evaluate(t);if(s<0)throw new En(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new En(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new En(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ka{constructor(t,s){this.type=St,this.needle=t,this.haystack=s}static parse(t,s){if(3!==t.length)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,zt),u=s.parse(t[2],2,zt);return l&&u?tl(l.type,[St,lt,je,zr,zt])?new ka(l,u):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${pn(l.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!jr(s,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${pn(Tn(s))} instead.`);if(!jr(l,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${pn(Tn(l))} instead.`);return l.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ul{constructor(t,s,l){this.type=je,this.needle=t,this.haystack=s,this.fromIndex=l}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,zt),u=s.parse(t[2],2,zt);if(!l||!u)return null;if(!tl(l.type,[St,lt,je,zr,zt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${pn(l.type)} instead`);if(4===t.length){const m=s.parse(t[3],3,je);return m?new ul(l,u,m):null}return new ul(l,u)}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!jr(s,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${pn(Tn(s))} instead.`);if(!jr(l,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${pn(Tn(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(t);return l.indexOf(s,u)}return l.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Cs{constructor(t,s,l,u,m,g){this.inputType=t,this.type=s,this.input=l,this.cases=u,this.outputs=m,this.otherwise=g}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let l,u;s.expectedType&&"value"!==s.expectedType.kind&&(u=s.expectedType);const m={},g=[];for(let E=2;E<t.length-1;E+=2){let I=t[E];const z=t[E+1];Array.isArray(I)||(I=[I]);const R=s.concat(E);if(0===I.length)return R.error("Expected at least one branch label.");for(const j of I){if("number"!=typeof j&&"string"!=typeof j)return R.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return R.error("Numeric branch labels must be integer values.");if(l){if(R.checkSubtype(l,Tn(j)))return null}else l=Tn(j);if(void 0!==m[String(j)])return R.error("Branch labels must be unique.");m[String(j)]=g.length}const B=s.parse(z,E,u);if(!B)return null;u=u||B.type,g.push(B)}const x=s.parse(t[1],1,zt);if(!x)return null;const w=s.parse(t[t.length-1],t.length-1,u);return w?"value"!==x.type.kind&&s.concat(1).checkSubtype(l,x.type)?null:new Cs(l,u,x,m,g,w):null}evaluate(t){const s=this.input.evaluate(t);return(Tn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],u={};for(const g of s){const x=u[this.cases[g]];void 0===x?(u[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[x][1].push(g)}const m=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,x]of l)t.push(1===x.length?m(x[0]):x.map(m)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}class Ws{constructor(t,s,l){this.type=t,this.branches=s,this.otherwise=l}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&"value"!==s.expectedType.kind&&(l=s.expectedType);const u=[];for(let g=1;g<t.length-1;g+=2){const x=s.parse(t[g],g,St);if(!x)return null;const w=s.parse(t[g+1],g+1,l);if(!w)return null;u.push([x,w]),l=l||w.type}const m=s.parse(t[t.length-1],t.length-1,l);return m?new Ws(l,u,m):null}evaluate(t){for(const[s,l]of this.branches)if(s.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,l]of this.branches)t(s),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class Rr{constructor(t,s,l,u){this.type=t,this.input=s,this.beginIndex=l,this.endIndex=u}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,zt),u=s.parse(t[2],2,je);if(!l||!u)return null;if(!tl(l.type,[Bi(zt),lt,zt]))return s.error(`Expected first argument to be of type array or string, but found ${pn(l.type)} instead`);if(4===t.length){const m=s.parse(t[3],3,je);return m?new Rr(l.type,l,u,m):null}return new Rr(l.type,l,u)}evaluate(t){const s=this.input.evaluate(t),l=this.beginIndex.evaluate(t);if(!jr(s,["string","array"]))throw new En(`Expected first argument to be of type array or string, but found ${pn(Tn(s))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(t);return s.slice(l,u)}return s.slice(l)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ma(r,t){return"=="===r||"!="===r?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Gl(r,t,s,l){return 0===l.compare(t,s)}function To(r,t,s){const l="=="!==r&&"!="!==r;return class yy{constructor(m,g,x){this.type=St,this.lhs=m,this.rhs=g,this.collator=x,this.hasUntypedArgument="value"===m.type.kind||"value"===g.type.kind}static parse(m,g){if(3!==m.length&&4!==m.length)return g.error("Expected two or three arguments.");const x=m[0];let w=g.parse(m[1],1,zt);if(!w)return null;if(!Ma(x,w.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${pn(w.type)}'.`);let E=g.parse(m[2],2,zt);if(!E)return null;if(!Ma(x,E.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${pn(E.type)}'.`);if(w.type.kind!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return g.error(`Cannot compare types '${pn(w.type)}' and '${pn(E.type)}'.`);l&&("value"===w.type.kind&&"value"!==E.type.kind?w=new _r(E.type,[w]):"value"!==w.type.kind&&"value"===E.type.kind&&(E=new _r(w.type,[E])));let I=null;if(4===m.length){if("string"!==w.type.kind&&"string"!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(m[3],3,xa),!I)return null}return new yy(w,E,I)}evaluate(m){const g=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const w=Tn(g),E=Tn(x);if(w.kind!==E.kind||"string"!==w.kind&&"number"!==w.kind)throw new En(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Tn(g),E=Tn(x);if("string"!==w.kind||"string"!==E.kind)return t(m,g,x)}return this.collator?s(m,g,x,this.collator.evaluate(m)):t(m,g,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[r];return this.eachChild(g=>{m.push(g.serialize())}),m}}}const Eo=To("==",function(r,t,s){return t===s},Gl),Tc=To("!=",function(r,t,s){return t!==s},function(r,t,s,l){return!Gl(0,t,s,l)}),ou=To("<",function(r,t,s){return t<s},function(r,t,s,l){return l.compare(t,s)<0}),Ec=To(">",function(r,t,s){return t>s},function(r,t,s,l){return l.compare(t,s)>0}),au=To("<=",function(r,t,s){return t<=s},function(r,t,s,l){return l.compare(t,s)<=0}),Sc=To(">=",function(r,t,s){return t>=s},function(r,t,s,l){return l.compare(t,s)>=0});class So{constructor(t,s,l,u,m){this.type=lt,this.number=t,this.locale=s,this.currency=l,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(t,s){if(3!==t.length)return s.error("Expected two arguments.");const l=s.parse(t[1],1,je);if(!l)return null;const u=t[2];if("object"!=typeof u||Array.isArray(u))return s.error("NumberFormat options argument must be an object.");let m=null;if(u.locale&&(m=s.parse(u.locale,1,lt),!m))return null;let g=null;if(u.currency&&(g=s.parse(u.currency,1,lt),!g))return null;let x=null;if(u["min-fraction-digits"]&&(x=s.parse(u["min-fraction-digits"],1,je),!x))return null;let w=null;return u["max-fraction-digits"]&&(w=s.parse(u["max-fraction-digits"],1,je),!w)?null:new So(l,m,g,x,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Qo{constructor(t){this.type=je,this.input=t}static parse(t,s){if(2!==t.length)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=s.parse(t[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?s.error(`Expected argument of type string or array, but found ${pn(l.type)} instead.`):new Qo(l):null}evaluate(t){const s=this.input.evaluate(t);if("string"==typeof s||Array.isArray(s))return s.length;throw new En(`Expected value to be of type string or array, but found ${pn(Tn(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}const ks={"==":Eo,"!=":Tc,">":Ec,"<":ou,">=":Sc,"<=":au,array:_r,at:ql,boolean:_r,case:Ws,coalesce:cl,collator:Sa,format:$r,image:Ta,in:ka,"index-of":ul,interpolate:Ai,"interpolate-hcl":Ai,"interpolate-lab":Ai,length:Qo,let:Yo,literal:mo,match:Cs,number:_r,"number-format":So,object:_r,slice:Rr,step:Es,string:_r,"to-boolean":xs,"to-color":xs,"to-number":xs,"to-string":xs,var:Ho,within:as};function Pa(r,[t,s,l,u]){t=t.evaluate(r),s=s.evaluate(r),l=l.evaluate(r);const m=u?u.evaluate(r):1,g=Bl(t,s,l,m);if(g)throw new En(g);return new $t(t/255*m,s/255*m,l/255*m,m)}function hl(r,t){return r in t}function Da(r,t){const s=t[r];return void 0===s?null:s}function Hs(r){return{type:r}}function jl(r){return{result:"success",value:r}}function Ks(r){return{result:"error",value:r}}function Wr(r){return"data-driven"===r["property-type"]||"cross-faded-data-driven"===r["property-type"]}function Xs(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Io(r){return!!r.expression&&r.expression.interpolated}function Zt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":null===r?"null":typeof r}function za(r){return"object"==typeof r&&null!==r&&!Array.isArray(r)}function Ao(r){return r}function Co(r,t){const s="color"===t.type,l=r.stops&&"object"==typeof r.stops[0][0],u=l||!(l||void 0!==r.property),m=r.type||(Io(t)?"exponential":"interval");if(s&&((r=Ct({},r)).stops&&(r.stops=r.stops.map(E=>[E[0],$t.parse(E[1])])),r.default=$t.parse(r.default?r.default:t.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!bc[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let g,x,w;if("exponential"===m)g=Ic;else if("interval"===m)g=La;else if("categorical"===m){g=Vn,x=Object.create(null);for(const E of r.stops)x[E[0]]=E[1];w=typeof r.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);g=lu}if(l){const E={},I=[];for(let B=0;B<r.stops.length;B++){const j=r.stops[B],X=j[0].zoom;void 0===E[X]&&(E[X]={zoom:X,type:r.type,property:r.property,default:r.default,stops:[]},I.push(X)),E[X].stops.push([j[0].value,j[1]])}const z=[];for(const B of I)z.push([E[B].zoom,Co(E[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Ai.interpolationFactor.bind(void 0,R),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},j)=>Ic({stops:z,base:r.base},t,B).evaluate(B,j)}}if(u){const E="exponential"===m?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Ai.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(I=>I[0]),evaluate:({zoom:I})=>g(r,t,I,x,w)}}return{kind:"source",evaluate(E,I){const z=I&&I.properties?I.properties[r.property]:void 0;return void 0===z?Jo(r.default,t.default):g(r,t,z,x,w)}}}function Jo(r,t,s){return void 0!==r?r:void 0!==t?t:void 0!==s?s:void 0}function Vn(r,t,s,l,u){return Jo(typeof s===u?l[s]:void 0,r.default,t.default)}function La(r,t,s){if("number"!==Zt(s))return Jo(r.default,t.default);const l=r.stops.length;if(1===l||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[l-1][0])return r.stops[l-1][1];const u=Zr(r.stops.map(m=>m[0]),s);return r.stops[u][1]}function Ic(r,t,s){const l=void 0!==r.base?r.base:1;if("number"!==Zt(s))return Jo(r.default,t.default);const u=r.stops.length;if(1===u||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[u-1][0])return r.stops[u-1][1];const m=Zr(r.stops.map(I=>I[0]),s),g=function(I,z,R,B){const j=B-R,X=I-R;return 0===j?0:1===z?X/j:(Math.pow(z,X)-1)/(Math.pow(z,j)-1)}(s,l,r.stops[m][0],r.stops[m+1][0]),x=r.stops[m][1],w=r.stops[m+1][1];let E=yo[t.type]||Ao;if(r.colorSpace&&"rgb"!==r.colorSpace){const I=bc[r.colorSpace];E=(z,R)=>I.reverse(I.interpolate(I.forward(z),I.forward(R),g))}return"function"==typeof x.evaluate?{evaluate(...I){const z=x.evaluate.apply(void 0,I),R=w.evaluate.apply(void 0,I);if(void 0!==z&&void 0!==R)return E(z,R,g)}}:E(x,w,g)}function lu(r,t,s){return"color"===t.type?s=$t.parse(s):"formatted"===t.type?s=oi.fromString(s.toString()):"resolvedImage"===t.type?s=yr.fromString(s.toString()):Zt(s)===t.type||"enum"===t.type&&t.values[s]||(s=void 0),Jo(s,r.default,t.default)}on.register(ks,{error:[{kind:"error"},[lt],(r,[t])=>{throw new En(t.evaluate(r))}],typeof:[lt,[zt],(r,[t])=>pn(Tn(t.evaluate(r)))],"to-rgba":[Bi(je,4),[gr],(r,[t])=>t.evaluate(r).toArray()],rgb:[gr,[je,je,je],Pa],rgba:[gr,[je,je,je,je],Pa],has:{type:St,overloads:[[[lt],(r,[t])=>hl(t.evaluate(r),r.properties())],[[lt,Ii],(r,[t,s])=>hl(t.evaluate(r),s.evaluate(r))]]},get:{type:zt,overloads:[[[lt],(r,[t])=>Da(t.evaluate(r),r.properties())],[[lt,Ii],(r,[t,s])=>Da(t.evaluate(r),s.evaluate(r))]]},"feature-state":[zt,[lt],(r,[t])=>Da(t.evaluate(r),r.featureState||{})],properties:[Ii,[],r=>r.properties()],"geometry-type":[lt,[],r=>r.geometryType()],id:[zt,[],r=>r.id()],zoom:[je,[],r=>r.globals.zoom],"heatmap-density":[je,[],r=>r.globals.heatmapDensity||0],"line-progress":[je,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[je,[],r=>r.globals.skyRadialProgress||0],accumulated:[zt,[],r=>void 0===r.globals.accumulated?null:r.globals.accumulated],"+":[je,Hs(je),(r,t)=>{let s=0;for(const l of t)s+=l.evaluate(r);return s}],"*":[je,Hs(je),(r,t)=>{let s=1;for(const l of t)s*=l.evaluate(r);return s}],"-":{type:je,overloads:[[[je,je],(r,[t,s])=>t.evaluate(r)-s.evaluate(r)],[[je],(r,[t])=>-t.evaluate(r)]]},"/":[je,[je,je],(r,[t,s])=>t.evaluate(r)/s.evaluate(r)],"%":[je,[je,je],(r,[t,s])=>t.evaluate(r)%s.evaluate(r)],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(r,[t,s])=>Math.pow(t.evaluate(r),s.evaluate(r))],sqrt:[je,[je],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[je,[je],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[je,[je],(r,[t])=>Math.log(t.evaluate(r))],log2:[je,[je],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[je,[je],(r,[t])=>Math.sin(t.evaluate(r))],cos:[je,[je],(r,[t])=>Math.cos(t.evaluate(r))],tan:[je,[je],(r,[t])=>Math.tan(t.evaluate(r))],asin:[je,[je],(r,[t])=>Math.asin(t.evaluate(r))],acos:[je,[je],(r,[t])=>Math.acos(t.evaluate(r))],atan:[je,[je],(r,[t])=>Math.atan(t.evaluate(r))],min:[je,Hs(je),(r,t)=>Math.min(...t.map(s=>s.evaluate(r)))],max:[je,Hs(je),(r,t)=>Math.max(...t.map(s=>s.evaluate(r)))],abs:[je,[je],(r,[t])=>Math.abs(t.evaluate(r))],round:[je,[je],(r,[t])=>{const s=t.evaluate(r);return s<0?-Math.round(-s):Math.round(s)}],floor:[je,[je],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[je,[je],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[St,[lt,zt],(r,[t,s])=>r.properties()[t.value]===s.value],"filter-id-==":[St,[zt],(r,[t])=>r.id()===t.value],"filter-type-==":[St,[lt],(r,[t])=>r.geometryType()===t.value],"filter-<":[St,[lt,zt],(r,[t,s])=>{const l=r.properties()[t.value],u=s.value;return typeof l==typeof u&&l<u}],"filter-id-<":[St,[zt],(r,[t])=>{const s=r.id(),l=t.value;return typeof s==typeof l&&s<l}],"filter->":[St,[lt,zt],(r,[t,s])=>{const l=r.properties()[t.value],u=s.value;return typeof l==typeof u&&l>u}],"filter-id->":[St,[zt],(r,[t])=>{const s=r.id(),l=t.value;return typeof s==typeof l&&s>l}],"filter-<=":[St,[lt,zt],(r,[t,s])=>{const l=r.properties()[t.value],u=s.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[St,[zt],(r,[t])=>{const s=r.id(),l=t.value;return typeof s==typeof l&&s<=l}],"filter->=":[St,[lt,zt],(r,[t,s])=>{const l=r.properties()[t.value],u=s.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[St,[zt],(r,[t])=>{const s=r.id(),l=t.value;return typeof s==typeof l&&s>=l}],"filter-has":[St,[zt],(r,[t])=>t.value in r.properties()],"filter-has-id":[St,[],r=>null!==r.id()&&void 0!==r.id()],"filter-type-in":[St,[Bi(lt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[St,[Bi(zt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[St,[lt,Bi(zt)],(r,[t,s])=>s.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[St,[lt,Bi(zt)],(r,[t,s])=>function(l,u,m,g){for(;m<=g;){const x=m+g>>1;if(u[x]===l)return!0;u[x]>l?g=x-1:m=x+1}return!1}(r.properties()[t.value],s.value,0,s.value.length-1)],all:{type:St,overloads:[[[St,St],(r,[t,s])=>t.evaluate(r)&&s.evaluate(r)],[Hs(St),(r,t)=>{for(const s of t)if(!s.evaluate(r))return!1;return!0}]]},any:{type:St,overloads:[[[St,St],(r,[t,s])=>t.evaluate(r)||s.evaluate(r)],[Hs(St),(r,t)=>{for(const s of t)if(s.evaluate(r))return!0;return!1}]]},"!":[St,[St],(r,[t])=>!t.evaluate(r)],"is-supported-script":[St,[lt],(r,[t])=>{const s=r.globals&&r.globals.isSupportedScript;return!s||s(t.evaluate(r))}],upcase:[lt,[lt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[lt,[lt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[lt,Hs(zt),(r,t)=>t.map(s=>fo(s.evaluate(r))).join("")],"resolved-locale":[lt,[xa],(r,[t])=>t.evaluate(r).resolvedLocale()]});class $l{constructor(t,s){var l;this.expression=t,this._warningHistory={},this._evaluator=new il,this._defaultValue=s?"color"===(l=s).type&&za(l.default)?new $t(0,0,0,0):"color"===l.type?$t.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(t,s,l,u,m,g){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=u,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,s,l,u,m,g){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const x=this.expression.evaluate(this._evaluator);if(null==x||"number"==typeof x&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new En(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,"undefined"!=typeof console&&console.warn(x.message)),this._defaultValue}}}function Hr(r){return Array.isArray(r)&&r.length>0&&"string"==typeof r[0]&&r[0]in ks}function ea(r,t){const s=new Ts(ks,[],t?function(u){const m={color:gr,string:lt,number:je,enum:lt,boolean:St,formatted:wa,resolvedImage:Go};return"array"===u.type?Bi(m[u.value]||zt,u.length):m[u.type]}(t):void 0),l=s.parse(r,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return l?jl(new $l(l,t)):Ks(s.errors)}class Fr{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent="constant"!==t&&!Wo(s.expression)}evaluateWithoutErrorHandling(t,s,l,u,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,u,m,g)}evaluate(t,s,l,u,m,g){return this._styleExpression.evaluate(t,s,l,u,m,g)}}class Ra{constructor(t,s,l,u){this.kind=t,this.zoomStops=l,this._styleExpression=s,this.isStateDependent="camera"!==t&&!Wo(s.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,s,l,u,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,u,m,g)}evaluate(t,s,l,u,m,g){return this._styleExpression.evaluate(t,s,l,u,m,g)}interpolationFactor(t,s,l){return this.interpolationType?Ai.interpolationFactor(this.interpolationType,t,s,l):0}}function Fa(r,t){if("error"===(r=ea(r,t)).result)return r;const s=r.value.expression,l=Zo(s);if(!l&&!Wr(t))return Ks([new Ot("","data expressions not supported")]);const u=Gt(s,["zoom"]);if(!u&&!Xs(t))return Ks([new Ot("","zoom expressions not supported")]);const m=Ni(s);return m||u?m instanceof Ot?Ks([m]):m instanceof Ai&&!Io(t)?Ks([new Ot("",'"interpolate" expressions cannot be used with this property')]):jl(m?new Ra(l?"camera":"composite",r.value,m.labels,m instanceof Ai?m.interpolation:void 0):new Fr(l?"constant":"source",r.value)):Ks([new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ko{constructor(t,s){this._parameters=t,this._specification=s,Ct(this,Co(this._parameters,this._specification))}static deserialize(t){return new ko(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ni(r){let t=null;if(r instanceof Yo)t=Ni(r.result);else if(r instanceof cl){for(const s of r.args)if(t=Ni(s),t)break}else(r instanceof Es||r instanceof Ai)&&r.input instanceof on&&"zoom"===r.input.name&&(t=r);return t instanceof Ot||r.eachChild(s=>{const l=Ni(s);l instanceof Ot?t=l:!t&&l?t=new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new Ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function vr(r){const t=r.key,s=r.value,l=r.valueSpec||{},u=r.objectElementValidators||{},m=r.style,g=r.styleSpec;let x=[];const w=Zt(s);if("object"!==w)return[new be(t,s,`object expected, ${w} found`)];for(const E in s){const I=E.split(".")[0],z=l[I]||l["*"];let R;if(u[I])R=u[I];else if(l[I])R=Ui;else if(u["*"])R=u["*"];else{if(!l["*"]){x.push(new be(t,s[E],`unknown property "${E}"`));continue}R=Ui}x=x.concat(R({key:(t&&`${t}.`)+E,value:s[E],valueSpec:z,style:m,styleSpec:g,object:s,objectKey:E},s))}for(const E in l)u[E]||l[E].required&&void 0===l[E].default&&void 0===s[E]&&x.push(new be(t,s,`missing required property "${E}"`));return x}function dl(r){const t=r.value,s=r.valueSpec,l=r.style,u=r.styleSpec,m=r.key,g=r.arrayElementValidator||Ui;if("array"!==Zt(t))return[new be(m,t,`array expected, ${Zt(t)} found`)];if(s.length&&t.length!==s.length)return[new be(m,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new be(m,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let x={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};u.$version<7&&(x.function=s.function),"object"===Zt(s.value)&&(x=s.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(g({array:t,arrayIndex:E,value:t[E],valueSpec:x,style:l,styleSpec:u,key:`${m}[${E}]`}));return w}function Ba(r){const t=r.key,s=r.value,l=r.valueSpec;let u=Zt(s);if("number"===u&&s!=s&&(u="NaN"),"number"!==u)return[new be(t,s,`number expected, ${u} found`)];if("minimum"in l){let m=l.minimum;if("array"===Zt(l.minimum)&&(m=l.minimum[r.arrayIndex]),s<m)return[new be(t,s,`${s} is less than the minimum value ${m}`)]}if("maximum"in l){let m=l.maximum;if("array"===Zt(l.maximum)&&(m=l.maximum[r.arrayIndex]),s>m)return[new be(t,s,`${s} is greater than the maximum value ${m}`)]}return[]}function Ys(r){const t=r.valueSpec,s=vt(r.value.type);let l,u,m,g={};const x="categorical"!==s&&void 0===r.value.property,w=!x,E="array"===Zt(r.value.stops)&&"array"===Zt(r.value.stops[0])&&"object"===Zt(r.value.stops[0][0]),I=vr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(B){if("identity"===s)return[new be(B.key,B.value,'identity function may not have a "stops" property')];let j=[];const X=B.value;return j=j.concat(dl({key:B.key,value:X,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:z})),"array"===Zt(X)&&0===X.length&&j.push(new be(B.key,X,"array must have at least one stop")),j},default:function(B){return Ui({key:B.key,value:B.value,valueSpec:t,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===s&&x&&I.push(new be(r.key,r.value,'missing required property "property"')),"identity"===s||r.value.stops||I.push(new be(r.key,r.value,'missing required property "stops"')),"exponential"===s&&r.valueSpec.expression&&!Io(r.valueSpec)&&I.push(new be(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(w&&!Wr(r.valueSpec)?I.push(new be(r.key,r.value,"property functions not supported")):x&&!Xs(r.valueSpec)&&I.push(new be(r.key,r.value,"zoom functions not supported"))),"categorical"!==s&&!E||void 0!==r.value.property||I.push(new be(r.key,r.value,'"property" property is required')),I;function z(B){let j=[];const X=B.value,ie=B.key;if("array"!==Zt(X))return[new be(ie,X,`array expected, ${Zt(X)} found`)];if(2!==X.length)return[new be(ie,X,`array length 2 expected, length ${X.length} found`)];if(E){if("object"!==Zt(X[0]))return[new be(ie,X,`object expected, ${Zt(X[0])} found`)];if(void 0===X[0].zoom)return[new be(ie,X,"object stop key must have zoom")];if(void 0===X[0].value)return[new be(ie,X,"object stop key must have value")];if(m&&m>vt(X[0].zoom))return[new be(ie,X[0].zoom,"stop zoom values must appear in ascending order")];vt(X[0].zoom)!==m&&(m=vt(X[0].zoom),u=void 0,g={}),j=j.concat(vr({key:`${ie}[0]`,value:X[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Ba,value:R}}))}else j=j.concat(R({key:`${ie}[0]`,value:X[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},X));return Hr(Yt(X[1]))?j.concat([new be(`${ie}[1]`,X[1],"expressions are not allowed in function stops.")]):j.concat(Ui({key:`${ie}[1]`,value:X[1],valueSpec:t,style:B.style,styleSpec:B.styleSpec}))}function R(B,j){const X=Zt(B.value),ie=vt(B.value),he=null!==B.value?B.value:j;if(l){if(X!==l)return[new be(B.key,he,`${X} stop domain type must match previous stop domain type ${l}`)]}else l=X;if("number"!==X&&"string"!==X&&"boolean"!==X)return[new be(B.key,he,"stop domain value must be a number, string, or boolean")];if("number"!==X&&"categorical"!==s){let ye=`number expected, ${X} found`;return Wr(t)&&void 0===s&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new be(B.key,he,ye)]}return"categorical"!==s||"number"!==X||isFinite(ie)&&Math.floor(ie)===ie?"categorical"!==s&&"number"===X&&void 0!==u&&ie<u?[new be(B.key,he,"stop domain values must appear in ascending order")]:(u=ie,"categorical"===s&&ie in g?[new be(B.key,he,"stop domain values must be unique")]:(g[ie]=!0,[])):[new be(B.key,he,`integer expected, found ${ie}`)]}}function Ms(r){const t=("property"===r.expressionContext?Fa:ea)(Yt(r.value),r.valueSpec);if("error"===t.result)return t.value.map(l=>new be(`${r.key}${l.key}`,r.value,l.message));const s=t.value.expression||t.value._styleExpression.expression;if("property"===r.expressionContext&&"text-font"===r.propertyKey&&!s.outputDefined())return[new be(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===r.expressionContext&&"layout"===r.propertyType&&!Wo(s))return[new be(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===r.expressionContext&&!Wo(s))return[new be(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&0===r.expressionContext.indexOf("cluster")){if(!Gt(s,["zoom","feature-state"]))return[new be(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===r.expressionContext&&!Zo(s))return[new be(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Mo(r){const t=r.key,s=r.value,l=r.valueSpec,u=[];return Array.isArray(l.values)?-1===l.values.indexOf(vt(s))&&u.push(new be(t,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(l.values).indexOf(vt(s))&&u.push(new be(t,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),u}function Qs(r){if(!0===r||!1===r)return!0;if(!Array.isArray(r)||0===r.length)return!1;switch(r[0]){case"has":return r.length>=2&&"$id"!==r[1]&&"$type"!==r[1];case"in":return r.length>=3&&("string"!=typeof r[1]||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==r.length||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Qs(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const pl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Po(r){if(null==r)return{filter:()=>!0,needGeometry:!1};Qs(r)||(r=na(r));const t=ea(r,pl);if("error"===t.result)throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,l,u)=>t.value.evaluate(s,l,{},u),needGeometry:ta(r)}}function fl(r,t){return r<t?-1:r>t?1:0}function ta(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let t=1;t<r.length;t++)if(ta(r[t]))return!0;return!1}function na(r){if(!r)return!0;const t=r[0];return r.length<=1?"any"!==t:"=="===t?Ps(r[1],r[2],"=="):"!="===t?C(Ps(r[1],r[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Ps(r[1],r[2],t):"any"===t?(s=r.slice(1),["any"].concat(s.map(na))):"all"===t?["all"].concat(r.slice(1).map(na)):"none"===t?["all"].concat(r.slice(1).map(na).map(C)):"in"===t?Js(r[1],r.slice(2)):"!in"===t?C(Js(r[1],r.slice(2))):"has"===t?Ds(r[1]):"!has"===t?C(Ds(r[1])):"within"!==t||r;var s}function Ps(r,t,s){switch(r){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,r,t]}}function Js(r,t){if(0===t.length)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",r,["literal",t.sort(fl)]]:["filter-in-small",r,["literal",t]]}}function Ds(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function C(r){return["!",r]}function A(r){return Qs(Yt(r.value))?Ms(Ct({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):V(r)}function V(r){const t=r.value,s=r.key;if("array"!==Zt(t))return[new be(s,t,`array expected, ${Zt(t)} found`)];const l=r.styleSpec;let u,m=[];if(t.length<1)return[new be(s,t,"filter array must have at least 1 element")];switch(m=m.concat(Mo({key:`${s}[0]`,value:t[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),vt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===vt(t[1])&&m.push(new be(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&m.push(new be(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=Zt(t[1]),"string"!==u&&m.push(new be(`${s}[1]`,t[1],`string expected, ${u} found`)));for(let g=2;g<t.length;g++)u=Zt(t[g]),"$type"===vt(t[1])?m=m.concat(Mo({key:`${s}[${g}]`,value:t[g],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&m.push(new be(`${s}[${g}]`,t[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(V({key:`${s}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":u=Zt(t[1]),2!==t.length?m.push(new be(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==u&&m.push(new be(`${s}[1]`,t[1],`string expected, ${u} found`));break;case"within":u=Zt(t[1]),2!==t.length?m.push(new be(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==u&&m.push(new be(`${s}[1]`,t[1],`object expected, ${u} found`))}return m}function ce(r,t){const s=r.key,l=r.style,u=r.styleSpec,m=r.value,g=r.objectKey,x=u[`${t}_${r.layerType}`];if(!x)return[];const w=g.match(/^(.*)-transition$/);if("paint"===t&&w&&x[w[1]]&&x[w[1]].transition)return Ui({key:s,value:m,valueSpec:u.transition,style:l,styleSpec:u});const E=r.valueSpec||x[g];if(!E)return[new be(s,m,`unknown property "${g}"`)];let I;if("string"===Zt(m)&&Wr(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(m)))return[new be(s,m,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const z=[];return"symbol"===r.layerType&&("text-field"===g&&l&&!l.glyphs&&z.push(new be(s,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&za(Yt(m))&&"identity"===vt(m.type)&&z.push(new be(s,m,'"text-font" does not support identity functions'))),z.concat(Ui({key:r.key,value:m,valueSpec:E,style:l,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:g}))}function Ue(r){return ce(r,"paint")}function yt(r){return ce(r,"layout")}function fn(r){let t=[];const s=r.value,l=r.key,u=r.style,m=r.styleSpec;s.type||s.ref||t.push(new be(l,s,'either "type" or "ref" is required'));let g=vt(s.type);const x=vt(s.ref);if(s.id){const w=vt(s.id);for(let E=0;E<r.arrayIndex;E++){const I=u.layers[E];vt(I.id)===w&&t.push(new be(l,s.id,`duplicate layer id "${s.id}", previously used at line ${I.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in s&&t.push(new be(l,s[E],`"${E}" is prohibited for ref layers`))}),u.layers.forEach(E=>{vt(E.id)===x&&(w=E)}),w?w.ref?t.push(new be(l,s.ref,"ref cannot reference another ref layer")):g=vt(w.type):t.push(new be(l,s.ref,`ref layer "${x}" not found`))}else if("background"!==g&&"sky"!==g)if(s.source){const w=u.sources&&u.sources[s.source],E=w&&vt(w.type);w?"vector"===E&&"raster"===g?t.push(new be(l,s.source,`layer "${s.id}" requires a raster source`)):"raster"===E&&"raster"!==g?t.push(new be(l,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==E||s["source-layer"]?"raster-dem"===E&&"hillshade"!==g?t.push(new be(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!s.paint||!s.paint["line-gradient"]||"geojson"===E&&w.lineMetrics||t.push(new be(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new be(l,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new be(l,s.source,`source "${s.source}" not found`))}else t.push(new be(l,s,'missing required property "source"'));return t=t.concat(vr({key:l,value:s,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ui({key:`${l}.type`,value:s.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,object:s,objectKey:"type"}),filter:A,layout:w=>vr({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>yt(Ct({layerType:g},E))}}),paint:w=>vr({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Ue(Ct({layerType:g},E))}})}})),t}function ai(r){const t=r.value,s=r.key,l=Zt(t);return"string"!==l?[new be(s,t,`string expected, ${l} found`)]:[]}const Ci={promoteId:function({key:r,value:t}){if("string"===Zt(t))return ai({key:r,value:t});{const s=[];for(const l in t)s.push(...ai({key:`${r}.${l}`,value:t[l]}));return s}}};function ls(r){const t=r.value,s=r.key,l=r.styleSpec,u=r.style;if(!t.type)return[new be(s,t,'"type" is required')];const m=vt(t.type);let g;switch(m){case"vector":case"raster":case"raster-dem":return g=vr({key:s,value:t,valueSpec:l[`source_${m.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:Ci}),g;case"geojson":if(g=vr({key:s,value:t,valueSpec:l.source_geojson,style:u,styleSpec:l,objectElementValidators:Ci}),t.cluster)for(const x in t.clusterProperties){const[w,E]=t.clusterProperties[x],I="string"==typeof w?[w,["accumulated"],["get",x]]:w;g.push(...Ms({key:`${s}.${x}.map`,value:E,expressionContext:"cluster-map"})),g.push(...Ms({key:`${s}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return g;case"video":return vr({key:s,value:t,valueSpec:l.source_video,style:u,styleSpec:l});case"image":return vr({key:s,value:t,valueSpec:l.source_image,style:u,styleSpec:l});case"canvas":return[new be(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mo({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:l})}}function Oa(r){const t=r.value,s=r.styleSpec,l=s.light,u=r.style;let m=[];const g=Zt(t);if(void 0===t)return m;if("object"!==g)return m=m.concat([new be("light",t,`object expected, ${g} found`)]),m;for(const x in t){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&l[w[1]]&&l[w[1]].transition?Ui({key:x,value:t[x],valueSpec:s.transition,style:u,styleSpec:s}):l[x]?Ui({key:x,value:t[x],valueSpec:l[x],style:u,styleSpec:s}):[new be(x,t[x],`unknown property "${x}"`)])}return m}function Na(r){const t=r.value,s=r.key,l=r.style,u=r.styleSpec,m=u.terrain;let g=[];const x=Zt(t);if(void 0===t)return g;if("object"!==x)return g=g.concat([new be("terrain",t,`object expected, ${x} found`)]),g;for(const w in t){const E=w.match(/^(.*)-transition$/);g=g.concat(E&&m[E[1]]&&m[E[1]].transition?Ui({key:w,value:t[w],valueSpec:u.transition,style:l,styleSpec:u}):m[w]?Ui({key:w,value:t[w],valueSpec:m[w],style:l,styleSpec:u}):[new be(w,t[w],`unknown property "${w}"`)])}if(t.source){const w=l.sources&&l.sources[t.source],E=w&&vt(w.type);w?"raster-dem"!==E&&g.push(new be(s,t.source,`terrain cannot be used with a source of type ${E}, it only be used with a "raster-dem" source type`)):g.push(new be(s,t.source,`source "${t.source}" not found`))}else g.push(new be(s,t,'terrain is missing required property "source"'));return g}function Br(r){const t=r.value,s=r.style,l=r.styleSpec,u=l.fog;let m=[];const g=Zt(t);if(void 0===t)return m;if("object"!==g)return m=m.concat([new be("fog",t,`object expected, ${g} found`)]),m;for(const x in t){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&u[w[1]]&&u[w[1]].transition?Ui({key:x,value:t[x],valueSpec:l.transition,style:s,styleSpec:l}):u[x]?Ui({key:x,value:t[x],valueSpec:u[x],style:s,styleSpec:l}):[new be(x,t[x],`unknown property "${x}"`)])}return m}const cu={"*":()=>[],array:dl,boolean:function(r){const t=r.value,s=r.key,l=Zt(t);return"boolean"!==l?[new be(s,t,`boolean expected, ${l} found`)]:[]},number:Ba,color:function(r){const t=r.key,s=r.value,l=Zt(s);return"string"!==l?[new be(t,s,`color expected, ${l} found`)]:null===yi.parseCSSColor(s)?[new be(t,s,`color expected, "${s}" found`)]:[]},constants:mt,enum:Mo,filter:A,function:Ys,layer:fn,object:vr,source:ls,light:Oa,terrain:Na,fog:Br,string:ai,formatted:function(r){return 0===ai(r).length?[]:Ms(r)},resolvedImage:function(r){return 0===ai(r).length?[]:Ms(r)}};function Ui(r){const t=r.value,s=r.valueSpec,l=r.styleSpec;return s.expression&&za(vt(t))?Ys(r):s.expression&&Hr(Yt(t))?Ms(r):s.type&&cu[s.type]?cu[s.type](r):vr(Ct({},r,{valueSpec:s.type?l[s.type]:s}))}function ml(r){const t=r.value,s=r.key,l=ai(r);return l.length||(-1===t.indexOf("{fontstack}")&&l.push(new be(s,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&l.push(new be(s,t,'"glyphs" url must include a "{range}" token'))),l}function eo(r,t=pe){let s=[];return s=s.concat(Ui({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,objectElementValidators:{glyphs:ml,"*":()=>[]}})),r.constants&&(s=s.concat(mt({key:"constants",value:r.constants,style:r,styleSpec:t}))),uu(s)}function uu(r){return[].concat(r).sort((t,s)=>t.line-s.line)}function to(r){return function(...t){return uu(r.apply(this,t))}}eo.source=to(ls),eo.light=to(Oa),eo.terrain=to(Na),eo.fog=to(Br),eo.layer=to(fn),eo.filter=to(A),eo.paintProperty=to(Ue),eo.layoutProperty=to(yt);const ia=eo,Ac=ia.light,hu=ia.fog,id=ia.paintProperty,Zl=ia.layoutProperty;function ih(r,t){let s=!1;if(t&&t.length)for(const l of t)r.fire(new Te(new Error(l.message))),s=!0;return s}var ra=Mn;function Mn(r,t,s){var l=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var u=new Int32Array(this.arrayBuffer);r=u[0],this.d=(t=u[1])+2*(s=u[2]);for(var m=0;m<this.d*this.d;m++){var g=u[3+m],x=u[3+m+1];l.push(g===x?null:u.subarray(g,x))}var w=u[3+l.length+1];this.keys=u.subarray(u[3+l.length],w),this.bboxes=u.subarray(w),this.insert=this._insertReadonly}else{this.d=t+2*s;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=r,this.padding=s,this.scale=t/r,this.uid=0;var I=s/t*r;this.min=-I,this.max=r+I}Mn.prototype.insert=function(r,t,s,l,u){this._forEachCell(t,s,l,u,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u)},Mn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Mn.prototype._insertCell=function(r,t,s,l,u,m){this.cells[u].push(m)},Mn.prototype.query=function(r,t,s,l,u){var m=this.min,g=this.max;if(r<=m&&t<=m&&g<=s&&g<=l&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(r,t,s,l,this._queryCell,x,{},u),x},Mn.prototype._queryCell=function(r,t,s,l,u,m,g,x){var w=this.cells[u];if(null!==w)for(var E=this.keys,I=this.bboxes,z=0;z<w.length;z++){var R=w[z];if(void 0===g[R]){var B=4*R;(x?x(I[B+0],I[B+1],I[B+2],I[B+3]):r<=I[B+2]&&t<=I[B+3]&&s>=I[B+0]&&l>=I[B+1])?(g[R]=!0,m.push(E[R])):g[R]=!1}}},Mn.prototype._forEachCell=function(r,t,s,l,u,m,g,x){for(var w=this._convertToCellCoord(r),E=this._convertToCellCoord(t),I=this._convertToCellCoord(s),z=this._convertToCellCoord(l),R=w;R<=I;R++)for(var B=E;B<=z;B++){var j=this.d*B+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&u.call(this,r,t,s,l,j,m,g,x))return}},Mn.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},Mn.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},Mn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,t=3+this.cells.length+1+1,s=0,l=0;l<this.cells.length;l++)s+=this.cells[l].length;var u=new Int32Array(t+s+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var m=t,g=0;g<r.length;g++){var x=r[g];u[3+g]=m,u.set(x,m),m+=x.length}return u[3+r.length]=m,u.set(this.keys,m),u[3+r.length+1]=m+=this.keys.length,u.set(this.bboxes,m),m+=this.bboxes.length,u.buffer};const{ImageData:Ua,ImageBitmap:Do}=at,Va={};function rt(r,t,s={}){Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Va[r]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}rt("Object",Object),ra.serialize=function(r,t){const s=r.toArrayBuffer();return t&&t.push(s),{buffer:s}},ra.deserialize=function(r){return new ra(r.buffer)},rt("Grid",ra),rt("Color",$t),rt("Error",Error),rt("ResolvedImage",yr),rt("StylePropertyFunction",ko),rt("StyleExpression",$l,{omit:["_evaluator"]}),rt("ZoomDependentExpression",Ra),rt("ZoomConstantExpression",Fr),rt("CompoundExpression",on,{omit:["_evaluate"]});for(const r in ks)ks[r]._classRegistryKey||rt(`Expression_${r}`,ks[r]);function Je(r){return r&&"undefined"!=typeof ArrayBuffer&&(r instanceof ArrayBuffer||r.constructor&&"ArrayBuffer"===r.constructor.name)}function li(r){return Do&&r instanceof Do}function zo(r,t){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Je(r)||li(r))return t&&t.push(r),r;if(ArrayBuffer.isView(r)){const s=r;return t&&t.push(s.buffer),s}if(r instanceof Ua)return t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const s=[];for(const l of r)s.push(zo(l,t));return s}if("object"==typeof r){const s=r.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const u=s.serialize?s.serialize(r,t):{};if(!s.serialize){for(const m in r){if(!r.hasOwnProperty(m)||Va[l].omit.indexOf(m)>=0)continue;const g=r[m];u[m]=Va[l].shallow.indexOf(m)>=0?g:zo(g,t)}r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof r)}function qa(r){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Je(r)||li(r)||ArrayBuffer.isView(r)||r instanceof Ua)return r;if(Array.isArray(r))return r.map(qa);if("object"==typeof r){const t=r.$name||"Object",{klass:s}=Va[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(r);const l=Object.create(s.prototype);for(const u of Object.keys(r)){if("$name"===u)continue;const m=r[u];l[u]=Va[t].shallow.indexOf(u)>=0?m:qa(m)}return l}throw new Error("can't deserialize object of type "+typeof r)}class dt{constructor(){this.first=!0}update(t,s){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const It=r=>r>=1536&&r<=1791,rh=r=>r>=1872&&r<=1919,tt=r=>r>=2208&&r<=2303,Ce=r=>r>=11904&&r<=12031,Ze=r=>r>=12032&&r<=12255,Qn=r=>r>=12272&&r<=12287,Wl=r=>r>=12288&&r<=12351,du=r=>r>=12352&&r<=12447,Hl=r=>r>=12448&&r<=12543,pu=r=>r>=12544&&r<=12591,fu=r=>r>=12704&&r<=12735,mu=r=>r>=12736&&r<=12783,lr=r=>r>=12784&&r<=12799,gu=r=>r>=12800&&r<=13055,Kl=r=>r>=13056&&r<=13311,Ht=r=>r>=13312&&r<=19903,sa=r=>r>=19968&&r<=40959,gl=r=>r>=40960&&r<=42127,ki=r=>r>=42128&&r<=42191,kt=r=>r>=44032&&r<=55215,yu=r=>r>=63744&&r<=64255,zs=r=>r>=64336&&r<=65023,_u=r=>r>=65040&&r<=65055,Ga=r=>r>=65072&&r<=65103,an=r=>r>=65104&&r<=65135,oa=r=>r>=65136&&r<=65279,Jn=r=>r>=65280&&r<=65519;function cs(r){for(const t of r)if(ja(t.charCodeAt(0)))return!0;return!1}function rd(r){for(const t of r)if(!Mi(t.charCodeAt(0)))return!1;return!0}function Mi(r){return!(It(r)||rh(r)||tt(r)||zs(r)||oa(r))}function ja(r){return!(746!==r&&747!==r&&(r<4352||!(fu(r)||pu(r)||Ga(r)&&!(r>=65097&&r<=65103)||yu(r)||Kl(r)||Ce(r)||mu(r)||!(!Wl(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||12336===r)||Ht(r)||sa(r)||gu(r)||(t=r,t>=12592&&t<=12687)||(t=>t>=43360&&t<=43391)(r)||(t=>t>=55216&&t<=55295)(r)||(t=>t>=4352&&t<=4607)(r)||kt(r)||du(r)||Qn(r)||(t=>t>=12688&&t<=12703)(r)||Ze(r)||lr(r)||Hl(r)&&12540!==r||!(!Jn(r)||65288===r||65289===r||65293===r||r>=65306&&r<=65310||65339===r||65341===r||65343===r||r>=65371&&r<=65503||65507===r||r>=65512&&r<=65519)||!(!an(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(t=>t>=5120&&t<=5759)(r)||(t=>t>=6320&&t<=6399)(r)||_u(r)||(t=>t>=19904&&t<=19967)(r)||gl(r)||ki(r))));var t}function Lo(r){return!(ja(r)||(t=r,(s=t)>=128&&s<=255&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(s=>s>=8192&&s<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(s=>s>=8448&&s<=8527)(t)||(s=>s>=8528&&s<=8591)(t)||(s=>s>=8960&&s<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(s=>s>=9216&&s<=9279)(t)&&9251!==t||(s=>s>=9280&&s<=9311)(t)||(s=>s>=9312&&s<=9471)(t)||(s=>s>=9632&&s<=9727)(t)||(s=>s>=9728&&s<=9983)(t)&&!(t>=9754&&t<=9759)||(s=>s>=11008&&s<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Wl(t)||Hl(t)||(s=>s>=57344&&s<=63743)(t)||Ga(t)||an(t)||Jn(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t,s}function ci(r){return r>=1424&&r<=2303||zs(r)||oa(r)}function $a(r,t){return!(!t&&ci(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(s=r,s>=6016&&s<=6143));var s}function yl(r){for(const t of r)if(ci(t.charCodeAt(0)))return!0;return!1}const d="deferred",n="loading",c="loaded";let f=null,y="unavailable",_=null;const b=function(r){r&&"string"==typeof r&&r.indexOf("NetworkError")>-1&&(y="error"),f&&f(r)};function S(){k.fire(new Ge("pluginStateChange",{pluginStatus:y,pluginURL:_}))}const k=new it,L=function(){return y},O=function(){if(y!==d||!_)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");y=n,S(),_&&P({url:_},r=>{r?b(r):(y=c,S())})},U={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>y===c||null!=U.applyArabicShaping,isLoading:()=>y===n,setState(r){y=r.pluginStatus,_=r.pluginURL},isParsed:()=>null!=U.applyArabicShaping&&null!=U.processBidirectionalText&&null!=U.processStyledBidirectionalText,getPluginURL:()=>_};class q{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dt,this.transition={})}isSupportedScript(t){return function(s,l){for(const u of s)if(!$a(u.charCodeAt(0),l))return!1;return!0}(t,U.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class ${constructor(t,s){this.property=t,this.value=s,this.expression=function(l,u){if(za(l))return new ko(l,u);if(Hr(l)){const m=Fa(l,u);if("error"===m.result)throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=l;return"string"==typeof l&&"color"===u.type&&(m=$t.parse(l)),{kind:"constant",evaluate:()=>m}}}(void 0===s?t.specification.default:s,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,s,l){return this.property.possiblyEvaluate(this,t,s,l)}}class Y{constructor(t){this.property=t,this.value=new $(t,void 0)}transitioned(t,s){return new le(this.property,this.value,s,Tt({},t.transition,this.transition),t.now)}untransitioned(){return new le(this.property,this.value,null,{},0)}}class Q{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return qt(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new Y(this._values[t].property)),this._values[t].value=new $(this._values[t].property,null===s?void 0:qt(s))}getTransition(t){return qt(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new Y(this._values[t].property)),this._values[t].transition=qt(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(t[s]=l);const u=this.getTransition(s);void 0!==u&&(t[`${s}-transition`]=u)}return t}transitioned(t,s){const l=new W(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(t,s._values[u]);return l}untransitioned(){const t=new W(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class le{constructor(t,s,l,u,m){const g=u.delay||0,x=u.duration||0;m=m||0,this.property=t,this.value=s,this.begin=m+g,this.end=this.begin+x,t.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(t,s,l){const u=t.now||0,m=this.value.possiblyEvaluate(t,s,l),g=this.prior;if(g){if(u>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(u<this.begin)return g.possiblyEvaluate(t,s,l);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,s,l),m,kn(x))}}return m}}class W{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,l){const u=new ue(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(t,s,l);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class J{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return qt(this._values[t].value)}setValue(t,s){this._values[t]=new $(this._values[t].property,null===s?void 0:qt(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(t[s]=l)}return t}possiblyEvaluate(t,s,l){const u=new ue(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(t,s,l);return u}}class re{constructor(t,s,l){this.property=t,this.value=s,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,s,l,u){return this.property.evaluate(this.value,this.parameters,t,s,l,u)}}class ue{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class te{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,l){const u=yo[this.specification.type];return u?u(t,s,l):t}}class ee{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,l,u){return new re(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(s,null,{},l,u)}:t.expression,s)}interpolate(t,s,l){if("constant"!==t.value.kind||"constant"!==s.value.kind)return t;if(void 0===t.value.value||void 0===s.value.value)return new re(this,{kind:"constant",value:void 0},t.parameters);const u=yo[this.specification.type];return u?new re(this,{kind:"constant",value:u(t.value.value,s.value.value,l)},t.parameters):t}evaluate(t,s,l,u,m,g){return"constant"===t.kind?t.value:t.evaluate(s,l,u,m,g)}}class Ae extends ee{possiblyEvaluate(t,s,l,u){if(void 0===t.value)return new re(this,{kind:"constant",value:void 0},s);if("constant"===t.expression.kind){const m=t.expression.evaluate(s,null,{},l,u),g="resolvedImage"===t.property.specification.type&&"string"!=typeof m?m.name:m,x=this._calculate(g,g,g,s);return new re(this,{kind:"constant",value:x},s)}if("camera"===t.expression.kind){const m=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new re(this,{kind:"constant",value:m},s)}return new re(this,t.expression,s)}evaluate(t,s,l,u,m,g){if("source"===t.kind){const x=t.evaluate(s,l,u,m,g);return this._calculate(x,x,x,s)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},l,u),t.evaluate({zoom:Math.floor(s.zoom)},l,u),t.evaluate({zoom:Math.floor(s.zoom)+1},l,u),s):t.value}_calculate(t,s,l,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:s,other:l}:{from:l,to:s,other:t}}interpolate(t){return t}}class De{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,u){if(void 0!==t.value){if("constant"===t.expression.kind){const m=t.expression.evaluate(s,null,{},l,u);return this._calculate(m,m,m,s)}return this._calculate(t.expression.evaluate(new q(Math.floor(s.zoom-1),s)),t.expression.evaluate(new q(Math.floor(s.zoom),s)),t.expression.evaluate(new q(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,l,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class Le{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,u){return!!t.expression.evaluate(s,null,{},l,u)}interpolate(){return!1}}class se{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const l=t[s];l.specification.overridable&&this.overridableProperties.push(s);const u=this.defaultPropertyValues[s]=new $(l,void 0),m=this.defaultTransitionablePropertyValues[s]=new Y(l);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate({})}}}function We(r,t){return 256*(r=dn(Math.floor(r),0,255))+dn(Math.floor(t),0,255)}rt("DataDrivenProperty",ee),rt("DataConstantProperty",te),rt("CrossFadedDataDrivenProperty",Ae),rt("CrossFadedProperty",De),rt("ColorRampProperty",Le);const Ne={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class nt{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ye{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Xe(r,t=1){let s=0,l=0;return{members:r.map(u=>{const m=Ne[u.type].BYTES_PER_ELEMENT,g=s=wt(s,Math.max(t,m)),x=u.components||1;return l=Math.max(l,m),s+=m*x,{name:u.name,type:u.type,components:x,offset:g}}),size:wt(s,Math.max(l,t)),alignment:t}}function wt(r,t){return Math.ceil(r/t)*t}class ft extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const u=2*t;return this.int16[u+0]=s,this.int16[u+1]=l,t}}ft.prototype.bytesPerElement=4,rt("StructArrayLayout2i4",ft);class Kt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l,u)}emplace(t,s,l,u,m){const g=4*t;return this.int16[g+0]=s,this.int16[g+1]=l,this.int16[g+2]=u,this.int16[g+3]=m,t}}Kt.prototype.bytesPerElement=8,rt("StructArrayLayout4i8",Kt);class _n extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,l,u,m,g,x)}emplace(t,s,l,u,m,g,x,w){const E=6*t,I=12*t,z=3*t;return this.int16[E+0]=s,this.int16[E+1]=l,this.uint8[I+4]=u,this.uint8[I+5]=m,this.uint8[I+6]=g,this.uint8[I+7]=x,this.float32[z+2]=w,t}}_n.prototype.bytesPerElement=12,rt("StructArrayLayout2i4ub1f12",_n);class vn extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const u=2*t;return this.float32[u+0]=s,this.float32[u+1]=l,t}}vn.prototype.bytesPerElement=8,rt("StructArrayLayout2f8",vn);class Ft extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m,g,x,w,E,I){const z=this.length;return this.resize(z+1),this.emplace(z,t,s,l,u,m,g,x,w,E,I)}emplace(t,s,l,u,m,g,x,w,E,I,z){const R=10*t;return this.uint16[R+0]=s,this.uint16[R+1]=l,this.uint16[R+2]=u,this.uint16[R+3]=m,this.uint16[R+4]=g,this.uint16[R+5]=x,this.uint16[R+6]=w,this.uint16[R+7]=E,this.uint16[R+8]=I,this.uint16[R+9]=z,t}}Ft.prototype.bytesPerElement=20,rt("StructArrayLayout10ui20",Ft);class cn extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m,g,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,u,m,g,x,w)}emplace(t,s,l,u,m,g,x,w,E){const I=8*t;return this.uint16[I+0]=s,this.uint16[I+1]=l,this.uint16[I+2]=u,this.uint16[I+3]=m,this.uint16[I+4]=g,this.uint16[I+5]=x,this.uint16[I+6]=w,this.uint16[I+7]=E,t}}cn.prototype.bytesPerElement=16,rt("StructArrayLayout8ui16",cn);class In extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m,g,x,w,E,I,z,R){const B=this.length;return this.resize(B+1),this.emplace(B,t,s,l,u,m,g,x,w,E,I,z,R)}emplace(t,s,l,u,m,g,x,w,E,I,z,R,B){const j=12*t;return this.int16[j+0]=s,this.int16[j+1]=l,this.int16[j+2]=u,this.int16[j+3]=m,this.uint16[j+4]=g,this.uint16[j+5]=x,this.uint16[j+6]=w,this.uint16[j+7]=E,this.int16[j+8]=I,this.int16[j+9]=z,this.int16[j+10]=R,this.int16[j+11]=B,t}}In.prototype.bytesPerElement=24,rt("StructArrayLayout4i4ui4i24",In);class cr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,s,l)}emplace(t,s,l,u){const m=3*t;return this.float32[m+0]=s,this.float32[m+1]=l,this.float32[m+2]=u,t}}cr.prototype.bytesPerElement=12,rt("StructArrayLayout3f12",cr);class Vi extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}Vi.prototype.bytesPerElement=4,rt("StructArrayLayout1ul4",Vi);class xr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m,g,x,w,E,I){const z=this.length;return this.resize(z+1),this.emplace(z,t,s,l,u,m,g,x,w,E,I)}emplace(t,s,l,u,m,g,x,w,E,I,z){const R=16*t,B=8*t;return this.int16[R+0]=s,this.int16[R+1]=l,this.float32[B+1]=u,this.float32[B+2]=m,this.float32[B+3]=g,this.float32[B+4]=x,this.int16[R+10]=w,this.uint32[B+6]=E,this.uint16[R+14]=I,this.uint16[R+15]=z,t}}xr.prototype.bytesPerElement=32,rt("StructArrayLayout2i4f1i1ul2ui32",xr);class Kr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,l,u,m,g)}emplace(t,s,l,u,m,g,x){const w=6*t;return this.int16[w+0]=s,this.int16[w+1]=l,this.int16[w+2]=u,this.int16[w+3]=m,this.int16[w+4]=g,this.int16[w+5]=x,t}}Kr.prototype.bytesPerElement=12,rt("StructArrayLayout2i2i2i12",Kr);class Ls extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,l,u,m)}emplace(t,s,l,u,m,g){const x=4*t,w=8*t;return this.float32[x+0]=s,this.float32[x+1]=l,this.float32[x+2]=u,this.int16[w+6]=m,this.int16[w+7]=g,t}}Ls.prototype.bytesPerElement=16,rt("StructArrayLayout2f1f2i16",Ls);class ln extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l,u)}emplace(t,s,l,u,m){const g=12*t,x=3*t;return this.uint8[g+0]=s,this.uint8[g+1]=l,this.float32[x+1]=u,this.float32[x+2]=m,t}}ln.prototype.bytesPerElement=12,rt("StructArrayLayout2ub2f12",ln);class An extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,s,l)}emplace(t,s,l,u){const m=3*t;return this.uint16[m+0]=s,this.uint16[m+1]=l,this.uint16[m+2]=u,t}}An.prototype.bytesPerElement=6,rt("StructArrayLayout3ui6",An);class Vt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m,g,x,w,E,I,z,R,B,j,X,ie,he,ye){const _e=this.length;return this.resize(_e+1),this.emplace(_e,t,s,l,u,m,g,x,w,E,I,z,R,B,j,X,ie,he,ye)}emplace(t,s,l,u,m,g,x,w,E,I,z,R,B,j,X,ie,he,ye,_e){const ve=13*t,we=26*t,xe=52*t;return this.float32[ve+0]=s,this.float32[ve+1]=l,this.uint16[we+4]=u,this.uint16[we+5]=m,this.uint32[ve+3]=g,this.uint32[ve+4]=x,this.uint32[ve+5]=w,this.uint16[we+12]=E,this.uint16[we+13]=I,this.uint16[we+14]=z,this.float32[ve+8]=R,this.float32[ve+9]=B,this.uint8[xe+40]=j,this.uint8[xe+41]=X,this.uint8[xe+42]=ie,this.uint32[ve+11]=he,this.int16[we+24]=ye,this.uint8[xe+50]=_e,t}}Vt.prototype.bytesPerElement=52,rt("StructArrayLayout2f2ui3ul3ui2f3ub1ul1i1ub52",Vt);class Ln extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,l,u,m,g,x,w,E,I,z,R,B,j,X,ie,he,ye,_e,ve,we,xe,Oe,qe,Fe,He,ze){const Re=this.length;return this.resize(Re+1),this.emplace(Re,t,s,l,u,m,g,x,w,E,I,z,R,B,j,X,ie,he,ye,_e,ve,we,xe,Oe,qe,Fe,He,ze)}emplace(t,s,l,u,m,g,x,w,E,I,z,R,B,j,X,ie,he,ye,_e,ve,we,xe,Oe,qe,Fe,He,ze,Re){const Ke=17*t,Pe=34*t;return this.float32[Ke+0]=s,this.float32[Ke+1]=l,this.int16[Pe+4]=u,this.int16[Pe+5]=m,this.int16[Pe+6]=g,this.int16[Pe+7]=x,this.int16[Pe+8]=w,this.int16[Pe+9]=E,this.uint16[Pe+10]=I,this.uint16[Pe+11]=z,this.uint16[Pe+12]=R,this.uint16[Pe+13]=B,this.uint16[Pe+14]=j,this.uint16[Pe+15]=X,this.uint16[Pe+16]=ie,this.uint16[Pe+17]=he,this.uint16[Pe+18]=ye,this.uint16[Pe+19]=_e,this.uint16[Pe+20]=ve,this.uint16[Pe+21]=we,this.uint16[Pe+22]=xe,this.uint16[Pe+23]=Oe,this.uint16[Pe+24]=qe,this.uint32[Ke+13]=Fe,this.float32[Ke+14]=He,this.float32[Ke+15]=ze,this.float32[Ke+16]=Re,t}}Ln.prototype.bytesPerElement=68,rt("StructArrayLayout2f6i15ui1ul3f68",Ln);class _i extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}_i.prototype.bytesPerElement=4,rt("StructArrayLayout1f4",_i);class xn extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,s,l)}emplace(t,s,l,u){const m=3*t;return this.int16[m+0]=s,this.int16[m+1]=l,this.int16[m+2]=u,t}}xn.prototype.bytesPerElement=6,rt("StructArrayLayout3i6",xn);class wr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l,u)}emplace(t,s,l,u,m){const g=6*t;return this.uint32[3*t+0]=s,this.uint16[g+2]=l,this.uint16[g+3]=u,this.uint16[g+4]=m,t}}wr.prototype.bytesPerElement=12,rt("StructArrayLayout1ul3ui12",wr);class us extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const u=2*t;return this.uint16[u+0]=s,this.uint16[u+1]=l,t}}us.prototype.bytesPerElement=4,rt("StructArrayLayout2ui4",us);class Pi extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Pi.prototype.bytesPerElement=2,rt("StructArrayLayout1ui2",Pi);class vi extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,l,u)}emplace(t,s,l,u,m){const g=4*t;return this.float32[g+0]=s,this.float32[g+1]=l,this.float32[g+2]=u,this.float32[g+3]=m,t}}vi.prototype.bytesPerElement=16,rt("StructArrayLayout4f16",vi);class vu extends nt{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new Be(this.anchorPointX,this.anchorPointY)}}vu.prototype.size=32;class Ro extends xr{get(t){return new vu(this,t)}}rt("CollisionBoxArray",Ro);class Za extends nt{get anchorX(){return this._structArray.float32[this._pos4+0]}get anchorY(){return this._structArray.float32[this._pos4+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+4]}get numGlyphs(){return this._structArray.uint16[this._pos2+5]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineStartIndex(){return this._structArray.uint32[this._pos4+4]}get lineLength(){return this._structArray.uint32[this._pos4+5]}get segment(){return this._structArray.uint16[this._pos2+12]}get lowerSize(){return this._structArray.uint16[this._pos2+13]}get upperSize(){return this._structArray.uint16[this._pos2+14]}get lineOffsetX(){return this._structArray.float32[this._pos4+8]}get lineOffsetY(){return this._structArray.float32[this._pos4+9]}get writingMode(){return this._structArray.uint8[this._pos1+40]}get placedOrientation(){return this._structArray.uint8[this._pos1+41]}set placedOrientation(t){this._structArray.uint8[this._pos1+41]=t}get hidden(){return this._structArray.uint8[this._pos1+42]}set hidden(t){this._structArray.uint8[this._pos1+42]=t}get crossTileID(){return this._structArray.uint32[this._pos4+11]}set crossTileID(t){this._structArray.uint32[this._pos4+11]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+24]}get flipState(){return this._structArray.uint8[this._pos1+50]}set flipState(t){this._structArray.uint8[this._pos1+50]=t}}Za.prototype.size=52;class Cc extends Vt{get(t){return new Za(this,t)}}rt("PlacedSymbolArray",Cc);class Fo extends nt{get anchorX(){return this._structArray.float32[this._pos4+0]}get anchorY(){return this._structArray.float32[this._pos4+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+8]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+9]}get key(){return this._structArray.uint16[this._pos2+10]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get featureIndex(){return this._structArray.uint16[this._pos2+19]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+21]}get numIconVertices(){return this._structArray.uint16[this._pos2+22]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+23]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+24]}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Fo.prototype.size=68;class Xl extends Ln{get(t){return new Fo(this,t)}}rt("SymbolInstanceArray",Xl);class kp extends _i{getoffsetX(t){return this.float32[1*t+0]}}rt("GlyphOffsetArray",kp);class sd extends xn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}rt("SymbolLineVertexArray",sd);class od extends nt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}od.prototype.size=12;class ad extends wr{get(t){return new od(this,t)}}rt("FeatureIndexArray",ad);class xu extends nt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}xu.prototype.size=4;class Mp extends us{get(t){return new xu(this,t)}}rt("FillExtrusionCentroidArray",Mp);const em=Xe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Pp=Xe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Yl=po(function(r){r.exports=function(t,s){var l,u,m,g,x,w,E,I;for(u=t.length-(l=3&t.length),m=s,x=3432918353,w=461845907,I=0;I<u;)E=255&t.charCodeAt(I)|(255&t.charCodeAt(++I))<<8|(255&t.charCodeAt(++I))<<16|(255&t.charCodeAt(++I))<<24,++I,m=27492+(65535&(g=5*(65535&(m=(m^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&t.charCodeAt(I+2))<<16;case 2:E^=(255&t.charCodeAt(I+1))<<8;case 1:m^=E=(65535&(E=(E=(65535&(E^=255&t.charCodeAt(I)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return m^=t.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),Ql=po(function(r){r.exports=function(t,s){for(var l,u=t.length,m=s^u,g=0;u>=4;)l=1540483477*(65535&(l=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:m^=(255&t.charCodeAt(g+2))<<16;case 2:m^=(255&t.charCodeAt(g+1))<<8;case 1:m=1540483477*(65535&(m^=255&t.charCodeAt(g)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),kc=Yl,Jl=Ql;kc.murmur3=Yl,kc.murmur2=Jl;class wu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,l,u){this.ids.push(ec(t)),this.positions.push(s,l,u)}getPositions(t){const s=ec(t);let l=0,u=this.ids.length-1;for(;l<u;){const g=l+u>>1;this.ids[g]>=s?u=g:l=g+1}const m=[];for(;this.ids[l]===s;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(t,s){const l=new Float64Array(t.ids),u=new Uint32Array(t.positions);return sh(l,u,0,l.length-1),s&&s.push(l.buffer,u.buffer),{ids:l,positions:u}}static deserialize(t){const s=new wu;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function ec(r){const t=+r;return!isNaN(t)&&t<=ii?t:kc(String(r))}function sh(r,t,s,l){for(;s<l;){const u=r[s+l>>1];let m=s-1,g=l+1;for(;;){do{m++}while(r[m]<u);do{g--}while(r[g]>u);if(m>=g)break;bu(r,m,g),bu(t,3*m,3*g),bu(t,3*m+1,3*g+1),bu(t,3*m+2,3*g+2)}g-s<l-g?(sh(r,t,s,g),s=g+1):(sh(r,t,g+1,l),l=g)}}function bu(r,t,s){const l=r[t];r[t]=r[s],r[s]=l}rt("FeaturePositionMap",wu);class no{constructor(t,s){this.gl=t.gl,this.location=s}}class oh extends no{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Dp extends no{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Di extends no{constructor(t,s){super(t,s),this.current=$t.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ah=new Float32Array(16),lh=new Float32Array(9);function ld(r){return[We(255*r.r,255*r.g),We(255*r.b,255*r.a)]}class tc{constructor(t,s,l){this.value=t,this.uniformNames=s.map(u=>`u_${u}`),this.type=l}setUniform(t,s,l){t.set(l.constantOr(this.value))}getBinding(t,s,l){return"color"===this.type?new Di(t,s):new oh(t,s)}}class Mc{constructor(t,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,s,l,u){const m="u_pattern_to"===u||"u_dash_to"===u?this.patternTo:"u_pattern_from"===u||"u_dash_from"===u?this.patternFrom:"u_pixel_ratio_to"===u?this.pixelRatioTo:"u_pixel_ratio_from"===u?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,s,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new Dp(t,s):new oh(t,s)}}class aa{constructor(t,s,l,u){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,s,l,u,m){const g=this.paintVertexArray.length,x=this.expression.evaluate(new q(0),s,{},u,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,x)}updatePaintArray(t,s,l,u){const m=this.expression.evaluate({zoom:0},l,u);this._setPaintValue(t,s,m)}_setPaintValue(t,s,l){if("color"===this.type){const u=ld(l);for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=t;u<s;u++)this.paintVertexArray.emplace(u,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class io{constructor(t,s,l,u,m,g){this.expression=t,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=u,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,s,l,u,m){const g=this.expression.evaluate(new q(this.zoom),s,{},u,[],m),x=this.expression.evaluate(new q(this.zoom+1),s,{},u,[],m),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,g,x)}updatePaintArray(t,s,l,u){const m=this.expression.evaluate({zoom:this.zoom},l,u),g=this.expression.evaluate({zoom:this.zoom+1},l,u);this._setPaintValue(t,s,m,g)}_setPaintValue(t,s,l,u){if("color"===this.type){const m=ld(l),g=ld(u);for(let x=t;x<s;x++)this.paintVertexArray.emplace(x,m[0],m[1],g[0],g[1])}else{for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,u=dn(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,s,l){return new oh(t,s)}}class ro{constructor(t,s,l,u,m,g,x){this.expression=t,this.type=l,this.useIntegerZoom=u,this.zoom=m,this.layerId=x,this.paintVertexAttributes=("array"===l?Pp:em).members;for(let w=0;w<s.length;++w);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,s,l){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(t,s,l,u,m){this._setPaintValues(t,s,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(t,s,l,u){if(!u||!l)return;const{min:m,mid:g,max:x}=l,w=u[m],E=u[g],I=u[x];if(w&&E&&I)for(let z=t;z<s;z++)this._setPaintValue(this.zoomInPaintVertexArray,z,E,w),this._setPaintValue(this.zoomOutPaintVertexArray,z,E,I)}_setPaintValue(t,s,l,u){t.emplace(s,l.tl[0],l.tl[1],l.br[0],l.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],l.pixelRatio,u.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Or{constructor(t,s,l=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const m in t.paint._values){if(!l(m))continue;const g=t.paint.get(m);if(!(g instanceof re&&Wr(g.property.specification)))continue;const x=Lp(m,t.type),w=g.value,E=g.property.specification.type,I=g.property.useIntegerZoom,z=g.property.specification["property-type"],R="cross-faded"===z||"cross-faded-data-driven"===z,B="line-dasharray"===String(m)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==w.kind||B)if("source"===w.kind||B||R){const j=Rp(m,E,"source");this.binders[m]=R?new ro(w,x,E,I,s,j,t.id):new aa(w,x,E,j),u.push(`/a_${m}`)}else{const j=Rp(m,E,"composite");this.binders[m]=new io(w,x,E,I,s,j),u.push(`/z_${m}`)}else this.binders[m]=R?new Mc(w.value,x):new tc(w.value,x,E),u.push(`/u_${m}`)}this.cacheKey=u.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof aa||s instanceof io?s.maxValue:0}populatePaintArrays(t,s,l,u,m){for(const g in this.binders){const x=this.binders[g];(x instanceof aa||x instanceof io||x instanceof ro)&&x.populatePaintArray(t,s,l,u,m)}}setConstantPatternPositions(t,s){for(const l in this.binders){const u=this.binders[l];u instanceof Mc&&u.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,l,u,m){let g=!1;for(const x in t){const w=s.getPositions(x);for(const E of w){const I=l.feature(E.index);for(const z in this.binders){const R=this.binders[z];if((R instanceof aa||R instanceof io||R instanceof ro)&&!0===R.expression.isStateDependent){const B=u.paint.get(z);R.expression=B.value,R.updatePaintArray(E.start,E.end,I,t[x],m),g=!0}}}}return g}defines(){const t=[];for(const s in this.binders){const l=this.binders[s];(l instanceof tc||l instanceof Mc)&&t.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof aa||l instanceof io||l instanceof ro)for(let u=0;u<l.paintVertexAttributes.length;u++)t.push(l.paintVertexAttributes[u].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof tc||l instanceof Mc||l instanceof io)for(const u of l.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const l=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof tc||m instanceof Mc||m instanceof io)for(const g of m.uniformNames)if(s[g]){const x=m.getBinding(t,s[g],g);l.push({name:g,property:u,binding:x})}}return l}setUniforms(t,s,l,u){for(const{name:m,property:g,binding:x}of s)this.binders[g].setUniform(x,u,l.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(t&&l instanceof ro){const u=2===t.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(l instanceof aa||l instanceof io)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const s in this.binders){const l=this.binders[s];(l instanceof aa||l instanceof io||l instanceof ro)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof aa||s instanceof io||s instanceof ro)&&s.destroy()}}}class _l{constructor(t,s,l=(()=>!0)){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Or(u,s,l);this.needsUpload=!1,this._featureMap=new wu,this._bufferOffset=0}populatePaintArrays(t,s,l,u,m,g){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,s,u,m,g);void 0!==s.id&&this._featureMap.add(s.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,l,u){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,s,m,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const zp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Lp(r,t){return zp[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}const Tu={"line-pattern":{source:Ft,composite:Ft},"fill-pattern":{source:Ft,composite:Ft},"fill-extrusion-pattern":{source:Ft,composite:Ft},"line-dasharray":{source:cn,composite:cn}},cd={color:{source:vn,composite:vi},number:{source:_i,composite:vn}};function Rp(r,t,s){const l=Tu[r];return l&&l[s]||cd[t][s]}rt("ConstantBinder",tc),rt("CrossFadedConstantBinder",Mc),rt("SourceExpressionBinder",aa),rt("CrossFadedCompositeBinder",ro),rt("CompositeExpressionBinder",io),rt("ProgramConfiguration",Or,{omit:["_buffers"]}),rt("ProgramConfigurationSet",_l);const ui="-transition";class Ut extends it{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new J(s.layout)),s.paint)){this._transitionablePaint=new Q(s.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ue(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,l={}){null!=s&&this._validate(Zl,`layers.${this.id}.layout.${t}`,t,s,l)||("visibility"!==t?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return Qe(t,ui)?this._transitionablePaint.getTransition(t.slice(0,-ui.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,l={}){if(null!=s&&this._validate(id,`layers.${this.id}.paint.${t}`,t,s,l))return!1;if(Qe(t,ui))return this._transitionablePaint.setTransition(t.slice(0,-ui.length),s||void 0),!1;{const u=this._transitionablePaint._values[t],m="cross-faded-data-driven"===u.property.specification["property-type"],g=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,x,w)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,s,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ut(t,(s,l)=>!(void 0===s||"layout"===l&&!Object.keys(s).length||"paint"===l&&!Object.keys(s).length))}_validate(t,s,l,u,m={}){return(!m||!1!==m.validate)&&ih(this,t.call(ia,{key:s,layerType:this.type,objectKey:l,value:u,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof re&&Wr(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}}const Fp=Xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bp}=Fp;class en{constructor(t=[]){this.segments=t}prepareSegment(t,s,l,u){let m=this.segments[this.segments.length-1];return t>en.MAX_VERTEX_ARRAY_LENGTH&&Qt(`Max vertices per segment is ${en.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>en.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==u)&&(m={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==u&&(m.sortKey=u),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,l,u){return new en([{vertexOffset:t,primitiveOffset:s,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}en.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt("SegmentVector",en);var Jt=8192;const Ji=Math.pow(2,14)-1,hi=-Ji-1;function vl(r){const t=Jt/r.extent,s=r.loadGeometry();for(let l=0;l<s.length;l++){const u=s[l];for(let m=0;m<u.length;m++){const g=u[m],x=Math.round(g.x*t),w=Math.round(g.y*t);g.x=dn(x,hi,Ji),g.y=dn(w,hi,Ji),(x<g.x||x>g.x+1||w<g.y||w>g.y+1)&&Qt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function nc(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?vl(r):[]}}function Xr(r,t,s,l,u){r.emplaceBack(2*t+(l+1)/2,2*s+(u+1)/2)}class ud{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ft,this.indexArray=new An,this.segments=new en,this.programConfigurations=new _l(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){const u=this.layers[0],m=[];let g=null;"circle"===u.type&&(g=u.layout.get("circle-sort-key"));for(const{feature:x,id:w,index:E,sourceLayerIndex:I}of t){const z=this.layers[0]._featureFilter.needGeometry,R=nc(x,z);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),R,l))continue;const B=g?g.evaluate(R,{},l):void 0,j={id:w,properties:x.properties,type:x.type,sourceLayerIndex:I,index:E,geometry:z?R.geometry:vl(x),patterns:{},sortKey:B};m.push(j)}g&&m.sort((x,w)=>x.sortKey-w.sortKey);for(const x of m){const{geometry:w,index:E,sourceLayerIndex:I}=x,z=t[E].feature;this.addFeature(x,w,E,l),s.featureIndex.insert(z,w,E,I,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,l,u){for(const m of s)for(const g of m){const x=g.x,w=g.y;if(x<0||x>=Jt||w<0||w>=Jt)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),I=E.vertexLength;Xr(this.layoutVertexArray,x,w,-1,-1),Xr(this.layoutVertexArray,x,w,1,-1),Xr(this.layoutVertexArray,x,w,1,1),Xr(this.layoutVertexArray,x,w,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},u)}}function ch(r,t){for(let s=0;s<r.length;s++)if(Wa(t,r[s]))return!0;for(let s=0;s<t.length;s++)if(Wa(r,t[s]))return!0;return!!mn(r,t)}function tm(r,t,s){return!!Wa(r,t)||!!Pc(t,r,s)}function hd(r,t){if(1===r.length)return zc(t,r[0]);for(let s=0;s<t.length;s++){const l=t[s];for(let u=0;u<l.length;u++)if(Wa(r,l[u]))return!0}for(let s=0;s<r.length;s++)if(zc(t,r[s]))return!0;for(let s=0;s<t.length;s++)if(mn(r,t[s]))return!0;return!1}function nm(r,t,s){if(r.length>1){if(mn(r,t))return!0;for(let l=0;l<t.length;l++)if(Pc(t[l],r,s))return!0}for(let l=0;l<r.length;l++)if(Pc(r[l],t,s))return!0;return!1}function mn(r,t){if(0===r.length||0===t.length)return!1;for(let s=0;s<r.length-1;s++){const l=r[s],u=r[s+1];for(let m=0;m<t.length-1;m++)if(im(l,u,t[m],t[m+1]))return!0}return!1}function im(r,t,s,l){return ir(r,s,l)!==ir(t,s,l)&&ir(r,t,s)!==ir(r,t,l)}function Pc(r,t,s){const l=s*s;if(1===t.length)return r.distSqr(t[0])<l;for(let u=1;u<t.length;u++)if(Dc(r,t[u-1],t[u])<l)return!0;return!1}function Dc(r,t,s){const l=t.distSqr(s);if(0===l)return r.distSqr(t);const u=((r.x-t.x)*(s.x-t.x)+(r.y-t.y)*(s.y-t.y))/l;return r.distSqr(u<0?t:u>1?s:s.sub(t)._mult(u)._add(t))}function zc(r,t){let s,l,u,m=!1;for(let g=0;g<r.length;g++){s=r[g];for(let x=0,w=s.length-1;x<s.length;w=x++)l=s[x],u=s[w],l.y>t.y!=u.y>t.y&&t.x<(u.x-l.x)*(t.y-l.y)/(u.y-l.y)+l.x&&(m=!m)}return m}function Wa(r,t){let s=!1;for(let l=0,u=r.length-1;l<r.length;u=l++){const m=r[l],g=r[u];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(s=!s)}return s}function dd(r,t,s,l,u){for(const g of r)if(t<=g.x&&s<=g.y&&l>=g.x&&u>=g.y)return!0;const m=[new Be(t,s),new Be(t,u),new Be(l,u),new Be(l,s)];if(r.length>2)for(const g of m)if(Wa(r,g))return!0;for(let g=0;g<r.length-1;g++)if(Op(r[g],r[g+1],m))return!0;return!1}function Op(r,t,s){const l=s[0],u=s[2];if(r.x<l.x&&t.x<l.x||r.x>u.x&&t.x>u.x||r.y<l.y&&t.y<l.y||r.y>u.y&&t.y>u.y)return!1;const m=ir(r,t,s[0]);return m!==ir(r,t,s[1])||m!==ir(r,t,s[2])||m!==ir(r,t,s[3])}function Lc(r,t,s){const l=t.paint.get(r).value;return"constant"===l.kind?l.value:s.programConfigurations.get(t.id).getMaxValue(r)}function uh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function pd(r,t,s,l,u){if(!t[0]&&!t[1])return r;const m=Be.convert(t)._mult(u);"viewport"===s&&m._rotate(-l);const g=[];for(let x=0;x<r.length;x++)g.push(r[x].sub(m));return g}function fd(r,t,s,l){const u=Be.convert(r)._mult(l);return"viewport"===t&&u._rotate(-s),u}rt("CircleBucket",ud,{omit:["layers"]});const rm=new se({"circle-sort-key":new ee(pe.layout_circle["circle-sort-key"])});var sm={paint:new se({"circle-radius":new ee(pe.paint_circle["circle-radius"]),"circle-color":new ee(pe.paint_circle["circle-color"]),"circle-blur":new ee(pe.paint_circle["circle-blur"]),"circle-opacity":new ee(pe.paint_circle["circle-opacity"]),"circle-translate":new te(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new te(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new te(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new te(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ee(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ee(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ee(pe.paint_circle["circle-stroke-opacity"])}),layout:rm},hs="undefined"!=typeof Float32Array?Float32Array:Array;function Rc(){var r=new hs(9);return hs!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function hh(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Np(r,t,s){var l=t[0],u=t[1],m=t[2],g=t[3],x=t[4],w=t[5],E=t[6],I=t[7],z=t[8],R=t[9],B=t[10],j=t[11],X=t[12],ie=t[13],he=t[14],ye=t[15],_e=s[0],ve=s[1],we=s[2],xe=s[3];return r[0]=_e*l+ve*x+we*z+xe*X,r[1]=_e*u+ve*w+we*R+xe*ie,r[2]=_e*m+ve*E+we*B+xe*he,r[3]=_e*g+ve*I+we*j+xe*ye,r[4]=(_e=s[4])*l+(ve=s[5])*x+(we=s[6])*z+(xe=s[7])*X,r[5]=_e*u+ve*w+we*R+xe*ie,r[6]=_e*m+ve*E+we*B+xe*he,r[7]=_e*g+ve*I+we*j+xe*ye,r[8]=(_e=s[8])*l+(ve=s[9])*x+(we=s[10])*z+(xe=s[11])*X,r[9]=_e*u+ve*w+we*R+xe*ie,r[10]=_e*m+ve*E+we*B+xe*he,r[11]=_e*g+ve*I+we*j+xe*ye,r[12]=(_e=s[12])*l+(ve=s[13])*x+(we=s[14])*z+(xe=s[15])*X,r[13]=_e*u+ve*w+we*R+xe*ie,r[14]=_e*m+ve*E+we*B+xe*he,r[15]=_e*g+ve*I+we*j+xe*ye,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var ur=Np;function Fc(){var r=new hs(3);return hs!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function md(r){return Math.hypot(r[0],r[1],r[2])}function la(r,t,s){var l=new hs(3);return l[0]=r,l[1]=t,l[2]=s,l}function Bo(r,t,s){return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],r}function dh(r,t,s){return r[0]=t[0]*s[0],r[1]=t[1]*s[1],r[2]=t[2]*s[2],r}function gd(r,t,s,l){return r[0]=t[0]+s[0]*l,r[1]=t[1]+s[1]*l,r[2]=t[2]+s[2]*l,r}function Bc(r,t){var s=t[0],l=t[1],u=t[2],m=s*s+l*l+u*u;return m>0&&(m=1/Math.sqrt(m)),r[0]=t[0]*m,r[1]=t[1]*m,r[2]=t[2]*m,r}function yd(r,t,s){var l=s[0],u=s[1],m=s[2],g=t[0],x=t[1],w=t[2],E=u*w-m*x,I=m*g-l*w,z=l*x-u*g,R=u*z-m*I,B=m*E-l*z,j=l*I-u*E,X=2*s[3];return I*=X,z*=X,B*=2,j*=2,r[0]=g+(E*=X)+(R*=2),r[1]=x+I+B,r[2]=w+z+j,r}var Oc,Up=Bo,om=dh,am=md;function xl(r,t,s){var l=t[0],u=t[1],m=t[2],g=t[3];return r[0]=s[0]*l+s[4]*u+s[8]*m+s[12]*g,r[1]=s[1]*l+s[5]*u+s[9]*m+s[13]*g,r[2]=s[2]*l+s[6]*u+s[10]*m+s[14]*g,r[3]=s[3]*l+s[7]*u+s[11]*m+s[15]*g,r}function ph(){var r=new hs(4);return hs!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Vp(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function _d(r,t,s){s*=.5;var l=t[0],u=t[1],m=t[2],g=t[3],x=Math.sin(s),w=Math.cos(s);return r[0]=l*w+g*x,r[1]=u*w+m*x,r[2]=m*w-u*x,r[3]=g*w-l*x,r}function qp(r,t,s){const l=xl([],[r.x,r.y,t,1],s);return new Be(l[0]/l[3],l[1]/l[3])}Fc(),Oc=new hs(4),hs!=Float32Array&&(Oc[0]=0,Oc[1]=0,Oc[2]=0,Oc[3]=0),Fc(),la(1,0,0),la(0,1,0),ph(),ph(),Rc();const vd=la(0,0,0),lm=la(0,0,1);function Gp(r,t){const s=Fc();return vd[2]=t,r.intersectsPlane(vd,lm,s),new Be(s[0],s[1])}class xd extends ud{}function fh(r,{width:t,height:s},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*s*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(t*s*l);return r.width=t,r.height=s,r.data=u,r}function jp(r,{width:t,height:s},l){if(t===r.width&&s===r.height)return;const u=fh({},{width:t,height:s},l);wd(r,u,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,s)},l),r.width=t,r.height=s,r.data=u.data}function wd(r,t,s,l,u,m){if(0===u.width||0===u.height)return t;if(u.width>r.width||u.height>r.height||s.x>r.width-u.width||s.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||l.x>t.width-u.width||l.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,x=t.data;for(let w=0;w<u.height;w++){const E=((s.y+w)*r.width+s.x)*m,I=((l.y+w)*t.width+l.x)*m;for(let z=0;z<u.width*m;z++)x[I+z]=g[E+z]}return t}rt("HeatmapBucket",xd,{omit:["layers"]});class Rs{constructor(t,s){fh(this,t,1,s)}resize(t){jp(this,t,1)}clone(){return new Rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,u,m){wd(t,s,l,u,m,1)}}class hr{constructor(t,s){fh(this,t,4,s)}resize(t){jp(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new hr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,u,m){wd(t,s,l,u,m,4)}}rt("AlphaImage",Rs),rt("RGBAImage",hr);var cm={paint:new se({"heatmap-radius":new ee(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ee(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new te(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Le(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new te(pe.paint_heatmap["heatmap-opacity"])})};function bd(r){const t={},s=r.resolution||256,l=r.clips?r.clips.length:1,u=r.image||new hr({width:s,height:l}),m=(g,x,w)=>{t[r.evaluationKey]=w;const E=r.expression.evaluate(t);u.data[g+x+0]=Math.floor(255*E.r/E.a),u.data[g+x+1]=Math.floor(255*E.g/E.a),u.data[g+x+2]=Math.floor(255*E.b/E.a),u.data[g+x+3]=Math.floor(255*E.a)};if(r.clips)for(let g=0,x=0;g<l;++g,x+=4*s)for(let w=0,E=0;w<s;w++,E+=4){const I=w/(s-1),{start:z,end:R}=r.clips[g];m(x,E,z*(1-I)+R*I)}else for(let g=0,x=0;g<s;g++,x+=4)m(0,x,g/(s-1));return u}var um={paint:new se({"hillshade-illumination-direction":new te(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new te(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new te(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new te(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new te(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new te(pe.paint_hillshade["hillshade-accent-color"])})};const $p=Xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Oo}=$p;var Td=so,Zp=so;function so(r,t,s){s=s||2;var l,u,m,g,x,w,E,I=t&&t.length,z=I?t[0]*s:r.length,R=Wp(r,0,z,s,!0),B=[];if(!R||R.next===R.prev)return B;if(I&&(R=function(X,ie,he,ye){var _e,ve,we,xe=[];for(_e=0,ve=ie.length;_e<ve;_e++)(we=Wp(X,ie[_e]*ye,_e<ve-1?ie[_e+1]*ye:X.length,ye,!1))===we.next&&(we.steiner=!0),xe.push(Fs(we));for(xe.sort(xi),_e=0;_e<xe.length;_e++)ca(xe[_e],he),he=qi(he,he.next);return he}(r,t,R,s)),r.length>80*s){l=m=r[0],u=g=r[1];for(var j=s;j<z;j+=s)(x=r[j])<l&&(l=x),(w=r[j+1])<u&&(u=w),x>m&&(m=x),w>g&&(g=w);E=0!==(E=Math.max(m-l,g-u))?1/E:0}return oo(R,B,s,l,u,E),B}function Wp(r,t,s,l,u){var m,g;if(u===Xa(r,t,s,l)>0)for(m=t;m<s;m+=l)g=lo(m,r[m],r[m+1],g);else for(m=s-l;m>=t;m-=l)g=lo(m,r[m],r[m+1],g);return g&&Ka(g,g.next)&&(Au(g),g=g.next),g}function qi(r,t){if(!r)return r;t||(t=r);var s,l=r;do{if(s=!1,l.steiner||!Ka(l,l.next)&&0!==Pn(l.prev,l,l.next))l=l.next;else{if(Au(l),(l=t=l.prev)===l.next)break;s=!0}}while(s||l!==t);return t}function oo(r,t,s,l,u,m,g){if(r){!g&&m&&function(I,z,R,B){var j=I;do{null===j.z&&(j.z=er(j.x,j.y,z,R,B)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==I);j.prevZ.nextZ=null,j.prevZ=null,function(X){var ie,he,ye,_e,ve,we,xe,Oe,qe=1;do{for(he=X,X=null,ve=null,we=0;he;){for(we++,ye=he,xe=0,ie=0;ie<qe&&(xe++,ye=ye.nextZ);ie++);for(Oe=qe;xe>0||Oe>0&&ye;)0!==xe&&(0===Oe||!ye||he.z<=ye.z)?(_e=he,he=he.nextZ,xe--):(_e=ye,ye=ye.nextZ,Oe--),ve?ve.nextZ=_e:X=_e,_e.prevZ=ve,ve=_e;he=ye}ve.nextZ=null,qe*=2}while(we>1)}(j)}(r,l,u,m);for(var x,w,E=r;r.prev!==r.next;)if(x=r.prev,w=r.next,m?Nr(r,l,u,m):qn(r))t.push(x.i/s),t.push(r.i/s),t.push(w.i/s),Au(r),r=w.next,E=w.next;else if((r=w)===E){g?1===g?oo(r=hm(qi(r),t,s),t,s,l,u,m,2):2===g&&dm(r,t,s,l,u,m):oo(qi(r),t,s,l,u,m,1);break}}}function qn(r){var t=r.prev,s=r,l=r.next;if(Pn(t,s,l)>=0)return!1;for(var u=r.next.next;u!==r.prev;){if(ao(t.x,t.y,s.x,s.y,l.x,l.y,u.x,u.y)&&Pn(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function Nr(r,t,s,l){var u=r.prev,m=r,g=r.next;if(Pn(u,m,g)>=0)return!1;for(var x=u.x>m.x?u.x>g.x?u.x:g.x:m.x>g.x?m.x:g.x,w=u.y>m.y?u.y>g.y?u.y:g.y:m.y>g.y?m.y:g.y,E=er(u.x<m.x?u.x<g.x?u.x:g.x:m.x<g.x?m.x:g.x,u.y<m.y?u.y<g.y?u.y:g.y:m.y<g.y?m.y:g.y,t,s,l),I=er(x,w,t,s,l),z=r.prevZ,R=r.nextZ;z&&z.z>=E&&R&&R.z<=I;){if(z!==r.prev&&z!==r.next&&ao(u.x,u.y,m.x,m.y,g.x,g.y,z.x,z.y)&&Pn(z.prev,z,z.next)>=0||(z=z.prevZ,R!==r.prev&&R!==r.next&&ao(u.x,u.y,m.x,m.y,g.x,g.y,R.x,R.y)&&Pn(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;z&&z.z>=E;){if(z!==r.prev&&z!==r.next&&ao(u.x,u.y,m.x,m.y,g.x,g.y,z.x,z.y)&&Pn(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;R&&R.z<=I;){if(R!==r.prev&&R!==r.next&&ao(u.x,u.y,m.x,m.y,g.x,g.y,R.x,R.y)&&Pn(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function hm(r,t,s){var l=r;do{var u=l.prev,m=l.next.next;!Ka(u,m)&&Hp(u,l,l.next,m)&&$e(u,m)&&$e(m,u)&&(t.push(u.i/s),t.push(l.i/s),t.push(m.i/s),Au(l),Au(l.next),l=r=m),l=l.next}while(l!==r);return qi(l)}function dm(r,t,s,l,u,m){var g=r;do{for(var x=g.next.next;x!==g.prev;){if(g.i!==x.i&&Ha(g,x)){var w=Iu(g,x);return g=qi(g,g.next),w=qi(w,w.next),oo(g,t,s,l,u,m),void oo(w,t,s,l,u,m)}x=x.next}g=g.next}while(g!==r)}function xi(r,t){return r.x-t.x}function ca(r,t){if(t=function(l,u){var m,g=u,x=l.x,w=l.y,E=-1/0;do{if(w<=g.y&&w>=g.next.y&&g.next.y!==g.y){var I=g.x+(w-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(I<=x&&I>E){if(E=I,I===x){if(w===g.y)return g;if(w===g.next.y)return g.next}m=g.x<g.next.x?g:g.next}}g=g.next}while(g!==u);if(!m)return null;if(x===E)return m;var z,R=m,B=m.x,j=m.y,X=1/0;g=m;do{x>=g.x&&g.x>=B&&x!==g.x&&ao(w<j?x:E,w,B,j,w<j?E:x,w,g.x,g.y)&&(z=Math.abs(w-g.y)/(x-g.x),$e(g,l)&&(z<X||z===X&&(g.x>m.x||g.x===m.x&&ds(m,g)))&&(m=g,X=z)),g=g.next}while(g!==R);return m}(r,t)){var s=Iu(t,r);qi(t,t.next),qi(s,s.next)}}function ds(r,t){return Pn(r.prev,r,t.prev)<0&&Pn(t.next,r,r.next)<0}function er(r,t,s,l,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-s)*u)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-l)*u)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Fs(r){var t=r,s=r;do{(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next}while(t!==r);return s}function ao(r,t,s,l,u,m,g,x){return(u-g)*(t-x)-(r-g)*(m-x)>=0&&(r-g)*(l-x)-(s-g)*(t-x)>=0&&(s-g)*(m-x)-(u-g)*(l-x)>=0}function Ha(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(s,l){var u=s;do{if(u.i!==s.i&&u.next.i!==s.i&&u.i!==l.i&&u.next.i!==l.i&&Hp(u,u.next,s,l))return!0;u=u.next}while(u!==s);return!1}(r,t)&&($e(r,t)&&$e(t,r)&&function(s,l){var u=s,m=!1,g=(s.x+l.x)/2,x=(s.y+l.y)/2;do{u.y>x!=u.next.y>x&&u.next.y!==u.y&&g<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(m=!m),u=u.next}while(u!==s);return m}(r,t)&&(Pn(r.prev,r,t.prev)||Pn(r,t.prev,t))||Ka(r,t)&&Pn(r.prev,r,r.next)>0&&Pn(t.prev,t,t.next)>0)}function Pn(r,t,s){return(t.y-r.y)*(s.x-t.x)-(t.x-r.x)*(s.y-t.y)}function Ka(r,t){return r.x===t.x&&r.y===t.y}function Hp(r,t,s,l){var u=Su(Pn(r,t,s)),m=Su(Pn(r,t,l)),g=Su(Pn(s,l,r)),x=Su(Pn(s,l,t));return u!==m&&g!==x||!(0!==u||!Eu(r,s,t))||!(0!==m||!Eu(r,l,t))||!(0!==g||!Eu(s,r,l))||!(0!==x||!Eu(s,t,l))}function Eu(r,t,s){return t.x<=Math.max(r.x,s.x)&&t.x>=Math.min(r.x,s.x)&&t.y<=Math.max(r.y,s.y)&&t.y>=Math.min(r.y,s.y)}function Su(r){return r>0?1:r<0?-1:0}function $e(r,t){return Pn(r.prev,r,r.next)<0?Pn(r,t,r.next)>=0&&Pn(r,r.prev,t)>=0:Pn(r,t,r.prev)<0||Pn(r,r.next,t)<0}function Iu(r,t){var s=new ic(r.i,r.x,r.y),l=new ic(t.i,t.x,t.y),u=r.next,m=t.prev;return r.next=t,t.prev=r,s.next=u,u.prev=s,l.next=s,s.prev=l,m.next=l,l.prev=m,l}function lo(r,t,s,l){var u=new ic(r,t,s);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function Au(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function ic(r,t,s){this.i=r,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xa(r,t,s,l){for(var u=0,m=t,g=s-l;m<s;m+=l)u+=(r[g]-r[m])*(r[m+1]+r[g+1]),g=m;return u}function pm(r,t,s,l,u){wl(r,t,s||0,l||r.length-1,u||Ed)}function wl(r,t,s,l,u){for(;l>s;){if(l-s>600){var m=l-s+1,g=t-s+1,x=Math.log(m),w=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*w*(m-w)/m)*(g-m/2<0?-1:1);wl(r,t,Math.max(s,Math.floor(t-g*w/m+E)),Math.min(l,Math.floor(t+(m-g)*w/m+E)),u)}var I=r[t],z=s,R=l;for(Nc(r,s,t),u(r[l],I)>0&&Nc(r,s,l);z<R;){for(Nc(r,z,R),z++,R--;u(r[z],I)<0;)z++;for(;u(r[R],I)>0;)R--}0===u(r[s],I)?Nc(r,s,R):Nc(r,++R,l),R<=t&&(s=R+1),t<=R&&(l=R-1)}}function Nc(r,t,s){var l=r[t];r[t]=r[s],r[s]=l}function Ed(r,t){return r<t?-1:r>t?1:0}function mh(r,t){const s=r.length;if(s<=1)return[r];const l=[];let u,m;for(let g=0;g<s;g++){const x=fr(r[g]);0!==x&&(r[g].area=Math.abs(x),void 0===m&&(m=x<0),m===x<0?(u&&l.push(u),u=[r[g]]):u.push(r[g]))}if(u&&l.push(u),t>1)for(let g=0;g<l.length;g++)l[g].length<=t||(pm(l[g],t,1,l[g].length-1,ps),l[g]=l[g].slice(0,t));return l}function ps(r,t){return t.area-r.area}function Cu(r,t,s){const l=s.patternDependencies;let u=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(u=!0);const x=g.constantOr(null);x&&(u=!0,l[x.to]=!0,l[x.from]=!0)}return u}function ku(r,t,s,l,u){const m=u.patternDependencies;for(const g of t){const x=g.paint.get(`${r}-pattern`).value;if("constant"!==x.kind){let w=x.evaluate({zoom:l-1},s,{},u.availableImages),E=x.evaluate({zoom:l},s,{},u.availableImages),I=x.evaluate({zoom:l+1},s,{},u.availableImages);w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,m[w]=!0,m[E]=!0,m[I]=!0,s.patterns[g.id]={min:w,mid:E,max:I}}}return s}so.deviation=function(r,t,s,l){var u=t&&t.length,m=Math.abs(Xa(r,0,u?t[0]*s:r.length,s));if(u)for(var g=0,x=t.length;g<x;g++)m-=Math.abs(Xa(r,t[g]*s,g<x-1?t[g+1]*s:r.length,s));var w=0;for(g=0;g<l.length;g+=3){var E=l[g]*s,I=l[g+1]*s,z=l[g+2]*s;w+=Math.abs((r[E]-r[z])*(r[I+1]-r[E+1])-(r[E]-r[I])*(r[z+1]-r[E+1]))}return 0===m&&0===w?0:Math.abs((w-m)/m)},so.flatten=function(r){for(var t=r[0][0].length,s={vertices:[],holes:[],dimensions:t},l=0,u=0;u<r.length;u++){for(var m=0;m<r[u].length;m++)for(var g=0;g<t;g++)s.vertices.push(r[u][m][g]);u>0&&s.holes.push(l+=r[u-1].length)}return s},Td.default=Zp;class ua{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ft,this.indexArray=new An,this.indexArray2=new us,this.programConfigurations=new _l(t.layers,t.zoom),this.segments=new en,this.segments2=new en,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=Cu("fill",this.layers,s);const u=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:g,id:x,index:w,sourceLayerIndex:E}of t){const I=this.layers[0]._featureFilter.needGeometry,z=nc(g,I);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),z,l))continue;const R=u?u.evaluate(z,{},l,s.availableImages):void 0,B={id:x,properties:g.properties,type:g.type,sourceLayerIndex:E,index:w,geometry:I?z.geometry:vl(g),patterns:{},sortKey:R};m.push(B)}u&&m.sort((g,x)=>g.sortKey-x.sortKey);for(const g of m){const{geometry:x,index:w,sourceLayerIndex:E}=g;if(this.hasPattern){const I=ku("fill",this.layers,g,this.zoom,s);this.patternFeatures.push(I)}else this.addFeature(g,x,w,l,{});s.featureIndex.insert(t[w].feature,x,w,E,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,s,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Oo),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,l,u,m){for(const g of mh(s,500)){let x=0;for(const B of g)x+=B.length;const w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),E=w.vertexLength,I=[],z=[];for(const B of g){if(0===B.length)continue;B!==g[0]&&z.push(I.length/2);const j=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),X=j.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(X+B.length-1,X),I.push(B[0].x),I.push(B[0].y);for(let ie=1;ie<B.length;ie++)this.layoutVertexArray.emplaceBack(B[ie].x,B[ie].y),this.indexArray2.emplaceBack(X+ie-1,X+ie),I.push(B[ie].x),I.push(B[ie].y);j.vertexLength+=B.length,j.primitiveLength+=B.length}const R=Td(I,z);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(E+R[B],E+R[B+1],E+R[B+2]);w.vertexLength+=x,w.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,m,u)}}rt("FillBucket",ua,{omit:["layers","patternFeatures"]});const Kp=new se({"fill-sort-key":new ee(pe.layout_fill["fill-sort-key"])});var Sd={paint:new se({"fill-antialias":new te(pe.paint_fill["fill-antialias"]),"fill-opacity":new ee(pe.paint_fill["fill-opacity"]),"fill-color":new ee(pe.paint_fill["fill-color"]),"fill-outline-color":new ee(pe.paint_fill["fill-outline-color"]),"fill-translate":new te(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new te(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ae(pe.paint_fill["fill-pattern"])}),layout:Kp};const Xp=Xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Id=Xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Yp}=Xp;var rc=No;function No(r,t,s,l,u){this.properties={},this.extent=s,this.type=0,this._pbf=r,this._geometry=-1,this._keys=l,this._values=u,r.readFields(Uc,this,t)}function Uc(r,t,s){1==r?t.id=s.readVarint():2==r?function(l,u){for(var m=l.readVarint()+l.pos;l.pos<m;){var g=u._keys[l.readVarint()],x=u._values[l.readVarint()];u.properties[g]=x}}(s,t):3==r?t.type=s.readVarint():4==r&&(t._geometry=s.pos)}function Mu(r){for(var t,s,l=0,u=0,m=r.length,g=m-1;u<m;g=u++)l+=((s=r[g]).x-(t=r[u]).x)*(t.y+s.y);return l}No.types=["Unknown","Point","LineString","Polygon"],No.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,s=r.readVarint()+r.pos,l=1,u=0,m=0,g=0,x=[];r.pos<s;){if(u<=0){var w=r.readVarint();l=7&w,u=w>>3}if(u--,1===l||2===l)m+=r.readSVarint(),g+=r.readSVarint(),1===l&&(t&&x.push(t),t=[]),t.push(new Be(m,g));else{if(7!==l)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&x.push(t),x},No.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,s=1,l=0,u=0,m=0,g=1/0,x=-1/0,w=1/0,E=-1/0;r.pos<t;){if(l<=0){var I=r.readVarint();s=7&I,l=I>>3}if(l--,1===s||2===s)(u+=r.readSVarint())<g&&(g=u),u>x&&(x=u),(m+=r.readSVarint())<w&&(w=m),m>E&&(E=m);else if(7!==s)throw new Error("unknown command "+s)}return[g,w,x,E]},No.prototype.toGeoJSON=function(r,t,s){var l,u,m=this.extent*Math.pow(2,s),g=this.extent*r,x=this.extent*t,w=this.loadGeometry(),E=No.types[this.type];function I(B){for(var j=0;j<B.length;j++){var X=B[j];B[j]=[360*(X.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(l=0;l<w.length;l++)z[l]=w[l][0];I(w=z);break;case 2:for(l=0;l<w.length;l++)I(w[l]);break;case 3:for(w=function(B){var j=B.length;if(j<=1)return[B];for(var X,ie,he=[],ye=0;ye<j;ye++){var _e=Mu(B[ye]);0!==_e&&(void 0===ie&&(ie=_e<0),ie===_e<0?(X&&he.push(X),X=[B[ye]]):X.push(B[ye]))}return X&&he.push(X),he}(w),l=0;l<w.length;l++)for(u=0;u<w[l].length;u++)I(w[l][u])}1===w.length?w=w[0]:E="Multi"+E;var R={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Ad=gh;function gh(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(fm,this,t),this.length=this._features.length}function fm(r,t,s){15===r?t.version=s.readVarint():1===r?t.name=s.readString():5===r?t.extent=s.readVarint():2===r?t._features.push(s.pos):3===r?t._keys.push(s.readString()):4===r&&t._values.push(function(l){for(var u=null,m=l.readVarint()+l.pos;l.pos<m;){var g=l.readVarint()>>3;u=1===g?l.readString():2===g?l.readFloat():3===g?l.readDouble():4===g?l.readVarint64():5===g?l.readVarint():6===g?l.readSVarint():7===g?l.readBoolean():null}return u}(s))}function Qp(r,t,s){if(3===r){var l=new Ad(s,s.readVarint()+s.pos);l.length&&(t[l.name]=l)}}gh.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new rc(this._pbf,t,this.extent,this._keys,this._values)};var bl={VectorTile:function(r,t){this.layers=r.readFields(Qp,{},t)},VectorTileFeature:rc,VectorTileLayer:Ad};const mm=bl.VectorTileFeature.types,Cd=Math.pow(2,13);function Pu(r,t,s,l,u,m,g,x){r.emplaceBack((t<<1)+g,(s<<1)+m,(Math.floor(l*Cd)<<1)+u,Math.round(x))}class kd{constructor(){this.acc=new Be(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Be(t.x,t.y),this.max=new Be(t.x,t.y))}append(t,s){this.currentPolyCount.edges++,this.acc._add(t);let l=!!this.borders;const u=this.min,m=this.max;t.x<u.x?(u.x=t.x,l=!0):t.x>m.x&&(m.x=t.x,l=!0),t.y<u.y?(u.y=t.y,l=!0):t.y>m.y&&(m.y=t.y,l=!0),((0===t.x||t.x===Jt)&&t.x===s.x)!=((0===t.y||t.y===Jt)&&t.y===s.y)&&this.processBorderOverlap(t,s),l&&this.checkBorderIntersection(t,s)}checkBorderIntersection(t,s){s.x<0!=t.x<0&&this.addBorderIntersection(0,Nt(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>Jt!=t.x>Jt&&this.addBorderIntersection(1,Nt(s.y,t.y,(Jt-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,Nt(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>Jt!=t.y>Jt&&this.addBorderIntersection(3,Nt(s.x,t.x,(Jt-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[t];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;const l=0===t.x?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,t.y)}else{const l=0===t.y?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,t.x)}}centroid(){const t=this.polyCount.reduce((s,l)=>s+l.edges,0);return 0!==t?this.acc.div(t)._round():new Be(0,0)}span(){return new Be(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0)}}class yh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Kt,this.centroidVertexArray=new Mp,this.indexArray=new An,this.programConfigurations=new _l(t.layers,t.zoom),this.segments=new en,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=t.enableTerrain}populate(t,s,l){this.features=[],this.hasPattern=Cu("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(u){const m=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*m/(m*m+1)/Jt/(1<<u.z)}(l);for(const{feature:u,id:m,index:g,sourceLayerIndex:x}of t){const w=this.layers[0]._featureFilter.needGeometry,E=nc(u,w);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),E,l))continue;const I={id:m,sourceLayerIndex:x,index:g,geometry:w?E.geometry:vl(u),properties:u.properties,type:u.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(ku("fill-extrusion",this.layers,I,this.zoom,s)):this.addFeature(I,I.geometry,g,l,{}),s.featureIndex.insert(u,I.geometry,g,x,this.index,z)}this.sortBorders()}addFeatures(t,s,l){for(const u of this.features){const{geometry:m}=u;this.addFeature(u,m,u.index,s,l)}this.sortBorders()}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Id.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,l,u,m){const g=this.enableTerrain?new kd:null;for(const w of mh(s,500)){let E=0,I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===w.length||(x=w[0]).every(X=>X.x<=0)||x.every(X=>X.x>=Jt)||x.every(X=>X.y<=0)||x.every(X=>X.y>=Jt))continue;for(let X=0;X<w.length;X++){const ie=w[X];if(0===ie.length)continue;E+=ie.length;let he=0;g&&g.startRing(ie[0]);for(let ye=0;ye<ie.length;ye++){const _e=ie[ye];if(ye>=1){const ve=ie[ye-1];if(!fs(_e,ve)){g&&g.append(_e,ve),I.vertexLength+4>en.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const we=_e.sub(ve)._perp(),xe=we.x/(Math.abs(we.x)+Math.abs(we.y)),Oe=we.y>0?1:0,qe=ve.dist(_e);he+qe>32768&&(he=0),Pu(this.layoutVertexArray,_e.x,_e.y,xe,Oe,0,0,he),Pu(this.layoutVertexArray,_e.x,_e.y,xe,Oe,0,1,he),he+=qe,Pu(this.layoutVertexArray,ve.x,ve.y,xe,Oe,0,0,he),Pu(this.layoutVertexArray,ve.x,ve.y,xe,Oe,0,1,he);const Fe=I.vertexLength;this.indexArray.emplaceBack(Fe,Fe+2,Fe+1),this.indexArray.emplaceBack(Fe+1,Fe+2,Fe+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+E>en.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray)),"Polygon"!==mm[t.type])continue;const z=[],R=[],B=I.vertexLength;for(let X=0;X<w.length;X++){const ie=w[X];if(0!==ie.length){ie!==w[0]&&R.push(z.length/2);for(let he=0;he<ie.length;he++){const ye=ie[he];Pu(this.layoutVertexArray,ye.x,ye.y,0,0,1,1,0),z.push(ye.x),z.push(ye.y),g&&g.currentPolyCount.top++}}}const j=Td(z,R);for(let X=0;X<j.length;X+=3)this.indexArray.emplaceBack(B+j[X],B+j[X+2],B+j[X+1]);I.primitiveLength+=j.length/3,I.vertexLength+=E}var x;if(g&&g.polyCount.length>0){if(g.borders){g.vertexArrayOffset=this.centroidVertexArray.length;const w=g.borders,E=this.featuresOnBorder.push(g)-1;for(let I=0;I<4;I++)w[I][0]!==Number.MAX_VALUE&&this.borders[I].push(E)}this.encodeCentroid(g.borders?void 0:g.centroid(),g)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,m,u)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((s,l)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[l].borders[t][0])}encodeCentroid(t,s,l=!0){let u,m;if(t)if(0!==t.y){const x=s.span()._mult(this.tileToMeter);u=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(t.x+450)),m=0;else u=0,m=+l;let g=l?this.centroidVertexArray.length:s.vertexArrayOffset;for(const x of s.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(g++,0,m),this.centroidVertexArray.emplace(g++,u,m);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(g++,u,m)}}}function fs(r,t){return r.x===t.x&&(r.x<0||r.x>Jt)||r.y===t.y&&(r.y<0||r.y>Jt)}rt("FillExtrusionBucket",yh,{omit:["layers","features"]}),rt("PartMetadata",kd);var Jp={paint:new se({"fill-extrusion-opacity":new te(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ee(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new te(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new te(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ae(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ee(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ee(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new te(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Tl(r,t){return r.x*t.x+r.y*t.y}function _h(r,t){if(1===r.length){let s=0;const l=t[s++];let u;for(;!u||l.equals(u);)if(u=t[s++],!u)return 1/0;for(;s<t.length;s++){const m=t[s],g=r[0],x=u.sub(l),w=m.sub(l),E=g.sub(l),I=Tl(x,x),z=Tl(x,w),R=Tl(w,w),B=Tl(E,x),j=Tl(E,w),X=I*R-z*z,ie=(R*B-z*j)/X,he=(I*j-z*B)/X,ye=l.z*(1-ie-he)+u.z*ie+m.z*he;if(isFinite(ye))return ye}return 1/0}{let s=1/0;for(const l of t)s=Math.min(s,l.z);return s}}function Md(r){const t=new Be(r[0],r[1]);return t.z=r[2],t}function El(r,t,s,l,u,m,g,x){const w=g*u.getElevationAt(r,t,!0,!0),E=0!==m[0],I=E?0===m[1]?g*(m[0]/7-450):g*function(z,R,B){const j=Math.floor(R[0]/8),X=Math.floor(R[1]/8),ie=10*(R[0]-8*j),he=10*(R[1]-8*X),ye=z.getElevationAt(j,X,!0,!0),_e=z.getMeterToDEM(B),ve=Math.floor(.5*(ie*_e-1)),we=Math.floor(.5*(he*_e-1)),xe=z.tileCoordToPixel(j,X),Oe=2*ve+1,qe=2*we+1,Fe=(bt=Oe,st=qe,[(_t=z).getElevationAtPixel(Lt=xe.x-ve,Rt=xe.y-we,!0),_t.getElevationAtPixel(Lt+st,Rt,!0),_t.getElevationAtPixel(Lt,Rt+st,!0),_t.getElevationAtPixel(Lt+bt,Rt+st,!0)]),He=Math.abs(Fe[0]-Fe[1]),ze=Math.abs(Fe[2]-Fe[3]),Re=Math.abs(Fe[0]-Fe[2])+Math.abs(Fe[1]-Fe[3]),Ke=Math.min(.25,.5*_e*(He+ze)/Oe),Pe=Math.min(.25,.5*_e*Re/qe);var _t,Lt,Rt,bt,st;return ye+Math.max(Ke*ie,Pe*he)}(u,m,x):w;return{base:w+(0===s)?-1:s,top:E?Math.max(I+l,w+s+2):w+l}}const Vc=Xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ef}=Vc,sc=Xe([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:gm}=sc,qc=bl.VectorTileFeature.types,tf=Math.cos(Math.PI/180*37.5);class ha{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new _n,this.layoutVertexArray2=new vn,this.indexArray=new An,this.programConfigurations=new _l(t.layers,t.zoom),this.segments=new en,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=Cu("line",this.layers,s);const u=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:E,id:I,index:z,sourceLayerIndex:R}of t){const B=this.layers[0]._featureFilter.needGeometry,j=nc(E,B);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),j,l))continue;const X=u?u.evaluate(j,{},l):void 0,ie={id:I,properties:E.properties,type:E.type,sourceLayerIndex:R,index:z,geometry:B?j.geometry:vl(E),patterns:{},sortKey:X};m.push(ie)}u&&m.sort((E,I)=>E.sortKey-I.sortKey);const{lineAtlas:g,featureIndex:x}=s,w=this.addConstantDashes(g);for(const E of m){const{geometry:I,index:z,sourceLayerIndex:R}=E;if(w&&this.addFeatureDashes(E,g),this.hasPattern){const B=ku("line",this.layers,E,this.zoom,s);this.patternFeatures.push(B)}else this.addFeature(E,I,z,l,g.positions);x.insert(t[z].feature,I,z,R,this.index)}}addConstantDashes(t){let s=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==m.kind)s=!0;else{const g=m.value,x=u.value;if(!x)continue;t.addDash(x.from,g),t.addDash(x.to,g),x.other&&t.addDash(x.other,g)}}return s}addFeatureDashes(t,s){const l=this.zoom;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===g.kind)continue;let x,w,E,I,z,R;if("constant"===m.kind){const ie=m.value;if(!ie)continue;x=ie.other||ie.to,w=ie.to,E=ie.from}else x=m.evaluate({zoom:l-1},t),w=m.evaluate({zoom:l},t),E=m.evaluate({zoom:l+1},t);"constant"===g.kind?I=z=R=g.value:(I=g.evaluate({zoom:l-1},t),z=g.evaluate({zoom:l},t),R=g.evaluate({zoom:l+1},t)),s.addDash(x,I),s.addDash(w,z),s.addDash(E,R);const B=s.getKey(x,I),j=s.getKey(w,z),X=s.getKey(E,R);t.patterns[u.id]={min:B,mid:j,max:X}}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,s,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,gm)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ef),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,l,u,m){const g=this.layers[0].layout,x=g.get("line-join").evaluate(t,{}),w=g.get("line-cap").evaluate(t,{}),E=g.get("line-miter-limit"),I=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of s)this.addLine(z,t,x,w,E,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,m,u)}addLine(t,s,l,u,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<t.length-1;he++)this.totalDistance+=t[he].dist(t[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===qc[s.type];let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(x?3:2))return;"bevel"===l&&(m=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let R,B,j,X,ie;this.e1=this.e2=-1,x&&(R=t[w-2],ie=t[E].sub(R)._unit()._perp());for(let he=E;he<w;he++){if(j=he===w-1?x?t[E+1]:void 0:t[he+1],j&&t[he].equals(j))continue;ie&&(X=ie),R&&(B=R),R=t[he],ie=j?j.sub(R)._unit()._perp():X,X=X||ie;let ye=X.add(ie);0===ye.x&&0===ye.y||ye._unit();const _e=X.x*ie.x+X.y*ie.y,ve=ye.x*ie.x+ye.y*ie.y,we=0!==ve?1/ve:1/0,xe=2*Math.sqrt(2-2*ve),Oe=ve<tf&&B&&j,qe=X.x*ie.y-X.y*ie.x>0;if(Oe&&he>E){const ze=R.dist(B);if(ze>2*I){const Re=R.sub(R.sub(B)._mult(I/ze)._round());this.updateDistance(B,Re),this.addCurrentVertex(Re,X,0,0,z),B=Re}}const Fe=B&&j;let He=Fe?l:x?"butt":u;if(Fe&&"round"===He&&(we<g?He="miter":we<=2&&(He="fakeround")),"miter"===He&&we>m&&(He="bevel"),"bevel"===He&&(we>2&&(He="flipbevel"),we<m&&(He="miter")),B&&this.updateDistance(B,R),"miter"===He)ye._mult(we),this.addCurrentVertex(R,ye,0,0,z);else if("flipbevel"===He){if(we>100)ye=ie.mult(-1);else{const ze=we*X.add(ie).mag()/X.sub(ie).mag();ye._perp()._mult(ze*(qe?-1:1))}this.addCurrentVertex(R,ye,0,0,z),this.addCurrentVertex(R,ye.mult(-1),0,0,z)}else if("bevel"===He||"fakeround"===He){const ze=-Math.sqrt(we*we-1),Re=qe?ze:0,Ke=qe?0:ze;if(B&&this.addCurrentVertex(R,X,Re,Ke,z),"fakeround"===He){const Pe=Math.round(180*xe/Math.PI/20);for(let _t=1;_t<Pe;_t++){let Lt=_t/Pe;if(.5!==Lt){const bt=Lt-.5;Lt+=Lt*bt*(Lt-1)*((1.0904+_e*(_e*(3.55645-1.43519*_e)-3.2452))*bt*bt+(.848013+_e*(.215638*_e-1.06021)))}const Rt=ie.sub(X)._mult(Lt)._add(X)._unit()._mult(qe?-1:1);this.addHalfVertex(R,Rt.x,Rt.y,!1,qe,0,z)}}j&&this.addCurrentVertex(R,ie,-Re,-Ke,z)}else if("butt"===He)this.addCurrentVertex(R,ye,0,0,z);else if("square"===He){const ze=B?1:-1;B||this.addCurrentVertex(R,ye,ze,ze,z),this.addCurrentVertex(R,ye,0,0,z),B&&this.addCurrentVertex(R,ye,ze,ze,z)}else"round"===He&&(B&&(this.addCurrentVertex(R,X,0,0,z),this.addCurrentVertex(R,X,1,1,z,!0)),j&&(this.addCurrentVertex(R,ie,-1,-1,z,!0),this.addCurrentVertex(R,ie,0,0,z)));if(Oe&&he<w-1){const ze=R.dist(j);if(ze>2*I){const Re=R.add(j.sub(R)._mult(I/ze)._round());this.updateDistance(R,Re),this.addCurrentVertex(Re,ie,0,0,z),R=Re}}}}addCurrentVertex(t,s,l,u,m,g=!1){const x=s.y*u-s.x,w=-s.y-s.x*u;this.addHalfVertex(t,s.x+s.y*l,s.y-s.x*l,g,!1,l,m),this.addHalfVertex(t,x,w,g,!0,-u,m)}addHalfVertex({x:t,y:s},l,u,m,g,x,w){this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(s<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}rt("LineBucket",ha,{omit:["layers","patternFeatures"]});const oc=new se({"line-cap":new ee(pe.layout_line["line-cap"]),"line-join":new ee(pe.layout_line["line-join"]),"line-miter-limit":new te(pe.layout_line["line-miter-limit"]),"line-round-limit":new te(pe.layout_line["line-round-limit"]),"line-sort-key":new ee(pe.layout_line["line-sort-key"])});var vh={paint:new se({"line-opacity":new ee(pe.paint_line["line-opacity"]),"line-color":new ee(pe.paint_line["line-color"]),"line-translate":new te(pe.paint_line["line-translate"]),"line-translate-anchor":new te(pe.paint_line["line-translate-anchor"]),"line-width":new ee(pe.paint_line["line-width"]),"line-gap-width":new ee(pe.paint_line["line-gap-width"]),"line-offset":new ee(pe.paint_line["line-offset"]),"line-blur":new ee(pe.paint_line["line-blur"]),"line-dasharray":new Ae(pe.paint_line["line-dasharray"]),"line-pattern":new Ae(pe.paint_line["line-pattern"]),"line-gradient":new Le(pe.paint_line["line-gradient"])}),layout:oc};const Pd=new class extends ee{possiblyEvaluate(r,t){return t=new q(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(r,t)}evaluate(r,t,s,l){return t=Tt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(r,t,s,l)}}(vh.paint.properties["line-width"].specification);function nf(r,t){return t>0?t+2*r:r}Pd.useIntegerZoom=!0;const ym=Xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_m=Xe([{name:"a_projected_pos",components:3,type:"Float32"}],4);Xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vm=Xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),xh=Xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Xe([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ac=Xe([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rf=Xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Xe([{name:"triangle",components:3,type:"Uint16"}]),Xe([{type:"Float32",name:"anchorX"},{type:"Float32",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Xe([{type:"Float32",name:"anchorX"},{type:"Float32",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Xe([{type:"Float32",name:"offsetX"}]),Xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const da=128;function wh(r,t){const{expression:s}=t;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new q(r+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:u}=s;let m=0;for(;m<l.length&&l[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<l.length&&l[g]<r+1;)g++;g=Math.min(l.length-1,g);const x=l[m],w=l[g];return"composite"===s.kind?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:w,minSize:s.evaluate(new q(x)),maxSize:s.evaluate(new q(w)),interpolationType:u}}}function Uo(r,{uSize:t,uSizeT:s},{lowerSize:l,upperSize:u}){return"source"===r.kind?l/da:"composite"===r.kind?Nt(l/da,u/da,s):t}function Ya(r,t){let s=0,l=0;if("constant"===r.kind)l=r.layoutSize;else if("source"!==r.kind){const{interpolationType:u,minZoom:m,maxZoom:g}=r,x=u?dn(Ai.interpolationFactor(u,t,m,g),0,1):0;"camera"===r.kind?l=Nt(r.minSize,r.maxSize,x):s=x}return{uSizeT:s,uSize:l}}var xm=Object.freeze({__proto__:null,getSizeData:wh,evaluateSizeForFeature:Uo,evaluateSizeForZoom:Ya,SIZE_PACK_FACTOR:da});function sf(r,t,s){return r.sections.forEach(l=>{l.text=function(u,m,g){const x=m.layout.get("text-transform").evaluate(g,{});return"uppercase"===x?u=u.toLocaleUpperCase():"lowercase"===x&&(u=u.toLocaleLowerCase()),U.applyArabicShaping&&(u=U.applyArabicShaping(u)),u}(l.text,t,s)}),r}const lc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Dd(r){return"\ufe36"===r||"\ufe48"===r||"\ufe38"===r||"\ufe44"===r||"\ufe42"===r||"\ufe3e"===r||"\ufe3c"===r||"\ufe3a"===r||"\ufe18"===r||"\ufe40"===r||"\ufe10"===r||"\ufe13"===r||"\ufe14"===r||"\uff40"===r||"\uffe3"===r||"\ufe11"===r||"\ufe12"===r}function Du(r){return"\ufe35"===r||"\ufe47"===r||"\ufe37"===r||"\ufe43"===r||"\ufe41"===r||"\ufe3d"===r||"\ufe3b"===r||"\ufe39"===r||"\ufe17"===r||"\ufe3f"===r}var zu=function(r,t,s,l,u){var m,g,x=8*u-l-1,w=(1<<x)-1,E=w>>1,I=-7,z=s?u-1:0,R=s?-1:1,B=r[t+z];for(z+=R,m=B&(1<<-I)-1,B>>=-I,I+=x;I>0;m=256*m+r[t+z],z+=R,I-=8);for(g=m&(1<<-I)-1,m>>=-I,I+=l;I>0;g=256*g+r[t+z],z+=R,I-=8);if(0===m)m=1-E;else{if(m===w)return g?NaN:1/0*(B?-1:1);g+=Math.pow(2,l),m-=E}return(B?-1:1)*g*Math.pow(2,m-l)},bh=function(r,t,s,l,u,m){var g,x,w,E=8*m-u-1,I=(1<<E)-1,z=I>>1,R=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,B=l?0:m-1,j=l?1:-1,X=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,g=I):(g=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-g))<1&&(g--,w*=2),(t+=g+z>=1?R/w:R*Math.pow(2,1-z))*w>=2&&(g++,w/=2),g+z>=I?(x=0,g=I):g+z>=1?(x=(t*w-1)*Math.pow(2,u),g+=z):(x=t*Math.pow(2,z-1)*Math.pow(2,u),g=0));u>=8;r[s+B]=255&x,B+=j,x/=256,u-=8);for(g=g<<u|x,E+=u;E>0;r[s+B]=255&g,B+=j,g/=256,E-=8);r[s+B-j]|=128*X},Lu=hn;function hn(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}hn.Varint=0,hn.Fixed64=1,hn.Bytes=2,hn.Fixed32=5;var Ru=4294967296,zd=1/Ru,of="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function pa(r){return r.type===hn.Bytes?r.readVarint()+r.pos:r.pos+1}function Th(r,t,s){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(l);for(var u=s.pos-1;u>=r;u--)s.buf[u+l]=s.buf[u]}function wm(r,t){for(var s=0;s<r.length;s++)t.writeVarint(r[s])}function af(r,t){for(var s=0;s<r.length;s++)t.writeSVarint(r[s])}function bm(r,t){for(var s=0;s<r.length;s++)t.writeFloat(r[s])}function lf(r,t){for(var s=0;s<r.length;s++)t.writeDouble(r[s])}function Tm(r,t){for(var s=0;s<r.length;s++)t.writeBoolean(r[s])}function Gc(r,t){for(var s=0;s<r.length;s++)t.writeFixed32(r[s])}function jc(r,t){for(var s=0;s<r.length;s++)t.writeSFixed32(r[s])}function Ld(r,t){for(var s=0;s<r.length;s++)t.writeFixed64(r[s])}function Eh(r,t){for(var s=0;s<r.length;s++)t.writeSFixed64(r[s])}function Fu(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function uc(r,t,s){r[s]=t,r[s+1]=t>>>8,r[s+2]=t>>>16,r[s+3]=t>>>24}function cf(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}function Rd(r,t,s){t.glyphs=[],1===r&&s.readMessage(Em,t)}function Em(r,t,s){if(3===r){const{id:l,bitmap:u,width:m,height:g,left:x,top:w,advance:E}=s.readMessage(Fd,{});t.glyphs.push({id:l,bitmap:new Rs({width:m+6,height:g+6},u),metrics:{width:m,height:g,left:x,top:w,advance:E}})}else 4===r?t.ascender=s.readSVarint():5===r&&(t.descender=s.readSVarint())}function Fd(r,t,s){1===r?t.id=s.readVarint():2===r?t.bitmap=s.readBytes():3===r?t.width=s.readVarint():4===r?t.height=s.readVarint():5===r?t.left=s.readSVarint():6===r?t.top=s.readSVarint():7===r&&(t.advance=s.readVarint())}function Bd(r){let t=0,s=0;for(const g of r)t+=g.w*g.h,s=Math.max(s,g.w);r.sort((g,x)=>x.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let u=0,m=0;for(const g of r)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,m=Math.max(m,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===w.w&&g.h===w.h){const E=l.pop();x<l.length&&(l[x]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(l.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:u,h:m,fill:t/(u*m)||0}}hn.prototype={destroy:function(){this.buf=null},readFields:function(r,t,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),u=l>>3,m=this.pos;this.type=7&l,r(u,t,this),this.pos===m&&this.skip(l)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Fu(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=cf(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Fu(this.buf,this.pos)+Fu(this.buf,this.pos+4)*Ru;return this.pos+=8,r},readSFixed64:function(){var r=Fu(this.buf,this.pos)+cf(this.buf,this.pos+4)*Ru;return this.pos+=8,r},readFloat:function(){var r=zu(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=zu(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,s,l=this.buf;return t=127&(s=l[this.pos++]),s<128?t:(t|=(127&(s=l[this.pos++]))<<7,s<128?t:(t|=(127&(s=l[this.pos++]))<<14,s<128?t:(t|=(127&(s=l[this.pos++]))<<21,s<128?t:function(u,m,g){var x,w,E=g.buf;if(x=(112&(w=E[g.pos++]))>>4,w<128||(x|=(127&(w=E[g.pos++]))<<3,w<128)||(x|=(127&(w=E[g.pos++]))<<10,w<128)||(x|=(127&(w=E[g.pos++]))<<17,w<128)||(x|=(127&(w=E[g.pos++]))<<24,w<128)||(x|=(1&(w=E[g.pos++]))<<31,w<128))return function(r,t,s){return s?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}(u,x,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=l[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&of?of.decode(this.buf.subarray(t,r)):function(s,l,u){for(var m="",g=l;g<u;){var x,w,E,I=s[g],z=null,R=I>239?4:I>223?3:I>191?2:1;if(g+R>u)break;1===R?I<128&&(z=I):2===R?128==(192&(x=s[g+1]))&&(z=(31&I)<<6|63&x)<=127&&(z=null):3===R?(w=s[g+2],128==(192&(x=s[g+1]))&&128==(192&w)&&((z=(15&I)<<12|(63&x)<<6|63&w)<=2047||z>=55296&&z<=57343)&&(z=null)):4===R&&(w=s[g+2],E=s[g+3],128==(192&(x=s[g+1]))&&128==(192&w)&&128==(192&E)&&((z=(15&I)<<18|(63&x)<<12|(63&w)<<6|63&E)<=65535||z>=1114112)&&(z=null)),null===z?(z=65533,R=1):z>65535&&(z-=65536,m+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),m+=String.fromCharCode(z),g+=R}return m}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==hn.Bytes)return r.push(this.readVarint(t));var s=pa(this);for(r=r||[];this.pos<s;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==hn.Bytes)return r.push(this.readSVarint());var t=pa(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==hn.Bytes)return r.push(this.readBoolean());var t=pa(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==hn.Bytes)return r.push(this.readFloat());var t=pa(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==hn.Bytes)return r.push(this.readDouble());var t=pa(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==hn.Bytes)return r.push(this.readFixed32());var t=pa(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==hn.Bytes)return r.push(this.readSFixed32());var t=pa(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==hn.Bytes)return r.push(this.readFixed64());var t=pa(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==hn.Bytes)return r.push(this.readSFixed64());var t=pa(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===hn.Varint)for(;this.buf[this.pos++]>127;);else if(t===hn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===hn.Fixed32)this.pos+=4;else{if(t!==hn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),uc(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),uc(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),uc(this.buf,-1&r,this.pos),uc(this.buf,Math.floor(r*zd),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),uc(this.buf,-1&r,this.pos),uc(this.buf,Math.floor(r*zd),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,s){var l,u,m,x;if(t>=0?(l=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,u=u+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),m=l,(x=s).buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7),function(m,g){var x=(7&m)<<4;g.buf[g.pos++]|=x|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(u,s)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(l,u,m){for(var g,x,w=0;w<u.length;w++){if((g=u.charCodeAt(w))>55295&&g<57344){if(!x){g>56319||w+1===u.length?(l[m++]=239,l[m++]=191,l[m++]=189):x=g;continue}if(g<56320){l[m++]=239,l[m++]=191,l[m++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(l[m++]=239,l[m++]=191,l[m++]=189,x=null);g<128?l[m++]=g:(g<2048?l[m++]=g>>6|192:(g<65536?l[m++]=g>>12|224:(l[m++]=g>>18|240,l[m++]=g>>12&63|128),l[m++]=g>>6&63|128),l[m++]=63&g|128)}return m}(this.buf,r,this.pos);var s=this.pos-t;s>=128&&Th(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(r){this.realloc(4),bh(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),bh(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=r[s]},writeRawMessage:function(r,t){this.pos++;var s=this.pos;r(t,this);var l=this.pos-s;l>=128&&Th(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(r,t,s){this.writeTag(r,hn.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,wm,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,af,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,Tm,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,bm,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,lf,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,Gc,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,jc,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,Ld,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,Eh,t)},writeBytesField:function(r,t){this.writeTag(r,hn.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,hn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,hn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,hn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,hn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,hn.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,hn.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,hn.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,hn.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,hn.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,Boolean(t))}};class Bu{constructor(t,{pixelRatio:s,version:l,stretchX:u,stretchY:m,content:g}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=u,this.stretchY=m,this.content=g,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class uf{constructor(t,s){const l={},u={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,l,m),this.addImages(s,u,m);const{w:g,h:x}=Bd(m),w=new hr({width:g||1,height:x||1});for(const E in t){const I=t[E],z=l[E].paddedRect;hr.copy(I.data,w,{x:0,y:0},{x:z.x+1,y:z.y+1},I.data)}for(const E in s){const I=s[E],z=u[E].paddedRect,R=z.x+1,B=z.y+1,j=I.data.width,X=I.data.height;hr.copy(I.data,w,{x:0,y:0},{x:R,y:B},I.data),hr.copy(I.data,w,{x:0,y:X-1},{x:R,y:B-1},{width:j,height:1}),hr.copy(I.data,w,{x:0,y:0},{x:R,y:B+X},{width:j,height:1}),hr.copy(I.data,w,{x:j-1,y:0},{x:R-1,y:B},{width:1,height:X}),hr.copy(I.data,w,{x:0,y:0},{x:R+j,y:B},{width:1,height:X})}this.image=w,this.iconPositions=l,this.patternPositions=u}addImages(t,s,l){for(const u in t){const m=t[u],g={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(g),s[u]=new Bu(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),s)}patchUpdatedImage(t,s,l){if(!t||!s||t.version===s.version)return;t.version=s.version;const[u,m]=t.tl;l.update(s.data,void 0,{x:u,y:m})}}rt("ImagePosition",Bu),rt("ImageAtlas",uf);const Yr={horizontal:1,vertical:2,horizontalOnly:3};class wi{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const l=new wi;return l.scale=t||1,l.fontStack=s,l}static forImage(t){const s=new wi;return s.imageName=t,s}}class $c{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const l=new $c;for(let u=0;u<t.sections.length;u++){const m=t.sections[u];m.image?l.addImageSection(m):l.addTextSection(m,s)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(s,l){let u="";for(let m=0;m<s.length;m++){const g=s.charCodeAt(m+1)||null,x=s.charCodeAt(m-1)||null;u+=!l&&(g&&Lo(g)&&!lc[s[m+1]]||x&&Lo(x)&&!lc[s[m-1]])||!lc[s[m]]?s[m]:lc[s[m]]}return u}(this.text,t)}trim(){let t=0;for(let l=0;l<this.text.length&&Sh[this.text.charCodeAt(l)];l++)t++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Sh[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const l=new $c;return l.text=this.text.substring(t,s),l.sectionIndex=this.sectionIndex.slice(t,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(wi.forText(t.scale,t.fontStack||s));const l=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(l)}addImageSection(t){const s=t.image?t.image.name:"";if(0===s.length)return void Qt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(wi.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Od(r,t,s,l,u,m,g,x,w,E,I,z,R,B,j,X){const ie=$c.fromFeature(r,u);let he;z===Yr.vertical&&ie.verticalizePunctuation(R);const{processBidirectionalText:ye,processStyledBidirectionalText:_e}=U;if(ye&&1===ie.sections.length){he=[];const xe=ye(ie.toString(),Ou(ie,E,m,t,l,B,j));for(const Oe of xe){const qe=new $c;qe.text=Oe,qe.sections=ie.sections;for(let Fe=0;Fe<Oe.length;Fe++)qe.sectionIndex.push(0);he.push(qe)}}else if(_e){he=[];const xe=_e(ie.text,ie.sectionIndex,Ou(ie,E,m,t,l,B,j));for(const Oe of xe){const qe=new $c;qe.text=Oe[0],qe.sectionIndex=Oe[1],qe.sections=ie.sections,he.push(qe)}}else he=function(xe,Oe){const qe=[],Fe=xe.text;let He=0;for(const ze of Oe)qe.push(xe.substring(He,ze)),He=ze;return He<Fe.length&&qe.push(xe.substring(He,Fe.length)),qe}(ie,Ou(ie,E,m,t,l,B,j));const ve=[],we={positionedLines:ve,text:ie.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(xe,Oe,qe,Fe,He,ze,Re,Ke,Pe,_t,Lt,Rt){let bt=0,st=0,wn=0;const ct="right"===Ke?1:"left"===Ke?0:.5;let Gn=!1;for(const bn of He){const ei=bn.getSections();for(const Zn of ei){if(Zn.imageName)continue;const Nn=Oe[Zn.fontStack];if(Nn&&(Gn=void 0!==Nn.ascender&&void 0!==Nn.descender,!Gn))break}if(!Gn)break}let di=0;for(const bn of He){bn.trim();const ei=bn.getMaxScale(),Zn=24*(ei-1),Nn={positionedGlyphs:[],lineOffset:0};xe.positionedLines[di]=Nn;const ji=Nn.positionedGlyphs;let tn=0;if(!bn.length()){st+=ze,++di;continue}let fi=0,Rn=0;for(let $i=0;$i<bn.length();$i++){const gt=bn.getSection($i),ms=bn.getSectionIndex($i),Zi=bn.getCharCode($i);let jt=gt.scale,ni=null,Xt=null,Cn=null,nr=24,co=0;const zl=!(Pe===Yr.horizontal||!Lt&&!ja(Zi)||Lt&&(Sh[Zi]||(pi=Zi,It(pi)||rh(pi)||tt(pi)||zs(pi)||oa(pi))));if(gt.imageName){const Os=Fe[gt.imageName];if(!Os)continue;Cn=gt.imageName,xe.iconsInText=xe.iconsInText||!0,Xt=Os.paddedRect;const dr=Os.displaySize;jt=24*jt/Rt,ni={width:dr[0],height:dr[1],left:1,top:-3,advance:zl?dr[1]:dr[0],localGlyph:!1},co=Gn?-ni.height*jt:24*ei-17-dr[1]*jt,nr=ni.advance;const qo=(zl?dr[0]:dr[1])*jt-24*ei;qo>0&&qo>tn&&(tn=qo)}else{const Os=qe[gt.fontStack];if(!Os)continue;Os[Zi]&&(Xt=Os[Zi]);const dr=Oe[gt.fontStack];if(!dr)continue;const qo=dr.glyphs[Zi];if(!qo)continue;if(ni=qo.metrics,nr=8203!==Zi?24:0,Gn){const mc=void 0!==dr.ascender?Math.abs(dr.ascender):0,Jr=void 0!==dr.descender?Math.abs(dr.descender):0,Wu=(mc+Jr)*jt;fi<Wu&&(fi=Wu,Rn=(mc-Jr)/2*jt),co=-mc*jt}else co=24*(ei-jt)-17}zl?(xe.verticalizable=!0,ji.push({glyph:Zi,imageName:Cn,x:bt,y:st+co,vertical:zl,scale:jt,localGlyph:ni.localGlyph,fontStack:gt.fontStack,sectionIndex:ms,metrics:ni,rect:Xt}),bt+=nr*jt+_t):(ji.push({glyph:Zi,imageName:Cn,x:bt,y:st+co,vertical:zl,scale:jt,localGlyph:ni.localGlyph,fontStack:gt.fontStack,sectionIndex:ms,metrics:ni,rect:Xt}),bt+=ni.advance*jt+_t)}0!==ji.length&&(wn=Math.max(bt-_t,wn),Gn?Wc(ji,ct,tn,Rn,ze*ei/2):Wc(ji,ct,tn,0,ze/2)),bt=0;const ti=ze*ei+tn;Nn.lineOffset=Math.max(tn,Zn),st+=ti,++di}var pi;const Gi=st,{horizontalAlign:jn,verticalAlign:$n}=Zc(Re);(function(bn,ei,Zn,Nn,ji,tn){const fi=(ei-Zn)*ji,Rn=-tn*Nn;for(const ti of bn)for(const $i of ti.positionedGlyphs)$i.x+=fi,$i.y+=Rn})(xe.positionedLines,ct,jn,$n,wn,Gi),xe.top+=-$n*Gi,xe.bottom=xe.top+Gi,xe.left+=-jn*wn,xe.right=xe.left+wn,xe.hasBaseline=Gn}(we,t,s,l,he,g,x,w,z,E,R,X),!function(xe){for(const Oe of xe)if(0!==Oe.positionedGlyphs.length)return!1;return!0}(ve)&&we}const Sh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hf(r,t,s,l,u,m){if(t.imageName){const g=l[t.imageName];return g?g.displaySize[0]*t.scale*24/m+u:0}{const g=s[t.fontStack],x=g&&g.glyphs[r];return x?x.metrics.advance*t.scale+u:0}}function df(r,t,s,l){const u=Math.pow(r-t,2);return l?r<t?u/2:2*u:u+Math.abs(s)*s}function Nd(r,t,s){let l=0;return 10===r&&(l-=1e4),s&&(l+=150),40!==r&&65288!==r||(l+=50),41!==t&&65289!==t||(l+=50),l}function Ud(r,t,s,l,u,m){let g=null,x=df(t,s,u,m);for(const w of l){const E=df(t-w.x,s,u,m)+w.badness;E<=x&&(g=w,x=E)}return{index:r,x:t,priorBreak:g,badness:x}}function Vd(r){return r?Vd(r.priorBreak).concat(r.index):[]}function Ou(r,t,s,l,u,m,g){if("point"!==m)return[];if(!r)return[];const x=[],w=function(R,B,j,X,ie,he){let ye=0;for(let _e=0;_e<R.length();_e++){const ve=R.getSection(_e);ye+=hf(R.getCharCode(_e),ve,X,ie,B,he)}return ye/Math.max(1,Math.ceil(ye/j))}(r,t,s,l,u,g),E=r.text.indexOf("\u200b")>=0;let I=0;for(let R=0;R<r.length();R++){const B=r.getSection(R),j=r.getCharCode(R);if(Sh[j]||(I+=hf(j,B,l,u,t,g)),R<r.length()-1){const X=!((z=j)<11904||!(fu(z)||pu(z)||Ga(z)||yu(z)||Kl(z)||Ce(z)||mu(z)||Wl(z)||Ht(z)||sa(z)||gu(z)||Jn(z)||du(z)||Qn(z)||Ze(z)||lr(z)||Hl(z)||_u(z)||ki(z)||gl(z)));(Sm[j]||X||B.imageName)&&x.push(Ud(R+1,I,w,x,Nd(j,r.getCharCode(R+1),X&&E),!1))}}var z;return Vd(Ud(r.length(),I,w,x,0,!0))}function Zc(r){let t=.5,s=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function Wc(r,t,s,l,u){if(!(t||s||l||u))return;const m=r.length-1,g=r[m],x=(g.x+g.metrics.advance*g.scale)*t;for(let w=0;w<=m;w++)r[w].x-=x,r[w].y+=s+l+u}function Ih(r,t,s){const{horizontalAlign:l,verticalAlign:u}=Zc(s),m=t[0]-r.displaySize[0]*l,g=t[1]-r.displaySize[1]*u;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function Ah(r,t,s,l,u,m){const g=r.image;let x;if(g.content){const ie=g.content,he=g.pixelRatio||1;x=[ie[0]/he,ie[1]/he,g.displaySize[0]-ie[2]/he,g.displaySize[1]-ie[3]/he]}const w=t.left*m,E=t.right*m;let I,z,R,B;"width"===s||"both"===s?(B=u[0]+w-l[3],z=u[0]+E+l[1]):(B=u[0]+(w+E-g.displaySize[0])/2,z=B+g.displaySize[0]);const j=t.top*m,X=t.bottom*m;return"height"===s||"both"===s?(I=u[1]+j-l[0],R=u[1]+X+l[2]):(I=u[1]+(j+X-g.displaySize[1])/2,R=I+g.displaySize[1]),{image:g,top:I,right:z,bottom:R,left:B,collisionPadding:x}}class fa extends Be{constructor(t,s,l,u){super(t,s),this.angle=l,void 0!==u&&(this.segment=u)}clone(){return new fa(this.x,this.y,this.angle,this.segment)}}function Ch(r,t,s,l,u){if(void 0===t.segment)return!0;let m=t,g=t.segment+1,x=0;for(;x>-s/2;){if(g--,g<0)return!1;x-=r[g].dist(m),m=r[g]}x+=r[g].dist(r[g+1]),g++;const w=[];let E=0;for(;x<s/2;){const I=r[g],z=r[g+1];if(!z)return!1;let R=r[g-1].angleTo(I)-I.angleTo(z);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:R}),E+=R;x-w[0].distance>l;)E-=w.shift().angleDelta;if(E>u)return!1;g++,x+=I.dist(z)}return!0}function qd(r){let t=0;for(let s=0;s<r.length-1;s++)t+=r[s].dist(r[s+1]);return t}function pf(r,t,s){return r?.6*t*s:0}function Gd(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Im(r,t,s,l,u,m){const g=pf(s,u,m),x=Gd(s,l)*m;let w=0;const E=qd(r)/2;for(let I=0;I<r.length-1;I++){const z=r[I],R=r[I+1],B=z.dist(R);if(w+B>E){const j=(E-w)/B,X=Nt(z.x,R.x,j),ie=Nt(z.y,R.y,j),he=new fa(X,ie,R.angleTo(z),I);return!g||Ch(r,he,x,g,t)?he:void 0}w+=B}}function Am(r,t,s,l,u,m,g,x,w){const E=pf(l,m,g),I=Gd(l,u),z=I*g,R=0===r[0].x||r[0].x===w||0===r[0].y||r[0].y===w;return t-z<t/4&&(t=z+t/4),ff(r,R?t/2*x%t:(I/2+2*m)*g*x%t,t,E,s,z,R,!1,w)}function ff(r,t,s,l,u,m,g,x,w){const E=m/2,I=qd(r);let z=0,R=t-s,B=[];for(let j=0;j<r.length-1;j++){const X=r[j],ie=r[j+1],he=X.dist(ie),ye=ie.angleTo(X);for(;R+s<z+he;){R+=s;const _e=(R-z)/he,ve=Nt(X.x,ie.x,_e),we=Nt(X.y,ie.y,_e);if(ve>=0&&ve<w&&we>=0&&we<w&&R-E>=0&&R+E<=I){const xe=new fa(ve,we,ye,j);xe._round(),l&&!Ch(r,xe,m,l,u)||B.push(xe)}}z+=he}return x||B.length||g||(B=ff(r,z/2,s,l,u,m,g,!0,w)),B}function jd(r,t,s,l,u){const m=[];for(let g=0;g<r.length;g++){const x=r[g];let w;for(let E=0;E<x.length-1;E++){let I=x[E],z=x[E+1];I.x<t&&z.x<t||(I.x<t?I=new Be(t,I.y+(t-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x<t&&(z=new Be(t,I.y+(t-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y<s&&z.y<s||(I.y<s?I=new Be(I.x+(s-I.y)/(z.y-I.y)*(z.x-I.x),s)._round():z.y<s&&(z=new Be(I.x+(s-I.y)/(z.y-I.y)*(z.x-I.x),s)._round()),I.x>=l&&z.x>=l||(I.x>=l?I=new Be(l,I.y+(l-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x>=l&&(z=new Be(l,I.y+(l-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y>=u&&z.y>=u||(I.y>=u?I=new Be(I.x+(u-I.y)/(z.y-I.y)*(z.x-I.x),u)._round():z.y>=u&&(z=new Be(I.x+(u-I.y)/(z.y-I.y)*(z.x-I.x),u)._round()),w&&I.equals(w[w.length-1])||(w=[I],m.push(w)),w.push(z)))))}}return m}rt("Anchor",fa);var Nu=Hc,Uu=Hc,Sl=1e20;function Hc(r,t,s,l,u,m){this.fontSize=r||24,this.buffer=void 0===t?3:t,this.cutoff=l||.25,this.fontFamily=u||"sans-serif",this.fontWeight=m||"normal",this.radius=s||8;var g=this.size=this.fontSize+2*this.buffer,x=g+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=g,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(g/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function mf(r,t,s,l,u,m){for(var g=0;g<t;g++)gf(r,g,t,s,l,u,m);for(var x=0;x<s;x++)gf(r,x*t,1,t,l,u,m)}function gf(r,t,s,l,u,m,g){var x,w,E,I;for(m[0]=0,g[0]=-Sl,g[1]=Sl,x=0;x<l;x++)u[x]=r[t+x*s];for(x=1,w=0,E=0;x<l;x++){do{E=(u[x]-u[I=m[w]]+x*x-I*I)/(x-I)/2}while(E<=g[w]&&--w>-1);m[++w]=x,g[w]=E,g[w+1]=Sl}for(x=0,w=0;x<l;x++){for(;g[w+1]<x;)w++;r[t+x*s]=u[I=m[w]]+(x-I)*(x-I)}}Hc.prototype._draw=function(r,t){var s,l,u,m,g,x,w,E,I,z=this.ctx.measureText(r),R=z.width,B=2*this.buffer;t&&this.useMetrics?(g=Math.floor(z.actualBoundingBoxAscent),E=this.buffer+Math.ceil(z.actualBoundingBoxAscent),x=this.buffer,w=this.buffer,s=(l=Math.min(this.size,Math.ceil(z.actualBoundingBoxRight-z.actualBoundingBoxLeft)))+B,u=(m=Math.min(this.size-x,Math.ceil(z.actualBoundingBoxAscent+z.actualBoundingBoxDescent)))+B,this.ctx.textBaseline="alphabetic"):(s=l=this.size,u=m=this.size,g=19*this.fontSize/24,x=w=0,E=this.middle,this.ctx.textBaseline="middle"),l&&m&&(this.ctx.clearRect(w,x,l,m),this.ctx.fillText(r,this.buffer,E),I=this.ctx.getImageData(w,x,l,m));var j=new Uint8ClampedArray(s*u);return function(X,ie,he,ye,_e,ve,we){ve.fill(Sl,0,ie*he),we.fill(0,0,ie*he);for(var xe=(ie-ye)/2,Oe=0;Oe<_e;Oe++)for(var qe=0;qe<ye;qe++){var Fe=(Oe+xe)*ie+qe+xe,He=X.data[4*(Oe*ye+qe)+3]/255;if(1===He)ve[Fe]=0,we[Fe]=Sl;else if(0===He)ve[Fe]=Sl,we[Fe]=0;else{var ze=Math.max(0,.5-He),Re=Math.max(0,He-.5);ve[Fe]=ze*ze,we[Fe]=Re*Re}}}(I,s,u,l,m,this.gridOuter,this.gridInner),mf(this.gridOuter,s,u,this.f,this.v,this.z),mf(this.gridInner,s,u,this.f,this.v,this.z),function(X,ie,he,ye,_e,ve,we){for(var xe=0;xe<ie*he;xe++){var Oe=Math.sqrt(ye[xe])-Math.sqrt(_e[xe]);X[xe]=Math.round(255-255*(Oe/ve+we))}}(j,s,u,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:j,metrics:{width:l,height:m,sdfWidth:s,sdfHeight:u,top:g,left:0,advance:R}}},Hc.prototype.draw=function(r){return this._draw(r,!1).data},Hc.prototype.drawWithMetrics=function(r){return this._draw(r,!0)},Nu.default=Uu;const $d={none:0,ideographs:1,all:2};class Kc{constructor(t,s,l){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,s){const l=[];for(const u in t)for(const m of t[u])l.push({stack:u,id:m});Sr(l,({stack:u,id:m},g)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[m];if(void 0!==w)return void g(null,{stack:u,id:m,glyph:w});if(w=this._tinySDF(x,u,m),w)return x.glyphs[m]=w,void g(null,{stack:u,id:m,glyph:w});const E=Math.floor(m/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void g(null,{stack:u,id:m,glyph:w});let I=x.requests[E];I||(I=x.requests[E]=[],Kc.loadGlyphRange(u,E,this.url,this.requestManager,(z,R)=>{if(R){x.ascender=R.ascender,x.descender=R.descender;for(const B in R.glyphs)this._doesCharSupportLocalGlyph(+B)||(x.glyphs[+B]=R.glyphs[+B]);x.ranges[E]=!0}for(const B of I)B(z,R);delete x.requests[E]})),I.push((z,R)=>{z?g(z):R&&g(null,{stack:u,id:m,glyph:R.glyphs[m]||null})})},(u,m)=>{if(u)s(u);else if(m){const g={};for(const{stack:x,id:w,glyph:E}of m)void 0===g[x]&&(g[x]={}),void 0===g[x].glyphs&&(g[x].glyphs={}),g[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[x].ascender=this.entries[x].ascender,g[x].descender=this.entries[x].descender;s(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==$d.none&&(this.localGlyphMode===$d.all?!!this.localFontFamily:!!this.localFontFamily&&(sa(t)||kt(t)||du(t)||Hl(t))||Wl(t))}_tinySDF(t,s,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let m=t.tinySDF;if(!m){let X="400";/bold/i.test(s)?X="900":/medium/i.test(s)?X="500":/light/i.test(s)&&(X="200"),m=t.tinySDF=new Kc.TinySDF(48,6,16,.25,u,X)}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const{data:g,metrics:x}=m.drawWithMetrics(String.fromCharCode(l)),{sdfWidth:w,sdfHeight:E,width:I,height:z,left:R,top:B,advance:j}=x;return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new Rs({width:w,height:E},g),metrics:{width:I/2,height:z/2,left:R/2,top:B/2-27,advance:j/2,localGlyph:!0}}}}function yf(r,t,s,l){const u=[],m=r.image,g=m.pixelRatio,x=m.paddedRect.w-2,w=m.paddedRect.h-2,E=r.right-r.left,I=r.bottom-r.top,z=m.stretchX||[[0,x]],R=m.stretchY||[[0,w]],B=(ze,Re)=>ze+Re[1]-Re[0],j=z.reduce(B,0),X=R.reduce(B,0),ie=x-j,he=w-X;let ye=0,_e=j,ve=0,we=X,xe=0,Oe=ie,qe=0,Fe=he;if(m.content&&l){const ze=m.content;ye=Il(z,0,ze[0]),ve=Il(R,0,ze[1]),_e=Il(z,ze[0],ze[2]),we=Il(R,ze[1],ze[3]),xe=ze[0]-ye,qe=ze[1]-ve,Oe=ze[2]-ze[0]-_e,Fe=ze[3]-ze[1]-we}const He=(ze,Re,Ke,Pe)=>{const _t=Qa(ze.stretch-ye,_e,E,r.left),Lt=Xc(ze.fixed-xe,Oe,ze.stretch,j),Rt=Qa(Re.stretch-ve,we,I,r.top),bt=Xc(Re.fixed-qe,Fe,Re.stretch,X),st=Qa(Ke.stretch-ye,_e,E,r.left),wn=Xc(Ke.fixed-xe,Oe,Ke.stretch,j),ct=Qa(Pe.stretch-ve,we,I,r.top),Gn=Xc(Pe.fixed-qe,Fe,Pe.stretch,X),di=new Be(_t,Rt),pi=new Be(st,Rt),Gi=new Be(st,ct),jn=new Be(_t,ct),$n=new Be(Lt/g,bt/g),bn=new Be(wn/g,Gn/g),ei=t*Math.PI/180;if(ei){const ji=Math.sin(ei),tn=Math.cos(ei),fi=[tn,-ji,ji,tn];di._matMult(fi),pi._matMult(fi),jn._matMult(fi),Gi._matMult(fi)}const Zn=ze.stretch+ze.fixed,Nn=Re.stretch+Re.fixed;return{tl:di,tr:pi,bl:jn,br:Gi,tex:{x:m.paddedRect.x+1+Zn,y:m.paddedRect.y+1+Nn,w:Ke.stretch+Ke.fixed-Zn,h:Pe.stretch+Pe.fixed-Nn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$n,pixelOffsetBR:bn,minFontScaleX:Oe/g/E,minFontScaleY:Fe/g/I,isSDF:s}};if(l&&(m.stretchX||m.stretchY)){const ze=kh(z,ie,j),Re=kh(R,he,X);for(let Ke=0;Ke<ze.length-1;Ke++){const Pe=ze[Ke],_t=ze[Ke+1];for(let Lt=0;Lt<Re.length-1;Lt++)u.push(He(Pe,Re[Lt],_t,Re[Lt+1]))}}else u.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return u}function Il(r,t,s){let l=0;for(const u of r)l+=Math.max(t,Math.min(s,u[1]))-Math.max(t,Math.min(s,u[0]));return l}function kh(r,t,s){const l=[{fixed:-1,stretch:0}];for(const[u,m]of r){const g=l[l.length-1];l.push({fixed:u-g.stretch,stretch:g.stretch}),l.push({fixed:u-g.stretch,stretch:g.stretch+(m-u)})}return l.push({fixed:t+1,stretch:s}),l}function Qa(r,t,s,l){return r/t*s+l}function Xc(r,t,s,l){return r-t*s/l}function Mh(r,t,s,l){const u=t+r.positionedLines[l].lineOffset;return 0===l?s+u/2:s+(u+(t+r.positionedLines[l-1].lineOffset))/2}Kc.loadGlyphRange=function(r,t,s,l,u){const m=256*t,g=m+255,x=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",r).replace("{range}",`${m}-${g}`),ss.Glyphs);P(x,(w,E)=>{if(w)u(w);else if(E){const I={},z=new Lu(E).readFields(Rd,{});for(const R of z.glyphs)I[R.id]=R;u(null,{glyphs:I,ascender:z.ascender,descender:z.descender})}})},Kc.TinySDF=Nu;class Vu{constructor(t=[],s=Zd){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:l}=this,u=s[t];for(;t>0;){const m=t-1>>1,g=s[m];if(l(u,g)>=0)break;s[t]=g,t=m}s[t]=u}_down(t){const{data:s,compare:l}=this,u=this.length>>1,m=s[t];for(;t<u;){let g=1+(t<<1),x=s[g];const w=g+1;if(w<this.length&&l(s[w],x)<0&&(g=w,x=s[w]),l(x,m)>=0)break;s[t]=x,t=g}s[t]=m}}function Zd(r,t){return r<t?-1:r>t?1:0}function _f(r,t=1,s=!1){let l=1/0,u=1/0,m=-1/0,g=-1/0;const x=r[0];for(let B=0;B<x.length;B++){const j=x[B];(!B||j.x<l)&&(l=j.x),(!B||j.y<u)&&(u=j.y),(!B||j.x>m)&&(m=j.x),(!B||j.y>g)&&(g=j.y)}const w=Math.min(m-l,g-u);let E=w/2;const I=new Vu([],Wd);if(0===w)return new Be(l,u);for(let B=l;B<m;B+=w)for(let j=u;j<g;j+=w)I.push(new Al(B+E,j+E,E,r));let z=function(B){let j=0,X=0,ie=0;const he=B[0];for(let ye=0,_e=he.length,ve=_e-1;ye<_e;ve=ye++){const we=he[ye],xe=he[ve],Oe=we.x*xe.y-xe.x*we.y;X+=(we.x+xe.x)*Oe,ie+=(we.y+xe.y)*Oe,j+=3*Oe}return new Al(X/j,ie/j,0,B)}(r),R=I.length;for(;I.length;){const B=I.pop();(B.d>z.d||!z.d)&&(z=B,s&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,R)),B.max-z.d<=t||(E=B.h/2,I.push(new Al(B.p.x-E,B.p.y-E,E,r)),I.push(new Al(B.p.x+E,B.p.y-E,E,r)),I.push(new Al(B.p.x-E,B.p.y+E,E,r)),I.push(new Al(B.p.x+E,B.p.y+E,E,r)),R+=4)}return s&&(console.log(`num probes: ${R}`),console.log(`best distance: ${z.d}`)),z.p}function Wd(r,t){return t.max-r.max}function Al(r,t,s,l){this.p=new Be(r,t),this.h=s,this.d=function(u,m){let g=!1,x=1/0;for(let w=0;w<m.length;w++){const E=m[w];for(let I=0,z=E.length,R=z-1;I<z;R=I++){const B=E[I],j=E[R];B.y>u.y!=j.y>u.y&&u.x<(j.x-B.x)*(u.y-B.y)/(j.y-B.y)+B.x&&(g=!g),x=Math.min(x,Dc(u,B,j))}}return(g?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const ma=Number.POSITIVE_INFINITY,vf=Math.sqrt(2);function xf(r,t){return t[1]!==ma?function(s,l,u){let m=0,g=0;switch(l=Math.abs(l),u=Math.abs(u),s){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(s){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,g]}(r,t[0],t[1]):function(s,l){let u=0,m=0;l<0&&(l=0);const g=l/vf;switch(s){case"top-right":case"top-left":m=g-7;break;case"bottom-right":case"bottom-left":m=7-g;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(s){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=l;break;case"right":u=-l}return[u,m]}(r,t[0])}function Hd(r,t,s,l,u,m,g,x){r.createArrays(),r.tilePixelRatio=Jt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const w=r.layers[0].layout,E=r.layers[0]._unevaluatedLayout._values,I={};if("composite"===r.textSizeData.kind){const{minZoom:B,maxZoom:j}=r.textSizeData;I.compositeTextSizes=[E["text-size"].possiblyEvaluate(new q(B),g),E["text-size"].possiblyEvaluate(new q(j),g)]}if("composite"===r.iconSizeData.kind){const{minZoom:B,maxZoom:j}=r.iconSizeData;I.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new q(B),g),E["icon-size"].possiblyEvaluate(new q(j),g)]}I.layoutTextSize=E["text-size"].possiblyEvaluate(new q(x+1),g),I.layoutIconSize=E["icon-size"].possiblyEvaluate(new q(x+1),g),I.textMaxSize=E["text-size"].possiblyEvaluate(new q(18),g);const z="map"===w.get("text-rotation-alignment")&&"point"!==w.get("symbol-placement"),R=w.get("text-size");for(const B of r.features){const j=w.get("text-font").evaluate(B,{},g).join(","),X=R.evaluate(B,{},g),ie=I.layoutTextSize.evaluate(B,{},g),he=(I.layoutIconSize.evaluate(B,{},g),{horizontal:{},vertical:void 0}),ye=B.text;let _e,ve=[0,0];if(ye){const Oe=ye.toString(),qe=24*w.get("text-letter-spacing").evaluate(B,{},g),Fe=24*w.get("text-line-height").evaluate(B,{},g),He=rd(Oe)?qe:0,ze=w.get("text-anchor").evaluate(B,{},g),Re=w.get("text-variable-anchor");if(!Re){const bt=w.get("text-radial-offset").evaluate(B,{},g);ve=bt?xf(ze,[24*bt,ma]):w.get("text-offset").evaluate(B,{},g).map(st=>24*st)}let Ke=z?"center":w.get("text-justify").evaluate(B,{},g);const Pe=w.get("symbol-placement"),_t="point"===Pe,Lt="point"===Pe?24*w.get("text-max-width").evaluate(B,{},g):0,Rt=bt=>{r.allowVerticalPlacement&&cs(Oe)&&(he.vertical=Od(ye,t,s,u,j,Lt,Fe,ze,bt,He,ve,Yr.vertical,!0,Pe,ie,X))};if(!z&&Re){const bt="auto"===Ke?Re.map(wn=>Kd(wn)):[Ke];let st=!1;for(let wn=0;wn<bt.length;wn++){const ct=bt[wn];if(!he.horizontal[ct])if(st)he.horizontal[ct]=he.horizontal[0];else{const Gn=Od(ye,t,s,u,j,Lt,Fe,"center",ct,He,ve,Yr.horizontal,!1,Pe,ie,X);Gn&&(he.horizontal[ct]=Gn,st=1===Gn.positionedLines.length)}}Rt("left")}else{if("auto"===Ke&&(Ke=Kd(ze)),_t||w.get("text-writing-mode").indexOf("horizontal")>=0||!cs(Oe)){const bt=Od(ye,t,s,u,j,Lt,Fe,ze,Ke,He,ve,Yr.horizontal,!1,Pe,ie,X);bt&&(he.horizontal[Ke]=bt)}Rt("point"===Pe?"left":Ke)}}let we=!1;if(B.icon&&B.icon.name){const Oe=l[B.icon.name];Oe&&(_e=Ih(u[B.icon.name],w.get("icon-offset").evaluate(B,{},g),w.get("icon-anchor").evaluate(B,{},g)),we=Oe.sdf,void 0===r.sdfIcons?r.sdfIcons=Oe.sdf:r.sdfIcons!==Oe.sdf&&Qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==r.pixelRatio||0!==w.get("icon-rotate").constantOr(1))&&(r.iconsNeedLinear=!0))}const xe=qu(he.horizontal)||he.vertical;r.iconsInText||(r.iconsInText=!!xe&&xe.iconsInText),(xe||_e)&&Xd(r,B,he,_e,l,I,ie,0,ve,we,g)}m&&r.generateCollisionDebugBuffers(x,r.collisionBoxArray)}function Kd(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xd(r,t,s,l,u,m,g,x,w,E,I){let z=m.textMaxSize.evaluate(t,{},I);void 0===z&&(z=g);const R=r.layers[0].layout,B=R.get("icon-offset").evaluate(t,{},I),j=qu(s.horizontal)||s.vertical,X=g/24,ie=r.tilePixelRatio*z/24,he=r.tilePixelRatio*R.get("symbol-spacing"),ye=R.get("text-padding")*r.tilePixelRatio,_e=R.get("icon-padding")*r.tilePixelRatio,ve=mi(R.get("text-max-angle")),we="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement"),xe="map"===R.get("icon-rotation-alignment")&&"point"!==R.get("symbol-placement"),Oe=R.get("symbol-placement"),qe=he/2,Fe=R.get("icon-text-fit");let He;l&&"none"!==Fe&&(r.allowVerticalPlacement&&s.vertical&&(He=Ah(l,s.vertical,Fe,R.get("icon-text-fit-padding"),B,X)),j&&(l=Ah(l,j,Fe,R.get("icon-text-fit-padding"),B,X)));const ze=(Re,Ke)=>{Ke.x<0||Ke.x>=Jt||Ke.y<0||Ke.y>=Jt||function(Pe,_t,Lt,Rt,bt,st,wn,ct,Gn,di,pi,Gi,jn,$n,bn,ei,Zn,Nn,ji,tn,fi,Rn,ti,$i){const gt=Pe.addToLineVertexArray(_t,Lt);let ms,Zi,jt,ni,Xt,Cn,nr,co=0,zl=0,Os=0,dr=0,qo=-1,mc=-1;const Jr={};let Wu=kc(""),yp=0,Wn=0;if(void 0===ct._unevaluatedLayout.getValue("text-radial-offset")?[yp,Wn]=ct.layout.get("text-offset").evaluate(tn,{},ti).map(es=>24*es):(yp=24*ct.layout.get("text-radial-offset").evaluate(tn,{},ti),Wn=ma),Pe.allowVerticalPlacement&&Rt.vertical){const es=Rt.vertical;if($n)Cn=Dh(es),wn&&(nr=Dh(wn));else{const gs=ct.layout.get("text-rotate").evaluate(tn,{},ti)+90;jt=Yc(Gn,_t,di,pi,Gi,es,jn,gs,bn),wn&&(ni=Yc(Gn,_t,di,pi,Gi,wn,Zn,gs))}}if(bt){const es=ct.layout.get("icon-rotate").evaluate(tn,{},ti),gs="none"!==ct.layout.get("icon-text-fit"),Hu=yf(bt,es,Rn,gs),Jh=wn?yf(wn,es,Rn,gs):void 0;Zi=Yc(Gn,_t,di,pi,Gi,bt,Zn,es),co=4*Hu.length;const Of=Pe.iconSizeData;let gc=null;"source"===Of.kind?(gc=[da*ct.layout.get("icon-size").evaluate(tn,{},ti)],gc[0]>Cl&&Qt(`${Pe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Of.kind&&(gc=[da*fi.compositeIconSizes[0].evaluate(tn,{},ti),da*fi.compositeIconSizes[1].evaluate(tn,{},ti)],(gc[0]>Cl||gc[1]>Cl)&&Qt(`${Pe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Pe.addSymbols(Pe.icon,Hu,gc,ji,Nn,tn,!1,_t,gt.lineStartIndex,gt.lineLength,-1,ti),qo=Pe.icon.placedSymbolArray.length-1,Jh&&(zl=4*Jh.length,Pe.addSymbols(Pe.icon,Jh,gc,ji,Nn,tn,Yr.vertical,_t,gt.lineStartIndex,gt.lineLength,-1,ti),mc=Pe.icon.placedSymbolArray.length-1)}for(const es in Rt.horizontal){const gs=Rt.horizontal[es];ms||(Wu=kc(gs.text),$n?Xt=Dh(gs):ms=Yc(Gn,_t,di,pi,Gi,gs,jn,ct.layout.get("text-rotate").evaluate(tn,{},ti),bn));const Hu=1===gs.positionedLines.length;if(Os+=Ph(Pe,_t,gs,st,ct,$n,tn,bn,gt,Rt.vertical?Yr.horizontal:Yr.horizontalOnly,Hu?Object.keys(Rt.horizontal):[es],Jr,qo,fi,ti),Hu)break}Rt.vertical&&(dr+=Ph(Pe,_t,Rt.vertical,st,ct,$n,tn,bn,gt,Yr.vertical,["vertical"],Jr,mc,fi,ti));let Ll=-1;const Bf=(es,gs)=>es?Math.max(es,gs):gs;Ll=Bf(Xt,Ll),Ll=Bf(Cn,Ll),Ll=Bf(nr,Ll);const Wi=Ll>-1?1:0;Wi&&(Ll*=$i/24),Pe.glyphOffsetArray.length>=kl.MAX_GLYPHS&&Qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==tn.sortKey&&Pe.addToSortKeyRanges(Pe.symbolInstances.length,tn.sortKey),Pe.symbolInstances.emplaceBack(_t.x,_t.y,Jr.right>=0?Jr.right:-1,Jr.center>=0?Jr.center:-1,Jr.left>=0?Jr.left:-1,Jr.vertical>=0?Jr.vertical:-1,qo,mc,Wu,void 0!==ms?ms:Pe.collisionBoxArray.length,void 0!==ms?ms+1:Pe.collisionBoxArray.length,void 0!==jt?jt:Pe.collisionBoxArray.length,void 0!==jt?jt+1:Pe.collisionBoxArray.length,void 0!==Zi?Zi:Pe.collisionBoxArray.length,void 0!==Zi?Zi+1:Pe.collisionBoxArray.length,ni||Pe.collisionBoxArray.length,ni?ni+1:Pe.collisionBoxArray.length,di,Os,dr,co,zl,Wi,0,yp,Wn,Ll)}(r,Ke,Re,s,l,u,He,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,ye,we,w,0,_e,xe,B,t,m,E,I,g)};if("line"===Oe)for(const Re of jd(t.geometry,0,0,Jt,Jt)){const Ke=Am(Re,he,ve,s.vertical||j,l,24,ie,r.overscaling,Jt);for(const Pe of Ke){const _t=j;_t&&Qc(r,_t.text,qe,Pe)||ze(Re,Pe)}}else if("line-center"===Oe){for(const Re of t.geometry)if(Re.length>1){const Ke=Im(Re,ve,s.vertical||j,l,24,ie);Ke&&ze(Re,Ke)}}else if("Polygon"===t.type)for(const Re of mh(t.geometry,0)){const Ke=_f(Re,16);ze(Re[0],new fa(Ke.x,Ke.y,0))}else if("LineString"===t.type)for(const Re of t.geometry)ze(Re,new fa(Re[0].x,Re[0].y,0));else if("Point"===t.type)for(const Re of t.geometry)for(const Ke of Re)ze([Ke],new fa(Ke.x,Ke.y,0))}const Cl=32640;function Ph(r,t,s,l,u,m,g,x,w,E,I,z,R,B,j){const X=function(ye,_e,ve,we,xe,Oe,qe,Fe){const He=[];if(0===_e.positionedLines.length)return He;const ze=we.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,Re=function(Rt){const bt=Rt[0],st=Rt[1],wn=bt*st;return wn>0?[bt,-st]:wn<0?[-bt,st]:0===bt?[st,bt]:[st,-bt]}(ve);let Ke=Math.abs(_e.top-_e.bottom);for(const Rt of _e.positionedLines)Ke-=Rt.lineOffset;const Pe=_e.positionedLines.length,_t=Ke/Pe;let Lt=_e.top-ve[1];for(let Rt=0;Rt<Pe;++Rt){const bt=_e.positionedLines[Rt];Lt=Mh(_e,_t,Lt,Rt);for(const st of bt.positionedGlyphs){if(!st.rect)continue;const wn=st.rect||{};let ct=4,Gn=!0,di=1,pi=0;const Gi=(xe||Fe)&&st.vertical,jn=st.metrics.advance*st.scale/2,$n=st.metrics,bn=st.rect;if(null===bn)continue;if(Fe&&_e.verticalizable&&(pi=st.imageName?jn-st.metrics.width*st.scale/2:0),st.imageName){const jt=qe[st.imageName];if(!jt)continue;Gn=jt.sdf,di=jt.pixelRatio,ct=1/di}const ei=xe?[st.x+jn,st.y]:[0,0];let Zn=[0,0],Nn=[0,0],ji=!1;xe||(Gi?(Nn=[st.x+jn+Re[0],st.y+Re[1]-pi],ji=!0):Zn=[st.x+jn+ve[0],st.y+ve[1]-pi]);const tn=bn.w*st.scale/(di*(st.localGlyph?2:1)),fi=bn.h*st.scale/(di*(st.localGlyph?2:1));let Rn,ti,$i,gt;if(Gi){const jt=st.y-Lt,ni=new Be(-jn,jn-jt),Xt=-Math.PI/2,Cn=new Be(...Nn);Rn=new Be(-jn+Zn[0],Zn[1]),Rn._rotateAround(Xt,ni)._add(Cn),Rn.x+=-jt+jn,Rn.y-=($n.left-ct)*st.scale;const nr=st.imageName?$n.advance*st.scale:24*st.scale,co=String.fromCharCode(st.glyph);Dd(co)?Rn.x+=(1-ct)*st.scale:Du(co)?Rn.x+=nr-$n.height*st.scale+(-ct-1)*st.scale:Rn.x+=st.imageName||$n.width+2*ct===bn.w&&$n.height+2*ct===bn.h?(nr-fi)/2:(nr-($n.height+2*ct)*st.scale)/2,ti=new Be(Rn.x,Rn.y-tn),$i=new Be(Rn.x+fi,Rn.y),gt=new Be(Rn.x+fi,Rn.y-tn)}else{const jt=($n.left-ct)*st.scale-jn+Zn[0],ni=(-$n.top-ct)*st.scale+Zn[1],Xt=jt+tn,Cn=ni+fi;Rn=new Be(jt,ni),ti=new Be(Xt,ni),$i=new Be(jt,Cn),gt=new Be(Xt,Cn)}if(ze){let jt;jt=xe?new Be(0,0):ji?new Be(Re[0],Re[1]):new Be(ve[0],ve[1]),Rn._rotateAround(ze,jt),ti._rotateAround(ze,jt),$i._rotateAround(ze,jt),gt._rotateAround(ze,jt)}const ms=new Be(0,0),Zi=new Be(0,0);He.push({tl:Rn,tr:ti,bl:$i,br:gt,tex:wn,writingMode:_e.writingMode,glyphOffset:ei,sectionIndex:st.sectionIndex,isSDF:Gn,pixelOffsetTL:ms,pixelOffsetBR:Zi,minFontScaleX:0,minFontScaleY:0})}}return He}(0,s,x,u,m,g,l,r.allowVerticalPlacement),ie=r.textSizeData;let he=null;"source"===ie.kind?(he=[da*u.layout.get("text-size").evaluate(g,{},j)],he[0]>Cl&&Qt(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ie.kind&&(he=[da*B.compositeTextSizes[0].evaluate(g,{},j),da*B.compositeTextSizes[1].evaluate(g,{},j)],(he[0]>Cl||he[1]>Cl)&&Qt(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,X,he,x,m,g,E,t,w.lineStartIndex,w.lineLength,R,j);for(const ye of I)z[ye]=r.text.placedSymbolArray.length-1;return 4*X.length}function qu(r){for(const t in r)return r[t];return null}function Yc(r,t,s,l,u,m,g,x,w){let E=m.top,I=m.bottom,z=m.left,R=m.right;const B=m.collisionPadding;if(B&&(z-=B[0],E-=B[1],R+=B[2],I+=B[3]),x){const j=new Be(z,E),X=new Be(R,E),ie=new Be(z,I),he=new Be(R,I),ye=mi(x);let _e=new Be(0,0);w&&(_e=new Be(w[0],w[1])),j._rotateAround(ye,_e),X._rotateAround(ye,_e),ie._rotateAround(ye,_e),he._rotateAround(ye,_e),z=Math.min(j.x,X.x,ie.x,he.x),R=Math.max(j.x,X.x,ie.x,he.x),E=Math.min(j.y,X.y,ie.y,he.y),I=Math.max(j.y,X.y,ie.y,he.y)}return r.emplaceBack(t.x,t.y,z,E,R,I,g,s,l,u),r.length-1}function Dh(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const t=r.bottom-r.top;return t>0?Math.max(10,t):null}function Qc(r,t,s,l){const u=r.compareText;if(t in u){const m=u[t];for(let g=m.length-1;g>=0;g--)if(l.dist(m[g])<s)return!0}else u[t]=[];return u[t].push(l),!1}const Yd=bl.VectorTileFeature.types,Cm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zh(r,t,s,l,u,m,g,x,w,E,I,z,R){const B=x?Math.min(Cl,Math.round(x[0])):0,j=x?Math.min(Cl,Math.round(x[1])):0;r.emplaceBack(t,s,Math.round(32*l),Math.round(32*u),m,g,(B<<1)+(w?1:0),j,16*E,16*I,256*z,256*R)}function Lh(r,t,s){r.emplaceBack(t.x,t.y,s),r.emplaceBack(t.x,t.y,s),r.emplaceBack(t.x,t.y,s),r.emplaceBack(t.x,t.y,s)}function wf(r){for(const t of r.sections)if(yl(t.text))return!0;return!1}class Qd{constructor(t){this.layoutVertexArray=new In,this.indexArray=new An,this.programConfigurations=t,this.segments=new en,this.dynamicLayoutVertexArray=new cr,this.opacityVertexArray=new Vi,this.placedSymbolArray=new Cc}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,s,l,u){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ym.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,_m.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Cm,!0),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rt("SymbolBuffers",Qd);class Gu{constructor(t,s,l){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new l,this.segments=new en,this.collisionVertexArray=new ln,this.collisionVertexArrayExt=new cr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,vm.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,xh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}rt("CollisionBuffers",Gu);class kl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=hh([]),this.placementViewportMatrix=hh([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wh(this.zoom,s["text-size"]),this.iconSizeData=wh(this.zoom,s["icon-size"]);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>Yr[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new Qd(new _l(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Qd(new _l(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new kp,this.lineVertexArray=new sd,this.symbolInstances=new Xl}calculateGlyphDependencies(t,s,l,u,m){for(let g=0;g<t.length;g++)if(s[t.charCodeAt(g)]=!0,u&&m){const x=lc[t.charAt(g)];x&&(s[x.charCodeAt(0)]=!0)}}populate(t,s,l){const u=this.layers[0],m=u.layout,g=m.get("text-font"),x=m.get("text-field"),w=m.get("icon-image"),E=("constant"!==x.value.kind||x.value.value instanceof oi&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&("constant"!==g.value.kind||g.value.value.length>0),I="constant"!==w.value.kind||!!w.value.value||Object.keys(w.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!E&&!I)return;const R=s.iconDependencies,B=s.glyphDependencies,j=s.availableImages,X=new q(this.zoom);for(const{feature:ie,id:he,index:ye,sourceLayerIndex:_e}of t){const ve=u._featureFilter.needGeometry,we=nc(ie,ve);if(!u._featureFilter.filter(X,we,l))continue;let xe,Oe;if(ve||(we.geometry=vl(ie)),E){const Fe=u.getValueAndResolveTokens("text-field",we,l,j),He=oi.factory(Fe);wf(He)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===L()||this.hasRTLText&&U.isParsed())&&(xe=sf(He,u,we))}if(I){const Fe=u.getValueAndResolveTokens("icon-image",we,l,j);Oe=Fe instanceof yr?Fe:yr.fromString(Fe)}if(!xe&&!Oe)continue;const qe=this.sortFeaturesByKey?z.evaluate(we,{},l):void 0;if(this.features.push({id:he,text:xe,icon:Oe,index:ye,sourceLayerIndex:_e,geometry:we.geometry,properties:ie.properties,type:Yd[ie.type],sortKey:qe}),Oe&&(R[Oe.name]=!0),xe){const Fe=g.evaluate(we,{},l).join(","),He="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Yr.vertical)>=0;for(const ze of xe.sections)if(ze.image)R[ze.image.name]=!0;else{const Re=cs(xe.toString()),Ke=ze.fontStack||Fe,Pe=B[Ke]=B[Ke]||{};this.calculateGlyphDependencies(ze.text,Pe,He,this.allowVerticalPlacement,Re)}}}"line"===m.get("symbol-placement")&&(this.features=function(ie){const he={},ye={},_e=[];let ve=0;function we(Fe){_e.push(ie[Fe]),ve++}function xe(Fe,He,ze){const Re=ye[Fe];return delete ye[Fe],ye[He]=Re,_e[Re].geometry[0].pop(),_e[Re].geometry[0]=_e[Re].geometry[0].concat(ze[0]),Re}function Oe(Fe,He,ze){const Re=he[He];return delete he[He],he[Fe]=Re,_e[Re].geometry[0].shift(),_e[Re].geometry[0]=ze[0].concat(_e[Re].geometry[0]),Re}function qe(Fe,He,ze){const Re=ze?He[0][He[0].length-1]:He[0][0];return`${Fe}:${Re.x}:${Re.y}`}for(let Fe=0;Fe<ie.length;Fe++){const He=ie[Fe],ze=He.geometry,Re=He.text?He.text.toString():null;if(!Re){we(Fe);continue}const Ke=qe(Re,ze),Pe=qe(Re,ze,!0);if(Ke in ye&&Pe in he&&ye[Ke]!==he[Pe]){const _t=Oe(Ke,Pe,ze),Lt=xe(Ke,Pe,_e[_t].geometry);delete he[Ke],delete ye[Pe],ye[qe(Re,_e[Lt].geometry,!0)]=Lt,_e[_t].geometry=null}else Ke in ye?xe(Ke,Pe,ze):Pe in he?Oe(Ke,Pe,ze):(we(Fe),he[Ke]=ve-1,ye[Pe]=ve-1)}return _e.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,he)=>ie.sortKey-he.sortKey)}update(t,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,l))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const l=this.lineVertexArray.length;if(void 0!==t.segment){let u=t.dist(s[t.segment+1]),m=t.dist(s[t.segment]);const g={};for(let x=t.segment+1;x<s.length;x++)g[x]={x:s[x].x,y:s[x].y,tileUnitDistanceFromAnchor:u},x<s.length-1&&(u+=s[x+1].dist(s[x]));for(let x=t.segment||0;x>=0;x--)g[x]={x:s[x].x,y:s[x].y,tileUnitDistanceFromAnchor:m},x>0&&(m+=s[x-1].dist(s[x]));for(let x=0;x<s.length;x++){const w=g[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,s,l,u,m,g,x,w,E,I,z,R){const B=t.indexArray,j=t.layoutVertexArray,X=t.segments.prepareSegment(4*s.length,j,B,this.canOverlap?g.sortKey:void 0),ie=this.glyphOffsetArray.length,he=X.vertexLength,ye=this.allowVerticalPlacement&&x===Yr.vertical?Math.PI/2:0,_e=g.text&&g.text.sections;for(let ve=0;ve<s.length;ve++){const{tl:we,tr:xe,bl:Oe,br:qe,tex:Fe,pixelOffsetTL:He,pixelOffsetBR:ze,minFontScaleX:Re,minFontScaleY:Ke,glyphOffset:Pe,isSDF:_t,sectionIndex:Lt}=s[ve],Rt=X.vertexLength,bt=Pe[1];zh(j,w.x,w.y,we.x,bt+we.y,Fe.x,Fe.y,l,_t,He.x,He.y,Re,Ke),zh(j,w.x,w.y,xe.x,bt+xe.y,Fe.x+Fe.w,Fe.y,l,_t,ze.x,He.y,Re,Ke),zh(j,w.x,w.y,Oe.x,bt+Oe.y,Fe.x,Fe.y+Fe.h,l,_t,He.x,ze.y,Re,Ke),zh(j,w.x,w.y,qe.x,bt+qe.y,Fe.x+Fe.w,Fe.y+Fe.h,l,_t,ze.x,ze.y,Re,Ke),Lh(t.dynamicLayoutVertexArray,w,ye),B.emplaceBack(Rt,Rt+1,Rt+2),B.emplaceBack(Rt+1,Rt+2,Rt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pe[0]),ve!==s.length-1&&Lt===s[ve+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,g,g.index,{},R,_e&&_e[Lt])}t.placedSymbolArray.emplaceBack(w.x,w.y,ie,this.glyphOffsetArray.length-ie,he,E,I,w.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],x,0,!1,0,z,0)}_commitLayoutVertex(t,s,l,u,m){t.emplaceBack(s.x,s.y,l,u,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(t,s,l,u,m){const g=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),x=g.vertexLength,w=m.anchorX,E=m.anchorY;for(let z=0;z<4;z++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(s,-t.padding,-t.padding),l.collisionVertexArrayExt.emplaceBack(s,t.padding,-t.padding),l.collisionVertexArrayExt.emplaceBack(s,t.padding,t.padding),l.collisionVertexArrayExt.emplaceBack(s,-t.padding,t.padding),this._commitLayoutVertex(l.layoutVertexArray,u,w,E,new Be(t.x1,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,w,E,new Be(t.x2,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,w,E,new Be(t.x2,t.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,w,E,new Be(t.x1,t.y2)),g.vertexLength+=4;const I=l.indexArray;I.emplaceBack(x,x+1),I.emplaceBack(x+1,x+2),I.emplaceBack(x+2,x+3),I.emplaceBack(x+3,x),g.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,l,u,m,g){for(let x=u;x<m;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(t,g,s,x);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.anchorPoint,g)}}_addIconDebugCollisionBoxes(t,s,l,u,m,g){for(let x=u;x<m;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(t,s,x);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.anchorPoint,g)}}generateCollisionDebugBuffers(t,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gu(Kr,ac.members,us),this.iconCollisionBox=new Gu(Kr,ac.members,us);const l=Ya(this.iconSizeData,t),u=Ya(this.textSizeData,t);for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(u,t,s,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,t,s,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,t,s,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,t,s,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,s,l,u){const m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:u),g=Uo(this.textSizeData,t,m)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,s,l){const u=this.icon.placedSymbolArray.get(l),m=Uo(this.iconSizeData,t,u);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(t,s,l){t.emplaceBack(s,-l,-l),t.emplaceBack(s,l,-l),t.emplaceBack(s,l,l),t.emplaceBack(s,-l,l)}_updateTextDebugCollisionBoxes(t,s,l,u,m,g){for(let x=u;x<m;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(t,g,s,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(t,s,l,u,m){for(let g=u;g<m;g++){const x=l.get(g),w=this.getSymbolInstanceIconSize(t,s,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding)}}updateCollisionDebugBuffers(t,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Ya(this.iconSizeData,t),u=Ya(this.textSizeData,t);for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(u,t,s,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,t,s,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,t,s,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,t,s,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,l,u,m,g,x,w,E){const I={};for(let z=s;z<l;z++){const R=t.get(z);I.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},I.textFeatureIndex=R.featureIndex;break}for(let z=u;z<m;z++){const R=t.get(z);I.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},I.verticalTextFeatureIndex=R.featureIndex;break}for(let z=g;z<x;z++){const R=t.get(z);I.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},I.iconFeatureIndex=R.featureIndex;break}for(let z=w;z<E;z++){const R=t.get(z);I.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},I.verticalIconFeatureIndex=R.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const l=t.placedSymbolArray.get(s),u=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<u;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(t),l=Math.cos(t),u=[],m=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const w=this.symbolInstances.get(x);u.push(0|Math.round(s*w.anchorX+l*w.anchorY)),m.push(w.featureIndex)}return g.sort((x,w)=>u[x]-u[w]||m[w]-m[x]),g}addToSortKeyRanges(t,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((u,m,g)=>{u>=0&&g.indexOf(u)===m&&this.addIndicesForPlacedSymbol(this.text,u)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}rt("SymbolBucket",kl,{omit:["layers","collisionBoxArray","features","compareText"]}),kl.MAX_GLYPHS=65535,kl.addDynamicAttributes=Lh;const Jd=new se({"symbol-placement":new te(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new te(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new te(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ee(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new te(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new te(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new te(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new te(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new te(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ee(pe.layout_symbol["icon-size"]),"icon-text-fit":new te(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new te(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ee(pe.layout_symbol["icon-image"]),"icon-rotate":new ee(pe.layout_symbol["icon-rotate"]),"icon-padding":new te(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new te(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new ee(pe.layout_symbol["icon-offset"]),"icon-anchor":new ee(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new te(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new te(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new te(pe.layout_symbol["text-rotation-alignment"]),"text-field":new ee(pe.layout_symbol["text-field"]),"text-font":new ee(pe.layout_symbol["text-font"]),"text-size":new ee(pe.layout_symbol["text-size"]),"text-max-width":new ee(pe.layout_symbol["text-max-width"]),"text-line-height":new ee(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new ee(pe.layout_symbol["text-letter-spacing"]),"text-justify":new ee(pe.layout_symbol["text-justify"]),"text-radial-offset":new ee(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new te(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new ee(pe.layout_symbol["text-anchor"]),"text-max-angle":new te(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new te(pe.layout_symbol["text-writing-mode"]),"text-rotate":new ee(pe.layout_symbol["text-rotate"]),"text-padding":new te(pe.layout_symbol["text-padding"]),"text-keep-upright":new te(pe.layout_symbol["text-keep-upright"]),"text-transform":new ee(pe.layout_symbol["text-transform"]),"text-offset":new ee(pe.layout_symbol["text-offset"]),"text-allow-overlap":new te(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new te(pe.layout_symbol["text-ignore-placement"]),"text-optional":new te(pe.layout_symbol["text-optional"])});var ep={paint:new se({"icon-opacity":new ee(pe.paint_symbol["icon-opacity"]),"icon-color":new ee(pe.paint_symbol["icon-color"]),"icon-halo-color":new ee(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ee(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ee(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new te(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new te(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ee(pe.paint_symbol["text-opacity"]),"text-color":new ee(pe.paint_symbol["text-color"],{runtimeType:gr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ee(pe.paint_symbol["text-halo-color"]),"text-halo-width":new ee(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new ee(pe.paint_symbol["text-halo-blur"]),"text-translate":new te(pe.paint_symbol["text-translate"]),"text-translate-anchor":new te(pe.paint_symbol["text-translate-anchor"])}),layout:Jd};class Rh{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:zr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt("FormatSectionOverride",Rh,{omit:["defaultValue"]});class Fh extends Ut{constructor(t){super(t,ep)}recalculate(t,s){super.recalculate(t,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const m of l)u.indexOf(m)<0&&u.push(m);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,s,l,u){const m=this.layout.get(t).evaluate(s,{},l,u),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Hr(g.value)||!m?m:(x=s.properties,m.replace(/{([^{}]+)}/g,(E,I)=>I in x?String(x[I]):""));var x}createBucket(t){return new kl(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of ep.paint.overridableProperties){if(!Fh.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),l=new Rh(s),u=new $l(l,s.property.specification);let m=null;m="constant"===s.value.kind||"source"===s.value.kind?new Fr("source",u):new Ra("composite",u,s.value.zoomStops,s.value._interpolationType),this.paint._values[t]=new re(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&Fh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const l=t.get("text-field"),u=ep.paint.properties[s];let m=!1;const g=x=>{for(const w of x)if(u.overrides&&u.overrides.hasOverride(w))return void(m=!0)};if("constant"===l.value.kind&&l.value.value instanceof oi)g(l.value.value.sections);else if("source"===l.value.kind){const x=E=>{m||(E instanceof mo&&Tn(E.value)===wa?g(E.value.sections):E instanceof $r?g(E.sections):E.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return m}getProgramConfiguration(t){return new Or(this,t)}}var tp={paint:new se({"background-color":new te(pe.paint_background["background-color"]),"background-pattern":new De(pe.paint_background["background-pattern"]),"background-opacity":new te(pe.paint_background["background-opacity"])})},np={paint:new se({"raster-opacity":new te(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new te(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new te(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new te(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new te(pe.paint_raster["raster-saturation"]),"raster-contrast":new te(pe.paint_raster["raster-contrast"]),"raster-resampling":new te(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new te(pe.paint_raster["raster-fade-duration"])})};class ip extends Ut{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var Jc={paint:new se({"sky-type":new te(pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new te(pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new te(pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new te(pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new te(pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Le(pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new te(pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new te(pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new te(pe.paint_sky["sky-opacity"])})};function ga(r,t,s){const l=la(0,0,1),u=Vp(ph());return function(m,g,x){x*=.5;var w=g[0],E=g[1],I=g[2],z=g[3],R=Math.sin(x),B=Math.cos(x);m[0]=w*B-I*R,m[1]=E*B+z*R,m[2]=I*B+w*R,m[3]=z*B-E*R}(u,u,s?-mi(r)+Math.PI:mi(r)),_d(u,u,-mi(t)),yd(l,l,u),Bc(l,l)}const rp={circle:class extends Ut{constructor(r){super(r,sm)}createBucket(r){return new ud(r)}queryRadius(r){const t=r;return Lc("circle-radius",this,t)+Lc("circle-stroke-width",this,t)+uh(this.paint.get("circle-translate"))}queryIntersectsFeature(r,t,s,l,u,m,g,x){const w="map"===this.paint.get("circle-pitch-alignment");if(w&&r.queryGeometry.isAboveHorizon)return!1;const E=fd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s),z=w?I*r.pixelToTileUnitsFactor:I;for(const R of l)for(const B of R){const j=B.add(E),X=x&&m.elevation?m.elevation.exaggeration()*x.getElevationAt(j.x,j.y,!0):0,ie=w?j:qp(j,X,g),he=w?r.tilespaceRays.map(ve=>Gp(ve,X)):r.queryGeometry.screenGeometry;let ye=z;const _e=xl([],[B.x,B.y,X,1],g);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?ye*=_e[3]/m.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(ye*=m.cameraToCenterDistance/_e[3]),tm(he,ie,ye))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new Or(this,r)}},heatmap:class extends Ut{createBucket(r){return new xd(r)}constructor(r){super(r,cm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"heatmap-color"===r&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new Or(this,r)}},hillshade:class extends Ut{constructor(r){super(r,um)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(r){return new Or(this,r)}},fill:class extends Ut{constructor(r){super(r,Sd)}getProgramIds(){const r=this.paint.get("fill-pattern"),t=r&&r.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(r){return new Or(this,r)}recalculate(r,t){super.recalculate(r,t);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new ua(r)}queryRadius(){return uh(this.paint.get("fill-translate"))}queryIntersectsFeature(r,t,s,l,u,m){return!r.queryGeometry.isAboveHorizon&&hd(pd(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Ut{constructor(r){super(r,Jp)}createBucket(r){return new yh(r)}queryRadius(){return uh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new Or(this,r)}queryIntersectsFeature(r,t,s,l,u,m,g,x,w){const E=fd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(t,s),z=this.paint.get("fill-extrusion-base").evaluate(t,s),R=[0,0],B=x&&m.elevation,j=m.elevation?m.elevation.exaggeration():1;if(B){const he=r.tile.getBucket(this).centroidVertexArray,ye=w+1;if(ye<he.length){const _e=he.get(ye);R[0]=_e.a_centroid_pos0,R[1]=_e.a_centroid_pos1}}if(0===R[0]&&1===R[1])return!1;const X=(he=l,ye=z,_e=I,ve=E,we=g,(xe=B?x:null)?function(He,ze,Re,Ke,Pe,_t,Lt,Rt,bt){const st=[],wn=[],ct=[0,0,0,1];for(const Gn of He){const di=[],pi=[];for(const Gi of Gn){const jn=Gi.x+Ke.x,$n=Gi.y+Ke.y,bn=El(jn,$n,ze,Re,_t,Lt,Rt,bt);ct[0]=jn,ct[1]=$n,ct[2]=bn.base,ct[3]=1,xl(ct,ct,Pe),ct[3]=Math.max(ct[3],1e-5);const ei=Md([ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]]);ct[0]=jn,ct[1]=$n,ct[2]=bn.top,ct[3]=1,xl(ct,ct,Pe),ct[3]=Math.max(ct[3],1e-5);const Zn=Md([ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]]);di.push(ei),pi.push(Zn)}st.push(di),wn.push(pi)}return[st,wn]}(he,ye,_e,ve,we,xe,R,j,m.center.lat):function(He,ze,Re,Ke,Pe){const _t=[],Lt=[],Rt=Pe[8]*ze,bt=Pe[9]*ze,st=Pe[10]*ze,wn=Pe[11]*ze,ct=Pe[8]*Re,Gn=Pe[9]*Re,di=Pe[10]*Re,pi=Pe[11]*Re;for(const Gi of He){const jn=[],$n=[];for(const bn of Gi){const ei=bn.x+Ke.x,Zn=bn.y+Ke.y,Nn=Pe[0]*ei+Pe[4]*Zn+Pe[12],ji=Pe[1]*ei+Pe[5]*Zn+Pe[13],tn=Pe[2]*ei+Pe[6]*Zn+Pe[14],fi=Pe[3]*ei+Pe[7]*Zn+Pe[15],Rn=Nn+Rt,ti=ji+bt,$i=tn+st,gt=Math.max(fi+wn,1e-5),ms=Nn+ct,Zi=ji+Gn,jt=tn+di,ni=Math.max(fi+pi,1e-5),Xt=new Be(Rn/gt,ti/gt);Xt.z=$i/gt,jn.push(Xt);const Cn=new Be(ms/ni,Zi/ni);Cn.z=jt/ni,$n.push(Cn)}_t.push(jn),Lt.push($n)}return[_t,Lt]}(he,ye,_e,ve,we)),ie=r.queryGeometry;var he,ye,_e,ve,we,xe;return function(he,ye,_e){let ve=1/0;hd(_e,ye)&&(ve=_h(_e,ye[0]));for(let we=0;we<ye.length;we++){const xe=ye[we],Oe=he[we];for(let qe=0;qe<xe.length-1;qe++){const Fe=xe[qe],He=[Fe,xe[qe+1],Oe[qe+1],Oe[qe],Fe];ch(_e,He)&&(ve=Math.min(ve,_h(_e,He)))}}return ve!==1/0&&ve}(X[0],X[1],ie.isPointQuery()?ie.screenBounds:ie.screenGeometry)}},line:class extends Ut{constructor(r){super(r,vh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if("line-gradient"===r){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Es,this.gradientVersion=(this.gradientVersion+1)%ii}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,t){super.recalculate(r,t),this.paint._values["line-floorwidth"]=Pd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new ha(r)}getProgramIds(){const r=this.paint.get("line-dasharray"),t=this.paint.get("line-pattern").constantOr(1),s=this.paint.get("line-gradient");return[t?"linePattern":r?"lineSDF":s?"lineGradient":"line"]}getProgramConfiguration(r){return new Or(this,r)}queryRadius(r){const t=r,s=nf(Lc("line-width",this,t),Lc("line-gap-width",this,t)),l=Lc("line-offset",this,t);return s/2+Math.abs(l)+uh(this.paint.get("line-translate"))}queryIntersectsFeature(r,t,s,l,u,m){if(r.queryGeometry.isAboveHorizon)return!1;const g=pd(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),x=r.pixelToTileUnitsFactor/2*nf(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),w=this.paint.get("line-offset").evaluate(t,s);return w&&(l=function(E,I){const z=[],R=new Be(0,0);for(let B=0;B<E.length;B++){const j=E[B],X=[];for(let ie=0;ie<j.length;ie++){const he=j[ie-1],ye=j[ie],_e=j[ie+1],ve=0===ie?R:ye.sub(he)._unit()._perp(),we=ie===j.length-1?R:_e.sub(ye)._unit()._perp(),xe=ve._add(we)._unit();xe._mult(1/(xe.x*we.x+xe.y*we.y)),X.push(xe._mult(I)._add(ye))}z.push(X)}return z}(l,w*r.pixelToTileUnitsFactor)),function(E,I,z){for(let R=0;R<I.length;R++){const B=I[R];if(E.length>=3)for(let j=0;j<B.length;j++)if(Wa(E,B[j]))return!0;if(nm(E,B,z))return!0}return!1}(g,l,x)}isTileClipped(){return!0}},symbol:Fh,background:class extends Ut{constructor(r){super(r,tp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ut{constructor(r){super(r,np)}getProgramIds(){return["raster"]}},sky:class extends Ut{constructor(r){super(r,Jc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"sky-gradient"===r?this._updateColorRamp():"sky-atmosphere-sun"!==r&&"sky-atmosphere-halo-color"!==r&&"sky-atmosphere-color"!==r&&"sky-atmosphere-sun-intensity"!==r||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=bd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}}getCenter(r,t){const s=this.paint.get("sky-type");if("atmosphere"===s){const l=this.paint.get("sky-atmosphere-sun"),u=!l,m=r.style.light,g=m.properties.get("position");return u&&"viewport"===m.properties.get("anchor")&&Qt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?ga(g.azimuthal,90-g.polar,t):ga(l[0],90-l[1],t)}if("gradient"===s){const l=this.paint.get("sky-gradient-center");return ga(l[0],90-l[1],t)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return"atmosphere"===r?["skyboxCapture","skybox"]:"gradient"===r?["skyboxGradient"]:null}}},{HTMLImageElement:hc,HTMLCanvasElement:dc,HTMLVideoElement:sp,ImageData:pc,ImageBitmap:Bh}=at;class Oh{constructor(t,s,l,u){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(s,u)}update(t,s,l){const{width:u,height:m}=t,g=!(this.size&&this.size[0]===u&&this.size[1]===m||l),{context:x}=this,{gl:w}=x;if(this.useMipmap=Boolean(s&&s.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!s||!1!==s.premultiply)),g)this.size=[u,m],t instanceof hc||t instanceof dc||t instanceof sp||t instanceof pc||Bh&&t instanceof Bh?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,t):w.texImage2D(w.TEXTURE_2D,0,this.format,u,m,0,this.format,w.UNSIGNED_BYTE,t.data);else{const{x:E,y:I}=l||{x:0,y:0};t instanceof hc||t instanceof dc||t instanceof sp||t instanceof pc||Bh&&t instanceof Bh?w.texSubImage2D(w.TEXTURE_2D,0,E,I,w.RGBA,w.UNSIGNED_BYTE,t):w.texSubImage2D(w.TEXTURE_2D,0,E,I,u,m,w.RGBA,w.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D)}bind(t,s,l){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||t),this.filter=t),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Ja{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof On?new On(t.lng,t.lat):On.convert(t),this}setSouthWest(t){return this._sw=t instanceof On?new On(t.lng,t.lat):On.convert(t),this}extend(t){const s=this._sw,l=this._ne;let u,m;if(t instanceof On)u=t,m=t;else{if(!(t instanceof Ja))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ja.convert(t)):this.extend(On.convert(t)):this;if(u=t._sw,m=t._ne,!u||!m)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new On(u.lng,u.lat),this._ne=new On(m.lng,m.lat)),this}getCenter(){return new On((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new On(this.getWest(),this.getNorth())}getSouthEast(){return new On(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:l}=On.convert(t);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(t){return!t||t instanceof Ja?t:new Ja(t)}}const Nh=6371008.8;class On{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new On(gn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,l=this.lat*s,u=t.lat*s,m=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((t.lng-this.lng)*s);return Nh*Math.acos(Math.min(m,1))}toBounds(t=0){const s=360*t/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Ja(new On(this.lng-l,this.lat-s),new On(this.lng+l,this.lat+s))}static convert(t){if(t instanceof On)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new On(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new On(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Uh=2*Math.PI*Nh;function bf(r){return Uh*Math.cos(r*Math.PI/180)}function Tf(r){return(180+r)/360}function Vh(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ju(r,t){return r/bf(t)}function qh(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Gh(r,t){return r*bf(qh(t))}class eu{constructor(t,s,l=0){this.x=+t,this.y=+s,this.z=+l}static fromLngLat(t,s=0){const l=On.convert(t);return new eu(Tf(l.lng),Vh(l.lat),ju(s,l.lat))}toLngLat(){return new On(360*this.x-180,qh(this.y))}toAltitude(){return Gh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Uh*(t=qh(this.y),1/Math.cos(t*Math.PI/180));var t}}class jh{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new Rs({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){const l=this.getKey(t,s);return this.positions[l]}trim(){const t=this.width,s=this.height=Mt(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,l){const u=[];let m=t.length%2==1?-t[t.length-1]*l:0,g=t[0]*l,x=!0;u.push({left:m,right:g,isDash:x,zeroLength:0===t[0]});let w=t[0];for(let E=1;E<t.length;E++){x=!x;const I=t[E];m=w*l,w+=I,g=w*l,u.push({left:m,right:g,isDash:x,zeroLength:0===I})}return u}addRoundDash(t,s,l){const u=s/2;for(let m=-l;m<=l;m++){const g=this.width*(this.nextRow+l+m);let x=0,w=t[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++x]);const I=Math.abs(E-w.left),z=Math.abs(E-w.right),R=Math.min(I,z);let B;const j=m/l*(u+1);if(w.isDash){const X=u-Math.abs(j);B=Math.sqrt(R*R+X*X)}else B=u-Math.sqrt(R*R+j*j);this.image.data[g+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(t,s){for(let w=t.length-1;w>=0;--w){const E=t[w],I=t[w+1];E.zeroLength?t.splice(w,1):I&&I.isDash===E.isDash&&(I.left=E.left,t.splice(w,1))}const l=t[0],u=t[t.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const m=this.width*this.nextRow;let g=0,x=t[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++g]);const E=Math.abs(w-x.left),I=Math.abs(w-x.right),z=Math.min(E,I);this.image.data[m+w]=Math.max(0,Math.min(255,(x.isDash?z:-z)+s+128))}}addDash(t,s){const l=this.getKey(t,s);if(this.positions[l])return this.positions[l];const u="round"===s,m=u?7:0,g=2*m+1;if(this.nextRow+g>this.height)return Qt("LineAtlas out of space"),null;0===t.length&&t.push(1);let x=0;for(let I=0;I<t.length;I++)t[I]<0&&(Qt("Negative value is found in line dasharray, replacing values with 0"),t[I]=0),x+=t[I];if(0!==x){const I=this.width/x,z=this.getDashRanges(t,this.width,I);u?this.addRoundDash(z,I,m):this.addRegularDash(z,"square"===s?.5*I:0)}const w=this.nextRow+m;this.nextRow+=g;const E={tl:[w,m],br:[x,0]};return this.positions[l]=E,E}}rt("LineAtlas",jh);class Ef{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Sf=at.performance;function op(r){const t=r?r.url.toString():void 0;return Sf.getEntriesByName(t)}class km{constructor(){this.tasks={},this.taskQueue=[],Xn(["process"],this),this.invoker=new Ef(this.process),this.nextId=0}add(t,s){const l=this.nextId++,u=function({type:m,isSymbolTile:g,zoom:x}){return x=x||0,"message"===m?0:"maybePrepare"!==m||g?"parseTile"!==m||g?"parseTile"===m&&g?300-x:"maybePrepare"===m&&g?400-x:500:200-x:100-x}(s);if(0===u){Ar();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:t,metadata:s,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Ar();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let u=0;u<this.taskQueue.length;u++){const m=this.tasks[this.taskQueue[u]];m.priority<s&&(s=m.priority,t=u)}if(null===t)return null;const l=this.taskQueue[t];return this.taskQueue.splice(t,1),l}remove(){this.invoker.remove()}}function If(r,t,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[r*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class ap{constructor(t,s,l){this.z=t,this.x=s,this.y=l,this.key=fc(0,t,t,s,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s){const l=(m=this.y,g=this.z,x=If(256*(u=this.x),256*(m=Math.pow(2,g)-m-1),g),w=If(256*(u+1),256*(m+1),g),x[0]+","+x[1]+","+w[0]+","+w[1]);var u,m,g,x,w;const E=function(I,z,R){let B,j="";for(let X=I;X>0;X--)B=1<<X-1,j+=(z&B?1:0)+(R&B?2:0);return j}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",E).replace("{bbox-epsg-3857}",l)}getTilePoint(t){const s=Math.pow(2,this.z);return new Be((t.x*s-this.x)*Jt,(t.y*s-this.y)*Jt)}getTileVec3(t){const s=Math.pow(2,this.z);return la((t.x*s-this.x)*Jt,(t.y*s-this.y)*Jt,Gh(t.z,t.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Af{constructor(t,s){this.wrap=t,this.canonical=s,this.key=fc(t,s.z,s.z,s.x,s.y)}}class br{constructor(t,s,l,u,m){this.overscaledZ=t,this.wrap=s,this.canonical=new ap(l,+u,+m),this.key=0===s&&t===l?this.canonical.key:fc(s,t,l,u,m)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const s=this.canonical.z-t;return t>this.canonical.z?new br(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new br(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return fc(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-t;return fc(this.wrap*+s,t,t,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new br(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new br(s,this.wrap,s,l,u),new br(s,this.wrap,s,l+1,u),new br(s,this.wrap,s,l,u+1),new br(s,this.wrap,s,l+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new br(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new br(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Af(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new eu(t.x-this.wrap,t.y))}getTileVec3(t){return this.canonical.getTileVec3(new eu(t.x-this.wrap,t.y,t.z))}}function fc(r,t,s,l,u){const m=1<<Math.min(s,22);let g=m*(u%m)+l%m;return r&&s<22&&(g+=m*m*((r<0?-2*r-1:2*r)%(1<<2*(22-s)))),16*(32*g+s)+(t-s)}rt("CanonicalTileID",ap),rt("OverscaledTileID",br,{omit:["projMatrix"]});class $h{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const l=t[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Cf{constructor(t,s,l,u,m){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=l,t._y=u,this.properties=t.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(t[s]=this[s]);return t}}var lp=Xe([{name:"a_pos",type:"Int16",components:2}]);class kf{constructor(t,s,l){this.tileID=t,this.uid=Ir(),this.uses=0,this.tileSize=s,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<ri.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(t,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,m){const g={};if(!m)return g;for(const x of u){const w=x.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(0!==w.length){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>w.filter(I=>I.id===E)[0]));for(const E of w)g[E.id]=x}}return g}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const m=this.buckets[u];if(m instanceof kl){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const m=this.buckets[u];if(m instanceof kl&&m.hasRTLText){this.hasRTLText=!0,U.isLoading()||U.isLoaded()||"deferred"!==L()||O();break}}this.queryPadding=0;for(const u in this.buckets){const m=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(m))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Ro}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Oh(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Oh(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Oh(t,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,l,u,m,g,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:g,params:m},t,s,l):{}}querySourceFeatures(t,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),m=s?s.sourceLayer:"",g=u._geojsonTileLayer||u[m];if(!g)return;const x=Po(s&&s.filter),{z:w,x:E,y:I}=this.tileID.canonical,z={z:w,x:E,y:I};for(let R=0;R<g.length;R++){const B=g.feature(R);if(x.needGeometry){const ie=nc(B,!0);if(!x.filter(new q(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!x.filter(new q(this.tileID.overscaledZ),B))continue;const j=l.getId(B,m),X=new Cf(B,w,E,I,j);X.tile=z,t.push(X)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const l=ns(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const m=this.expirationTime-s;m?this.expirationTime=l+Math.max(m,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const m=this.buckets[u],g=m.layers[0].sourceLayer||"_geojsonTileLayer",x=l[g],w=t[g];if(!x||!w||0===Object.keys(w).length)continue;m.update(w,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=s&&s.style&&s.style.getLayer(u);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(m)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ri.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ri.now()+t}setDependencies(t,s){const l={};for(const u of s)l[u]=!0;this.dependencies[t]=l}hasDependency(t,s){for(const l of t){const u=this.dependencies[l];if(u)for(const m of s)if(u[m])return!0}return!1}clearQueryDebugViz(){}}class cp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,l){const u=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},Tt(this.stateChanges[t][u],l),null===this.deletedStates[t]){this.deletedStates[t]={};for(const m in this.state[t])m!==u&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][u]){this.deletedStates[t][u]={};for(const m in this.state[t][u])l[m]||(this.deletedStates[t][u][m]=null)}else for(const m in l)this.deletedStates[t]&&this.deletedStates[t][u]&&null===this.deletedStates[t][u][m]&&delete this.deletedStates[t][u][m]}removeFeatureState(t,s,l){if(null===this.deletedStates[t])return;const u=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&void 0!==s)null!==this.deletedStates[t][u]&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][l]=null);else if(void 0!==s)if(this.stateChanges[t]&&this.stateChanges[t][u])for(l in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][l]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,s){const l=String(s),u=Tt({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const m=this.deletedStates[t][s];if(null===m)return{};for(const g in m)delete u[g]}return u}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const m={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),Tt(this.state[u][g],this.stateChanges[u][g]),m[g]=this.state[u][g];l[u]=m}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const m={};if(null===this.deletedStates[u])for(const g in this.state[u])m[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(null===this.deletedStates[u][g])this.state[u][g]={};else for(const x of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][x];m[g]=this.state[u][g]}l[u]=l[u]||{},Tt(l[u],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const u in t)t[u].setFeatureState(l,s)}}class up{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){const l=this.toIdx(t,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function Zh(r,t,s,l){let u=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(s[g]<r[g]||s[g]>t[g])return null}else{const x=1/l[g];let w=(r[g]-s[g])*x,E=(t[g]-s[g])*x;if(w>E){const I=w;w=E,E=I}if(w>u&&(u=w),E<m&&(m=E),u>m)return null}return u}function hp(r,t,s,l,u,m,g,x,w,E,I){const z=l-r,R=u-t,B=m-s,j=g-r,X=x-t,ie=w-s,he=I[1]*ie-I[2]*X,ye=I[2]*j-I[0]*ie,_e=I[0]*X-I[1]*j,ve=z*he+R*ye+B*_e;if(Math.abs(ve)<1e-15)return null;const we=1/ve,xe=E[0]-r,Oe=E[1]-t,qe=E[2]-s,Fe=(xe*he+Oe*ye+qe*_e)*we;if(Fe<0||Fe>1)return null;const He=Oe*B-qe*R,ze=qe*z-xe*B,Re=xe*R-Oe*z,Ke=(I[0]*He+I[1]*ze+I[2]*Re)*we;return Ke<0||Fe+Ke>1?null:(j*He+X*ze+ie*Re)*we}function Mf(r,t,s){return(r-t)/(s-t)}function Wh(r,t,s,l,u,m,g,x,w){const E=1<<s,I=m-l,z=g-u,R=(r+1)/E*I+l,B=(t+0)/E*z+u,j=(t+1)/E*z+u;x[0]=(r+0)/E*I+l,x[1]=B,w[0]=R,w[1]=j}class Pf{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(m){const g=Math.ceil(Math.log2(m.dim/8)),x=[];let w=Math.ceil(Math.pow(2,g));const E=1/w,I=(B,j,X,ie,he)=>{const ye=ie?1:0,_e=(B+1)*X-ye,ve=j*X,we=(j+1)*X-ye;he[0]=B*X,he[1]=ve,he[2]=_e,he[3]=we};let z=new up(w);const R=[];for(let B=0;B<w*w;B++){I(B%w,Math.floor(B/w),E,!1,R);const j=Ml(R[0],R[1],m),X=Ml(R[2],R[1],m),ie=Ml(R[2],R[3],m),he=Ml(R[0],R[3],m);z.minimums.push(Math.min(j,X,ie,he)),z.maximums.push(Math.max(j,X,ie,he)),z.leaves.push(1)}for(x.push(z),w/=2;w>=1;w/=2){const B=x[x.length-1];z=new up(w);for(let j=0;j<w*w;j++){I(j%w,Math.floor(j/w),2,!0,R);const X=B.getElevation(R[0],R[1]),ie=B.getElevation(R[2],R[1]),he=B.getElevation(R[2],R[3]),ye=B.getElevation(R[0],R[3]),_e=B.isLeaf(R[0],R[1]),ve=B.isLeaf(R[2],R[1]),we=B.isLeaf(R[2],R[3]),xe=B.isLeaf(R[0],R[3]),Oe=Math.min(X.min,ie.min,he.min,ye.min),qe=Math.max(X.max,ie.max,he.max,ye.max),Fe=_e&&ve&&we&&xe;z.maximums.push(qe),z.minimums.push(Oe),z.leaves.push(qe-Oe<=5&&Fe?1:0)}x.push(z)}return x}(this.dem),l=s.length-1,u=s[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(t,s,l,u,m,g,x=1){return Zh([t,s,-100],[l,u,this.maximums[0]*x],m,g)}raycast(t,s,l,u,m,g,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(t,s,l,u,m,g,x);if(null==w)return null;const E=[],I=[],z=[],R=[],B=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:j,t:X,nodex:ie,nodey:he,depth:ye}=B.pop();if(this.leaves[j]){Wh(ie,he,ye,t,s,l,u,z,R);const ve=1<<ye,we=(ie+0)/ve,xe=(ie+1)/ve,Oe=(he+0)/ve,qe=(he+1)/ve,Fe=Ml(we,Oe,this.dem)*x,He=Ml(xe,Oe,this.dem)*x,ze=Ml(xe,qe,this.dem)*x,Re=Ml(we,qe,this.dem)*x,Ke=hp(z[0],z[1],Fe,R[0],z[1],He,R[0],R[1],ze,m,g),Pe=hp(R[0],R[1],ze,z[0],R[1],Re,z[0],z[1],Fe,m,g),_t=Math.min(null!==Ke?Ke:Number.MAX_VALUE,null!==Pe?Pe:Number.MAX_VALUE);if(_t!==Number.MAX_VALUE)return _t;{const Lt=gd([],m,g,X);if(Hh(Fe,He,Re,ze,Mf(Lt[0],z[0],R[0]),Mf(Lt[1],z[1],R[1]))>=Lt[2])return X}continue}let _e=0;for(let ve=0;ve<this._siblingOffset.length;ve++){Wh((ie<<1)+this._siblingOffset[ve][0],(he<<1)+this._siblingOffset[ve][1],ye+1,t,s,l,u,z,R),z[2]=-100,R[2]=this.maximums[this.childOffsets[j]+ve]*x;const we=Zh(z,R,m,g);if(null!=we){const xe=we;E[ve]=xe;let Oe=!1;for(let qe=0;qe<_e&&!Oe;qe++)xe>=E[I[qe]]&&(I.splice(qe,0,ve),Oe=!0);Oe||(I[_e]=ve),_e++}}for(let ve=0;ve<_e;ve++){const we=I[ve];B.push({idx:this.childOffsets[j]+we,t:E[we],nodex:(ie<<1)+this._siblingOffset[we][0],nodey:(he<<1)+this._siblingOffset[we][1],depth:ye+1})}}return null}_addNode(t,s,l){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,l,u,m){if(1===t[u].isLeaf(s,l))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const g=u-1,x=t[g];let w,E=0;for(let I=0;I<this._siblingOffset.length;I++){const z=2*s+this._siblingOffset[I][0],R=2*l+this._siblingOffset[I][1],B=x.getElevation(z,R),j=x.isLeaf(z,R),X=this._addNode(B.min,B.max,j);j&&(E|=1<<I),w||(w=X)}for(let I=0;I<this._siblingOffset.length;I++)E&1<<I||this._construct(t,2*s+this._siblingOffset[I][0],2*l+this._siblingOffset[I][1],g,w+I)}}function Hh(r,t,s,l,u,m){return Nt(Nt(r,s,m),Nt(t,l,m),u)}function Ml(r,t,s){const l=s.dim,u=dn(r*l-.5,0,l-1),m=dn(t*l-.5,0,l-1),g=Math.floor(u),x=Math.floor(m),w=Math.min(g+1,l-1),E=Math.min(x+1,l-1);return Hh(s.get(g,x),s.get(w,x),s.get(g,E),s.get(w,E),u-g,m-x)}const Kh={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Xh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,l,u=!1,m=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return Qt(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const g=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox",this.borderReady=u,!u){for(let x=0;x<g;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(g,x)]=this.data[this._idx(g-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,g)]=this.data[this._idx(x,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Pf(this)}get(t,s,l=!1){const u=new Uint8Array(this.data.buffer);l&&(t=dn(t,-1,this.dim),s=dn(s,-1,this.dim));const m=4*this._idx(t,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(u[m],u[m+1],u[m+2])}static getUnpackVector(t){return Kh[t]}get unpackVector(){return Kh[this.encoding]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}_unpackMapbox(t,s,l){return(256*t*256+256*s+l)/10-1e4}_unpackTerrarium(t,s,l){return 256*t+s+l/256-32768}static pack(t,s){const l=[0,0,0,0],u=Xh.getUnpackVector(s);let m=Math.floor((t+u[3])/u[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new hr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=s*this.dim,m=s*this.dim+this.dim,g=l*this.dim,x=l*this.dim+this.dim;switch(s){case-1:u=m-1;break;case 1:m=u+1}switch(l){case-1:g=x-1;break;case 1:x=g+1}const w=-s*this.dim,E=-l*this.dim;for(let I=g;I<x;I++)for(let z=u;z<m;z++)this.data[this._idx(z,I)]=t.data[this._idx(z+w,I+E)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}rt("DEMData",Xh),rt("DemMinMaxQuadTree",Pf,{omit:["dem"]});class dp{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,l){const u=t.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const m={value:s,timeout:void 0};if(void 0!==l&&(m.timeout=setTimeout(()=>{this.remove(t,m)},l)),this.data[u].push(m),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const l=t.wrapped().key,u=void 0===s?0:this.data[l].indexOf(s),m=this.data[l][u];return this.data[l].splice(u,1),m.timeout&&clearTimeout(m.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const l in this.data)for(const u of this.data[l])t(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class Pl{constructor(t,s,l){this.func=t,this.mask=s,this.range=l}}Pl.ReadOnly=!1,Pl.ReadWrite=!0,Pl.disabled=new Pl(519,Pl.ReadOnly,[0,1]);class Dl{constructor(t,s,l,u,m,g){this.test=t,this.ref=s,this.mask=l,this.fail=u,this.depthFail=m,this.pass=g}}Dl.disabled=new Dl({func:519,mask:0},0,0,7680,7680,7680);class Vo{constructor(t,s,l){this.blendFunction=t,this.blendColor=s,this.mask=l}}Vo.Replace=[1,0],Vo.disabled=new Vo(Vo.Replace,$t.transparent,[!1,!1,!1,!1]),Vo.unblended=new Vo(Vo.Replace,$t.transparent,[!0,!0,!0,!0]),Vo.alphaBlended=new Vo([1,771],$t.transparent,[!0,!0,!0,!0]);class Bs{constructor(t,s,l){this.enable=t,this.mode=s,this.frontFace=l}}Bs.disabled=new Bs(!1,1029,2305),Bs.backCCW=new Bs(!0,1029,2305),Bs.backCW=new Bs(!0,1029,2304),Bs.frontCW=new Bs(!0,1028,2304),Bs.frontCCW=new Bs(!0,1028,2305);class Qr extends it{constructor(t,s,l){super(),this.id=t,this._onlySymbols=l,s.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new dp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new cp}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return nn(this._tiles).map(t=>t.tileID).sort(Yh).map(t=>t.key)}getRenderableIds(t){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,t)&&s.push(this._tiles[l]);return t?s.sort((l,u)=>{const m=l.tileID,g=u.tileID,x=new Be(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),w=new Be(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-g.overscaledZ||w.y-x.y||w.x-x.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Yh).map(l=>l.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const l=this._tiles[t];l&&("loading"!==l.state&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,t,s)))}_tileLoaded(t,s,l,u){if(u)return t.state="errored",void(404!==u.status?this._source.fire(new Te(u,{tile:t})):this.update(this.transform));t.timeAdded=ri.now(),"expired"===l&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Ge("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const m=s[u];if(t.neighboringTiles&&t.neighboringTiles[m]){const g=this.getTileByID(m);l(t,g),l(g,t)}}function l(u,m){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=m.tileID.canonical.x-u.tileID.canonical.x;const x=m.tileID.canonical.y-u.tileID.canonical.y,w=Math.pow(2,u.tileID.canonical.z),E=m.tileID.key;0===g&&0===x||Math.abs(x)>1||(Math.abs(g)>1&&(1===Math.abs(g+w)?g+=w:1===Math.abs(g-w)&&(g-=w)),m.dem&&u.dem&&(u.dem.backfillBorder(m.dem,g,x),u.neighboringTiles&&u.neighboringTiles[E]&&(u.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,l,u){for(const m in this._tiles){let g=this._tiles[m];if(u[m]||!g.hasData()||g.tileID.overscaledZ<=s||g.tileID.overscaledZ>l)continue;let x=g.tileID;for(;g&&g.tileID.overscaledZ>s+1;){const E=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[E.key],g&&g.hasData()&&(x=E)}let w=x;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),t[w.key]){u[x.key]=x;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=t.overscaledZ-1;l>=s;l--){const u=t.scaledTo(l),m=this._getLoadedTile(u);if(m)return m}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const l=Math.ceil(t.width/s)+1,u=Math.ceil(t.height/s)+1,m=Math.floor(l*u*5),g="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(g)}handleWrapJump(t){const s=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,s){const l={};for(const u in this._tiles){const m=this._tiles[u];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),l[m.tileID.key]=m}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(t,s,l){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let u;this.updateCacheSize(t,s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new br(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const m=this._updateRetainedTiles(u);if(Df(this._source.type)&&0!==u.length){const x={},w={},E=Object.keys(m);for(const z of E){const R=m[z],B=this._tiles[z];if(!B||B.fadeEndTime&&B.fadeEndTime<=ri.now())continue;const j=this.findLoadedParent(R,Math.max(R.overscaledZ-Qr.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),x[j.tileID.key]=j.tileID),w[z]=R}const I=u[u.length-1].overscaledZ;for(const z in this._tiles){const R=this._tiles[z];if(m[z]||!R.hasData())continue;let B=R.tileID;for(;B.overscaledZ>I;){B=B.scaledTo(B.overscaledZ-1);const j=this._tiles[B.key];if(j&&j.hasData()&&w[B.key]){m[z]=R.tileID;break}}}for(const z in x)m[z]||(this._coveredTiles[z]=!0,m[z]=x[z])}for(const x in m)this._tiles[x].clearFadeHold();const g=function(x,w){const E=[];for(const I in x)I in w||E.push(I);return E}(this._tiles,m);for(const x of g){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(0===t.length)return s;const l={},u=t[t.length-1].overscaledZ,m=t[0].overscaledZ,g=Math.max(m-Qr.maxOverzooming,this._source.minzoom),x=Math.max(m+Qr.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const I=this._addTile(E);s[E.key]=E,I.hasData()||u<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,u,x,s);for(const E of t){let I=this._tiles[E.key];if(I.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const R=E.children(this._source.maxzoom)[0],B=this.getTile(R);if(B&&B.hasData()){s[R.key]=R;continue}}else{const R=E.children(this._source.maxzoom);if(s[R[0].key]&&s[R[1].key]&&s[R[2].key]&&s[R[3].key])continue}let z=I.wasRequested();for(let R=E.overscaledZ-1;R>=g;--R){const B=E.scaledTo(R);if(l[B.key]||(l[B.key]=!0,I=this.getTile(B),!I&&z&&(I=this._addTile(B)),I&&(s[B.key]=B,z=I.wasRequested(),I.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let l,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const m=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;u=m}for(const m of s)this._loadedParentTiles[m]=l}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const l=Boolean(s);return l||(s=new kf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s?(s.uses++,this._tiles[t.key]=s,l||this._source.fire(new Ge("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=s.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._cache.reset()}tilesIn(t,s,l){const u=[],m=this.transform;if(!m)return u;for(const g in this._tiles){const x=this._tiles[g];if(l&&x.clearQueryDebugViz(),x.holdingForFade())continue;const w=t.containsTile(x,m,s);w&&u.push(w)}return u}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Df(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=ri.now())return!0}return!1}setFeatureState(t,s,l){this._state.updateState(t=t||"_geojsonTileLayer",s,l)}removeFeatureState(t,s,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,l)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,l){const u=this._tiles[t];u&&u.setDependencies(s,l)}reloadTilesForDependencies(t,s){for(const l in this._tiles)this._tiles[l].hasDependency(t,s)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(t,s))}}function Yh(r,t){const s=Math.abs(2*r.wrap)-+(r.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return r.overscaledZ-t.overscaledZ||l-s||t.canonical.y-r.canonical.y||t.canonical.x-r.canonical.x}function Df(r){return"raster"===r||"image"===r||"video"===r}Qr.maxOverzooming=10,Qr.maxUnderzooming=3;class tu{constructor(t,s,l){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(t,s,l){const u=l||t.findDEMTileFor(s);if(!u||!u.dem)return;const m=u.dem,g=u.tileID,x=1<<s.canonical.z-g.canonical.z;return new tu(u,u.tileSize/Jt/x,[(s.canonical.x/x-g.canonical.x)*m.dim,(s.canonical.y/x-g.canonical.y)*m.dim])}tileCoordToPixel(t,s){const l=s*this._scale+this._offset[1],u=Math.floor(t*this._scale+this._offset[0]),m=Math.floor(l);return new Be(u,m)}getElevationAt(t,s,l,u){const m=t*this._scale+this._offset[0],g=s*this._scale+this._offset[1],x=Math.floor(m),w=Math.floor(g),E=this._dem;return u=!!u,l?Nt(Nt(E.get(x,w,u),E.get(x,w+1,u),g-w),Nt(E.get(x+1,w,u),E.get(x+1,w+1,u),g-w),m-x):E.get(x,w,u)}getElevationAtPixel(t,s,l){return this._dem.get(t,s,!!l)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ju(1,t)*this._dem.stride}}class zf{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ra(Jt,16,0),this.featureIndexArray=new ad,this.promoteId=s}insert(t,s,l,u,m,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,m,g);const w=this.grid;for(let E=0;E<s.length;E++){const I=s[E],z=[1/0,1/0,-1/0,-1/0];for(let R=0;R<I.length;R++){const B=I[R];z[0]=Math.min(z[0],B.x),z[1]=Math.min(z[1],B.y),z[2]=Math.max(z[2],B.x),z[3]=Math.max(z[3],B.y)}z[0]<Jt&&z[1]<Jt&&z[2]>=0&&z[3]>=0&&w.insert(x,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new bl.VectorTile(new Lu(this.rawTileData)).layers,this.sourceLayerCoder=new $h(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,l,u){this.loadVTLayers();const m=t.params||{},g=Po(m.filter),x=t.tileResult,w=t.transform,E=x.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(j,X,ie,he)=>dd(x.bufferedTilespaceGeometry,j,X,ie,he));I.sort(fp);let z=null;w.elevation&&I.length>0&&(z=tu.create(w.elevation,this.tileID));const R={};let B;for(let j=0;j<I.length;j++){const X=I[j];if(X===B)continue;B=X;const ie=this.featureIndexArray.get(X);let he=null;this.loadMatchingFeature(R,ie,g,m.layers,m.availableImages,s,l,u,(ye,_e,ve,we=0)=>(he||(he=vl(ye)),_e.queryIntersectsFeature(x,ye,ve,he,this.z,t.transform,t.pixelPosMatrix,z,we)))}return R}loadMatchingFeature(t,s,l,u,m,g,x,w,E){const{featureIndex:I,bucketIndex:z,sourceLayerIndex:R,layoutVertexArrayOffset:B}=s,j=this.bucketLayerIDs[z];if(u&&!function(ye,_e){for(let ve=0;ve<ye.length;ve++)if(_e.indexOf(ye[ve])>=0)return!0;return!1}(u,j))return;const X=this.sourceLayerCoder.decode(R),ie=this.vtLayers[X].feature(I);if(l.needGeometry){const ye=nc(ie,!0);if(!l.filter(new q(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!l.filter(new q(this.tileID.overscaledZ),ie))return;const he=this.getId(ie,X);for(let ye=0;ye<j.length;ye++){const _e=j[ye];if(u&&u.indexOf(_e)<0)continue;const ve=g[_e];if(!ve)continue;let we={};void 0!==he&&w&&(we=w.getState(ve.sourceLayer||"_geojsonTileLayer",he));const xe=Tt({},x[_e]);xe.paint=Lf(xe.paint,ve.paint,ie,we,m),xe.layout=Lf(xe.layout,ve.layout,ie,we,m);const Oe=!E||E(ie,ve,we,B);if(!Oe)continue;const qe=new Cf(ie,this.z,this.x,this.y,he);qe.layer=xe;let Fe=t[_e];void 0===Fe&&(Fe=t[_e]=[]),Fe.push({featureIndex:I,feature:qe,intersectionZ:Oe})}}lookupSymbolFeatures(t,s,l,u,m,g,x,w){const E={};this.loadVTLayers();const I=Po(m);for(const z of t)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:u,featureIndex:z,layoutVertexArrayOffset:0},I,g,x,w,s);return E}hasLayer(t){for(const s of this.bucketLayerIDs)for(const l of s)if(t===l)return!0;return!1}getId(t,s){let l=t.id;return this.promoteId&&(l=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof l&&(l=Number(l))),l}}function Lf(r,t,s,l,u){return bi(r,(m,g)=>{const x=t instanceof ue?t.get(g):null;return x&&x.evaluate?x.evaluate(s,l,u):x})}function fp(r,t){return t-r}rt("FeatureIndex",zf,{omit:["rawTileData","sourceLayerCoder"]});class Rf{constructor(t){const s={},l=[];for(const x in t){const w=t[x],E=s[x]={};for(const I in w.glyphs){const z=w.glyphs[+I];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const R=z.metrics.localGlyph?2:1,B={x:0,y:0,w:z.bitmap.width+2*R,h:z.bitmap.height+2*R};l.push(B),E[I]=B}}const{w:u,h:m}=Bd(l),g=new Rs({width:u||1,height:m||1});for(const x in t){const w=t[x];for(const E in w.glyphs){const I=w.glyphs[+E];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const z=s[x][E],R=I.metrics.localGlyph?2:1;Rs.copy(I.bitmap,g,{x:0,y:0},{x:z.x+R,y:z.y+R},I.bitmap)}}this.image=g,this.positions=s}}rt("GlyphAtlas",Rf);class mp{constructor(t){this.tileID=new br(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile}parse(t,s,l,u,m){this.status="parsing",this.data=t,this.collisionBoxArray=new Ro;const g=new $h(Object.keys(t.layers).sort()),x=new zf(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},E=new jh(256,256),I={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:l},z=s.familiesBySource[this.source];for(const we in z){const xe=t.layers[we];if(!xe)continue;let Oe=!1,qe=!1;for(const ze of z[we])"symbol"===ze[0].type?Oe=!0:qe=!0;if(!0===this.isSymbolTile&&!Oe||!1===this.isSymbolTile&&!qe)continue;1===xe.version&&Qt(`Vector tile source "${this.source}" layer "${we}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fe=g.encode(we),He=[];for(let ze=0;ze<xe.length;ze++){const Re=xe.feature(ze),Ke=x.getId(Re,we);He.push({feature:Re,id:Ke,index:ze,sourceLayerIndex:Fe})}for(const ze of z[we]){const Re=ze[0];void 0!==this.isSymbolTile&&"symbol"===Re.type!==this.isSymbolTile||Re.minzoom&&this.zoom<Math.floor(Re.minzoom)||Re.maxzoom&&this.zoom>=Re.maxzoom||"none"!==Re.visibility&&(gp(ze,this.zoom,l),(w[Re.id]=Re.createBucket({index:x.bucketLayerIDs.length,layers:ze,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fe,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(He,I,this.tileID.canonical),x.bucketLayerIDs.push(ze.map(Ke=>Ke.id)))}}let R,B,j,X;E.trim();const ie={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},he=bi(I.glyphDependencies,we=>Object.keys(we).map(Number));Object.keys(he).length?u.send("getGlyphs",{uid:this.uid,stacks:he},(we,xe)=>{R||(R=we,B=xe,ve.call(this))},void 0,!1,ie):B={};const ye=Object.keys(I.iconDependencies);ye.length?u.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"icons"},(we,xe)=>{R||(R=we,j=xe,ve.call(this))},void 0,!1,ie):j={};const _e=Object.keys(I.patternDependencies);function ve(){if(R)return m(R);if(B&&j&&X){const we=new Rf(B),xe=new uf(j,X);for(const Oe in w){const qe=w[Oe];qe instanceof kl?(gp(qe.layers,this.zoom,l),Hd(qe,B,we.positions,j,xe.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):qe.hasPattern&&(qe instanceof ha||qe instanceof ua||qe instanceof yh)&&(gp(qe.layers,this.zoom,l),qe.addFeatures(I,this.tileID.canonical,xe.patternPositions))}this.status="done",m(null,{buckets:nn(w).filter(Oe=>!Oe.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:we.image,lineAtlas:E,imageAtlas:xe,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?we.positions:null})}}_e.length?u.send("getImages",{icons:_e,source:this.source,tileID:this.tileID,type:"patterns"},(we,xe)=>{R||(R=we,X=xe,ve.call(this))},void 0,!1,ie):X={},ve.call(this)}}function gp(r,t,s){const l=new q(t);for(const u of r)u.recalculate(l,s)}class Qh{constructor(t){this.entries={},this.scheduler=t}request(t,s,l,u){const m=this.entries[t]=this.entries[t]||{callbacks:[]};if(m.result){const[g,x]=m.result;return this.scheduler?this.scheduler.add(()=>{u(g,x)},s):u(g,x),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=l((g,x)=>{m.result=[g,x];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,x)},s):w(g,x);setTimeout(()=>delete this.entries[t],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(g=>g!==u),m.callbacks.length||(m.cancel(),delete this.entries[t]))}}}function Ff(r,t,s){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},u=>{const m=P(r.request,(g,x,w,E)=>{g?u(g):x&&u(null,{vectorTile:s?void 0:new bl.VectorTile(new Lu(x)),rawData:x,cacheControl:w,expires:E})});return()=>{m.cancel(),u()}},t)}h.ARRAY_TYPE=hs,h.AUTH_ERR_MSG=Dt,h.Actor=class{constructor(r,t,s){this.target=r,this.parent=t,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Xn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ar()?r:at,this.scheduler=new km}send(r,t,s,l,u=!1,m){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=m,this.callbacks[g]=s);const x=Yn(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:r,hasCallback:!!s,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:zo(t,x)},x),{cancel:()=>{s&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(r){const t=r.data,s=t.id;if(s&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(t.mustQueue||Ar()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,t),l&&l.metadata||{type:"message"})}else this.processTask(s,t)}processTask(r,t){if("<response>"===t.type){const s=this.callbacks[r];delete this.callbacks[r],s&&(t.error?s(qa(t.error)):s(null,qa(t.data)))}else{const s=Yn(this.globalScope)?void 0:[],l=t.hasCallback?(m,g)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:m?zo(m):null,data:zo(g,s)},s)}:m=>{},u=qa(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,u,l);else if(this.parent.getWorkerSource){const m=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,m[0],u.source)[m[1]](u,l)}else l(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.CanonicalTileID=ap,h.Color=$t,h.ColorMode=Vo,h.CullFaceMode=Bs,h.DEMData=Xh,h.DataConstantProperty=te,h.DedupedRequest=Qh,h.DepthMode=Pl,h.EXTENT=Jt,h.Elevation=class{getAtPointOrZero(r,t=0){return this.getAtPoint(r,t)||0}getAtPoint(r,t,s=!0){null==t&&(t=null);const l=this._source();if(!l||r.y<0||r.y>1)return t;const u=l.getSource().maxzoom,m=1<<u,g=Math.floor(r.x),x=r.x-g,w=new br(u,g,u,Math.floor(x*m),Math.floor(r.y*m)),E=this.findDEMTileFor(w);if(!E||!E.dem)return t;const I=E.dem,z=1<<E.tileID.canonical.z,R=(x*z-E.tileID.canonical.x)*I.dim,B=(r.y*z-E.tileID.canonical.y)*I.dim,j=Math.floor(R),X=Math.floor(B);return(s?this.exaggeration():1)*Nt(Nt(I.get(j,X),I.get(j,X+1),B-X),Nt(I.get(j+1,X),I.get(j+1,X+1),B-X),R-j)}getAtTileOffset(r,t,s){const l=1<<r.canonical.z;return this.getAtPointOrZero(new eu(r.wrap+(r.canonical.x+t/Jt)/l,(r.canonical.y+s/Jt)/l))}getForTilePoints(r,t,s,l){const u=tu.create(this,r,l);return!!u&&(t.forEach(m=>{m[2]=this.exaggeration()*u.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(r){const t=this.findDEMTileFor(r);if(!t||!t.dem)return null;const s=t.dem.tree,l=t.tileID,u=1<<r.canonical.z-l.canonical.z;let m=r.canonical.x/u-l.canonical.x,g=r.canonical.y/u-l.canonical.y,x=0;for(let w=0;w<r.canonical.z-l.canonical.z&&!s.leaves[x];w++){m*=2,g*=2;const E=2*Math.floor(g)+Math.floor(m);x=s.childOffsets[x]+E,m%=1,g%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},h.ErrorEvent=Te,h.EvaluationParameters=q,h.Event=Ge,h.Evented=it,h.GlyphManager=Kc,h.ImagePosition=Bu,h.LineAtlas=jh,h.LngLat=On,h.LngLatBounds=Ja,h.LocalGlyphMode=$d,h.MAX_SAFE_INTEGER=ii,h.MercatorCoordinate=eu,h.ONE_EM=24,h.OverscaledTileID=br,h.Properties=se,h.RGBAImage=hr,h.RequestManager=class{constructor(r,t,s){this._transformRequestFn=r,this._customAccessToken=t,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const r=function(){let t="";for(let s=0;s<10;s++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yn,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,t){return this._transformRequestFn&&this._transformRequestFn(r,t)||{url:r}}normalizeStyleURL(r,t){if(!rn(r))return r;const s=un(r);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||t)}normalizeGlyphsURL(r,t){if(!rn(r))return r;const s=un(r);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||t)}normalizeSourceURL(r,t){if(!rn(r))return r;const s=un(r);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||t)}normalizeSpriteURL(r,t,s,l){const u=un(r);return rn(r)?(u.path=`/styles/v1${u.path}/sprite${t}${s}`,this._makeAPIURL(u,this._customAccessToken||l)):(u.path+=`${t}${s}`,Vr(u))}normalizeTileURL(r,t,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!rn(r))return r;const l=un(r);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||s&&"raster"!==l.authority&&512===s?"@2x":""}${Yi.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${Et.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${Et.TILE_URL_VERSION}${l.path}`);const u=this._customAccessToken||function(m){for(const g of m){const x=g.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||Et.ACCESS_TOKEN;return Et.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,u)}canonicalizeTileURL(r,t){const s=un(r);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return r;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${Et.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${Et.TILE_URL_VERSION}/`,"")}`;let u=s.params;return t&&(u=u.filter(m=>!m.match(/^access_token=/))),u.length&&(l+=`?${u.join("&")}`),l}canonicalizeTileset(r,t){const s=!!t&&rn(t),l=[];for(const u of r.tiles||[])Mr(u)?l.push(this.canonicalizeTileURL(u,s)):l.push(u);return l}_makeAPIURL(r,t){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=un(Et.API_URL);if(r.protocol=l.protocol,r.authority=l.authority,"http"===r.protocol){const u=r.params.indexOf("secure");u>=0&&r.params.splice(u,1)}if("/"!==l.path&&(r.path=`${l.path}${r.path}`),!Et.REQUIRE_ACCESS_TOKEN)return Vr(r);if(t=t||Et.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return r.params=r.params.filter(u=>-1===u.indexOf("access_token")),r.params.push(`access_token=${t||""}`),Vr(r)}},h.ResourceType=ss,h.SegmentVector=en,h.SourceCache=Qr,h.StencilMode=Dl,h.StructArrayLayout1ui2=Pi,h.StructArrayLayout2f1f2i16=Ls,h.StructArrayLayout2i4=ft,h.StructArrayLayout2ui4=us,h.StructArrayLayout3f12=cr,h.StructArrayLayout3ui6=An,h.StructArrayLayout4i8=Kt,h.Texture=Oh,h.Tile=kf,h.Transitionable=Q,h.Uniform1f=oh,h.Uniform1i=class extends no{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},h.Uniform2f=class extends no{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},h.Uniform3f=class extends no{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},h.Uniform4f=Dp,h.UniformColor=Di,h.UniformMatrix3f=class extends no{constructor(r,t){super(r,t),this.current=lh}set(r){for(let t=0;t<9;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},h.UniformMatrix4f=class extends no{constructor(r,t){super(r,t),this.current=ah}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},h.UnwrappedTileID=Af,h.ValidationError=be,h.VectorTileWorkerSource=class extends it{constructor(r,t,s,l,u){super(),this.actor=r,this.layerIndex=t,this.availableImages=s,this.loadVectorData=u||Ff,this.loading={},this.loaded={},this.deduped=new Qh(r.scheduler),this.isSpriteLoaded=l,this.scheduler=r.scheduler}loadTile(r,t){const s=r.uid,l=r&&r.request,u=l&&l.collectResourceTiming,m=this.loading[s]=new mp(r);m.abort=this.loadVectorData(r,(g,x)=>{const w=!this.loading[s];if(delete this.loading[s],w||g||!x)return m.status="done",w||(this.loaded[s]=m),t(g);const E=x.rawData,I={};x.expires&&(I.expires=x.expires),x.cacheControl&&(I.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new bl.VectorTile(new Lu(E));const z=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(R,B)=>{if(R||!B)return t(R);const j={};if(u){const X=op(l);X.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(X)))}t(null,Tt({rawTileData:E.slice(0)},B,I,j))})};this.isSpriteLoaded?z():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(z,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):z()}),this.loaded=this.loaded||{},this.loaded[s]=m})}reloadTile(r,t){const s=this.loaded,l=r.uid,u=this;if(s&&s[l]){const m=s[l];m.showCollisionBoxes=r.showCollisionBoxes,m.enableTerrain=!!r.enableTerrain;const g=(x,w)=>{const E=m.reloadCallback;E&&(delete m.reloadCallback,m.parse(m.vectorTile,u.layerIndex,this.availableImages,u.actor,E)),t(x,w)};"parsing"===m.status?m.reloadCallback=g:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(r,t){const s=r.uid,l=this.loading[s];l&&(l.abort&&l.abort(),delete this.loading[s]),t()}removeTile(r,t){const s=this.loaded,l=r.uid;s&&s[l]&&delete s[l],t()}},h.WritingMode=Yr,h.ZoomHistory=dt,h.add=function(r,t,s){return r[0]=t[0]+s[0],r[1]=t[1]+s[1],r[2]=t[2]+s[2],r},h.addDynamicAttributes=Lh,h.altitudeFromMercatorZ=Gh,h.asyncAll=Sr,h.bezier=pr,h.bindAll=Xn,h.bufferConvexPolygon=function(r,t){const s=[];for(let l=0;l<r.length;l++){const u=gn(l-1,-1,r.length-1),m=gn(l+1,-1,r.length-1),g=r[l],x=r[m],w=r[u].sub(g).unit(),E=x.sub(g).unit(),I=E.angleWithSep(w.x,w.y),z=w.add(E).unit().mult(-1*t/Math.sin(I/2));s.push(g.add(z))}return s},h.cacheEntryPossiblyAdded=function(r){Si++,Si>Qi&&(r.getActor().send("enforceCacheSizeLimit",Fi),Si=0)},h.clamp=dn,h.clearTileCache=function(r){const t=at.caches.delete(qr);r&&t.catch(r).then(()=>r())},h.clipLine=jd,h.clone=function(r){var t=new hs(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},h.clone$1=function(r){var t=new hs(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},h.clone$2=qt,h.collisionCircleLayout=rf,h.config=Et,h.conjugate=function(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r},h.copy=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},h.create=Fc,h.create$1=function(){var r=new hs(16);return hs!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},h.create$2=Rc,h.createExpression=ea,h.createFilter=Po,h.createLayout=Xe,h.createStyleLayer=function(r){return"custom"===r.type?new ip(r):new rp[r.type](r)},h.cross=function(r,t,s){var l=t[0],u=t[1],m=t[2],g=s[0],x=s[1],w=s[2];return r[0]=u*w-m*x,r[1]=m*g-l*w,r[2]=l*x-u*g,r},h.degToRad=mi,h.div=function(r,t,s){return r[0]=t[0]/s[0],r[1]=t[1]/s[1],r[2]=t[2]/s[2],r},h.dot=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]},h.dot$1=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},h.ease=Me,h.easeCubicInOut=kn,h.emitValidationErrors=ih,h.endsWith=Qe,h.enforceCacheSizeLimit=function(r){Gr(),si&&si.then(t=>{t.keys().then(s=>{for(let l=0;l<s.length-r;l++)t.delete(s[l])})})},h.evaluateSizeForFeature=Uo,h.evaluateSizeForZoom=Ya,h.evaluateVariableOffset=xf,h.evented=k,h.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]},h.exactEquals$1=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]},h.exported=ri,h.exported$1=Yi,h.extend=Tt,h.filterObject=ut,h.fromMat4=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r},h.fromQuat=function(r,t){var s=t[0],l=t[1],u=t[2],m=t[3],g=s+s,x=l+l,w=u+u,E=s*g,I=l*g,z=l*x,R=u*g,B=u*x,j=u*w,X=m*g,ie=m*x,he=m*w;return r[0]=1-z-j,r[1]=I+he,r[2]=R-ie,r[3]=0,r[4]=I-he,r[5]=1-E-j,r[6]=B+X,r[7]=0,r[8]=R+ie,r[9]=B-X,r[10]=1-E-z,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},h.fromRotation=function(r,t){var s=Math.sin(t),l=Math.cos(t);return r[0]=l,r[1]=s,r[2]=0,r[3]=-s,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},h.fromScaling=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},h.furthestTileCorner=function(r){const t=Math.round((r+45+360)%360/90)%4;return Ur[t]},h.getAABBPointSquareDist=function(r,t,s){let l=0;for(let u=0;u<2;++u){const m=s?s[u]:0;r[u]>m&&(l+=(r[u]-m)*(r[u]-m)),t[u]<m&&(l+=(m-t[u])*(m-t[u]))}return l},h.getAnchorAlignment=Zc,h.getAnchorJustification=Kd,h.getBounds=function(r){let t=1/0,s=1/0,l=-1/0,u=-1/0;for(const m of r)t=Math.min(t,m.x),s=Math.min(s,m.y),l=Math.max(l,m.x),u=Math.max(u,m.y);return{min:new Be(t,s),max:new Be(l,u)}},h.getImage=oe,h.getJSON=function(r,t){return H(Tt(r,{type:"json"}),t)},h.getMapSessionAPI=mr,h.getPerformanceMeasurement=op,h.getRTLTextPluginStatus=L,h.getReferrer=Dr,h.getVideo=function(r,t){const s=at.document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let l=0;l<r.length;l++){const u=at.document.createElement("source");G(r[l])||(s.crossOrigin="Anonymous"),u.src=r[l],s.appendChild(u)}return{cancel:()=>{}}},h.identity=hh,h.identity$1=Vp,h.invert=function(r,t){var s=t[0],l=t[1],u=t[2],m=t[3],g=t[4],x=t[5],w=t[6],E=t[7],I=t[8],z=t[9],R=t[10],B=t[11],j=t[12],X=t[13],ie=t[14],he=t[15],ye=s*x-l*g,_e=s*w-u*g,ve=s*E-m*g,we=l*w-u*x,xe=l*E-m*x,Oe=u*E-m*w,qe=I*X-z*j,Fe=I*ie-R*j,He=I*he-B*j,ze=z*ie-R*X,Re=z*he-B*X,Ke=R*he-B*ie,Pe=ye*Ke-_e*Re+ve*ze+we*He-xe*Fe+Oe*qe;return Pe?(r[0]=(x*Ke-w*Re+E*ze)*(Pe=1/Pe),r[1]=(u*Re-l*Ke-m*ze)*Pe,r[2]=(X*Oe-ie*xe+he*we)*Pe,r[3]=(R*xe-z*Oe-B*we)*Pe,r[4]=(w*He-g*Ke-E*Fe)*Pe,r[5]=(s*Ke-u*He+m*Fe)*Pe,r[6]=(ie*ve-j*Oe-he*_e)*Pe,r[7]=(I*Oe-R*ve+B*_e)*Pe,r[8]=(g*Re-x*He+E*qe)*Pe,r[9]=(l*He-s*Re-m*qe)*Pe,r[10]=(j*xe-X*ve+he*ye)*Pe,r[11]=(z*ve-I*xe-B*ye)*Pe,r[12]=(x*Fe-g*ze-w*qe)*Pe,r[13]=(s*ze-l*Fe+u*qe)*Pe,r[14]=(X*_e-j*we-ie*ye)*Pe,r[15]=(I*we-z*_e+R*ye)*Pe,r):null},h.isMapAuthenticated=function(r){return Bn.has(r)},h.isMapboxURL=rn,h.latFromMercatorY=qh,h.len=am,h.length=md,h.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},h.loadVectorTile=Ff,h.makeRequest=H,h.mercatorXfromLng=Tf,h.mercatorYfromLat=Vh,h.mercatorZfromAltitude=ju,h.mul=function(r,t,s){return r[0]=t[0]*s[0],r[1]=t[1]*s[1],r[2]=t[2]*s[2],r[3]=t[3]*s[3],r},h.mul$1=ur,h.mul$2=om,h.multiply=Np,h.multiply$1=dh,h.nextPowerOfTwo=Mt,h.normalize=Bc,h.normalize$1=function(r,t){var s=t[0],l=t[1],u=t[2],m=t[3],g=s*s+l*l+u*u+m*m;return g>0&&(g=1/Math.sqrt(g)),r[0]=s*g,r[1]=l*g,r[2]=u*g,r[3]=m*g,r},h.number=Nt,h.ortho=function(r,t,s,l,u,m,g){var x=1/(t-s),w=1/(l-u),E=1/(m-g);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*w,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*E,r[11]=0,r[12]=(t+s)*x,r[13]=(u+l)*w,r[14]=(g+m)*E,r[15]=1,r},h.pbf=Lu,h.perspective=function(r,t,s,l,u){var m,g=1/Math.tan(t/2);return r[0]=g/s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=u&&u!==1/0?(r[10]=(u+l)*(m=1/(l-u)),r[14]=2*u*l*m):(r[10]=-1,r[14]=-2*l),r},h.pick=function(r,t){const s={};for(let l=0;l<t.length;l++){const u=t[l];u in r&&(s[u]=r[u])}return s},h.plugin=U,h.pointGeometry=Be,h.polygonIntersectsBox=dd,h.polygonIntersectsPolygon=ch,h.polygonizeBounds=function(r,t,s=0,l=!0){const u=new Be(s,s),m=r.sub(u),g=t.add(u),x=[m,new Be(g.x,m.y),g,new Be(m.x,g.y)];return l&&x.push(m),x},h.posAttributes=lp,h.postMapLoadEvent=Gs,h.postTurnstileEvent=ho,h.potpack=Bd,h.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},h.radToDeg=function(r){return r*Er},h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.registerForPluginStateChange=function(r){return r({pluginStatus:y,pluginURL:_}),k.on("pluginStateChange",r),r},h.removeAuthState=function(r){Bn.delete(r)},h.renderColorRamp=bd,h.rotateX=function(r,t,s){var l=Math.sin(s),u=Math.cos(s),m=t[4],g=t[5],x=t[6],w=t[7],E=t[8],I=t[9],z=t[10],R=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*u+E*l,r[5]=g*u+I*l,r[6]=x*u+z*l,r[7]=w*u+R*l,r[8]=E*u-m*l,r[9]=I*u-g*l,r[10]=z*u-x*l,r[11]=R*u-w*l,r},h.rotateX$1=_d,h.rotateY=function(r,t,s){var l=Math.sin(s),u=Math.cos(s),m=t[0],g=t[1],x=t[2],w=t[3],E=t[8],I=t[9],z=t[10],R=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*u-E*l,r[1]=g*u-I*l,r[2]=x*u-z*l,r[3]=w*u-R*l,r[8]=m*l+E*u,r[9]=g*l+I*u,r[10]=x*l+z*u,r[11]=w*l+R*u,r},h.rotateZ=function(r,t,s){var l=Math.sin(s),u=Math.cos(s),m=t[0],g=t[1],x=t[2],w=t[3],E=t[4],I=t[5],z=t[6],R=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*u+E*l,r[1]=g*u+I*l,r[2]=x*u+z*l,r[3]=w*u+R*l,r[4]=E*u-m*l,r[5]=I*u-g*l,r[6]=z*u-x*l,r[7]=R*u-w*l,r},h.rotateZ$1=function(r,t,s){s*=.5;var l=t[0],u=t[1],m=t[2],g=t[3],x=Math.sin(s),w=Math.cos(s);return r[0]=l*w+u*x,r[1]=u*w-l*x,r[2]=m*w+g*x,r[3]=g*w-m*x,r},h.scale=function(r,t,s){return r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r},h.scale$1=function(r,t,s){var l=s[0],u=s[1],m=s[2];return r[0]=t[0]*l,r[1]=t[1]*l,r[2]=t[2]*l,r[3]=t[3]*l,r[4]=t[4]*u,r[5]=t[5]*u,r[6]=t[6]*u,r[7]=t[7]*u,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},h.scale$2=function(r,t,s){return r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r[3]=t[3]*s,r},h.scaleAndAdd=gd,h.setCacheLimits=function(r,t){Fi=r,Qi=t},h.setRTLTextPlugin=function(r,t,s=!1){if(y===d||y===n||y===c)throw new Error("setRTLTextPlugin cannot be called multiple times.");_=ri.resolveURL(r),y=d,f=t,S(),s||O()},h.smoothstep=function(r,t,s){return(s=dn((s-r)/(t-r),0,1))*s*(3-2*s)},h.spec=pe,h.storeAuthState=function(r,t){t?Bn.add(r):Bn.delete(r)},h.sub=Up,h.subtract=Bo,h.symbolSize=xm,h.transformMat3=function(r,t,s){var l=t[0],u=t[1],m=t[2];return r[0]=l*s[0]+u*s[3]+m*s[6],r[1]=l*s[1]+u*s[4]+m*s[7],r[2]=l*s[2]+u*s[5]+m*s[8],r},h.transformMat4=xl,h.transformMat4$1=function(r,t,s){var l=t[0],u=t[1],m=t[2],g=s[3]*l+s[7]*u+s[11]*m+s[15];return r[0]=(s[0]*l+s[4]*u+s[8]*m+s[12])/(g=g||1),r[1]=(s[1]*l+s[5]*u+s[9]*m+s[13])/g,r[2]=(s[2]*l+s[6]*u+s[10]*m+s[14])/g,r},h.transformQuat=yd,h.translate=function(r,t,s){var l,u,m,g,x,w,E,I,z,R,B,j,X=s[0],ie=s[1],he=s[2];return t===r?(r[12]=t[0]*X+t[4]*ie+t[8]*he+t[12],r[13]=t[1]*X+t[5]*ie+t[9]*he+t[13],r[14]=t[2]*X+t[6]*ie+t[10]*he+t[14],r[15]=t[3]*X+t[7]*ie+t[11]*he+t[15]):(u=t[1],m=t[2],g=t[3],x=t[4],w=t[5],E=t[6],I=t[7],z=t[8],R=t[9],B=t[10],j=t[11],r[0]=l=t[0],r[1]=u,r[2]=m,r[3]=g,r[4]=x,r[5]=w,r[6]=E,r[7]=I,r[8]=z,r[9]=R,r[10]=B,r[11]=j,r[12]=l*X+x*ie+z*he+t[12],r[13]=u*X+w*ie+R*he+t[13],r[14]=m*X+E*ie+B*he+t[14],r[15]=g*X+I*ie+j*he+t[15]),r},h.triggerPluginCompletionEvent=b,h.uniqueId=Ir,h.validateCustomStyleLayer=function(r){const t=[],s=r.id;return void 0===s&&t.push({message:`layers.${s}: missing required property "id"`}),void 0===r.render&&t.push({message:`layers.${s}: missing required method "render"`}),r.renderingMode&&"2d"!==r.renderingMode&&"3d"!==r.renderingMode&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},h.validateFog=hu,h.validateLight=Ac,h.validateStyle=ia,h.values=nn,h.vectorTile=bl,h.version="2.4.1",h.warnOnce=Qt,h.window=at,h.wrap=gn}),ts(0,function(h){function Ee(H){const P=typeof H;if("number"===P||"boolean"===P||"string"===P||null==H)return JSON.stringify(H);if(Array.isArray(H)){let G="[";for(const Z of H)G+=`${Ee(Z)},`;return`${G}]`}const D=Object.keys(H).sort();let F="{";for(let G=0;G<D.length;G++)F+=`${JSON.stringify(D[G])}:${Ee(H[D[G]])},`;return`${F}}`}function Dn(H){let P="";for(const D of h.refProperties)P+=`/${Ee(H[D])}`;return P}class Ki{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,D){for(const G of P){this._layerConfigs[G.id]=G;const Z=this._layers[G.id]=h.createStyleLayer(G);Z._featureFilter=h.createFilter(Z.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of D)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const F=function(G,Z){const de={};for(let oe=0;oe<G.length;oe++){const ge=Z&&Z[G[oe].id]||Dn(G[oe]);Z&&(Z[G[oe].id]=ge);let Ie=de[ge];Ie||(Ie=de[ge]=[]),Ie.push(G[oe])}const fe=[];for(const oe in de)fe.push(de[oe]);return fe}(h.values(this._layerConfigs),this.keyCache);for(const G of F){const Z=G.map(Ge=>this._layers[Ge.id]),de=Z[0];if("none"===de.visibility)continue;const fe=de.source||"";let oe=this.familiesBySource[fe];oe||(oe=this.familiesBySource[fe]={});const ge=de.sourceLayer||"_geojsonTileLayer";let Ie=oe[ge];Ie||(Ie=oe[ge]=[]),Ie.push(Z)}}}const{ImageBitmap:Be}=h.window;class ae{loadTile(P,D){const{uid:F,encoding:G,rawImageData:Z,padding:de,buildQuadTree:fe}=P,oe=Be&&Z instanceof Be?this.getImageData(Z,de):Z;D(null,new h.DEMData(F,oe,G,de<1,fe))}getImageData(P,D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const F=this.offscreenCanvasContext.getImageData(-D,-D,P.width+2*D,P.height+2*D);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new h.RGBAImage({width:F.width,height:F.height},F.data)}}var at=function H(P,D){var F,G=P&&P.type;if("FeatureCollection"===G)for(F=0;F<P.features.length;F++)H(P.features[F],D);else if("GeometryCollection"===G)for(F=0;F<P.geometries.length;F++)H(P.geometries[F],D);else if("Feature"===G)H(P.geometry,D);else if("Polygon"===G)ii(P.coordinates,D);else if("MultiPolygon"===G)for(F=0;F<P.coordinates.length;F++)ii(P.coordinates[F],D);return P};function ii(H,P){if(0!==H.length){_s(H[0],P);for(var D=1;D<H.length;D++)_s(H[D],!P)}}function _s(H,P){for(var D=0,F=0,G=H.length,Z=G-1;F<G;Z=F++)D+=(H[F][0]-H[Z][0])*(H[Z][1]+H[F][1]);D>=0!=!!P&&H.reverse()}const Er=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class mi{constructor(P){this._feature=P,this.extent=h.EXTENT,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(1===this._feature.type){const P=[];for(const D of this._feature.geometry)P.push([new h.pointGeometry(D[0],D[1])]);return P}{const P=[];for(const D of this._feature.geometry){const F=[];for(const G of D)F.push(new h.pointGeometry(G[0],G[1]));P.push(F)}return P}}toGeoJSON(P,D,F){return Er.call(this,P,D,F)}}class Ur{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=P.length,this._features=P}feature(P){return new mi(this._features[P])}}var kn=h.vectorTile.VectorTileFeature,pr=Me;function Me(H,P){this.options=P||{},this.features=H,this.length=H.length}function dn(H,P){this.id="number"==typeof H.id?H.id:void 0,this.type=H.type,this.rawGeometry=1===H.type?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=P||4096}Me.prototype.feature=function(H){return new dn(this.features[H],this.options.extent)},dn.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var P=0;P<H.length;P++){for(var D=H[P],F=[],G=0;G<D.length;G++)F.push(new h.pointGeometry(D[G][0],D[G][1]));this.geometry.push(F)}return this.geometry},dn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,P=1/0,D=-1/0,F=1/0,G=-1/0,Z=0;Z<H.length;Z++)for(var de=H[Z],fe=0;fe<de.length;fe++){var oe=de[fe];P=Math.min(P,oe.x),D=Math.max(D,oe.x),F=Math.min(F,oe.y),G=Math.max(G,oe.y)}return[P,F,D,G]},dn.prototype.toGeoJSON=kn.prototype.toGeoJSON;var gn=nn,Sr=pr;function nn(H){var P=new h.pbf;return function(D,F){for(var G in D.layers)F.writeMessage(3,Tt,D.layers[G])}(H,P),P.finish()}function Tt(H,P){var D;P.writeVarintField(15,H.version||1),P.writeStringField(1,H.name||""),P.writeVarintField(5,H.extent||4096);var F={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<H.length;D++)F.feature=H.feature(D),P.writeMessage(2,Xi,F);var G=F.keys;for(D=0;D<G.length;D++)P.writeStringField(3,G[D]);var Z=F.values;for(D=0;D<Z.length;D++)P.writeMessage(4,Xn,Z[D])}function Xi(H,P){var D=H.feature;void 0!==D.id&&P.writeVarintField(1,D.id),P.writeMessage(2,Ir,H),P.writeVarintField(3,D.type),P.writeMessage(4,qs,D)}function Ir(H,P){var D=H.feature,F=H.keys,G=H.values,Z=H.keycache,de=H.valuecache;for(var fe in D.properties){var oe=Z[fe];void 0===oe&&(F.push(fe),Z[fe]=oe=F.length-1),P.writeVarint(oe);var ge=D.properties[fe],Ie=typeof ge;"string"!==Ie&&"boolean"!==Ie&&"number"!==Ie&&(ge=JSON.stringify(ge));var Ge=Ie+":"+ge,Te=de[Ge];void 0===Te&&(G.push(ge),de[Ge]=Te=G.length-1),P.writeVarint(Te)}}function Kn(H,P){return(P<<3)+(7&H)}function Mt(H){return H<<1^H>>31}function qs(H,P){for(var D=H.loadGeometry(),F=H.type,G=0,Z=0,de=D.length,fe=0;fe<de;fe++){var oe=D[fe],ge=1;1===F&&(ge=oe.length),P.writeVarint(Kn(1,ge));for(var Ie=3===F?oe.length-1:oe.length,Ge=0;Ge<Ie;Ge++){1===Ge&&1!==F&&P.writeVarint(Kn(2,Ie-1));var Te=oe[Ge].x-G,it=oe[Ge].y-Z;P.writeVarint(Mt(Te)),P.writeVarint(Mt(it)),G+=Te,Z+=it}3===F&&P.writeVarint(Kn(7,1))}}function Xn(H,P){var D=typeof H;"string"===D?P.writeStringField(1,H):"boolean"===D?P.writeBooleanField(7,H):"number"===D&&(H%1!=0?P.writeDoubleField(3,H):H<0?P.writeSVarintField(6,H):P.writeVarintField(5,H))}function Qe(H,P,D,F,G,Z){if(G-F<=D)return;const de=F+G>>1;bi(H,P,de,F,G,Z%2),Qe(H,P,D,F,de-1,Z+1),Qe(H,P,D,de+1,G,Z+1)}function bi(H,P,D,F,G,Z){for(;G>F;){if(G-F>600){const ge=G-F+1,Ie=D-F+1,Ge=Math.log(ge),Te=.5*Math.exp(2*Ge/3),it=.5*Math.sqrt(Ge*Te*(ge-Te)/ge)*(Ie-ge/2<0?-1:1);bi(H,P,D,Math.max(F,Math.floor(D-Ie*Te/ge+it)),Math.min(G,Math.floor(D+(ge-Ie)*Te/ge+it)),Z)}const de=P[2*D+Z];let fe=F,oe=G;for(ut(H,P,F,D),P[2*G+Z]>de&&ut(H,P,F,G);fe<oe;){for(ut(H,P,fe,oe),fe++,oe--;P[2*fe+Z]<de;)fe++;for(;P[2*oe+Z]>de;)oe--}P[2*F+Z]===de?ut(H,P,F,oe):(oe++,ut(H,P,oe,G)),oe<=D&&(F=oe+1),D<=oe&&(G=oe-1)}}function ut(H,P,D,F){qt(H,D,F),qt(P,2*D,2*F),qt(P,2*D+1,2*F+1)}function qt(H,P,D){const F=H[P];H[P]=H[D],H[D]=F}function Ti(H,P,D,F){const G=H-D,Z=P-F;return G*G+Z*Z}gn.fromVectorTileJs=nn,gn.fromGeojsonVt=function(H,P){P=P||{};var D={};for(var F in H)D[F]=new pr(H[F].features,P),D[F].name=F,D[F].version=P.version,D[F].extent=P.extent;return nn({layers:D})},gn.GeoJSONWrapper=Sr;const Qt=H=>H[0],ir=H=>H[1];class fr{constructor(P,D=Qt,F=ir,G=64,Z=Float64Array){this.nodeSize=G,this.points=P;const de=P.length<65536?Uint16Array:Uint32Array,fe=this.ids=new de(P.length),oe=this.coords=new Z(2*P.length);for(let ge=0;ge<P.length;ge++)fe[ge]=ge,oe[2*ge]=D(P[ge]),oe[2*ge+1]=F(P[ge]);Qe(fe,oe,G,0,fe.length-1,0)}range(P,D,F,G){return function(Z,de,fe,oe,ge,Ie,Ge){const Te=[0,Z.length-1,0],it=[];let pe,be;for(;Te.length;){const mt=Te.pop(),Ct=Te.pop(),vt=Te.pop();if(Ct-vt<=Ge){for(let sn=vt;sn<=Ct;sn++)pe=de[2*sn],be=de[2*sn+1],pe>=fe&&pe<=ge&&be>=oe&&be<=Ie&&it.push(Z[sn]);continue}const Yt=Math.floor((vt+Ct)/2);pe=de[2*Yt],be=de[2*Yt+1],pe>=fe&&pe<=ge&&be>=oe&&be<=Ie&&it.push(Z[Yt]);const Ot=(mt+1)%2;(0===mt?fe<=pe:oe<=be)&&(Te.push(vt),Te.push(Yt-1),Te.push(Ot)),(0===mt?ge>=pe:Ie>=be)&&(Te.push(Yt+1),Te.push(Ct),Te.push(Ot))}return it}(this.ids,this.coords,P,D,F,G,this.nodeSize)}within(P,D,F){return function(G,Z,de,fe,oe,ge){const Ie=[0,G.length-1,0],Ge=[],Te=oe*oe;for(;Ie.length;){const it=Ie.pop(),pe=Ie.pop(),be=Ie.pop();if(pe-be<=ge){for(let Ot=be;Ot<=pe;Ot++)Ti(Z[2*Ot],Z[2*Ot+1],de,fe)<=Te&&Ge.push(G[Ot]);continue}const mt=Math.floor((be+pe)/2),Ct=Z[2*mt],vt=Z[2*mt+1];Ti(Ct,vt,de,fe)<=Te&&Ge.push(G[mt]);const Yt=(it+1)%2;(0===it?de-oe<=Ct:fe-oe<=vt)&&(Ie.push(be),Ie.push(mt-1),Ie.push(Yt)),(0===it?de+oe>=Ct:fe+oe>=vt)&&(Ie.push(mt+1),Ie.push(pe),Ie.push(Yt))}return Ge}(this.ids,this.coords,P,D,F,this.nodeSize)}}const Ar={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:H=>H},ns=Math.fround||(Cr=new Float32Array(1),H=>(Cr[0]=+H,Cr[0]));var Cr;class pt{constructor(P){this.options=Yi(Object.create(Ar),P),this.trees=new Array(this.options.maxZoom+1)}load(P){const{log:D,minZoom:F,maxZoom:G,nodeSize:Z}=this.options;D&&console.time("total time");const de=`prepare ${P.length} points`;D&&console.time(de),this.points=P;let fe=[];for(let oe=0;oe<P.length;oe++)P[oe].geometry&&fe.push(zn(P[oe],oe));this.trees[G+1]=new fr(fe,rr,zi,Z,Float32Array),D&&console.timeEnd(de);for(let oe=G;oe>=F;oe--){const ge=+Date.now();fe=this._cluster(fe,oe),this.trees[oe]=new fr(fe,rr,zi,Z,Float32Array),D&&console.log("z%d: %d clusters in %dms",oe,fe.length,+Date.now()-ge)}return D&&console.timeEnd("total time"),this}getClusters(P,D){let F=((P[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,P[1]));let Z=180===P[2]?180:((P[2]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)F=-180,Z=180;else if(F>Z){const Ie=this.getClusters([F,G,180,de],D),Ge=this.getClusters([-180,G,Z,de],D);return Ie.concat(Ge)}const fe=this.trees[this._limitZoom(D)],oe=fe.range(ri(F),kr(de),ri(Z),kr(G)),ge=[];for(const Ie of oe){const Ge=fe.points[Ie];ge.push(Ge.numPoints?Yn(Ge):this.points[Ge.index])}return ge}getChildren(P){const D=this._getOriginId(P),F=this._getOriginZoom(P),G="No cluster with the specified id.",Z=this.trees[F];if(!Z)throw new Error(G);const de=Z.points[D];if(!de)throw new Error(G);const fe=this.options.radius/(this.options.extent*Math.pow(2,F-1)),oe=Z.within(de.x,de.y,fe),ge=[];for(const Ie of oe){const Ge=Z.points[Ie];Ge.parentId===P&&ge.push(Ge.numPoints?Yn(Ge):this.points[Ge.index])}if(0===ge.length)throw new Error(G);return ge}getLeaves(P,D,F){const G=[];return this._appendLeaves(G,P,D=D||10,F=F||0,0),G}getTile(P,D,F){const G=this.trees[this._limitZoom(P)],Z=Math.pow(2,P),{extent:de,radius:fe}=this.options,oe=fe/de,ge=(F-oe)/Z,Ie=(F+1+oe)/Z,Ge={features:[]};return this._addTileFeatures(G.range((D-oe)/Z,ge,(D+1+oe)/Z,Ie),G.points,D,F,Z,Ge),0===D&&this._addTileFeatures(G.range(1-oe/Z,ge,1,Ie),G.points,Z,F,Z,Ge),D===Z-1&&this._addTileFeatures(G.range(0,ge,oe/Z,Ie),G.points,-1,F,Z,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(P){let D=this._getOriginZoom(P)-1;for(;D<=this.options.maxZoom;){const F=this.getChildren(P);if(D++,1!==F.length)break;P=F[0].properties.cluster_id}return D}_appendLeaves(P,D,F,G,Z){const de=this.getChildren(D);for(const fe of de){const oe=fe.properties;if(oe&&oe.cluster?Z+oe.point_count<=G?Z+=oe.point_count:Z=this._appendLeaves(P,oe.cluster_id,F,G,Z):Z<G?Z++:P.push(fe),P.length===F)break}return Z}_addTileFeatures(P,D,F,G,Z,de){for(const fe of P){const oe=D[fe],ge=oe.numPoints;let Ie,Ge,Te;if(ge)Ie=Fn(oe),Ge=oe.x,Te=oe.y;else{const be=this.points[oe.index];Ie=be.properties,Ge=ri(be.geometry.coordinates[0]),Te=kr(be.geometry.coordinates[1])}const it={type:1,geometry:[[Math.round(this.options.extent*(Ge*Z-F)),Math.round(this.options.extent*(Te*Z-G))]],tags:Ie};let pe;ge?pe=oe.id:this.options.generateId?pe=oe.index:this.points[oe.index].id&&(pe=this.points[oe.index].id),void 0!==pe&&(it.id=pe),de.features.push(it)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(+P,this.options.maxZoom+1))}_cluster(P,D){const F=[],{radius:G,extent:Z,reduce:de,minPoints:fe}=this.options,oe=G/(Z*Math.pow(2,D));for(let ge=0;ge<P.length;ge++){const Ie=P[ge];if(Ie.zoom<=D)continue;Ie.zoom=D;const Ge=this.trees[D+1],Te=Ge.within(Ie.x,Ie.y,oe),it=Ie.numPoints||1;let pe=it;for(const be of Te){const mt=Ge.points[be];mt.zoom>D&&(pe+=mt.numPoints||1)}if(pe>=fe){let be=Ie.x*it,mt=Ie.y*it,Ct=de&&it>1?this._map(Ie,!0):null;const vt=(ge<<5)+(D+1)+this.points.length;for(const Yt of Te){const Ot=Ge.points[Yt];if(Ot.zoom<=D)continue;Ot.zoom=D;const sn=Ot.numPoints||1;be+=Ot.x*sn,mt+=Ot.y*sn,Ot.parentId=vt,de&&(Ct||(Ct=this._map(Ie,!0)),de(Ct,this._map(Ot)))}Ie.parentId=vt,F.push(gi(be/pe,mt/pe,vt,pe,Ct))}else if(F.push(Ie),pe>1)for(const be of Te){const mt=Ge.points[be];mt.zoom<=D||(mt.zoom=D,F.push(mt))}}return F}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,D){if(P.numPoints)return D?Yi({},P.properties):P.properties;const F=this.points[P.index].properties,G=this.options.map(F);return D&&G===F?Yi({},G):G}}function gi(H,P,D,F,G){return{x:ns(H),y:ns(P),zoom:1/0,id:D,parentId:-1,numPoints:F,properties:G}}function zn(H,P){const[D,F]=H.geometry.coordinates;return{x:ns(ri(D)),y:ns(kr(F)),zoom:1/0,index:P,parentId:-1}}function Yn(H){return{type:"Feature",id:H.id,properties:Fn(H),geometry:{type:"Point",coordinates:[(P=H.x,360*(P-.5)),Et(H.y)]}};var P}function Fn(H){const P=H.numPoints,D=P>=1e4?`${Math.round(P/1e3)}k`:P>=1e3?Math.round(P/100)/10+"k":P;return Yi(Yi({},H.properties),{cluster:!0,cluster_id:H.id,point_count:P,point_count_abbreviated:D})}function ri(H){return H/360+.5}function kr(H){const P=Math.sin(H*Math.PI/180),D=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return D<0?0:D>1?1:D}function Et(H){const P=(180-360*H)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function Yi(H,P){for(const D in P)H[D]=P[D];return H}function rr(H){return H.x}function zi(H){return H.y}function At(H,P,D,F){for(var G,Z=F,de=D-P>>1,fe=D-P,oe=H[P],ge=H[P+1],Ie=H[D],Ge=H[D+1],Te=P+3;Te<D;Te+=3){var it=Li(H[Te],H[Te+1],oe,ge,Ie,Ge);if(it>Z)G=Te,Z=it;else if(it===Z){var pe=Math.abs(Te-de);pe<fe&&(G=Te,fe=pe)}}Z>F&&(G-P>3&&At(H,P,G,F),H[G+2]=Z,D-G>3&&At(H,G,D,F))}function Li(H,P,D,F,G,Z){var de=G-D,fe=Z-F;if(0!==de||0!==fe){var oe=((H-D)*de+(P-F)*fe)/(de*de+fe*fe);oe>1?(D=G,F=Z):oe>0&&(D+=de*oe,F+=fe*oe)}return(de=H-D)*de+(fe=P-F)*fe}function Wt(H,P,D,F){var G={id:void 0===H?null:H,type:P,geometry:D,tags:F,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Z){var de=Z.geometry,fe=Z.type;if("Point"===fe||"MultiPoint"===fe||"LineString"===fe)yn(Z,de);else if("Polygon"===fe||"MultiLineString"===fe)for(var oe=0;oe<de.length;oe++)yn(Z,de[oe]);else if("MultiPolygon"===fe)for(oe=0;oe<de.length;oe++)for(var ge=0;ge<de[oe].length;ge++)yn(Z,de[oe][ge])}(G),G}function yn(H,P){for(var D=0;D<P.length;D+=3)H.minX=Math.min(H.minX,P[D]),H.minY=Math.min(H.minY,P[D+1]),H.maxX=Math.max(H.maxX,P[D]),H.maxY=Math.max(H.maxY,P[D+1])}function Dt(H,P,D,F){if(P.geometry){var G=P.geometry.coordinates,Z=P.geometry.type,de=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2),fe=[],oe=P.id;if(D.promoteId?oe=P.properties[D.promoteId]:D.generateId&&(oe=F||0),"Point"===Z)rn(G,fe);else if("MultiPoint"===Z)for(var ge=0;ge<G.length;ge++)rn(G[ge],fe);else if("LineString"===Z)Mr(G,fe,de,!1);else if("MultiLineString"===Z){if(D.lineMetrics){for(ge=0;ge<G.length;ge++)Mr(G[ge],fe=[],de,!1),H.push(Wt(oe,"LineString",fe,P.properties));return}sr(G,fe,de,!1)}else if("Polygon"===Z)sr(G,fe,de,!0);else{if("MultiPolygon"!==Z){if("GeometryCollection"===Z){for(ge=0;ge<P.geometry.geometries.length;ge++)Dt(H,{id:oe,geometry:P.geometry.geometries[ge],properties:P.properties},D,F);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<G.length;ge++){var Ie=[];sr(G[ge],Ie,de,!0),fe.push(Ie)}}H.push(Wt(oe,Z,fe,P.properties))}}function rn(H,P){P.push(un(H[0])),P.push(Vr(H[1])),P.push(0)}function Mr(H,P,D,F){for(var G,Z,de=0,fe=0;fe<H.length;fe++){var oe=un(H[fe][0]),ge=Vr(H[fe][1]);P.push(oe),P.push(ge),P.push(0),fe>0&&(de+=F?(G*ge-oe*Z)/2:Math.sqrt(Math.pow(oe-G,2)+Math.pow(ge-Z,2))),G=oe,Z=ge}var Ie=P.length-3;P[2]=1,At(P,0,Ie,D),P[Ie+2]=1,P.size=Math.abs(de),P.start=0,P.end=P.size}function sr(H,P,D,F){for(var G=0;G<H.length;G++){var Z=[];Mr(H[G],Z,D,F),P.push(Z)}}function un(H){return H/360+.5}function Vr(H){var P=Math.sin(H*Math.PI/180),D=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return D<0?0:D>1?1:D}function Ei(H,P,D,F,G,Z,de,fe){if(F/=P,Z>=(D/=P)&&de<F)return H;if(de<D||Z>=F)return null;for(var oe=[],ge=0;ge<H.length;ge++){var Ie=H[ge],Ge=Ie.geometry,Te=Ie.type,it=0===G?Ie.minX:Ie.minY,pe=0===G?Ie.maxX:Ie.maxY;if(it>=D&&pe<F)oe.push(Ie);else if(!(pe<D||it>=F)){var be=[];if("Point"===Te||"MultiPoint"===Te)is(Ge,be,D,F,G);else if("LineString"===Te)Ri(Ge,be,D,F,G,!1,fe.lineMetrics);else if("MultiLineString"===Te)or(Ge,be,D,F,G,!1);else if("Polygon"===Te)or(Ge,be,D,F,G,!0);else if("MultiPolygon"===Te)for(var mt=0;mt<Ge.length;mt++){var Ct=[];or(Ge[mt],Ct,D,F,G,!0),Ct.length&&be.push(Ct)}if(be.length){if(fe.lineMetrics&&"LineString"===Te){for(mt=0;mt<be.length;mt++)oe.push(Wt(Ie.id,Te,be[mt],Ie.tags));continue}"LineString"!==Te&&"MultiLineString"!==Te||(1===be.length?(Te="LineString",be=be[0]):Te="MultiLineString"),"Point"!==Te&&"MultiPoint"!==Te||(Te=3===be.length?"Point":"MultiPoint"),oe.push(Wt(Ie.id,Te,be,Ie.tags))}}}return oe.length?oe:null}function is(H,P,D,F,G){for(var Z=0;Z<H.length;Z+=3){var de=H[Z+G];de>=D&&de<=F&&(P.push(H[Z]),P.push(H[Z+1]),P.push(H[Z+2]))}}function Ri(H,P,D,F,G,Z,de){for(var fe,oe,ge=ho(H),Ie=0===G?js:mr,Ge=H.start,Te=0;Te<H.length-3;Te+=3){var it=H[Te],pe=H[Te+1],be=H[Te+2],mt=H[Te+3],Ct=H[Te+4],vt=0===G?it:pe,Yt=0===G?mt:Ct,Ot=!1;de&&(fe=Math.sqrt(Math.pow(it-mt,2)+Math.pow(pe-Ct,2))),vt<D?Yt>D&&(oe=Ie(ge,it,pe,mt,Ct,D),de&&(ge.start=Ge+fe*oe)):vt>F?Yt<F&&(oe=Ie(ge,it,pe,mt,Ct,F),de&&(ge.start=Ge+fe*oe)):Gs(ge,it,pe,be),Yt<D&&vt>=D&&(oe=Ie(ge,it,pe,mt,Ct,D),Ot=!0),Yt>F&&vt<=F&&(oe=Ie(ge,it,pe,mt,Ct,F),Ot=!0),!Z&&Ot&&(de&&(ge.end=Ge+fe*oe),P.push(ge),ge=ho(H)),de&&(Ge+=fe)}var sn=H.length-3;it=H[sn],pe=H[sn+1],be=H[sn+2],(vt=0===G?it:pe)>=D&&vt<=F&&Gs(ge,it,pe,be),sn=ge.length-3,Z&&sn>=3&&(ge[sn]!==ge[0]||ge[sn+1]!==ge[1])&&Gs(ge,ge[0],ge[1],ge[2]),ge.length&&P.push(ge)}function ho(H){var P=[];return P.size=H.size,P.start=H.start,P.end=H.end,P}function or(H,P,D,F,G,Z){for(var de=0;de<H.length;de++)Ri(H[de],P,D,F,G,Z,!1)}function Gs(H,P,D,F){H.push(P),H.push(D),H.push(F)}function js(H,P,D,F,G,Z){var de=(Z-P)/(F-P);return H.push(Z),H.push(D+(G-D)*de),H.push(1),de}function mr(H,P,D,F,G,Z){var de=(Z-D)/(G-D);return H.push(P+(F-P)*de),H.push(Z),H.push(1),de}function Bn(H,P){for(var D=[],F=0;F<H.length;F++){var G,Z=H[F],de=Z.type;if("Point"===de||"MultiPoint"===de||"LineString"===de)G=qr(Z.geometry,P);else if("MultiLineString"===de||"Polygon"===de){G=[];for(var fe=0;fe<Z.geometry.length;fe++)G.push(qr(Z.geometry[fe],P))}else if("MultiPolygon"===de)for(G=[],fe=0;fe<Z.geometry.length;fe++){for(var oe=[],ge=0;ge<Z.geometry[fe].length;ge++)oe.push(qr(Z.geometry[fe][ge],P));G.push(oe)}D.push(Wt(Z.id,de,G,Z.tags))}return D}function qr(H,P){var D=[];D.size=H.size,void 0!==H.start&&(D.start=H.start,D.end=H.end);for(var F=0;F<H.length;F+=3)D.push(H[F]+P,H[F+1],H[F+2]);return D}function si(H,P){if(H.transformed)return H;var D,F,G,Z=1<<H.z,de=H.x,fe=H.y;for(D=0;D<H.features.length;D++){var oe=H.features[D],ge=oe.geometry,Ie=oe.type;if(oe.geometry=[],1===Ie)for(F=0;F<ge.length;F+=2)oe.geometry.push(Pr(ge[F],ge[F+1],P,Z,de,fe));else for(F=0;F<ge.length;F++){var Ge=[];for(G=0;G<ge[F].length;G+=2)Ge.push(Pr(ge[F][G],ge[F][G+1],P,Z,de,fe));oe.geometry.push(Ge)}}return H.transformed=!0,H}function Pr(H,P,D,F,G,Z){return[Math.round(D*(H*F-G)),Math.round(D*(P*F-Z))]}function Fi(H,P,D,F,G){for(var Z=P===G.maxZoom?0:G.tolerance/((1<<P)*G.extent),de={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:D,y:F,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<H.length;fe++){de.numFeatures++,Qi(de,H[fe],Z,G);var oe=H[fe].minX,ge=H[fe].minY,Ie=H[fe].maxX,Ge=H[fe].maxY;oe<de.minX&&(de.minX=oe),ge<de.minY&&(de.minY=ge),Ie>de.maxX&&(de.maxX=Ie),Ge>de.maxY&&(de.maxY=Ge)}return de}function Qi(H,P,D,F){var G=P.geometry,Z=P.type,de=[];if("Point"===Z||"MultiPoint"===Z)for(var fe=0;fe<G.length;fe+=3)de.push(G[fe]),de.push(G[fe+1]),H.numPoints++,H.numSimplified++;else if("LineString"===Z)Gr(de,G,H,D,!1,!1);else if("MultiLineString"===Z||"Polygon"===Z)for(fe=0;fe<G.length;fe++)Gr(de,G[fe],H,D,"Polygon"===Z,0===fe);else if("MultiPolygon"===Z)for(var oe=0;oe<G.length;oe++){var ge=G[oe];for(fe=0;fe<ge.length;fe++)Gr(de,ge[fe],H,D,!0,0===fe)}if(de.length){var Ie=P.tags||null;if("LineString"===Z&&F.lineMetrics){for(var Ge in Ie={},P.tags)Ie[Ge]=P.tags[Ge];Ie.mapbox_clip_start=G.start/G.size,Ie.mapbox_clip_end=G.end/G.size}var Te={geometry:de,type:"Polygon"===Z||"MultiPolygon"===Z?3:"LineString"===Z||"MultiLineString"===Z?2:1,tags:Ie};null!==P.id&&(Te.id=P.id),H.features.push(Te)}}function Gr(H,P,D,F,G,Z){var de=F*F;if(F>0&&P.size<(G?de:F))D.numPoints+=P.length/3;else{for(var fe=[],oe=0;oe<P.length;oe+=3)(0===F||P[oe+2]>de)&&(D.numSimplified++,fe.push(P[oe]),fe.push(P[oe+1])),D.numPoints++;G&&function(ge,Ie){for(var Ge=0,Te=0,it=ge.length,pe=it-2;Te<it;pe=Te,Te+=2)Ge+=(ge[Te]-ge[pe])*(ge[Te+1]+ge[pe+1]);if(Ge>0===Ie)for(Te=0,it=ge.length;Te<it/2;Te+=2){var be=ge[Te],mt=ge[Te+1];ge[Te]=ge[it-2-Te],ge[Te+1]=ge[it-1-Te],ge[it-2-Te]=be,ge[it-1-Te]=mt}}(fe,Z),H.push(fe)}}function rs(H,P){var D=(P=this.options=function(G,Z){for(var de in Z)G[de]=Z[de];return G}(Object.create(this.options),P)).debug;if(D&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var G,Z,de,fe,oe,ge,F=function(G,Z){var de=[];if("FeatureCollection"===G.type)for(var fe=0;fe<G.features.length;fe++)Dt(de,G.features[fe],Z,fe);else Dt(de,"Feature"===G.type?G:{geometry:G},Z);return de}(H,P);this.tiles={},this.tileCoords=[],D&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(G=F,Z=P,de=Z.buffer/Z.extent,fe=G,oe=Ei(G,1,-1-de,de,0,-1,2,Z),ge=Ei(G,1,1-de,2+de,0,-1,2,Z),(oe||ge)&&(fe=Ei(G,1,-de,1+de,0,-1,2,Z)||[],oe&&(fe=Bn(oe,1).concat(fe)),ge&&(fe=fe.concat(Bn(ge,-1)))),F=fe).length&&this.splitTile(F,0,0,0),D&&(F.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Si(H,P,D){return 32*((1<<H)*D+P)+H}function ss(H,P){const D=H.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const F=this._geoJSONIndex.getTile(D.z,D.x,D.y);if(!F)return P(null,null);const G=new Ur(F.features);let Z=gn(G);0===Z.byteOffset&&Z.byteLength===Z.buffer.byteLength||(Z=new Uint8Array(Z)),P(null,{vectorTile:G,rawData:Z.buffer})}rs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rs.prototype.splitTile=function(H,P,D,F,G,Z,de){for(var fe=[H,P,D,F],oe=this.options,ge=oe.debug;fe.length;){F=fe.pop(),D=fe.pop(),P=fe.pop(),H=fe.pop();var Ie=1<<P,Ge=Si(P,D,F),Te=this.tiles[Ge];if(!Te&&(ge>1&&console.time("creation"),Te=this.tiles[Ge]=Fi(H,P,D,F,oe),this.tileCoords.push({z:P,x:D,y:F}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,D,F,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));var it="z"+P;this.stats[it]=(this.stats[it]||0)+1,this.total++}if(Te.source=H,G){if(P===oe.maxZoom||P===G)continue;var pe=1<<G-P;if(D!==Math.floor(Z/pe)||F!==Math.floor(de/pe))continue}else if(P===oe.indexMaxZoom||Te.numPoints<=oe.indexMaxPoints)continue;if(Te.source=null,0!==H.length){ge>1&&console.time("clipping");var be,mt,Ct,vt,Yt,Ot,sn=.5*oe.buffer/oe.extent,zr=.5-sn,je=.5+sn,lt=1+sn;be=mt=Ct=vt=null,Yt=Ei(H,Ie,D-sn,D+je,0,Te.minX,Te.maxX,oe),Ot=Ei(H,Ie,D+zr,D+lt,0,Te.minX,Te.maxX,oe),H=null,Yt&&(be=Ei(Yt,Ie,F-sn,F+je,1,Te.minY,Te.maxY,oe),mt=Ei(Yt,Ie,F+zr,F+lt,1,Te.minY,Te.maxY,oe),Yt=null),Ot&&(Ct=Ei(Ot,Ie,F-sn,F+je,1,Te.minY,Te.maxY,oe),vt=Ei(Ot,Ie,F+zr,F+lt,1,Te.minY,Te.maxY,oe),Ot=null),ge>1&&console.timeEnd("clipping"),fe.push(be||[],P+1,2*D,2*F),fe.push(mt||[],P+1,2*D,2*F+1),fe.push(Ct||[],P+1,2*D+1,2*F),fe.push(vt||[],P+1,2*D+1,2*F+1)}}},rs.prototype.getTile=function(H,P,D){var F=this.options,G=F.extent,Z=F.debug;if(H<0||H>24)return null;var de=1<<H,fe=Si(H,P=(P%de+de)%de,D);if(this.tiles[fe])return si(this.tiles[fe],G);Z>1&&console.log("drilling down to z%d-%d-%d",H,P,D);for(var oe,ge=H,Ie=P,Ge=D;!oe&&ge>0;)ge--,Ie=Math.floor(Ie/2),Ge=Math.floor(Ge/2),oe=this.tiles[Si(ge,Ie,Ge)];return oe&&oe.source?(Z>1&&console.log("found parent tile z%d-%d-%d",ge,Ie,Ge),Z>1&&console.time("drilling down"),this.splitTile(oe.source,ge,Ie,Ge,H,P,D),Z>1&&console.timeEnd("drilling down"),this.tiles[fe]?si(this.tiles[fe],G):null):null};class $s extends h.VectorTileWorkerSource{constructor(P,D,F,G,Z){super(P,D,F,G,ss),Z&&(this.loadGeoJSON=Z)}loadData(P,D){const F=P&&P.request,G=F&&F.collectResourceTiming;this.loadGeoJSON(P,(Z,de)=>{if(Z||!de)return D(Z);if("object"!=typeof de)return D(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));{at(de,!0);try{if(P.filter){const oe=h.createExpression(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===oe.result)throw new Error(oe.value.map(Ie=>`${Ie.key}: ${Ie.message}`).join(", "));const ge=de.features.filter(Ie=>oe.value.evaluate({zoom:0},Ie));de={type:"FeatureCollection",features:ge}}this._geoJSONIndex=P.cluster?new pt(function({superclusterOptions:oe,clusterProperties:ge}){if(!ge||!oe)return oe;const Ie={},Ge={},Te={accumulated:null,zoom:0},it={properties:null},pe=Object.keys(ge);for(const be of pe){const[mt,Ct]=ge[be],vt=h.createExpression(Ct),Yt=h.createExpression("string"==typeof mt?[mt,["accumulated"],["get",be]]:mt);Ie[be]=vt.value,Ge[be]=Yt.value}return oe.map=be=>{it.properties=be;const mt={};for(const Ct of pe)mt[Ct]=Ie[Ct].evaluate(Te,it);return mt},oe.reduce=(be,mt)=>{it.properties=mt;for(const Ct of pe)Te.accumulated=be[Ct],be[Ct]=Ge[Ct].evaluate(Te,it)},oe}(P)).load(de.features):new rs(oe=de,P.geojsonVtOptions)}catch(oe){return D(oe)}this.loaded={};const fe={};if(G){const oe=h.getPerformanceMeasurement(F);oe&&(fe.resourceTiming={},fe.resourceTiming[P.source]=JSON.parse(JSON.stringify(oe)))}D(null,fe)}var oe})}reloadTile(P,D){const F=this.loaded;return F&&F[P.uid]?super.reloadTile(P,D):this.loadTile(P,D)}loadGeoJSON(P,D){if(P.request)h.getJSON(P.request,D);else{if("string"!=typeof P.data)return D(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));try{return D(null,JSON.parse(P.data))}catch(F){return D(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(P,D){try{D(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch(F){D(F)}}getClusterChildren(P,D){try{D(null,this._geoJSONIndex.getChildren(P.clusterId))}catch(F){D(F)}}getClusterLeaves(P,D){try{D(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch(F){D(F)}}}class Dr{constructor(P){this.self=P,this.actor=new h.Actor(P,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:h.VectorTileWorkerSource,geojson:$s},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(D,F)=>{if(this.workerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.workerSourceTypes[D]=F},this.self.registerRTLTextPlugin=D=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=D.applyArabicShaping,h.plugin.processBidirectionalText=D.processBidirectionalText,h.plugin.processStyledBidirectionalText=D.processStyledBidirectionalText}}checkIfReady(P,D,F){F()}setReferrer(P,D){this.referrer=D}spriteLoaded(P,D){this.isSpriteLoaded=D;for(const F in this.workerSources[P]){const G=this.workerSources[P][F];for(const Z in G)G[Z]instanceof h.VectorTileWorkerSource&&(G[Z].isSpriteLoaded=D,G[Z].fire(new h.Event("isSpriteLoaded")))}}setImages(P,D,F){this.availableImages[P]=D;for(const G in this.workerSources[P]){const Z=this.workerSources[P][G];for(const de in Z)Z[de].availableImages=D}F()}enableTerrain(P,D,F){this.terrain=D,F()}setLayers(P,D,F){this.getLayerIndex(P).replace(D),F()}updateLayers(P,D,F){this.getLayerIndex(P).update(D.layers,D.removedIds),F()}loadTile(P,D,F){const G=this.enableTerrain?h.extend({enableTerrain:this.terrain},D):D;this.getWorkerSource(P,D.type,D.source).loadTile(G,F)}loadDEMTile(P,D,F){const G=this.enableTerrain?h.extend({buildQuadTree:this.terrain},D):D;this.getDEMWorkerSource(P,D.source).loadTile(G,F)}reloadTile(P,D,F){const G=this.enableTerrain?h.extend({enableTerrain:this.terrain},D):D;this.getWorkerSource(P,D.type,D.source).reloadTile(G,F)}abortTile(P,D,F){this.getWorkerSource(P,D.type,D.source).abortTile(D,F)}removeTile(P,D,F){this.getWorkerSource(P,D.type,D.source).removeTile(D,F)}removeSource(P,D,F){if(!this.workerSources[P]||!this.workerSources[P][D.type]||!this.workerSources[P][D.type][D.source])return;const G=this.workerSources[P][D.type][D.source];delete this.workerSources[P][D.type][D.source],void 0!==G.removeSource?G.removeSource(D,F):F()}loadWorkerSource(P,D,F){try{this.self.importScripts(D.url),F()}catch(G){F(G.toString())}}syncRTLPluginState(P,D,F){try{h.plugin.setState(D);const G=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&null!=G){this.self.importScripts(G);const Z=h.plugin.isParsed();F(Z?void 0:new Error(`RTL Text Plugin failed to import scripts from ${G}`),Z)}}catch(G){F(G.toString())}}getAvailableImages(P){let D=this.availableImages[P];return D||(D=[]),D}getLayerIndex(P){let D=this.layerIndexes[P];return D||(D=this.layerIndexes[P]=new Ki),D}getWorkerSource(P,D,F){return this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][D]||(this.workerSources[P][D]={}),this.workerSources[P][D][F]||(this.workerSources[P][D][F]=new this.workerSourceTypes[D]({send:(G,Z,de,fe,oe,ge)=>{this.actor.send(G,Z,de,P,oe,ge)},scheduler:this.actor.scheduler},this.getLayerIndex(P),this.getAvailableImages(P),this.isSpriteLoaded)),this.workerSources[P][D][F]}getDEMWorkerSource(P,D){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][D]||(this.demWorkerSources[P][D]=new ae),this.demWorkerSources[P][D]}enforceCacheSizeLimit(P,D){h.enforceCacheSizeLimit(D)}getWorkerPerformanceMetrics(P,D,F){F(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Dr(self)),Dr}),ts(0,function(h){var Ee=Dn;function Dn(d){return n=d,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,y,_=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(_);try{y=new Worker(b),f=!0}catch(S){f=!1}return y&&y.terminate(),URL.revokeObjectURL(b),f}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var f=document.createElement("canvas");f.width=f.height=1;var y=f.getContext("2d");if(!y)return!1;var _=y.getImageData(0,0,1,1);return _&&_.width===f.width}()||(void 0===Ki[c=n&&n.failIfMajorPerformanceCaveat]&&(Ki[c]=function(f){var y,b,S,k,_=(b=f,S=document.createElement("canvas"),(k=Object.create(Dn.webGLContextAttributes)).failIfMajorPerformanceCaveat=b,S.getContext("webgl",k)||S.getContext("experimental-webgl",k));if(!_)return!1;try{y=_.createShader(_.VERTEX_SHADER)}catch(b){return!1}return!(!y||_.isContextLost())&&(_.shaderSource(y,"void main() {}"),_.compileShader(y),!0===_.getShaderParameter(y,_.COMPILE_STATUS))}(c)),!Ki[c]||document.documentMode));var n,c}var Ki={};function Be(d,n){if(Array.isArray(d)){if(!Array.isArray(n)||d.length!==n.length)return!1;for(let c=0;c<d.length;c++)if(!Be(d[c],n[c]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==n){if("object"!=typeof n||Object.keys(d).length!==Object.keys(n).length)return!1;for(const c in d)if(!Be(d[c],n[c]))return!1;return!0}return d===n}Dn.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ae={create:function(d,n,c){const f=h.window.document.createElement(d);return void 0!==n&&(f.className=n),c&&c.appendChild(f),f},createNS:function(d,n){return h.window.document.createElementNS(d,n)}},at=h.window.document&&h.window.document.documentElement.style,ii=at&&void 0!==at.userSelect?"userSelect":"WebkitUserSelect";let _s;ae.disableDrag=function(){at&&ii&&(_s=at[ii],at[ii]="none")},ae.enableDrag=function(){at&&ii&&(at[ii]=_s)},ae.setTransform=function(d,n){d.style.transform=n};let Er=!1;try{const d=Object.defineProperty({},"passive",{get(){Er=!0}});h.window.addEventListener("test",d,d),h.window.removeEventListener("test",d,d)}catch(d){Er=!1}ae.addEventListener=function(d,n,c,f={}){d.addEventListener(n,c,"passive"in f&&Er?f:f.capture)},ae.removeEventListener=function(d,n,c,f={}){d.removeEventListener(n,c,"passive"in f&&Er?f:f.capture)};const mi=function(d){d.preventDefault(),d.stopPropagation(),h.window.removeEventListener("click",mi,!0)};function Ur(d,n,c){const f=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new h.pointGeometry((c.clientX-n.left)*f,(c.clientY-n.top)*f)}ae.suppressClick=function(){h.window.addEventListener("click",mi,!0),h.window.setTimeout(()=>{h.window.removeEventListener("click",mi,!0)},0)},ae.mousePos=function(d,n){const c=d.getBoundingClientRect();return Ur(d,c,n)},ae.touchPos=function(d,n){const c=d.getBoundingClientRect(),f=[];for(let y=0;y<n.length;y++)f.push(Ur(d,c,n[y]));return f},ae.mouseButton=function(d){return void 0!==h.window.InstallTrigger&&2===d.button&&d.ctrlKey&&h.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button},ae.remove=function(d){d.parentNode&&d.parentNode.removeChild(d)};class kn{constructor(n,c){this.pos=n,this.dir=c}intersectsPlane(n,c,f){const y=h.dot(c,this.dir);if(Math.abs(y)<1e-6)return!1;const _=h.dot(h.sub(h.create(),n,this.pos),c)/y,b=h.scaleAndAdd(h.create(),this.pos,this.dir,_);return h.copy(f,b),!0}}class pr{constructor(n,c){this.points=n,this.planes=c}static fromInvProjectionMatrix(n,c,f){const y=Math.pow(2,f),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const k=h.transformMat4([],S,n),L=1/k[3]/c*y;return h.mul(k,k,[L,L,1/k[3],L])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const k=h.sub([],_[S[0]],_[S[1]]),L=h.sub([],_[S[2]],_[S[1]]),O=h.normalize([],h.cross([],k,L)),U=-h.dot(O,_[S[1]]);return O.concat(U)});return new pr(_,b)}}class Me{constructor(n,c){this.min=n,this.max=c,this.center=h.scale([],h.add([],this.min,this.max),.5)}quadrant(n){const c=[n%2==0,n<2],f=h.clone(this.min),y=h.clone(this.max);for(let _=0;_<c.length;_++)f[_]=c[_]?this.min[_]:this.center[_],y[_]=c[_]?this.center[_]:this.max[_];return y[2]=this.max[2],new Me(f,y)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}intersects(n){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let y=0;y<n.planes.length;y++){const _=n.planes[y];let b=0;for(let S=0;S<c.length;S++)b+=h.dot$1(_,c[S])>=0;if(0===b)return 0;b!==c.length&&(f=!1)}if(f)return 2;for(let y=0;y<3;y++){let _=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let S=0;S<n.points.length;S++){const k=n.points[S][y]-this.min[y];_=Math.min(_,k),b=Math.max(b,k)}if(b<0||_>this.max[y]-this.min[y])return 0}return 1}}function dn(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class gn extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,f);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new h.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,c){if(!n)return!0;let f=0;for(const y of n){if(y[0]<f||y[1]<y[0]||c<y[1])return!1;f=y[1]}return!0}_validateContent(n,c){return!(n&&(4!==n.length||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let f=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(f=!1);this.isLoaded()||f?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const f={};for(const y of n){this.images[y]||this.fire(new h.Event("styleimagemissing",{id:y}));const _=this.images[y];_?f[y]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:h.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,f)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],f=this.getImage(n);if(!f)return null;if(c&&c.position.version===f.version)return c.position;if(c)c.position.version=f.version;else{const y={w:f.data.width+2,h:f.data.height+2,x:0,y:0},_=new h.ImagePosition(y,f);this.patterns[n]={bin:y,position:_}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const _ in this.patterns)n.push(this.patterns[_].bin);const{w:c,h:f}=h.potpack(n),y=this.atlasImage;y.resize({width:c||1,height:f||1});for(const _ in this.patterns){const{bin:b}=this.patterns[_],S=b.x+1,k=b.y+1,L=this.images[_].data,O=L.width,U=L.height;h.RGBAImage.copy(L,y,{x:0,y:0},{x:S,y:k},{width:O,height:U}),h.RGBAImage.copy(L,y,{x:0,y:U-1},{x:S,y:k-1},{width:O,height:1}),h.RGBAImage.copy(L,y,{x:0,y:0},{x:S,y:k+U},{width:O,height:1}),h.RGBAImage.copy(L,y,{x:O-1,y:0},{x:S-1,y:k},{width:1,height:U}),h.RGBAImage.copy(L,y,{x:0,y:0},{x:S+O,y:k},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const f=this.images[c];dn(f)&&this.updateImage(c,f)}}}const Sr=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(d,n){return function([c,f,y]){const _=h.degToRad(f+90),b=h.degToRad(y);return{x:c*Math.cos(_)*Math.sin(b),y:c*Math.sin(_)*Math.sin(b),z:c*Math.cos(b),azimuthal:f,polar:y}}(d.expression.evaluate(n))}interpolate(d,n,c){return{x:h.number(d.x,n.x,c),y:h.number(d.y,n.y,c),z:h.number(d.z,n.z,c),azimuthal:h.number(d.azimuthal,n.azimuthal,c),polar:h.number(d.polar,n.polar,c)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),nn="-transition";class Tt extends h.Evented{constructor(n){super(),this._transitionable=new h.Transitionable(Sr),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(h.validateLight,n,c))for(const f in n){const y=n[f];h.endsWith(f,nn)?this._transitionable.setTransition(f.slice(0,-nn.length),y):this._transitionable.setValue(f,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,f){return(!f||!1!==f.validate)&&h.emitValidationErrors(this,n.call(h.validateStyle,h.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}const Xi=new h.Properties({source:new h.DataConstantProperty(h.spec.terrain.source),exaggeration:new h.DataConstantProperty(h.spec.terrain.exaggeration)}),Ir="-transition";class Kn extends h.Evented{constructor(n){super(),this._transitionable=new h.Transitionable(Xi),this.set(n),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(n){for(const c in n){const f=n[c];h.endsWith(c,Ir)?this._transitionable.setTransition(c.slice(0,-Ir.length),f):this._transitionable.setValue(c,f)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function Mt(d,n,c,f){const y=h.smoothstep(45,65,c),[_,b]=qs(d,f),S=h.length(n);let k=1-Math.min(1,Math.exp((S-_)/(b-_)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*y*d.alpha}function qs(d,n){const c=.5/Math.tan(.5*n);return[d.range[0]+c,d.range[1]+c]}const Xn=new h.Properties({range:new h.DataConstantProperty(h.spec.fog.range),color:new h.DataConstantProperty(h.spec.fog.color),"horizon-blend":new h.DataConstantProperty(h.spec.fog["horizon-blend"])}),Qe="-transition";class bi extends h.Evented{constructor(n){super(),this._transitionable=new h.Transitionable(Xn),this.set(n),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(h.validateFog,n,c))for(const f in n){const y=n[f];h.endsWith(f,Qe)?this._transitionable.setTransition(f.slice(0,-Qe.length),y):this._transitionable.setValue(f,y)}}getOpacity(n){const c=this.properties&&this.properties.get("color")||1;return h.smoothstep(45,65,n)*c.a}getOpacityAtLatLng(n,c){return function(f,y,_){const b=h.MercatorCoordinate.fromLngLat(y),S=_.elevation?_.elevation.getAtPointOrZero(b):0,k=[b.x,b.y,S];return h.transformMat4$1(k,k,_.mercatorFogMatrix),Mt(f,k,_.pitch,_._fov)}(this.state,n,c)}getFovAdjustedRange(n){return qs(this.state,n)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,f){return(!f||!1!==f.validate)&&h.emitValidationErrors(this,n.call(h.validateStyle,h.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class ut{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const f=this.workerPool.acquire(this.id);for(let y=0;y<f.length;y++){const _=new ut.Actor(f[y],c,this.id);_.name=`Worker ${y}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,f){h.asyncAll(this.actors,(y,_)=>{y.send(n,c,_)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qt(d,n,c){return n*(h.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}ut.Actor=h.Actor;class Ti{constructor(n,c,f,y){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(_=>y.pointCoordinate3D(_)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(n,c){let f,y;if(n instanceof h.pointGeometry||"number"==typeof n[0]){const _=h.pointGeometry.convert(n);f=[h.pointGeometry.convert(n)],y=c.isPointAboveHorizon(_)}else{const _=h.pointGeometry.convert(n[0]),b=h.pointGeometry.convert(n[1]);f=[_,b],y=h.polygonizeBounds(_,b).every(S=>c.isPointAboveHorizon(S))}return new Ti(f,c.getCameraPoint(),y,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return h.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],f=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],y=h.polygonizeBounds(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),h.bufferConvexPolygon(y,n)}containsTile(n,c,f){const y=n.queryPadding+1,_=f?this._bufferedCameraMercator(y,c).map($=>n.tileID.getTilePoint($)):this._bufferedScreenMercator(y,c).map($=>n.tileID.getTilePoint($)),b=this.screenGeometryMercator.map($=>n.tileID.getTileVec3($)),S=b.map($=>new h.pointGeometry($[0],$[1])),k=c.getFreeCameraOptions().position||new h.MercatorCoordinate(0,0,0),L=n.tileID.getTileVec3(k),O=b.map($=>{const Y=h.sub($,$,L);return h.normalize(Y,Y),new kn(L,Y)}),U=qt(n,1,c.zoom);if(h.polygonIntersectsBox(_,0,0,h.EXTENT,h.EXTENT))return{queryGeometry:this,tilespaceGeometry:S,tilespaceRays:O,bufferedTilespaceGeometry:_,bufferedTilespaceBounds:(q=h.getBounds(_),q.min.x=h.clamp(q.min.x,0,h.EXTENT),q.min.y=h.clamp(q.min.y,0,h.EXTENT),q.max.x=h.clamp(q.max.x,0,h.EXTENT),q.max.y=h.clamp(q.max.y,0,h.EXTENT),q),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:U};var q}_bufferedScreenMercator(n,c){const f=Qt(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{const y=this.bufferedScreenGeometry(n).map(_=>c.pointCoordinate3D(_));return this._screenRaycastCache[f]=y,y}}_bufferedCameraMercator(n,c){const f=Qt(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{const y=this.bufferedCameraGeometry(n).map(_=>c.pointCoordinate3D(_));return this._cameraRaycastCache[f]=y,y}}}function Qt(d){return 100*d|0}function ir(d,n,c){const f=function(y,_){if(y)return c(y);if(_){const b=h.pick(h.extend(_,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(b.vectorLayers=_.vector_layers,b.vectorLayerIds=b.vectorLayers.map(S=>S.id)),b.tiles=n.canonicalizeTileset(b,d.url),c(null,b)}};return d.url?h.getJSON(n.transformRequest(n.normalizeSourceURL(d.url),h.ResourceType.Source),f):h.exported.frame(()=>f(null,d))}class fr{constructor(n,c,f){this.bounds=h.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),f=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*c),_=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*c),b=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=f&&n.x<_&&n.y>=y&&n.y<b}}class Ar{constructor(n,c,f){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ns={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Cr{constructor(n,c,f,y){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=n;const _=n.gl;this.buffer=_.createBuffer(),n.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let f=0;f<this.attributes.length;f++){const y=c.attributes[this.attributes[f].name];void 0!==y&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,c,f){for(let y=0;y<this.attributes.length;y++){const _=this.attributes[y],b=c.attributes[_.name];void 0!==b&&n.vertexAttribPointer(b,_.components,n[ns[_.type]],!1,this.itemSize,_.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gi extends pt{getDefault(){return h.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zn extends pt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Yn extends pt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Fn extends pt{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ri extends pt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class kr extends pt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Et extends pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Yi extends pt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class rr extends pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class zi extends pt{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class At extends pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class Li extends pt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Wt extends pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class yn extends pt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Dt extends pt{getDefault(){return h.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class rn extends pt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Mr extends pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class sr extends pt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class un extends pt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Vr extends pt{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class Ei extends pt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class is extends pt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ri extends pt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class ho extends pt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class or extends pt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Gs extends pt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class js extends pt{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class mr extends pt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Bn extends pt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class qr extends pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class si extends pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Pr extends pt{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Fi extends Pr{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Qi extends Pr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Gr extends Qi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class rs{constructor(n,c,f,y){this.context=n,this.width=c,this.height=f;const _=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Fi(n,_),y&&(this.depthAttachment=new Qi(n,_))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const f=this.depthAttachment.get();f&&n.deleteRenderbuffer(f)}n.deleteFramebuffer(this.framebuffer)}}class Si{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new gi(this),this.clearDepth=new zn(this),this.clearStencil=new Yn(this),this.colorMask=new Fn(this),this.depthMask=new ri(this),this.stencilMask=new kr(this),this.stencilFunc=new Et(this),this.stencilOp=new Yi(this),this.stencilTest=new rr(this),this.depthRange=new zi(this),this.depthTest=new At(this),this.depthFunc=new Li(this),this.blend=new Wt(this),this.blendFunc=new yn(this),this.blendColor=new Dt(this),this.blendEquation=new rn(this),this.cullFace=new Mr(this),this.cullFaceSide=new sr(this),this.frontFace=new un(this),this.program=new Vr(this),this.activeTexture=new Ei(this),this.viewport=new is(this),this.bindFramebuffer=new Ri(this),this.bindRenderbuffer=new ho(this),this.bindTexture=new or(this),this.bindVertexBuffer=new Gs(this),this.bindElementBuffer=new js(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new mr(this),this.pixelStoreUnpack=new Bn(this),this.pixelStoreUnpackPremultiplyAlpha=new qr(this),this.pixelStoreUnpackFlipY=new si(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new Ar(this,n,c)}createVertexBuffer(n,c,f){return new Cr(this,n,c,f)}createRenderbuffer(n,c,f){const y=this.gl,_=y.createRenderbuffer();return this.bindRenderbuffer.set(_),y.renderbufferStorage(y.RENDERBUFFER,n,c,f),this.bindRenderbuffer.set(null),_}createFramebuffer(n,c,f){return new rs(this,n,c,f)}clear({color:n,depth:c,stencil:f}){const y=this.gl;let _=0;n&&(_|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(_|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==f&&(_|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(_)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){Be(n.blendFunction,h.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ss extends h.Evented{constructor(n,c,f,y){super(),this.id=n,this.dispatcher=f,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},c),h.extend(this,h.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ir(this._options,this.map._requestManager,(n,c)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new h.ErrorEvent(n)):c&&(h.extend(this,c),c.bounds&&(this.tileBounds=new fr(c.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(c.tiles),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const f=h.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=h.getImage(this.map._requestManager.transformRequest(y,h.ResourceType.Tile),(_,b,S,k)=>{if(delete n.request,n.aborted)n.state="unloaded",c(null);else if(_)n.state="errored",c(_);else if(b){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:S,expires:k});const L=this.map.painter.context,O=L.gl;n.texture=this.map.painter.getTileTexture(b.width),n.texture?n.texture.update(b,{useMipmap:!0}):(n.texture=new h.Texture(L,b,O.RGBA,{useMipmap:!0}),n.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),L.extTextureFilterAnisotropic&&O.texParameterf(O.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax)),n.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}}let $s;var Dr=h.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class H extends h.Evented{constructor(n,c,f,y){super(),this.id=n,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(n,c){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(f,y)=>{this._loaded=!0,f?this.fire(new h.ErrorEvent(f)):y&&(this.image=h.exported.getImageData(y),n&&(this.coordinates=n),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n;const c=n.map(h.MercatorCoordinate.fromLngLat);this.tileID=function(y){let _=1/0,b=1/0,S=-1/0,k=-1/0;for(const q of y)_=Math.min(_,q.x),b=Math.min(b,q.y),S=Math.max(S,q.x),k=Math.max(k,q.y);const L=Math.max(S-_,k-b),O=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),U=Math.pow(2,O);return new h.CanonicalTileID(O,Math.floor((_+S)/2*U),Math.floor((b+k)/2*U))}(c),this.minzoom=this.maxzoom=this.tileID.z;const f=c.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new h.StructArrayLayout4i8,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,h.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,h.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,h.EXTENT,h.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,c=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Dr.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new h.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const f in this.tiles){const y=this.tiles[f];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const P={vector:class extends h.Evented{constructor(d,n,c,f){if(super(),this.id=d,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(n,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new h.DedupedRequest}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ir(this._options,this.map._requestManager,(d,n)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new h.ErrorEvent(d)):n&&(h.extend(this,n),n.bounds&&(this.tileBounds=new fr(n.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d();const n=this.map.style._getSourceCaches(this.id);for(const c of n)c.clearTiles();this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(d,n){const c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(c,h.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(f.request.collectResourceTiming=this._collectResourceTiming,d.actor&&"expired"!==d.state)"loading"===d.state?d.reloadCallback=n:d.request=d.actor.send("reloadTile",f,y.bind(this));else if(d.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",f,y.bind(this),void 0,!0);else{const _=h.loadVectorTile.call({deduped:this._deduped},f,(b,S)=>{b||!S?y.call(this,b):(f.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},d.actor&&d.actor.send("loadTile",f,y.bind(this),void 0,!0))},!0);d.request={cancel:_}}function y(_,b){return delete d.request,d.aborted?n(null):_&&404!==_.status?n(_):(b&&b.resourceTiming&&(d.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&d.setExpiryData(b),d.loadVectorData(b,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ss,"raster-dem":class extends ss{constructor(d,n,c,f){super(d,n,c,f),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(y,_){y&&(d.state="errored",n(y)),_&&(d.dem=_,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=h.getImage(this.map._requestManager.transformRequest(c,h.ResourceType.Tile),function(y,_,b,S){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(y)d.state="errored",n(y);else if(_){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:b,expires:S});const k=h.window.ImageBitmap&&_ instanceof h.window.ImageBitmap&&(null==$s&&($s=h.window.OffscreenCanvas&&new h.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof h.window.createImageBitmap),$s),L=1-(_.width-h.prevPowerOfTwo(_.width))/2;L<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const O=k?_:h.exported.getImageData(_,L),U={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:L};d.actor&&"expired"!==d.state||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",U,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const n=d.canonical,c=Math.pow(2,n.z),f=(n.x-1+c)%c,y=0===n.x?d.wrap-1:d.wrap,_=(n.x+1+c)%c,b=n.x+1===c?d.wrap+1:d.wrap,S={};return S[new h.OverscaledTileID(d.overscaledZ,y,n.z,f,n.y).key]={backfilled:!1},S[new h.OverscaledTileID(d.overscaledZ,b,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(S[new h.OverscaledTileID(d.overscaledZ,y,n.z,f,n.y-1).key]={backfilled:!1},S[new h.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new h.OverscaledTileID(d.overscaledZ,b,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<c&&(S[new h.OverscaledTileID(d.overscaledZ,y,n.z,f,n.y+1).key]={backfilled:!1},S[new h.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new h.OverscaledTileID(d.overscaledZ,b,n.z,_,n.y+1).key]={backfilled:!1}),S}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends h.Evented{constructor(d,n,c,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=n.data,this._options=h.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*y,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*y,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:h.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},n),this}getClusterLeaves(d,n,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:n,offset:c},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=h.extend({},this.workerOptions),n=this._data;"string"==typeof n?(d.request=this.map._requestManager.transformRequest(h.exported.resolveURL(n),h.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new h.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(y.resourceTiming=f.resourceTiming[this.id]),this.fire(new h.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,n){const c=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(c,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(f,y)=>(delete d.request,d.unloadVectorData(),d.aborted?n(null):f?n(f):(d.loadVectorData(y,this.map.painter,"reloadTile"===c),n(null))),void 0,"loadTile"===c)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends H{constructor(d,n,c,f){super(d,n,c,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,h.ResourceType.Source).url);h.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new h.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Dr.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new h.Texture(d,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const c in this.tiles){const f=this.tiles[c];"loaded"!==f.state&&(f.state="loaded",f.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:H,canvas:class extends H{constructor(d,n,c,f){super(d,n,c,f),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(_=>"number"!=typeof _))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof h.window.HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof h.window.HTMLCanvasElement?this.options.canvas:h.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,c=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Dr.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.Texture(n,this.canvas,c.RGBA,{premultiply:!0});for(const f in this.tiles){const y=this.tiles[f];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}}},D=function(d,n,c,f){const y=new P[n.type](d,n,c,f);if(y.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${y.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],y),y};function F(d,n){const c=h.identity([]);return h.scale$1(c,c,[.5*d.width,.5*-d.height,1]),h.translate(c,c,[1,-1,0]),h.multiply(c,c,d.calculateProjMatrix(n.toUnwrapped()))}function G(d,n,c,f,y,_,b,S=!1){const k=d.tilesIn(f,b,S);k.sort(de);const L=[];for(const U of k)L.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(n,c,d._state,U,y,_,F(d.transform,U.tile.tileID),S)});const O=function(U){const q={},$={};for(const Y of U){const Q=Y.queryResults,le=Y.wrappedTileID,W=$[le]=$[le]||{};for(const J in Q){const re=Q[J],ue=W[J]=W[J]||{},te=q[J]=q[J]||[];for(const ee of re)ue[ee.featureIndex]||(ue[ee.featureIndex]=!0,te.push(ee))}}return q}(L);for(const U in O)O[U].forEach(q=>{const $=q.feature,Y=d.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=Y});return O}function Z(d,n){const c=d.getRenderableIds().map(_=>d.getTileByID(_)),f=[],y={};for(let _=0;_<c.length;_++){const b=c[_],S=b.tileID.canonical.key;y[S]||(y[S]=!0,b.querySourceFeatures(f,n))}return f}function de(d,n){const c=d.tileID,f=n.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function fe(){return null!=yl.workerClass?new yl.workerClass:new h.window.Worker(yl.workerUrl)}const oe="mapboxgl_preloaded_worker_pool";class ge{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<ge.workerCount;)this.workers.push(new fe);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oe]}numActive(){return Object.keys(this.active).length}}let Ie;function Ge(){return Ie||(Ie=new ge),Ie}function Te(d,n){const c={};for(const f in d)"ref"!==f&&(c[f]=d[f]);return h.refProperties.forEach(f=>{f in n&&(c[f]=n[f])}),c}function it(d){d=d.slice();const n=Object.create(null);for(let c=0;c<d.length;c++)n[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=Te(d[c],n[d[c].ref]));return d}ge.workerCount=2;const pe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function be(d,n,c){c.push({command:pe.addSource,args:[d,n[d]]})}function mt(d,n,c){n.push({command:pe.removeSource,args:[d]}),c[d]=!0}function Ct(d,n,c,f){mt(d,c,f),be(d,n,c)}function vt(d,n,c){let f;for(f in d[c])if(d[c].hasOwnProperty(f)&&"data"!==f&&!Be(d[c][f],n[c][f]))return!1;for(f in n[c])if(n[c].hasOwnProperty(f)&&"data"!==f&&!Be(d[c][f],n[c][f]))return!1;return!0}function Yt(d,n,c,f,y,_){let b;for(b in n=n||{},d=d||{})d.hasOwnProperty(b)&&(Be(d[b],n[b])||c.push({command:_,args:[f,b,n[b],y]}));for(b in n)n.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(Be(d[b],n[b])||c.push({command:_,args:[f,b,n[b],y]}))}function Ot(d){return d.id}function sn(d,n){return d[n.id]=n,d}class zr{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=h.clamp(n,0,1);let c=1,f=this._distances[c];const y=n*this.paddedLength+this.padding;for(;f<y&&c<this._distances.length;)f=this._distances[++c];const _=c-1,b=this._distances[_],S=f-b,k=S>0?(y-b)/S:0;return this.points[_].mult(1-k).add(this.points[c].mult(k))}}class je{constructor(n,c,f){const y=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(c/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)y.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,f,y,_){this._forEachCell(c,f,y,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(_)}insertCircle(n,c,f,y){this._forEachCell(c-y,f-y,c+y,f+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(f),this.circles.push(y)}_insertBoxCell(n,c,f,y,_,b){this.boxCells[_].push(b)}_insertCircleCell(n,c,f,y,_,b){this.circleCells[_].push(b)}_query(n,c,f,y,_,b){if(f<0||n>this.width||y<0||c>this.height)return!_&&[];const S=[];if(n<=0&&c<=0&&this.width<=f&&this.height<=y){if(_)return!0;for(let k=0;k<this.boxKeys.length;k++)S.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],O=this.circles[3*k+1],U=this.circles[3*k+2];S.push({key:this.circleKeys[k],x1:L-U,y1:O-U,x2:L+U,y2:O+U})}return b?S.filter(b):S}return this._forEachCell(n,c,f,y,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},b),_?S.length>0:S}_queryCircle(n,c,f,y,_){const b=n-f,S=n+f,k=c-f,L=c+f;if(S<0||b>this.width||L<0||k>this.height)return!y&&[];const O=[];return this._forEachCell(b,k,S,L,this._queryCellCircle,O,{hitTest:y,circle:{x:n,y:c,radius:f},seenUids:{box:{},circle:{}}},_),y?O.length>0:O}query(n,c,f,y,_){return this._query(n,c,f,y,!1,_)}hitTest(n,c,f,y,_){return this._query(n,c,f,y,!0,_)}hitTestCircle(n,c,f,y){return this._queryCircle(n,c,f,!0,y)}_queryCell(n,c,f,y,_,b,S,k){const L=S.seenUids,O=this.boxCells[_];if(null!==O){const q=this.bboxes;for(const $ of O)if(!L.box[$]){L.box[$]=!0;const Y=4*$;if(n<=q[Y+2]&&c<=q[Y+3]&&f>=q[Y+0]&&y>=q[Y+1]&&(!k||k(this.boxKeys[$]))){if(S.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[$],x1:q[Y],y1:q[Y+1],x2:q[Y+2],y2:q[Y+3]})}}}const U=this.circleCells[_];if(null!==U){const q=this.circles;for(const $ of U)if(!L.circle[$]){L.circle[$]=!0;const Y=3*$;if(this._circleAndRectCollide(q[Y],q[Y+1],q[Y+2],n,c,f,y)&&(!k||k(this.circleKeys[$]))){if(S.hitTest)return b.push(!0),!0;{const Q=q[Y],le=q[Y+1],W=q[Y+2];b.push({key:this.circleKeys[$],x1:Q-W,y1:le-W,x2:Q+W,y2:le+W})}}}}}_queryCellCircle(n,c,f,y,_,b,S,k){const L=S.circle,O=S.seenUids,U=this.boxCells[_];if(null!==U){const $=this.bboxes;for(const Y of U)if(!O.box[Y]){O.box[Y]=!0;const Q=4*Y;if(this._circleAndRectCollide(L.x,L.y,L.radius,$[Q+0],$[Q+1],$[Q+2],$[Q+3])&&(!k||k(this.boxKeys[Y])))return b.push(!0),!0}}const q=this.circleCells[_];if(null!==q){const $=this.circles;for(const Y of q)if(!O.circle[Y]){O.circle[Y]=!0;const Q=3*Y;if(this._circlesCollide($[Q],$[Q+1],$[Q+2],L.x,L.y,L.radius)&&(!k||k(this.circleKeys[Y])))return b.push(!0),!0}}}_forEachCell(n,c,f,y,_,b,S,k){const L=this._convertToXCellCoord(n),O=this._convertToYCellCoord(c),U=this._convertToXCellCoord(f),q=this._convertToYCellCoord(y);for(let $=L;$<=U;$++)for(let Y=O;Y<=q;Y++)if(_.call(this,n,c,f,y,this.xCellCount*Y+$,b,S,k))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,f,y,_,b){const S=y-n,k=_-c,L=f+b;return L*L>S*S+k*k}_circleAndRectCollide(n,c,f,y,_,b,S){const k=(b-y)/2,L=Math.abs(n-(y+k));if(L>k+f)return!1;const O=(S-_)/2,U=Math.abs(c-(_+O));if(U>O+f)return!1;if(L<=k||U<=O)return!0;const q=L-k,$=U-O;return q*q+$*$<=f*f}}const lt=Math.tan(85*Math.PI/180);function St(d,n,c,f,y){const _=h.create$1();return n?(h.scale$1(_,_,[1/y,1/y,1]),c||h.rotateZ(_,_,f.angle)):h.multiply(_,f.labelPlaneMatrix,d),_}function gr(d,n,c,f,y){if(n){const _=h.clone$1(d);return h.scale$1(_,_,[y,y,1]),c||h.rotateZ(_,_,-f.angle),_}return f.glCoordMatrix}function Ii(d,n,c=0){const f=[d.x,d.y,c,1];c?h.transformMat4(f,f,n):po(f,f,n);const y=f[3];return{point:new h.pointGeometry(f[0]/y,f[1]/y),signedDistanceFromCamera:y}}function zt(d,n){return Math.min(.5+d/n*.5,1.5)}function xa(d,n){const c=d[0]/d[3],f=d[1]/d[3];return c>=-n[0]&&c<=n[0]&&f>=-n[1]&&f<=n[1]}function wa(d,n,c,f,y,_,b,S,k){const L=f?d.textSizeData:d.iconSizeData,O=h.evaluateSizeForZoom(L,c.transform.zoom),U=[256/c.width*2+1,256/c.height*2+1],q=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;q.clear();const $=d.lineVertexArray,Y=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,Q=c.transform.width/c.transform.height;let le=!1;for(let W=0;W<Y.length;W++){const J=Y.get(W);if(J.writingMode!==h.WritingMode.vertical||le||0!==W&&Y.get(W-1).writingMode===h.WritingMode.horizontal||(le=!0),J.hidden||J.writingMode===h.WritingMode.vertical&&!le){jr(J.numGlyphs,q);continue}le=!1;const re=k?k({x:J.anchorX,y:J.anchorY}):0,ue=[J.anchorX,J.anchorY,re,1];if(h.transformMat4(ue,ue,n),!xa(ue,U)){jr(J.numGlyphs,q);continue}const te=zt(c.transform.cameraToCenterDistance,ue[3]),ee=h.evaluateSizeForFeature(L,O,J),Ae=b?ee/te:ee*te,De=new h.pointGeometry(J.anchorX,J.anchorY),Le=Ii(De,y,re);if(Le.signedDistanceFromCamera<=0){jr(J.numGlyphs,q);continue}const se=Le.point;let We={};const Ne=b?null:k,nt=pn(J,Ae,!1,S,n,y,_,d.glyphOffsetArray,$,q,se,De,We,Q,Ne);le=nt.useVertical,Ne&&nt.needsFlipping&&(We={}),(nt.notEnoughRoom||le||nt.needsFlipping&&pn(J,Ae,!0,S,n,y,_,d.glyphOffsetArray,$,q,se,De,We,Q,Ne).notEnoughRoom)&&jr(J.numGlyphs,q)}f?d.text.dynamicLayoutVertexBuffer.updateData(q):d.icon.dynamicLayoutVertexBuffer.updateData(q)}function Go(d,n,c,f,y,_,b,S,k,L,O,U,q){const $=S.glyphStartIndex+S.numGlyphs,Y=S.lineStartIndex,Q=S.lineStartIndex+S.lineLength,le=n.getoffsetX(S.glyphStartIndex),W=n.getoffsetX($-1),J=os(d*le,c,f,y,_,b,S.segment,Y,Q,k,L,O,U,q,!0);if(!J)return null;const re=os(d*W,c,f,y,_,b,S.segment,Y,Q,k,L,O,U,q,!0);return re?{first:J,last:re}:null}function Bi(d,n,c,f){return d.writingMode===h.WritingMode.horizontal&&Math.abs(c.y-n.y)>Math.abs(c.x-n.x)*f?{useVertical:!0}:d.writingMode===h.WritingMode.vertical?n.y<c.y?{needsFlipping:!0}:null:0!==d.flipState&&function(y,_,b){const S=(_.x-y.x)*b;return 0===S||Math.abs((_.y-y.y)/S)>lt}(n,c,f)?1===d.flipState?{needsFlipping:!0}:null:n.x>c.x?{needsFlipping:!0}:null}function pn(d,n,c,f,y,_,b,S,k,L,O,U,q,$,Y){const Q=n/24,le=d.lineOffsetX*Q,W=d.lineOffsetY*Q;let J;if(d.numGlyphs>1){const re=d.glyphStartIndex+d.numGlyphs,ue=d.lineStartIndex,te=d.lineStartIndex+d.lineLength,ee=Go(Q,S,le,W,c,O,U,d,k,_,q,Y);if(!ee)return{notEnoughRoom:!0};const Ae=Ii(ee.first.point,b).point,De=Ii(ee.last.point,b).point;if(f&&!c){const Le=Bi(d,Ae,De,$);if(d.flipState=Le&&Le.needsFlipping?1:2,Le)return Le}J=[ee.first];for(let Le=d.glyphStartIndex+1;Le<re-1;Le++)J.push(os(Q*S.getoffsetX(Le),le,W,c,O,U,d.segment,ue,te,k,_,q,Y));J.push(ee.last)}else{if(f&&!c){const ue=Ii(U,y).point,te=d.lineStartIndex+d.segment+1,ee=new h.pointGeometry(k.getx(te),k.gety(te)),Ae=Ii(ee,y),De=Bi(d,ue,Ae.signedDistanceFromCamera>0?Ae.point:Fl(U,ee,ue,1,y),$);if(d.flipState=De&&De.needsFlipping?1:2,De)return De}const re=os(Q*S.getoffsetX(d.glyphStartIndex),le,W,c,O,U,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,k,_,q,Y);if(!re)return{notEnoughRoom:!0};J=[re]}for(const re of J)h.addDynamicAttributes(L,re.point,re.angle);return{}}function Fl(d,n,c,f,y,_){const b=d.add(d.sub(n)._unit()),S=Ii(b,y,_?_(b):0).point,k=c.sub(S);return c.add(k._mult(f/k.mag()))}function os(d,n,c,f,y,_,b,S,k,L,O,U,q,$,Y){const Q=f?d-n:d+n;let le=Q>0?1:-1,W=0;f&&(le*=-1,W=Math.PI),le<0&&(W+=Math.PI);let J=le>0?S+b:S+b+1,re=y,ue=y,te=0,ee=0;const Ae=Math.abs(Q),De=[],Le=[];let se=_;const We=()=>{const ft=J-le;return 0===te?_:new h.pointGeometry(L.getx(ft),L.gety(ft))},Ne=()=>Fl(We(),se,ue,Ae-te+1,O,q);for(;te+ee<=Ae;){if(J+=le,J<S||J>=k)return null;if(ue=re,De.push(re),$&&Le.push(se||We()),re=U[J],void 0===re){se=new h.pointGeometry(L.getx(J),L.gety(J));const ft=Ii(se,O,q?q(se):0);re=ft.signedDistanceFromCamera>0?U[J]=ft.point:Ne()}else se=null;te+=ee,ee=ue.dist(re)}Y&&q&&(se=se||new h.pointGeometry(L.getx(J),L.gety(J)),U[J]=re=void 0===U[J]?re:Ne(),ee=ue.dist(re));const nt=(Ae-te)/ee,Ye=re.sub(ue),Xe=Ye.mult(nt)._add(ue);c&&Xe._add(Ye._unit()._perp()._mult(c*le));const wt=W+Math.atan2(re.y-ue.y,re.x-ue.x);return De.push(Xe),$&&(se=se||new h.pointGeometry(L.getx(J),L.gety(J)),Le.push(function(ft,Kt,_n){const vn=1-_n;return new h.pointGeometry(ft.x*vn+Kt.x*_n,ft.y*vn+Kt.y*_n)}(Le.length>0?Le[Le.length-1]:se,se,nt))),{point:Xe,angle:wt,path:De,tilePath:Le}}const tl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function jr(d,n){for(let c=0;c<d;c++){const f=n.length;n.resize(f+4),n.float32.set(tl,3*f)}}function po(d,n,c){const f=n[0],y=n[1];return d[0]=c[0]*f+c[4]*y+c[12],d[1]=c[1]*f+c[5]*y+c[13],d[3]=c[3]*f+c[7]*y+c[15],d}const yi=100;class $t{constructor(n,c,f=new je(n.width+200,n.height+200,25),y=new je(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+yi,this.screenBottomBoundary=n.height+yi,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,f,y,_,b,S){const k=this.projectAndGetPerspectiveRatio(b,c.anchorPointX,c.anchorPointY,c.elevation,c.tileID),L=_*k.perspectiveRatio,O=(c.x1*n+f.x-c.padding)*L+k.point.x,U=(c.y1*n+f.y-c.padding)*L+k.point.y,q=(c.x2*n+f.x+c.padding)*L+k.point.x,$=(c.y2*n+f.y+c.padding)*L+k.point.y,Y=k.perspectiveRatio<=.55||k.aboveHorizon;return!this.isInsideGrid(O,U,q,$)||!y&&this.grid.hitTest(O,U,q,$,S)||Y?{box:[],offscreen:!1}:{box:[O,U,q,$],offscreen:this.isOffscreen(O,U,q,$)}}placeCollisionCircles(n,c,f,y,_,b,S,k,L,O,U,q,$,Y){const Q=[],le=this.transform.elevation,W=le?Ne=>le.getAtTileOffset(Y,Ne.x,Ne.y):Ne=>0,J=new h.pointGeometry(c.anchorX,c.anchorY),re=W(J),ue=this.projectAndGetPerspectiveRatio(b,J.x,J.y,re,Y),{perspectiveRatio:te}=ue,ee=(O?_/te:_*te)/h.ONE_EM,Ae=Ii(J,S,re).point,De=ue.signedDistanceFromCamera>0?Go(ee,y,c.lineOffsetX*ee,c.lineOffsetY*ee,!1,Ae,J,c,f,S,{},le&&!O?W:null,O&&!!le):null;let Le=!1,se=!1,We=!0;if(De&&!ue.aboveHorizon){const Ne=.5*q*te+$,nt=new h.pointGeometry(-100,-100),Ye=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Xe=new zr,wt=De.first,ft=De.last;let Kt=[];for(let Ft=wt.path.length-1;Ft>=1;Ft--)Kt.push(wt.path[Ft]);for(let Ft=1;Ft<ft.path.length;Ft++)Kt.push(ft.path[Ft]);const _n=2.5*Ne;if(k){const Ft=Kt.map(le?(cn,In)=>{const cr=W(In<wt.path.length-1?wt.tilePath[wt.path.length-1-In]:ft.tilePath[In-wt.path.length+2]);return Ii(cn,k,cr)}:cn=>Ii(cn,k));Kt=Ft.some(cn=>cn.signedDistanceFromCamera<=0)?[]:Ft.map(cn=>cn.point)}let vn=[];if(Kt.length>0){const Ft=Kt[0].clone(),cn=Kt[0].clone();for(let In=1;In<Kt.length;In++)Ft.x=Math.min(Ft.x,Kt[In].x),Ft.y=Math.min(Ft.y,Kt[In].y),cn.x=Math.max(cn.x,Kt[In].x),cn.y=Math.max(cn.y,Kt[In].y);vn=Ft.x>=nt.x&&cn.x<=Ye.x&&Ft.y>=nt.y&&cn.y<=Ye.y?[Kt]:cn.x<nt.x||Ft.x>Ye.x||cn.y<nt.y||Ft.y>Ye.y?[]:h.clipLine([Kt],nt.x,nt.y,Ye.x,Ye.y)}for(const Ft of vn){Xe.reset(Ft,.25*Ne);let cn=0;cn=Xe.length<=.5*Ne?1:Math.ceil(Xe.paddedLength/_n)+1;for(let In=0;In<cn;In++){const cr=In/Math.max(cn-1,1),Vi=Xe.lerp(cr),xr=Vi.x+yi,Kr=Vi.y+yi;Q.push(xr,Kr,Ne,0);const Ls=xr-Ne,ln=Kr-Ne,An=xr+Ne,Vt=Kr+Ne;if(We=We&&this.isOffscreen(Ls,ln,An,Vt),se=se||this.isInsideGrid(Ls,ln,An,Vt),!n&&this.grid.hitTestCircle(xr,Kr,Ne,U)&&(Le=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!L&&Le||!se?[]:Q,offscreen:We,collisionDetected:Le}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let f=1/0,y=1/0,_=-1/0,b=-1/0;for(const O of n){const U=new h.pointGeometry(O.x+yi,O.y+yi);f=Math.min(f,U.x),y=Math.min(y,U.y),_=Math.max(_,U.x),b=Math.max(b,U.y),c.push(U)}const S=this.grid.query(f,y,_,b).concat(this.ignoredGrid.query(f,y,_,b)),k={},L={};for(const O of S){const U=O.key;if(void 0===k[U.bucketInstanceId]&&(k[U.bucketInstanceId]={}),k[U.bucketInstanceId][U.featureIndex])continue;const q=[new h.pointGeometry(O.x1,O.y1),new h.pointGeometry(O.x2,O.y1),new h.pointGeometry(O.x2,O.y2),new h.pointGeometry(O.x1,O.y2)];h.polygonIntersectsPolygon(c,q)&&(k[U.bucketInstanceId][U.featureIndex]=!0,void 0===L[U.bucketInstanceId]&&(L[U.bucketInstanceId]=[]),L[U.bucketInstanceId].push(U.featureIndex))}return L}insertCollisionBox(n,c,f,y,_){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:_},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,f,y,_){const b=c?this.ignoredGrid:this.grid,S={bucketInstanceId:f,featureIndex:y,collisionGroupID:_};for(let k=0;k<n.length;k+=4)b.insertCircle(S,n[k],n[k+1],n[k+2])}projectAndGetPerspectiveRatio(n,c,f,y,_){const b=[c,f,y||0,1];let S=!1;if(y||this.transform.pitch>0){h.transformMat4(b,b,n);let k=!1;this.fogState&&_&&(k=function(L,O,U,q,$,Y){const Q=Y.calculateFogTileMatrix($),le=[O,U,q];return h.transformMat4$1(le,le,Q),Mt(L,le,Y.pitch,Y._fov)}(this.fogState,c,f,y||0,_.toUnwrapped(),this.transform)>.9),S=b[2]>b[3]||k}else po(b,b,n);return{point:new h.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+yi,(-b[1]/b[3]+1)/2*this.transform.height+yi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/b[3]*.5,1.5),signedDistanceFromCamera:b[3],aboveHorizon:S}}isOffscreen(n,c,f,y){return f<yi||n>=this.screenRightBoundary||y<yi||c>this.screenBottomBoundary}isInsideGrid(n,c,f,y){return f>=0&&n<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=h.identity([]);return h.translate(n,n,[-100,-100,0]),n}}class ba{constructor(n,c,f,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):y&&f?1:0,this.placed=f}isHidden(){return 0===this.opacity&&!this.placed}}class xt{constructor(n,c,f,y,_){this.text=new ba(n?n.text:null,c,f,_),this.icon=new ba(n?n.icon:null,c,y,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class oi{constructor(n,c,f){this.text=n,this.icon=c,this.skipFade=f}}class yr{constructor(){this.invProjMatrix=h.create$1(),this.viewportMatrix=h.create$1(),this.circles=[]}}class Bl{constructor(n,c,f,y,_){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=y,this.tileID=_}}class jo{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[n]}}function Tn(d,n,c,f,y){const{horizontalAlign:_,verticalAlign:b}=h.getAnchorAlignment(d),S=-(_-.5)*n,k=-(b-.5)*c,L=h.evaluateVariableOffset(d,f);return new h.pointGeometry(S+L[0]*y,k+L[1]*y)}function fo(d,n,c,f,y){const _=new h.pointGeometry(d,n);return c&&_._rotate(f?y:-y),_}class mo{constructor(n,c,f,y,_){this.transform=n.clone(),this.collisionIndex=new $t(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new jo(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,f,y){const _=f.getBucket(c),b=f.latestFeatureIndex;if(!_||!b||c.id!==_.layerIds[0])return;const S=f.collisionBoxArray,k=_.layers[0].layout,L=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),O=f.tileSize/h.EXTENT,U=this.transform.calculateProjMatrix(f.tileID.toUnwrapped()),q="map"===k.get("text-pitch-alignment"),$="map"===k.get("text-rotation-alignment"),Y=qt(f,1,this.transform.zoom),Q=St(U,q,$,this.transform,Y);let le=null;if(q){const J=gr(U,q,$,this.transform,Y);le=h.multiply([],this.transform.labelPlaneMatrix,J)}this.retainedQueryData[_.bucketInstanceId]=new Bl(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,f.tileID);const W={bucket:_,layout:k,posMatrix:U,textLabelPlaneMatrix:Q,labelToScreenMatrix:le,scale:L,textPixelRatio:O,holdingForFade:f.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:h.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(y)for(const J of _.sortKeyRanges){const{sortKey:re,symbolInstanceStart:ue,symbolInstanceEnd:te}=J;n.push({sortKey:re,symbolInstanceStart:ue,symbolInstanceEnd:te,parameters:W})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:W})}attemptAnchorPlacement(n,c,f,y,_,b,S,k,L,O,U,q,$,Y,Q,le,W,J){const re=[q.textOffset0,q.textOffset1],ue=Tn(n,f,y,re,_),te=this.collisionIndex.placeCollisionBox(_,c,fo(ue.x,ue.y,b,S,this.transform.angle),U,k,L,O.predicate);if((!le||0!==this.collisionIndex.placeCollisionBox(Y.getSymbolInstanceIconSize(J,this.transform.zoom,$),le,fo(ue.x,ue.y,b,S,this.transform.angle),U,k,L,O.predicate).box.length)&&te.box.length>0){let ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(ee=this.prevPlacement.variableOffsets[q.crossTileID].anchor),this.variableOffsets[q.crossTileID]={textOffset:re,width:f,height:y,anchor:n,textScale:_,prevAnchor:ee},this.markUsedJustification(Y,n,q,Q),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,Q,q),this.placedOrientations[q.crossTileID]=Q),{shift:ue,placedGlyphBoxes:te}}}placeLayerBucketPart(n,c,f){const{bucket:y,layout:_,posMatrix:b,textLabelPlaneMatrix:S,labelToScreenMatrix:k,textPixelRatio:L,holdingForFade:O,collisionBoxArray:U,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:$,collisionGroup:Y}=n.parameters,Q=_.get("text-optional"),le=_.get("icon-optional"),W=_.get("text-allow-overlap"),J=_.get("icon-allow-overlap"),re="map"===_.get("text-rotation-alignment"),ue="map"===_.get("text-pitch-alignment"),te="none"!==_.get("icon-text-fit"),ee="viewport-y"===_.get("symbol-z-order"),Ae=W&&(J||!y.hasIconData()||le),De=J&&(W||!y.hasTextData()||Q);!y.collisionArrays&&U&&y.deserializeCollisionBoxes(U),f&&y.updateCollisionDebugBuffers(this.transform.zoom,U);const Le=(se,We,Ne)=>{if(c[se.crossTileID])return;if(O)return void(this.placements[se.crossTileID]=new oi(!1,!1,!1));let nt=!1,Ye=!1,Xe=!0,wt=null,ft={box:null,offscreen:null},Kt={box:null,offscreen:null},_n=null,vn=null,Ft=null,cn=0,In=0,cr=0;Ne.textFeatureIndex?cn=Ne.textFeatureIndex:se.useRuntimeCollisionCircles&&(cn=se.featureIndex),Ne.verticalTextFeatureIndex&&(In=Ne.verticalTextFeatureIndex);const Vi=ln=>{ln.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||ln.elevation)&&(ln.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,ln.anchorPointX,ln.anchorPointY):0)},xr=Ne.textBox;if(xr){Vi(xr);const ln=Vt=>{let Ln=h.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Vt&&this.prevPlacement){const _i=this.prevPlacement.placedOrientations[se.crossTileID];_i&&(this.placedOrientations[se.crossTileID]=_i,Ln=_i,this.markUsedOrientation(y,Ln,se))}return Ln},An=(Vt,Ln)=>{if(y.allowVerticalPlacement&&se.numVerticalGlyphVertices>0&&Ne.verticalTextBox){for(const _i of y.writingModes)if(_i===h.WritingMode.vertical?(ft=Ln(),Kt=ft):ft=Vt(),ft&&ft.box&&ft.box.length)break}else ft=Vt()};if(_.get("text-variable-anchor")){let Vt=_.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]){const xn=this.prevPlacement.variableOffsets[se.crossTileID];Vt.indexOf(xn.anchor)>0&&(Vt=Vt.filter(wr=>wr!==xn.anchor),Vt.unshift(xn.anchor))}const Ln=(xn,wr,us)=>{const Pi=y.getSymbolInstanceTextSize(q,se,this.transform.zoom,We),vi=(xn.x2-xn.x1)*Pi+2*xn.padding,vu=(xn.y2-xn.y1)*Pi+2*xn.padding,Ro=te&&!J?wr:null;Ro&&Vi(Ro);let Za={box:[],offscreen:!1};const Cc=W?2*Vt.length:Vt.length;for(let Fo=0;Fo<Cc;++Fo){const Xl=this.attemptAnchorPlacement(Vt[Fo%Vt.length],xn,vi,vu,Pi,re,ue,L,b,Y,Fo>=Vt.length,se,We,y,us,Ro,q,$);if(Xl&&(Za=Xl.placedGlyphBoxes,Za&&Za.box&&Za.box.length)){nt=!0,wt=Xl.shift;break}}return Za};An(()=>Ln(xr,Ne.iconBox,h.WritingMode.horizontal),()=>{const xn=Ne.verticalTextBox;return xn&&Vi(xn),y.allowVerticalPlacement&&!(ft&&ft.box&&ft.box.length)&&se.numVerticalGlyphVertices>0&&xn?Ln(xn,Ne.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null}}),ft&&(nt=ft.box,Xe=ft.offscreen);const _i=ln(ft&&ft.box);if(!nt&&this.prevPlacement){const xn=this.prevPlacement.variableOffsets[se.crossTileID];xn&&(this.variableOffsets[se.crossTileID]=xn,this.markUsedJustification(y,xn.anchor,se,_i))}}else{const Vt=(Ln,_i)=>{const xn=y.getSymbolInstanceTextSize(q,se,this.transform.zoom,We),wr=this.collisionIndex.placeCollisionBox(xn,Ln,new h.pointGeometry(0,0),W,L,b,Y.predicate);return wr&&wr.box&&wr.box.length&&(this.markUsedOrientation(y,_i,se),this.placedOrientations[se.crossTileID]=_i),wr};An(()=>Vt(xr,h.WritingMode.horizontal),()=>{const Ln=Ne.verticalTextBox;return y.allowVerticalPlacement&&se.numVerticalGlyphVertices>0&&Ln?(Vi(Ln),Vt(Ln,h.WritingMode.vertical)):{box:null,offscreen:null}}),ln(ft&&ft.box&&ft.box.length)}}if(_n=ft,nt=_n&&_n.box&&_n.box.length>0,Xe=_n&&_n.offscreen,se.useRuntimeCollisionCircles){const ln=y.text.placedSymbolArray.get(se.centerJustifiedTextSymbolIndex>=0?se.centerJustifiedTextSymbolIndex:se.verticalPlacedTextSymbolIndex),An=h.evaluateSizeForFeature(y.textSizeData,q,ln),Vt=_.get("text-padding");vn=this.collisionIndex.placeCollisionCircles(W,ln,y.lineVertexArray,y.glyphOffsetArray,An,b,S,k,f,ue,Y.predicate,se.collisionCircleDiameter,Vt,this.retainedQueryData[y.bucketInstanceId].tileID),nt=W||vn.circles.length>0&&!vn.collisionDetected,Xe=Xe&&vn.offscreen}if(Ne.iconFeatureIndex&&(cr=Ne.iconFeatureIndex),Ne.iconBox){const ln=An=>{Vi(An);const Vt=te&&wt?fo(wt.x,wt.y,re,ue,this.transform.angle):new h.pointGeometry(0,0),Ln=y.getSymbolInstanceIconSize($,this.transform.zoom,We);return this.collisionIndex.placeCollisionBox(Ln,An,Vt,J,L,b,Y.predicate)};Kt&&Kt.box&&Kt.box.length&&Ne.verticalIconBox?(Ft=ln(Ne.verticalIconBox),Ye=Ft.box.length>0):(Ft=ln(Ne.iconBox),Ye=Ft.box.length>0),Xe=Xe&&Ft.offscreen}const Kr=Q||0===se.numHorizontalGlyphVertices&&0===se.numVerticalGlyphVertices,Ls=le||0===se.numIconVertices;if(Kr||Ls?Ls?Kr||(Ye=Ye&&nt):nt=Ye&&nt:Ye=nt=Ye&&nt,nt&&_n&&_n.box&&this.collisionIndex.insertCollisionBox(_n.box,_.get("text-ignore-placement"),y.bucketInstanceId,Kt&&Kt.box&&In?In:cn,Y.ID),Ye&&Ft&&this.collisionIndex.insertCollisionBox(Ft.box,_.get("icon-ignore-placement"),y.bucketInstanceId,cr,Y.ID),vn&&(nt&&this.collisionIndex.insertCollisionCircles(vn.circles,_.get("text-ignore-placement"),y.bucketInstanceId,cn,Y.ID),f)){const ln=y.bucketInstanceId;let An=this.collisionCircleArrays[ln];void 0===An&&(An=this.collisionCircleArrays[ln]=new yr);for(let Vt=0;Vt<vn.circles.length;Vt+=4)An.circles.push(vn.circles[Vt+0]),An.circles.push(vn.circles[Vt+1]),An.circles.push(vn.circles[Vt+2]),An.circles.push(vn.collisionDetected?1:0)}this.placements[se.crossTileID]=new oi(nt||Ae,Ye||De,Xe||y.justReloaded),c[se.crossTileID]=!0};if(ee){const se=y.getSortedSymbolIndexes(this.transform.angle);for(let We=se.length-1;We>=0;--We){const Ne=se[We];Le(y.symbolInstances.get(Ne),Ne,y.collisionArrays[Ne])}}else for(let se=n.symbolInstanceStart;se<n.symbolInstanceEnd;se++)Le(y.symbolInstances.get(se),se,y.collisionArrays[se]);if(f&&y.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[y.bucketInstanceId];h.invert(se.invProjMatrix,b),se.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(n,c,f,y){let _;_=y===h.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(c)];const b=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const S of b)S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=_>=0&&S!==_?0:f.crossTileID)}markUsedOrientation(n,c,f){const y=c===h.WritingMode.horizontal||c===h.WritingMode.horizontalOnly?c:0,_=c===h.WritingMode.vertical?c:0,b=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const S of b)n.text.placedSymbolArray.get(S).placedOrientation=y;f.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(n):1,_=c?c.opacities:{},b=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const k in this.placements){const L=this.placements[k],O=_[k];O?(this.opacities[k]=new xt(O,y,L.text,L.icon),f=f||L.text!==O.text.placed||L.icon!==O.icon.placed):(this.opacities[k]=new xt(null,y,L.text,L.icon,L.skipFade),f=f||L.text||L.icon)}for(const k in _){const L=_[k];if(!this.opacities[k]){const O=new xt(L,y,!1,!1);O.isHidden()||(this.opacities[k]=O,f=f||L.text.placed||L.icon.placed)}}for(const k in b)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=b[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);f?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const f={};for(const y of c){const _=y.getBucket(n);_&&y.latestFeatureIndex&&n.id===_.layerIds[0]&&this.updateBucketOpacities(_,f,y.collisionBoxArray)}}updateBucketOpacities(n,c,f){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0].layout,_=new xt(null,0,!1,!1,!0),b=y.get("text-allow-overlap"),S=y.get("icon-allow-overlap"),k=y.get("text-variable-anchor"),L="map"===y.get("text-rotation-alignment"),O="map"===y.get("text-pitch-alignment"),U="none"!==y.get("icon-text-fit"),q=new xt(null,0,b&&(S||!n.hasIconData()||y.get("icon-optional")),S&&(b||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&f&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(f);const $=(Y,Q,le)=>{for(let W=0;W<Q/4;W++)Y.opacityVertexArray.emplaceBack(le)};for(let Y=0;Y<n.symbolInstances.length;Y++){const Q=n.symbolInstances.get(Y),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:W,crossTileID:J}=Q;let re=this.opacities[J];c[J]?re=_:re||(re=q,this.opacities[J]=re),c[J]=!0;const ue=Q.numIconVertices>0,te=this.placedOrientations[Q.crossTileID],ee=te===h.WritingMode.vertical,Ae=te===h.WritingMode.horizontal||te===h.WritingMode.horizontalOnly;if(le>0||W>0){const De=il(re.text);$(n.text,le,ee?on:De),$(n.text,W,Ae?on:De);const Le=re.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(Ne=>{Ne>=0&&(n.text.placedSymbolArray.get(Ne).hidden=Le||ee?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Le||Ae?1:0);const se=this.variableOffsets[Q.crossTileID];se&&this.markUsedJustification(n,se.anchor,Q,te);const We=this.placedOrientations[Q.crossTileID];We&&(this.markUsedJustification(n,"left",Q,We),this.markUsedOrientation(n,We,Q))}if(ue){const De=il(re.icon);Q.placedIconSymbolIndex>=0&&($(n.icon,Q.numIconVertices,ee?on:De),n.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=re.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&($(n.icon,Q.numVerticalIconVertices,Ae?on:De),n.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const De=n.collisionArrays[Y];if(De){let Le=new h.pointGeometry(0,0);if(De.textBox||De.verticalTextBox){let We=!0;if(k){const Ne=this.variableOffsets[J];Ne?(Le=Tn(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textScale),L&&Le._rotate(O?this.transform.angle:-this.transform.angle)):We=!1}De.textBox&&En(n.textCollisionBox.collisionVertexArray,re.text.placed,!We||ee,Le.x,Le.y),De.verticalTextBox&&En(n.textCollisionBox.collisionVertexArray,re.text.placed,!We||Ae,Le.x,Le.y)}const se=Boolean(!Ae&&De.verticalIconBox);De.iconBox&&En(n.iconCollisionBox.collisionVertexArray,re.icon.placed,se,U?Le.x:0,U?Le.y:0),De.verticalIconBox&&En(n.iconCollisionBox.collisionVertexArray,re.icon.placed,!se,U?Le.x:0,U?Le.y:0)}}}if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Y.invProjMatrix,n.placementViewportMatrix=Y.viewportMatrix,n.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function En(d,n,c,f,y){d.emplaceBack(n?1:0,c?1:0,f||0,y||0),d.emplaceBack(n?1:0,c?1:0,f||0,y||0),d.emplaceBack(n?1:0,c?1:0,f||0,y||0),d.emplaceBack(n?1:0,c?1:0,f||0,y||0)}const nl=Math.pow(2,25),_r=Math.pow(2,24),$r=Math.pow(2,17),Ta=Math.pow(2,16),vs=Math.pow(2,9),xs=Math.pow(2,8),Ea=Math.pow(2,1);function il(d){if(0===d.opacity&&!d.placed)return 0;if(1===d.opacity&&d.placed)return 4294967295;const n=d.placed?1:0,c=Math.floor(127*d.opacity);return c*nl+n*_r+c*$r+n*Ta+c*vs+n*xs+c*Ea+n}const on=0;class Sa{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,c,f,y,_){const b=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(b,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<b.length;)if(c.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,_())return!0;return!1}}class ar{constructor(n,c,f,y,_,b,S,k){this.placement=new mo(n,_,b,S,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,c,f){const y=h.exported.now(),_=()=>{const b=h.exported.now()-y;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=c[n[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===b.type&&(!b.minzoom||b.minzoom<=S)&&(!b.maxzoom||b.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Sa(b)),this._inProgressLayer.continuePlacement(f[b.source],this.placement,this._showCollisionBoxes,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const $o=512/h.EXTENT/2;class Ia{constructor(n,c,f){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let y=0;y<c.length;y++){const _=c.get(y),b=_.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,n)})}}getScaledCoordinates(n,c){const f=$o/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*h.EXTENT+n.anchorX)*f),y:Math.floor((c.canonical.y*h.EXTENT+n.anchorY)*f)}}findMatches(n,c,f){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let _=0;_<n.length;_++){const b=n.get(_);if(b.crossTileID)continue;const S=this.indexedSymbolInstances[b.key];if(!S)continue;const k=this.getScaledCoordinates(b,c);for(const L of S)if(Math.abs(L.coord.x-k.x)<=y&&Math.abs(L.coord.y-k.y)<=y&&!f[L.crossTileID]){f[L.crossTileID]=!0,b.crossTileID=L.crossTileID;break}}}}class Ol{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(0!==c)for(const f in this.indexes){const y=this.indexes[f],_={};for(const b in y){const S=y[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),_[S.tileID.key]=S}this.indexes[f]=_}this.lng=n}addBucket(n,c,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let _=0;_<c.symbolInstances.length;_++)c.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const y=this.usedCrossTileIDs[n.overscaledZ];for(const _ in this.indexes){const b=this.indexes[_];if(Number(_)>n.overscaledZ)for(const S in b){const k=b[S];k.tileID.isChildOf(n)&&k.findMatches(c.symbolInstances,n,y)}else{const S=b[n.scaledTo(Number(_)).key];S&&S.findMatches(c.symbolInstances,n,y)}}for(let _=0;_<c.symbolInstances.length;_++){const b=c.symbolInstances.get(_);b.crossTileID||(b.crossTileID=f.generate(),y[b.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ia(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const f in c.indexedSymbolInstances)for(const y of c.indexedSymbolInstances[f])delete this.usedCrossTileIDs[n][y.crossTileID]}removeStaleBuckets(n){let c=!1;for(const f in this.indexes){const y=this.indexes[f];for(const _ in y)n[y[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,y[_]),delete y[_],c=!0)}return c}}class Aa{constructor(){this.layerIndexes={},this.crossTileIDs=new Ol,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,f){let y=this.layerIndexes[n.id];void 0===y&&(y=this.layerIndexes[n.id]=new vc);let _=!1;const b={};y.handleWrapJump(f);for(const S of c){const k=S.getBucket(n);k&&n.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(S.tileID,k,this.crossTileIDs)&&(_=!0),b[k.bucketInstanceId]=!0)}return y.removeStaleBuckets(b)&&(_=!0),_}pruneUnusedLayers(n){const c={};n.forEach(f=>{c[f]=!0});for(const f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}const ws=(d,n)=>h.emitValidationErrors(d,n&&n.filter(c=>"source.canvas"!==c.identifier)),rl=h.pick(pe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Nl=h.pick(pe,["setCenter","setZoom","setBearing","setPitch"]),sl=function(){const d={},n=h.spec.$version;for(const c in h.spec.$root){const f=h.spec.$root[c];if(f.required){let y=null;y="version"===c?n:"array"===f.type?[]:{},null!=y&&(d[c]=y)}}return d}(),ol={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Oi extends h.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new ut(Ge(),this),this.imageManager=new gn,this.imageManager.setEventedParent(this),this.glyphManager=new h.GlyphManager(n._requestManager,c.localFontFamily?h.LocalGlyphMode.all:c.localIdeographFontFamily?h.LocalGlyphMode.ideographs:h.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new h.LineAtlas(256,512),this.crossTileSymbolIndex=new Aa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const f=this;this._rtlTextPluginCallback=Oi.registerForPluginStateChange(y=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(_,b)=>{if(h.triggerPluginCompletionEvent(_),b&&b.every(S=>S))for(const S in f._sourceCaches){const k=f._sourceCaches[S],L=k.getSource().type;"vector"!==L&&"geojson"!==L||k.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const _=this.getSource(y.sourceId);if(_&&_.vectorLayerIds)for(const b in this._layers){const S=this._layers[b];S.source===_.id&&this._validateLayer(S)}})}loadURL(n,c={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const f="boolean"==typeof c.validate?c.validate:!h.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const y=this.map._requestManager.transformRequest(n,h.ResourceType.Style);this._request=h.getJSON(y,(_,b)=>{this._request=null,_?this.fire(new h.ErrorEvent(_)):b&&this._load(b,f)})}loadJSON(n,c={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(n,!1!==c.validate)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(sl,!1)}_updateLayerCount(n,c){const f=c?1:-1;n.is3D()&&(this._num3DLayers+=f),"circle"===n.type&&(this._numCircleLayers+=f),"symbol"===n.type&&(this._numSymbolLayers+=f)}_load(n,c){if(c&&ws(this,h.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n;for(const y in n.sources)this.addSource(y,n.sources[y],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const f=it(this.stylesheet.layers);this._order=f.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of f)y=h.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Tt(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}_loadSprite(n){this._spriteRequest=function(c,f,y){let _,b,S;const k=h.exported.devicePixelRatio>1?"@2x":"";let L=h.getJSON(f.transformRequest(f.normalizeSpriteURL(c,k,".json"),h.ResourceType.SpriteJSON),(q,$)=>{L=null,S||(S=q,_=$,U())}),O=h.getImage(f.transformRequest(f.normalizeSpriteURL(c,k,".png"),h.ResourceType.SpriteImage),(q,$)=>{O=null,S||(S=q,b=$,U())});function U(){if(S)y(S);else if(_&&b){const q=h.exported.getImageData(b),$={};for(const Y in _){const{width:Q,height:le,x:W,y:J,sdf:re,pixelRatio:ue,stretchX:te,stretchY:ee,content:Ae}=_[Y],De=new h.RGBAImage({width:Q,height:le});h.RGBAImage.copy(q,De,{x:W,y:J},{x:0,y:0},{width:Q,height:le}),$[Y]={data:De,pixelRatio:ue,sdf:re,stretchX:te,stretchY:ee,content:Ae}}y(null,$)}}return{cancel(){L&&(L.cancel(),L=null),O&&(O.cancel(),O=null)}}}(n,this.map._requestManager,(c,f)=>{if(this._spriteRequest=null,c)this.fire(new h.ErrorEvent(c));else if(f)for(const y in f)this.imageManager.addImage(y,f[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const f=n.sourceLayer;f&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(f))&&this.fire(new h.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const f of n){const y=this._layers[f];"custom"!==y.type&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&ol[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(y.length||_.length)&&this._updateWorkerLayers(y,_);for(const b in this._updatedSources){const S=this._updatedSources[b];"reload"===S?this._reloadSource(b):"clear"===S&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const f={};for(const y in this._sourceCaches){const _=this._sourceCaches[y];f[y]=_.used,_.used=!1}for(const y of this._order){const _=this._layers[y];if(_.recalculate(n,this._availableImages),!_.isHidden(n.zoom)){const S=this._getLayerSourceCache(_);S&&(S.used=!0)}const b=this.map.painter;if(b){const S=_.getProgramIds();if(!S)continue;const k=_.getProgramConfiguration(n.zoom);for(const L of S)b.useProgram(L,k)}}for(const y in f){const _=this._sourceCaches[y];f[y]!==_.used&&_.getSource().fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),ws(this,h.validateStyle(n)))return!1;(n=h.clone$2(n)).layers=it(n.layers);const c=function(y,_){if(!y)return[{command:pe.setStyle,args:[_]}];let b=[];try{if(!Be(y.version,_.version))return[{command:pe.setStyle,args:[_]}];Be(y.center,_.center)||b.push({command:pe.setCenter,args:[_.center]}),Be(y.zoom,_.zoom)||b.push({command:pe.setZoom,args:[_.zoom]}),Be(y.bearing,_.bearing)||b.push({command:pe.setBearing,args:[_.bearing]}),Be(y.pitch,_.pitch)||b.push({command:pe.setPitch,args:[_.pitch]}),Be(y.sprite,_.sprite)||b.push({command:pe.setSprite,args:[_.sprite]}),Be(y.glyphs,_.glyphs)||b.push({command:pe.setGlyphs,args:[_.glyphs]}),Be(y.transition,_.transition)||b.push({command:pe.setTransition,args:[_.transition]}),Be(y.light,_.light)||b.push({command:pe.setLight,args:[_.light]}),Be(y.fog,_.fog)||b.push({command:pe.setFog,args:[_.fog]});const S={},k=[];!function(U,q,$,Y){let Q;for(Q in q=q||{},U=U||{})U.hasOwnProperty(Q)&&(q.hasOwnProperty(Q)||mt(Q,$,Y));for(Q in q)q.hasOwnProperty(Q)&&(U.hasOwnProperty(Q)?Be(U[Q],q[Q])||("geojson"===U[Q].type&&"geojson"===q[Q].type&&vt(U,q,Q)?$.push({command:pe.setGeoJSONSourceData,args:[Q,q[Q].data]}):Ct(Q,q,$,Y)):be(Q,q,$))}(y.sources,_.sources,k,S);const L=[];y.layers&&y.layers.forEach(U=>{S[U.source]?b.push({command:pe.removeLayer,args:[U.id]}):L.push(U)});let O=y.terrain;O&&S[O.source]&&(b.push({command:pe.setTerrain,args:[void 0]}),O=void 0),b=b.concat(k),Be(O,_.terrain)||b.push({command:pe.setTerrain,args:[_.terrain]}),function(U,q,$){q=q||[];const Y=(U=U||[]).map(Ot),Q=q.map(Ot),le=U.reduce(sn,{}),W=q.reduce(sn,{}),J=Y.slice(),re=Object.create(null);let ue,te,ee,Ae,De,Le,se;for(ue=0,te=0;ue<Y.length;ue++)ee=Y[ue],W.hasOwnProperty(ee)?te++:($.push({command:pe.removeLayer,args:[ee]}),J.splice(J.indexOf(ee,te),1));for(ue=0,te=0;ue<Q.length;ue++)ee=Q[Q.length-1-ue],J[J.length-1-ue]!==ee&&(le.hasOwnProperty(ee)?($.push({command:pe.removeLayer,args:[ee]}),J.splice(J.lastIndexOf(ee,J.length-te),1)):te++,Le=J[J.length-ue],$.push({command:pe.addLayer,args:[W[ee],Le]}),J.splice(J.length-ue,0,ee),re[ee]=!0);for(ue=0;ue<Q.length;ue++)if(ee=Q[ue],Ae=le[ee],De=W[ee],!re[ee]&&!Be(Ae,De))if(Be(Ae.source,De.source)&&Be(Ae["source-layer"],De["source-layer"])&&Be(Ae.type,De.type)){for(se in Yt(Ae.layout,De.layout,$,ee,null,pe.setLayoutProperty),Yt(Ae.paint,De.paint,$,ee,null,pe.setPaintProperty),Be(Ae.filter,De.filter)||$.push({command:pe.setFilter,args:[ee,De.filter]}),Be(Ae.minzoom,De.minzoom)&&Be(Ae.maxzoom,De.maxzoom)||$.push({command:pe.setLayerZoomRange,args:[ee,De.minzoom,De.maxzoom]}),Ae)Ae.hasOwnProperty(se)&&"layout"!==se&&"paint"!==se&&"filter"!==se&&"metadata"!==se&&"minzoom"!==se&&"maxzoom"!==se&&(0===se.indexOf("paint.")?Yt(Ae[se],De[se],$,ee,se.slice(6),pe.setPaintProperty):Be(Ae[se],De[se])||$.push({command:pe.setLayerProperty,args:[ee,se,De[se]]}));for(se in De)De.hasOwnProperty(se)&&!Ae.hasOwnProperty(se)&&"layout"!==se&&"paint"!==se&&"filter"!==se&&"metadata"!==se&&"minzoom"!==se&&"maxzoom"!==se&&(0===se.indexOf("paint.")?Yt(Ae[se],De[se],$,ee,se.slice(6),pe.setPaintProperty):Be(Ae[se],De[se])||$.push({command:pe.setLayerProperty,args:[ee,se,De[se]]}))}else $.push({command:pe.removeLayer,args:[ee]}),Le=J[J.lastIndexOf(ee)+1],$.push({command:pe.addLayer,args:[De,Le]})}(L,_.layers,b)}catch(S){console.warn("Unable to compute style diff:",S),b=[{command:pe.setStyle,args:[_]}]}return b}(this.serialize(),n).filter(y=>!(y.command in Nl));if(0===c.length)return!1;const f=c.filter(y=>!(y.command in rl));if(f.length>0)throw new Error(`Unimplemented: ${f.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=n,!0}addImage(n,c){if(this.getImage(n))return this.fire(new h.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(n,c),this._afterImageUpdated(n)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new h.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,c,f={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(h.validateStyle.source,`sources.${n}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=D(n,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:n}));const _=b=>{const S=(b?"symbol:":"other:")+n,k=this._sourceCaches[S]=new h.SourceCache(S,y,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[n]=k,k.style=this,k.onAdd(this.map)};_(!1),"vector"!==c.type&&"geojson"!==c.type||_(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(void 0===c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new h.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new h.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(n);for(const y of f)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}addLayer(n,c,f={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let _;if("custom"===n.type){if(ws(this,h.validateCustomStyleLayer(n)))return;_=h.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(y,n.source),n=h.clone$2(n),n=h.extend(n,{source:y})),this._validate(h.validateStyle.layer,`layers.${y}`,n,{arrayIndex:-1},f))return;_=h.createStyleLayer(n),this._validateLayer(_),_.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const b=c?this._order.indexOf(c):this._order.length;if(c&&-1===b)return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(b,0,y),this._layerOrderChanged=!0,this._layers[y]=_;const S=this._getLayerSourceCache(_);if(this._removedLayers[y]&&_.source&&S&&"custom"!==_.type){const k=this._removedLayers[y];delete this._removedLayers[y],k.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",S.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const f=this._order.indexOf(n);this._order.splice(f,1);const y=c?this._order.indexOf(c):this._order.length;c&&-1===y?this.fire(new h.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const f=this._order.indexOf(n);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,f){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===c&&y.maxzoom===f||(null!=c&&(y.minzoom=c),null!=f&&(y.maxzoom=f),this._updateLayer(y)):this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,f={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!Be(y.filter,c))return null==c?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(h.validateStyle.filter,`layers.${y.id}.filter`,c,null,f)||(y.filter=h.clone$2(c),this._updateLayer(y)))}else this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){return h.clone$2(this.getLayer(n).filter)}setLayoutProperty(n,c,f,y={}){this._checkLoaded();const _=this.getLayer(n);_?Be(_.getLayoutProperty(c),f)||(_.setLayoutProperty(c,f,y),this._updateLayer(_)):this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const f=this.getLayer(n);if(f)return f.getLayoutProperty(c);this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,f,y={}){this._checkLoaded();const _=this.getLayer(n);_?Be(_.getPaintProperty(c),f)||(_.setPaintProperty(c,f,y)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new h.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){return this.getLayer(n).getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const f=n.source,y=n.sourceLayer,_=this.getSource(f);if(void 0===_)return void this.fire(new h.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const b=_.type;if("geojson"===b&&y)return void this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===b&&!y)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(f);for(const k of S)k.setFeatureState(y,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const f=n.source,y=this.getSource(f);if(void 0===y)return void this.fire(new h.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const _=y.type,b="vector"===_?n.sourceLayer:void 0;if("vector"===_&&!b)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(f);for(const k of S)k.removeFeatureState(b,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,f=n.sourceLayer,y=this.getSource(c);if(void 0!==y){if("vector"!==y.type||f)return void 0===n.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(f,n.id);this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new h.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const f=this._sourceCaches[c].getSource();n[f.id]||(n[f.id]=f.serialize())}return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:n,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(n){const c=b=>"fill-extrusion"===this._layers[b].type,f={},y=[];for(let b=this._order.length-1;b>=0;b--){const S=this._order[b];if(c(S)){f[S]=b;for(const k of n){const L=k[S];if(L)for(const O of L)y.push(O)}}}y.sort((b,S)=>S.intersectionZ-b.intersectionZ);const _=[];for(let b=this._order.length-1;b>=0;b--){const S=this._order[b];if(c(S))for(let k=y.length-1;k>=0;k--){const L=y[k].feature;if(f[L.layer.id]<b)break;_.push(L),y.pop()}else for(const k of n){const L=k[S];if(L)for(const O of L)_.push(O.feature)}}return _}queryRenderedFeatures(n,c,f){c&&c.filter&&this._validate(h.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of c.layers){const L=this._layers[k];if(!L)return this.fire(new h.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];y[L.source]=!0}}const _=[];c.availableImages=this._availableImages;const b=c&&c.layers?c.layers.some(k=>{const L=this.getLayer(k);return L&&L.is3D()}):this.has3DLayers(),S=Ti.createFromScreenPoints(n,f);for(const k in this._sourceCaches){const L=this._sourceCaches[k].getSource().id;c.layers&&!y[L]||_.push(G(this._sourceCaches[k],this._layers,this._serializedLayers,S,c,f,b,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(k,L,O,U,q,$,Y){const Q={},le=$.queryRenderedSymbols(U),W=[];for(const J of Object.keys(le).map(Number))W.push(Y[J]);W.sort(de);for(const J of W){const re=J.featureIndex.lookupSymbolFeatures(le[J.bucketInstanceId],L,J.bucketIndex,J.sourceLayerIndex,q.filter,q.layers,q.availableImages,k);for(const ue in re){const te=Q[ue]=Q[ue]||[],ee=re[ue];ee.sort((Ae,De)=>{const Le=J.featureSortOrder;if(Le){const se=Le.indexOf(Ae.featureIndex);return Le.indexOf(De.featureIndex)-se}return De.featureIndex-Ae.featureIndex});for(const Ae of ee)te.push(Ae)}}for(const J in Q)Q[J].forEach(re=>{const ue=re.feature,te=O(k[J]).getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=te});return Q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(n,c){c&&c.filter&&this._validate(h.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const f=this._getSourceCaches(n);let y=[];for(const _ of f)y=y.concat(Z(_,c));return y}addSourceType(n,c,f){return Oi.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(Oi.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const f=this.light.getLight();let y=!1;for(const b in n)if(!Be(n[b],f[b])){y=!0;break}if(!y)return;const _={now:h.exported.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,c),this.light.updateTransitions(_)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(n){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof n.source){const c="terrain-dem-src";this.addSource(c,n.source),n=h.clone$2(n),n=h.extend(n,{source:c})}if(!this._validate(h.validateStyle.terrain,"terrain",n)){if(this.terrain){const c=this.terrain,f=c.get();for(const y in n)if(!Be(n[y],f[y])){c.set(n),this.stylesheet.terrain=n;const _={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(_);break}}else this._createTerrain(n);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(n){const c=this.fog=new bi(n);this.stylesheet.fog=n;const f={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(f)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,f=c.get();for(const y in n)if(!Be(n[y],f[y])){c.set(n),this.stylesheet.fog=n;const _={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(_);break}}else this._createFog(n);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(f=>this.isLayerDraped(this._layers[f])),c=this._order.filter(f=>!this.isLayerDraped(this._layers[f]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n){const c=this.terrain=new Kn(n);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const f={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(f)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];"fill-extrusion"===c.type&&this._updateLayer(c)}}_validate(n,c,f,y,_={}){return(!_||!1!==_.validate)&&ws(this,n.call(h.validateStyle,h.extend({key:c,style:this.serialize(),value:f,styleSpec:h.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const f of c)f.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const f of c)f.resume(),f.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,f,y,_=!1){let b=!1,S=!1;const k={};for(const L of this._order){const O=this._layers[L];if("symbol"!==O.type)continue;if(!k[O.source]){const q=this._getLayerSourceCache(O);if(!q)continue;k[O.source]=q.getRenderableIds(!0).map($=>q.getTileByID($)).sort(($,Y)=>Y.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(Y.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(O,k[O.source],n.center.lng);b=b||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||0===f,this._layerOrderChanged&&this.fire(new h.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),n.zoom))&&(this.pauseablePlacement=new ar(n,this._order,_,c,f,y,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),S=!0),b&&this.pauseablePlacement.placement.setStale()),S||b)for(const L of this._order){const O=this._layers[L];"symbol"===O.type&&this.placement.updateLayerOpacities(O,k[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,f){this.imageManager.getImages(c.icons,f),this._updateTilesForChangedImages();const y=_=>{_&&_.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(n,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(n,c,f){return h.makeRequest(c,f)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Oi.getSourceType=function(d){return P[d]},Oi.setSourceType=function(d,n){P[d]=n},Oi.registerForPluginStateChange=h.registerForPluginStateChange;var al="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ul="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let go={},bs={};go=Gt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),bs=Gt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const as=Gt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Zo=al;var Wo={background:Gt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Gt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Gt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Gt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Gt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Gt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Gt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Gt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Gt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Gt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Gt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Gt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Gt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);gl_Position=u_matrix*vec4(pos,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Gt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\n#else\nvec3 p=vec3(pos_nx.xy,z);gl_Position=u_matrix*vec4(p,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Gt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Gt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineGradient:Gt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Gt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineSDF:Gt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);v_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Gt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Gt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:Gt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Gt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:Gt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Gt("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Gt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ul),skyboxGradient:Gt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ul),skyboxCapture:Gt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}")};function Gt(d,n,c){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,_=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b=d.match(y),S=n.match(y),k=al.match(y);let L=S?S.concat(b):b;c||(go.staticUniforms&&(L=go.staticUniforms.concat(L)),bs.staticUniforms&&(L=bs.staticUniforms.concat(L))),L&&(L=L.concat(k));const O={};return{fragmentSource:d=d.replace(f,(U,q,$,Y,Q)=>(O[Q]=!0,"define"===q?`\n#ifndef HAS_UNIFORM_u_${Q}\nvarying ${$} ${Y} ${Q};\n#else\nuniform ${$} ${Y} u_${Q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Q}\n    ${$} ${Y} ${Q} = u_${Q};\n#endif\n`)),vertexSource:n=n.replace(f,(U,q,$,Y,Q)=>{const le="float"===Y?"vec2":"vec4",W=Q.match(/color/)?"color":le;return O[Q]?"define"===q?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nattribute ${$} ${le} a_${Q};\nvarying ${$} ${Y} ${Q};\n#else\nuniform ${$} ${Y} u_${Q};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = a_${Q};\n#else\n    ${$} ${Y} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = unpack_mix_${W}(a_${Q}, u_${Q}_t);\n#else\n    ${$} ${Y} ${Q} = u_${Q};\n#endif\n`:"define"===q?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nattribute ${$} ${le} a_${Q};\n#else\nuniform ${$} ${Y} u_${Q};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${$} ${Y} ${Q} = a_${Q};\n#else\n    ${$} ${Y} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${$} ${Y} ${Q} = unpack_mix_${W}(a_${Q}, u_${Q}_t);\n#else\n    ${$} ${Y} ${Q} = u_${Q};\n#endif\n`}),staticAttributes:_,staticUniforms:L}}class Ho{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,c,f,y,_,b,S,k){this.context=n;let L=this.boundPaintVertexBuffers.length!==y.length;for(let O=0;!L&&O<y.length;O++)this.boundPaintVertexBuffers[O]!==y[O]&&(L=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===f&&!L&&this.boundIndexBuffer===_&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===k?(n.bindVertexArrayOES.set(this.vao),S&&S.bind(),_&&_.dynamicDraw&&_.bind(),k&&k.bind()):this.freshBind(c,f,y,_,b,S,k)}freshBind(n,c,f,y,_,b,S){let k;const L=n.numAttributes,O=this.context,U=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=y,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=S;else{k=O.currentNumAttributes||0;for(let q=L;q<k;q++)U.disableVertexAttribArray(q)}c.enableAttributes(U,n);for(const q of f)q.enableAttributes(U,n);b&&b.enableAttributes(U,n),S&&S.enableAttributes(U,n),c.bind(),c.setVertexAttribPointers(U,n,_);for(const q of f)q.bind(),q.setVertexAttribPointers(U,n,_);b&&(b.bind(),b.setVertexAttribPointers(U,n,_)),y&&y.bind(),S&&(S.bind(),S.setVertexAttribPointers(U,n,_)),O.currentNumAttributes=L}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ts(d,n){const c=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new h.MercatorCoordinate(0,f/c).toLngLat().lat,new h.MercatorCoordinate(0,(f+1)/c).toLngLat().lat]}function ll(d,n,c,f,y,_,b){const S=d.context,k=S.gl,L=c.fbo;if(!L)return;d.prepareDrawTile(n);const O=d.useProgram("hillshade");S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get());const U=((q,$,Y,Q)=>{const le=Y.paint.get("hillshade-shadow-color"),W=Y.paint.get("hillshade-highlight-color"),J=Y.paint.get("hillshade-accent-color");let re=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Y.paint.get("hillshade-illumination-anchor")&&(re-=q.transform.angle);const ue=!q.options.moving;return{u_matrix:Q||q.transform.calculateProjMatrix($.tileID.toUnwrapped(),ue),u_image:0,u_latrange:Ts(0,$.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),re],u_shadow:le,u_highlight:W,u_accent:J}})(d,c,f,d.terrain?n.projMatrix:null);d.prepareDrawProgram(S,O,n.toUnwrapped()),O.draw(S,k.TRIANGLES,y,_,b,h.CullFaceMode.disabled,U,f.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Zr(d,n,c){if(!n.needsDEMTextureUpload)return;const f=d.context,y=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(c.stride);const _=c.getPixels();n.demTexture?n.demTexture.update(_,{premultiply:!1}):n.demTexture=new h.Texture(f,_,y.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Es(d,n,c,f,y,_){const b=d.context,S=b.gl;if(!n.dem)return;const k=n.dem;if(b.activeTexture.set(S.TEXTURE1),Zr(d,n,k),!n.demTexture)return;n.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const L=k.dim;b.activeTexture.set(S.TEXTURE0);let O=n.fbo;if(!O){const U=new h.Texture(b,{width:L,height:L,data:null},S.RGBA);U.bind(S.LINEAR,S.CLAMP_TO_EDGE),O=n.fbo=b.createFramebuffer(L,L,!0),O.colorAttachment.set(U.texture)}b.bindFramebuffer.set(O.framebuffer),b.viewport.set([0,0,L,L]),d.useProgram("hillshadePrepare").draw(b,S.TRIANGLES,f,y,_,h.CullFaceMode.disabled,((U,q)=>{const $=q.stride,Y=h.create$1();return h.ortho(Y,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(Y,Y,[0,-h.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[$,$],u_zoom:U.overscaledZ,u_unpack:q.unpackVector}})(n.tileID,k),c.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),n.needsHillshadePrepare=!1}const Nt=(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_image0:new h.Uniform1i(d,n.u_image0),u_skirt_height:new h.Uniform1f(d,n.u_skirt_height)}),yo=(d,n)=>({u_matrix:d,u_image0:0,u_skirt_height:n}),Ca=new class{constructor(){this.operations={}}newMorphing(d,n,c,f,y){if(d in this.operations){const _=this.operations[d];_.to.tileID.key!==c.tileID.key&&(_.queued=c)}else this.operations[d]={startTime:f,phase:0,duration:y,from:n,to:c,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const c=this.operations[n];for(c.phase=(d-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Ko={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Zs(d,n){const c=1<<d.z;return!n&&(0===d.x||d.x===c-1)||0===d.y||d.y===c-1}const _o=d=>({u_matrix:d});function Ss(d,n,c,f,y){if(y>0){const _=h.exported.now(),b=(_-d.timeAdded)/y,S=n?(_-n.timeAdded)/y:-1,k=c.getSource(),L=f.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),O=!n||Math.abs(n.tileID.overscaledZ-L)>Math.abs(d.tileID.overscaledZ-L),U=O&&d.refreshedUponExpiration?1:h.clamp(O?b:1-S,0,1);return d.refreshedUponExpiration&&b>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class xc extends h.SourceCache{constructor(n){const c=D("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new ut(Ge(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,f){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,b)=>{if(_[b.key]="",!this._tiles[b.key]){const S=new h.Tile(b,this._source.tileSize*b.overscaleFactor(),n.tileZoom);S.state="loaded",this._tiles[b.key]=S}return _},{});for(const _ in this._tiles)_ in y||(this.freeFBO(_),this._tiles[_].state="unloaded",delete this._tiles[_])}freeFBO(n){const c=this.proxyCachedFBO[n];if(void 0!==c){const f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wc extends h.OverscaledTileID{constructor(n,c,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class Is extends h.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,y,_]=function(k){const L=new h.StructArrayLayout4i8,O=new h.StructArrayLayout3ui6,U=131;L.reserve(17161),O.reserve(33800);const q=h.EXTENT/128,$=h.EXTENT+q/2,Y=$+q;for(let le=-q;le<Y;le+=q)for(let W=-q;W<Y;W+=q){const J=W<0||W>$||le<0||le>$?24575:0,re=h.clamp(Math.round(W),0,h.EXTENT),ue=h.clamp(Math.round(le),0,h.EXTENT);L.emplaceBack(re+J,ue,re,ue)}const Q=(le,W)=>{const J=W*U+le;O.emplaceBack(J+1,J,J+U),O.emplaceBack(J+U,J+U+1,J+1)};for(let le=1;le<129;le++)for(let W=1;W<129;W++)Q(W,le);return[0,129].forEach(le=>{for(let W=0;W<130;W++)Q(W,le),Q(le,W)}),[L,O,32768]}(),b=n.context;this.gridBuffer=b.createVertexBuffer(f,Dr.members),this.gridIndexBuffer=b.createIndexBuffer(y),this.gridSegments=h.SegmentVector.simpleSegment(0,0,f.length,y.length),this.gridNoSkirtSegments=h.SegmentVector.simpleSegment(0,0,f.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new xc(c.map),this.orthoMatrix=h.create$1(),h.ortho(this.orthoMatrix,0,h.EXTENT,0,h.EXTENT,0,1);const S=b.gl;this._overlapStencilMode=new h.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,c,f){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const y=n.terrain.properties;this.sourceCache=n._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const _=()=>{this.sourceCache.used&&h.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const b=this.sourceCache.getSource().tileSize/128,S=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(c,b*S,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),c.updateElevation(!f),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&h.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=0===f._centerAltitude&&-1===this.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(f.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(k=>{const L=c.getTileByID(k).tileID;return L.projMatrix=f.calculateProjMatrix(L.toUnwrapped()),L});(function(k,L){const O=L.transform.pointCoordinate(L.transform.getCameraPoint()),U=new h.pointGeometry(O.x,O.y);k.sort((q,$)=>{if($.overscaledZ-q.overscaledZ)return $.overscaledZ-q.overscaledZ;const Y=new h.pointGeometry(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),Q=new h.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),le=U.mult(1<<q.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(Y)-le.distSqr(Q)})})(y,this.painter),this._previousZoom=f.zoom;const _=this.proxyToSource||{};this.proxyToSource={},y.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const b=this._style._sourceCaches;for(const k in b){const L=b[k];if(!L.used||(L!==this.sourceCache&&(this._findCoveringTileCache[L.id]={}),this._setupProxiedCoordsForOrtho(L,n[k],_),L.usedForTerrain))continue;const O=n[k];L.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[c.id]=y.map(k=>new wc(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=h.exported.now();const S={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const L=this.terrainTileForTile[k.key];if(!L)continue;const O=L.tileID.key;O in S||(this._visibleDemTiles.push(L),S[O]=O)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const f in this.terrainTileForTile){const y=this.terrainTileForTile[f],_=y.dem;!_||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),Zr(this.painter,y,_))}}_prepareDemTileUniforms(n,c,f,y){if(!c||null==c.demTexture)return!1;const _=n.tileID.canonical,b=Math.pow(2,c.tileID.canonical.z-_.z),S=y||"";return f[`u_dem_tl${S}`]=[_.x*b%1,_.y*b%1],f[`u_dem_scale${S}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((f,y)=>{if(!y.dem)return f;const _=y.dem.tree.minimums[0];return _>0&&n++,f+_},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const f=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(h.DEMData.pack(f,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(y,{premultiply:!1}):_=this._emptyDEMTexture=new h.Texture(n,y,c.RGBA,{premultiply:!1}),_}setupElevationDraw(n,c,f){const y=this.painter.context,_=y.gl,b=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:h.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();let k=null,L=null,O=1;if(f&&f.morphing&&this._useVertexMorphing){const U=f.morphing.srcDemTile,q=f.morphing.dstDemTile;O=f.morphing.phase,U&&q&&(this._prepareDemTileUniforms(n,U,b,"_prev")&&(L=U),this._prepareDemTileUniforms(n,q,b)&&(k=q))}if(L&&k?(y.activeTexture.set(_.TEXTURE2),k.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),y.activeTexture.set(_.TEXTURE4),L.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),b.u_dem_lerp=O):(k=this.terrainTileForTile[n.tileID.key],y.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(n,k,b)?k.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST)),f&&f.useDepthForOcclusion&&(y.activeTexture.set(_.TEXTURE3),this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),f&&f.useMeterToDem&&k){const U=(1<<k.tileID.canonical.z)*h.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=U}f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(y,b)}renderToBackBuffer(n){const c=this.painter,f=this.painter.context;0!==n.length&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(y,_,b,S,k){const L=y.context,O=L.gl;let U,q;const $=y.options.showTerrainWireframe?2:0,Y=(re,ue)=>{if(q===re)return;const te=[Ko[re]];ue&&te.push(Ko[$]),U=y.useProgram("terrainRaster",null,te),q=re},Q=y.colorModeForRenderPass(),le=new h.DepthMode(O.LEQUAL,h.DepthMode.ReadWrite,y.depthRangeFor3D);Ca.update(k);const W=y.transform,J=6*Math.pow(1.5,22-W.zoom)*_.exaggeration();($?[!1,!0]:[!1]).forEach(re=>{q=-1;const ue=re?O.LINES:O.TRIANGLES,[te,ee]=re?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const Le of S){const se=b.getTile(Le),We=h.StencilMode.disabled,Ne=_.prevTerrainTileForTile[Le.key],nt=_.terrainTileForTile[Le.key];De=nt,null!=(Ae=Ne)&&null!=De&&Ae.hasData()&&De.hasData()&&null!=Ae.demTexture&&null!=De.demTexture&&Ae.tileID.key!==De.tileID.key&&Ca.newMorphing(Le.key,Ne,nt,k,250),L.activeTexture.set(O.TEXTURE0),se.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const Ye=Ca.getMorphValuesForProxy(Le.key),Xe=Ye?1:0;let wt;Ye&&(wt={morphing:{srcDemTile:Ye.from,dstDemTile:Ye.to,phase:h.easeCubicInOut(Ye.phase)}});const ft=yo(Le.projMatrix,Zs(Le.canonical,W.renderWorldCopies)?J/10:J);Y(Xe,re),_.setupElevationDraw(se,U,wt),y.prepareDrawProgram(L,U,Le.toUnwrapped()),U.draw(L,ue,le,We,Q,h.CullFaceMode.backCCW,ft,"terrain_raster",_.gridBuffer,te,ee)}var Ae,De})}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const c=this.painter,f=this.painter.context,y=this.proxySourceCache,_=this.proxiedCoords[y.id],b=this._drapedRenderBatches.shift(),S=[],k=c.style.order;let L=0;for(const O of _){const U=y.getTileByID(O.proxyTileKey),q=y.proxyCachedFBO[O.key]?y.proxyCachedFBO[O.key][n]:void 0,$=void 0!==q?y.renderCache[q]:this.pool[L++],Y=void 0!==q;if(U.texture=$.tex,Y&&!$.dirty){S.push(U.tileID);continue}let Q;f.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(f.clear({color:h.Color.transparent}),$.dirty=!1);for(let le=b.start;le<=b.end;++le){const W=c.style._layers[k[le]];if(W.isHidden(c.transform.zoom))continue;const J=c.style._getLayerSourceCache(W),re=J?this.proxyToSource[O.key][J.id]:[O];if(!re)continue;const ue=re;f.viewport.set([0,0,$.fb.width,$.fb.height]),Q!==(J?J.id:null)&&(this._setupStencil($,re,W,J),Q=J?J.id:null),c.renderLayer(c,J,W,ue)}this.renderedToTile?($.dirty=!0,S.push(U.tileID)):Y||--L,5===L&&(L=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),b.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(0===c)return{efficiency:100};let f,y=0,_=0,b=!1;for(let S=0;S<c;++S){const k=n._layers[n.order[S]];this._style.isLayerDraped(k)?(b&&++y,++_):b||(b=!0,f=k.id)}return 0===_?{efficiency:100}:{efficiency:100*(1-y/_),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,c,f){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const b=_.tileID,S=Math.pow(2,b.overscaledZ),{x:k,y:L}=b.canonical,O=k/S,U=(k+1)/S,q=L/S,$=(L+1)/S;return{minx:O,miny:q,maxx:U,maxy:$,t:_.dem.tree.raycastRoot(O,q,U,$,n,c,f),tile:_}});y.sort((_,b)=>(null!==_.t?_.t:Number.MAX_VALUE)-(null!==b.t?b.t:Number.MAX_VALUE));for(const _ of y){if(null==_.t)return null;const b=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,n,c,f);if(null!=b)return b}return null}_createFBO(){const n=this.painter.context,c=n.gl,f=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const y=new h.Texture(n,{width:f[0],height:f[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const _=n.createFramebuffer(f[0],f[1],!1);return _.colorAttachment.set(y.texture),_.depthAttachment=new Gr(n,_.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:_,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],f=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),_=!!y&&1!==y.t,b=c.hasTransition();return"custom"!==c.type&&!f&&(_||b)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof ss){n=!0;break}if(n)for(let c=0;c<this._style.order.length;++c){const f=this._style._layers[this._style.order[c]],y=f.isHidden(this.painter.transform.zoom),_=this._style._getLayerSourceCache(f);if("raster"!==f.type||y||!_)continue;const b=f.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const k=this.proxyToSource[S.key][_.id];if(k)for(const L of k){const O=Ss(_.getTile(L),_.findLoadedParent(L,0),_,this.painter.transform,b);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(_.id,L)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(0===c)return;const f=[];let y,_=0,b=this._style._layers[n[_]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++_<c;)b=this._style._layers[n[_]];for(;_<c;++_){const S=this._style._layers[n[_]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===y&&(y=_):void 0!==y&&(f.push({start:y,end:_-1}),y=void 0))}void 0!==y&&f.push({start:y,end:_-1}),this._drapedRenderBatches=f}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const b=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let S=0;S<b.length;++S){const k=Object.values(b[S]);c.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();const f=this.proxyCoords,y=this._tilesDirty;for(let b=f.length-1;b>=0;b--){const S=f[b];if(c.getTileByID(S.key),void 0!==c.proxyCachedFBO[S.key]){const k=n[S.key],L=this.proxyToSource[S.key];let O=0;for(const U in L){const q=L[U],$=k[U];if(!$||$.length!==q.length||q.some((Y,Q)=>Y!==$[Q]||y[U]&&y[U].hasOwnProperty(Y.key))){O=-1;break}++O}for(const U in c.proxyCachedFBO[S.key])c.renderCache[c.proxyCachedFBO[S.key][U]].dirty=O<0||O!==Object.values(k).length}}const _=[...this._drapedRenderBatches];_.sort((b,S)=>S.end-S.start-(b.end-b.start));for(const b of _)for(const S of f){if(c.proxyCachedFBO[S.key])continue;let k=c.renderCachePool.pop();void 0===k&&c.renderCache.length<50&&(k=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==k&&(c.proxyCachedFBO[S.key]={},c.proxyCachedFBO[S.key][b.start]=k,c.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,f,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,b=_.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let S;if(f.isTileClipped())S=c.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):h.StencilMode.disabled}_renderTileClippingMasks(n,c){const f=this.painter,y=this.painter.context,_=y.gl;f._tileClippingMaskIDs={},y.setColorMode(h.ColorMode.disabled),y.setDepthMode(h.DepthMode.disabled);const b=f.useProgram("clippingMask");for(const S of n){const k=f._tileClippingMaskIDs[S.key]=--c;b.draw(y,_.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:_.ALWAYS,mask:0},k,255,_.KEEP,_.KEEP,_.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,_o(S.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const f=[n.x,n.y,1,1];h.transformMat4(f,f,c.pixelMatrixInverse),h.scale$2(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;const y=c._camera.position,_=h.mercatorZfromAltitude(1,c.center.lat),b=[y[0],y[1],y[2]/_,0],S=h.subtract([],f.slice(0,3),b);h.normalize(S,S);const k=this.raycast(b,S,this._exaggeration);return null!==k&&k?(h.scaleAndAdd(b,b,S,k),b[3]=b[2],b[2]*=_,b):null}drawDepth(){const n=this.painter,c=n.context,f=this.proxySourceCache,y=Math.ceil(n.width),_=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===_||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const b=c.gl,S=c.createFramebuffer(y,_,!0);c.activeTexture.set(b.TEXTURE0);const k=new h.Texture(c,{width:y,height:_,data:null},b.RGBA);k.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.colorAttachment.set(k.texture);const L=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,_);S.depthAttachment.set(L),this._depthFBO=S,this._depthTexture=k}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,_]),function(b,S,k,L){const O=b.context,U=O.gl;O.clear({depth:1});const q=b.useProgram("terrainDepth"),$=new h.DepthMode(U.LESS,h.DepthMode.ReadWrite,b.depthRangeFor3D);for(const Y of L){const Q=k.getTile(Y),le=yo(Y.projMatrix,0);S.setupElevationDraw(Q,q),q.draw(O,U.TRIANGLES,$,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.backCCW,le,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(n,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,f){if(n.getSource()instanceof H)return this._setupProxiedCoordsForImageSource(n,c,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],_=this.proxyCoords;for(let S=0;S<_.length;S++){const k=_[S],L=this._findTileCoveringTileID(k,n);if(L){const O=this._createProxiedId(k,L,f[k.key]&&f[k.key][n.id]);y.push(O),this.proxyToSource[k.key][n.id]=[O]}}let b=!1;for(let S=0;S<c.length;S++){const k=n.getTile(c[S]);if(!k||!k.hasData())continue;const L=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==k.tileID.canonical.z){const O=this.proxyToSource[L.tileID.key][n.id],U=this._createProxiedId(L.tileID,k,f[L.tileID.key]&&f[L.tileID.key][n.id]);O?O.splice(O.length-1,0,U):this.proxyToSource[L.tileID.key][n.id]=[U],y.push(U),b=!0}}this._sourceTilesOverlap[n.id]=b}_setupProxiedCoordsForImageSource(n,c,f){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],_=this.proxyCoords,b=n.getSource(),S=new h.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),k=b.coordinates.map(h.MercatorCoordinate.fromLngLat).reduce((O,U)=>(O.min.x=Math.min(O.min.x,U.x-S.x),O.min.y=Math.min(O.min.y,U.y-S.y),O.max.x=Math.max(O.max.x,U.x-S.x),O.max.y=Math.max(O.max.y,U.y-S.y),O),{min:new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(O,U)=>{const q=O.wrap+O.canonical.x/(1<<O.canonical.z),$=O.canonical.y/(1<<O.canonical.z),Y=h.EXTENT/(1<<O.canonical.z),Q=U.wrap+U.canonical.x/(1<<U.canonical.z),le=U.canonical.y/(1<<U.canonical.z);return q+Y<Q+k.min.x||q>Q+k.max.x||$+Y<le+k.min.y||$>le+k.max.y};for(let O=0;O<_.length;O++){const U=_[O];for(let q=0;q<c.length;q++){const $=n.getTile(c[q]);if(!$||!$.hasData()||L(U,$.tileID))continue;const Y=this._createProxiedId(U,$,f[U.key]&&f[U.key][n.id]),Q=this.proxyToSource[U.key][n.id];Q?Q.push(Y):this.proxyToSource[U.key][n.id]=[Y],y.push(Y)}}}_createProxiedId(n,c,f){let y=this.orthoMatrix;if(f){const _=f.find(b=>b.key===c.tileID.key);if(_)return _}if(c.tileID.key!==n.key){const _=n.canonical.z-c.tileID.canonical.z;let b,S,k;y=h.create$1();const L=c.tileID.wrap-n.wrap<<n.overscaledZ;_>0?(b=h.EXTENT>>_,S=b*((c.tileID.canonical.x<<_)-n.canonical.x+L),k=b*((c.tileID.canonical.y<<_)-n.canonical.y)):(b=h.EXTENT<<-_,S=h.EXTENT*(c.tileID.canonical.x-(n.canonical.x+L<<-_)),k=h.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-_))),h.ortho(y,0,b,0,b,0,1),h.translate(y,y,[S,k,0])}return new wc(c.tileID,n.key,y)}_findTileCoveringTileID(n,c){let f=c.getTile(n);if(f&&f.hasData())return f;const y=this._findCoveringTileCache[c.id],_=y[n.key];if(f=_?c.getTileByID(_):null,f&&f.hasData()||null===_)return f;let b=f?f.tileID:n,S=b.overscaledZ;const k=c.getSource().minzoom,L=[];if(!_){const U=c.getSource().maxzoom;if(n.canonical.z>=U){const q=n.canonical.z-U;c.getSource().reparseOverscaled?(S=Math.max(n.canonical.z+2,c.transform.tileZoom),b=new h.OverscaledTileID(S,n.wrap,U,n.canonical.x>>q,n.canonical.y>>q)):0!==q&&(S=U,b=new h.OverscaledTileID(S,n.wrap,U,n.canonical.x>>q,n.canonical.y>>q))}b.key!==n.key&&(L.push(b.key),f=c.getTile(b))}const O=U=>{L.forEach(q=>{y[q]=U}),L.length=0};for(S-=1;S>=k&&(!f||!f.hasData());S--){f&&O(f.tileID.key);const U=b.calculateScaledKey(S);if(f=c.getTileByID(U),f&&f.hasData())break;const q=y[U];if(null===q)break;void 0===q?L.push(U):f=c.getTileByID(q)}return O(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(n){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let f,y,_;const b=new h.StructArrayLayout2ui4,S=131;for(y=1;y<129;y++){for(f=1;f<129;f++)_=y*S+f,b.emplaceBack(_,_+1),b.emplaceBack(_,_+S),b.emplaceBack(_+1,_+S),128===y&&b.emplaceBack(_+S,_+S+1);b.emplaceBack(_+1,_+1+S)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=h.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Lr(d){const n=[];for(let c=0;c<d.length;c++){if(null===d[c])continue;const f=d[c].split(" ");n.push(f.pop())}return n}class vo{static cacheKey(n,c,f){let y=`${n}${f?f.cacheKey:""}`;for(const _ of c)y+=`/${_}`;return y}constructor(n,c,f,y,_,b){const S=n.gl;this.program=S.createProgram();const k=Lr(f.staticAttributes),L=y?y.getBinderAttributes():[],O=k.concat(L),U=f.staticUniforms?Lr(f.staticUniforms):[],q=y?y.getBinderUniforms():[],$=U.concat(q),Y=[];for(const te of $)Y.indexOf(te)<0&&Y.push(te);let Q=y?y.defines():[];Q=Q.concat(b.map(te=>`#define ${te}`));const le=Q.concat(as.fragmentSource,Zo,bs.fragmentSource,f.fragmentSource).join("\n"),W=Q.concat(as.vertexSource,Zo,bs.vertexSource,go.vertexSource,f.vertexSource).join("\n"),J=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(J,le),S.compileShader(J),S.attachShader(this.program,J);const re=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(re,W),S.compileShader(re),S.attachShader(this.program,re),this.attributes={};const ue={};this.numAttributes=O.length;for(let te=0;te<this.numAttributes;te++)O[te]&&(S.bindAttribLocation(this.program,te,O[te]),this.attributes[O[te]]=te);S.linkProgram(this.program),S.deleteShader(re),S.deleteShader(J);for(let te=0;te<Y.length;te++){const ee=Y[te];if(ee&&!ue[ee]){const Ae=S.getUniformLocation(this.program,ee);Ae&&(ue[ee]=Ae)}}var te,ee;this.fixedUniforms=_(n,ue),this.binderUniforms=y?y.getUniforms(n,ue):[],-1!==b.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new h.Uniform1i(te=n,(ee=ue).u_dem),u_dem_prev:new h.Uniform1i(te,ee.u_dem_prev),u_dem_unpack:new h.Uniform4f(te,ee.u_dem_unpack),u_dem_tl:new h.Uniform2f(te,ee.u_dem_tl),u_dem_scale:new h.Uniform1f(te,ee.u_dem_scale),u_dem_tl_prev:new h.Uniform2f(te,ee.u_dem_tl_prev),u_dem_scale_prev:new h.Uniform1f(te,ee.u_dem_scale_prev),u_dem_size:new h.Uniform1f(te,ee.u_dem_size),u_dem_lerp:new h.Uniform1f(te,ee.u_dem_lerp),u_exaggeration:new h.Uniform1f(te,ee.u_exaggeration),u_depth:new h.Uniform1i(te,ee.u_depth),u_depth_size_inv:new h.Uniform2f(te,ee.u_depth_size_inv),u_meter_to_dem:new h.Uniform1f(te,ee.u_meter_to_dem),u_label_plane_matrix_inv:new h.UniformMatrix4f(te,ee.u_label_plane_matrix_inv)}),-1!==b.indexOf("FOG")&&(this.fogUniforms=((te,ee)=>({u_fog_matrix:new h.UniformMatrix4f(te,ee.u_fog_matrix),u_fog_range:new h.Uniform2f(te,ee.u_fog_range),u_fog_color:new h.Uniform4f(te,ee.u_fog_color),u_fog_horizon_blend:new h.Uniform1f(te,ee.u_fog_horizon_blend),u_fog_temporal_offset:new h.Uniform1f(te,ee.u_fog_temporal_offset)}))(n,ue))}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y].set(c[y])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y].location&&f[y].set(c[y])}}draw(n,c,f,y,_,b,S,k,L,O,U,q,$,Y,Q,le){const W=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(f),n.setStencilMode(y),n.setColorMode(_),n.setCullFace(b);for(const re in this.fixedUniforms)this.fixedUniforms[re].set(S[re]);Y&&Y.setUniforms(n,this.binderUniforms,q,{zoom:$});const J={[W.LINES]:2,[W.TRIANGLES]:3,[W.LINE_STRIP]:1}[c];for(const re of U.get()){const ue=re.vaos||(re.vaos={});(ue[k]||(ue[k]=new Ho)).bind(n,this,L,Y?Y.getPaintVertexBuffers():[],O,re.vertexOffset,Q,le),W.drawElements(c,re.primitiveLength*J,W.UNSIGNED_SHORT,re.primitiveOffset*J*2)}}}function xo(d,n,c){const f=1/qt(c,1,n.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),_=c.tileSize*Math.pow(2,n.transform.tileZoom)/y,b=_*(c.tileID.canonical.x+c.tileID.wrap*y),S=_*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[f,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[b>>16,S>>16],u_pixel_coord_lower:[65535&b,65535&S]}}const wo=(d,n,c,f)=>{const y=n.style.light,_=y.properties.get("position"),b=[_.x,_.y,_.z],S=h.create$2();"viewport"===y.properties.get("anchor")&&(h.fromRotation(S,-n.transform.angle),h.transformMat3(b,b,S));const k=y.properties.get("color");return{u_matrix:d,u_lightpos:b,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+c,u_opacity:f}},Vl=(d,n,c,f,y,_,b)=>h.extend(wo(d,n,c,f),xo(_,n,b),{u_height_factor:-Math.pow(2,y.overscaledZ)/b.tileSize/8}),Sn=d=>({u_matrix:d}),As=(d,n,c,f)=>h.extend(Sn(d),xo(c,n,f)),Xo=(d,n)=>({u_matrix:d,u_world:n}),bc=(d,n,c,f,y)=>h.extend(As(d,n,c,f),{u_world:y}),Ai=(d,n,c,f)=>{const y=d.transform;let _;if("map"===f.paint.get("circle-pitch-alignment")){const b=qt(c,1,y.zoom);_=[b,b]}else _=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:d.translatePosMatrix(n.projMatrix,c,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:h.exported.devicePixelRatio,u_extrude_scale:_}},bo=d=>{const n=[];return"map"===d.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},cl=(d,n,c)=>{const f=h.EXTENT/c.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/f,n.pixelsToGLUnits[1]/f]}},Yo=(d,n,c=1)=>({u_matrix:d,u_color:n,u_overlay:0,u_overlay_scale:c}),ql=(d,n,c,f)=>({u_matrix:d,u_extrude_scale:qt(n,1,c),u_intensity:f}),ka=(d,n,c,f)=>{const y=d.transform;return{u_matrix:Ma(d,n,c,f),u_ratio:1/qt(n,1,y.zoom),u_device_pixel_ratio:h.exported.devicePixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ul=(d,n,c,f,y)=>h.extend(ka(d,n,c,f),{u_image:0,u_image_height:y}),Cs=(d,n,c,f,y)=>{const _=d.transform,b=Rr(n,_);return{u_matrix:Ma(d,n,c,y),u_texsize:n.imageAtlasTexture.size,u_ratio:1/qt(n,1,_.zoom),u_device_pixel_ratio:h.exported.devicePixelRatio,u_image:0,u_scale:[b,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Ws=(d,n,c,f,y)=>{const _=Rr(n,d.transform);return h.extend(ka(d,n,c,y),{u_texsize:n.lineAtlasTexture.size,u_scale:[_,f.fromScale,f.toScale],u_image:0,u_mix:f.t})};function Rr(d,n){return 1/qt(d,1,n.tileZoom)}function Ma(d,n,c,f){return d.translatePosMatrix(f||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const Gl=(d,n,c,f,y)=>{return{u_matrix:d,u_tl_parent:n,u_scale_parent:c,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(b=y.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(_=y.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:To(y.paint.get("raster-hue-rotate"))};var _,b};function To(d){d*=Math.PI/180;const n=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const Eo=(d,n,c,f,y,_,b,S,k,L)=>{const O=y.transform;return{u_is_size_zoom_constant:+("constant"===d||"source"===d),u_is_size_feature_constant:+("constant"===d||"camera"===d),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:O.width/O.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+k,u_pitch_with_map:+f,u_texsize:L,u_texture:0}},Tc=(d,n,c,f,y,_,b,S,k,L,O)=>{const{cameraToCenterDistance:U,_pitch:q}=y.transform;return h.extend(Eo(d,n,c,f,y,_,b,S,k,L),{u_gamma_scale:f?U*Math.cos(y.terrain?0:q):1,u_device_pixel_ratio:h.exported.devicePixelRatio,u_is_halo:+O})},ou=(d,n,c,f,y,_,b,S,k,L)=>h.extend(Tc(d,n,c,f,y,_,b,S,!0,k,!0),{u_texsize_icon:L,u_texture_icon:1}),Ec=(d,n,c)=>({u_matrix:d,u_opacity:n,u_color:c}),au=(d,n,c,f,y,_)=>h.extend(function(b,S,k,L){const O=k.imageManager.getPattern(b.from.toString()),U=k.imageManager.getPattern(b.to.toString()),{width:q,height:$}=k.imageManager.getPixelSize(),Y=Math.pow(2,L.tileID.overscaledZ),Q=L.tileSize*Math.pow(2,k.transform.tileZoom)/Y,le=Q*(L.tileID.canonical.x+L.tileID.wrap*Y),W=Q*L.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[q,$],u_mix:S.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/qt(L,1,k.transform.tileZoom),u_pixel_coord_upper:[le>>16,W>>16],u_pixel_coord_lower:[65535&le,65535&W]}}(f,_,c,y),{u_matrix:d,u_opacity:n}),Sc={fillExtrusion:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_lightpos:new h.Uniform3f(d,n.u_lightpos),u_lightintensity:new h.Uniform1f(d,n.u_lightintensity),u_lightcolor:new h.Uniform3f(d,n.u_lightcolor),u_vertical_gradient:new h.Uniform1f(d,n.u_vertical_gradient),u_opacity:new h.Uniform1f(d,n.u_opacity)}),fillExtrusionPattern:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_lightpos:new h.Uniform3f(d,n.u_lightpos),u_lightintensity:new h.Uniform1f(d,n.u_lightintensity),u_lightcolor:new h.Uniform3f(d,n.u_lightcolor),u_vertical_gradient:new h.Uniform1f(d,n.u_vertical_gradient),u_height_factor:new h.Uniform1f(d,n.u_height_factor),u_image:new h.Uniform1i(d,n.u_image),u_texsize:new h.Uniform2f(d,n.u_texsize),u_pixel_coord_upper:new h.Uniform2f(d,n.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(d,n.u_pixel_coord_lower),u_scale:new h.Uniform3f(d,n.u_scale),u_fade:new h.Uniform1f(d,n.u_fade),u_opacity:new h.Uniform1f(d,n.u_opacity)}),fill:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix)}),fillPattern:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_image:new h.Uniform1i(d,n.u_image),u_texsize:new h.Uniform2f(d,n.u_texsize),u_pixel_coord_upper:new h.Uniform2f(d,n.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(d,n.u_pixel_coord_lower),u_scale:new h.Uniform3f(d,n.u_scale),u_fade:new h.Uniform1f(d,n.u_fade)}),fillOutline:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_world:new h.Uniform2f(d,n.u_world)}),fillOutlinePattern:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_world:new h.Uniform2f(d,n.u_world),u_image:new h.Uniform1i(d,n.u_image),u_texsize:new h.Uniform2f(d,n.u_texsize),u_pixel_coord_upper:new h.Uniform2f(d,n.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(d,n.u_pixel_coord_lower),u_scale:new h.Uniform3f(d,n.u_scale),u_fade:new h.Uniform1f(d,n.u_fade)}),circle:(d,n)=>({u_camera_to_center_distance:new h.Uniform1f(d,n.u_camera_to_center_distance),u_extrude_scale:new h.Uniform2f(d,n.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f(d,n.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f(d,n.u_matrix)}),collisionBox:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_camera_to_center_distance:new h.Uniform1f(d,n.u_camera_to_center_distance),u_extrude_scale:new h.Uniform2f(d,n.u_extrude_scale)}),collisionCircle:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_inv_matrix:new h.UniformMatrix4f(d,n.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f(d,n.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f(d,n.u_viewport_size)}),debug:(d,n)=>({u_color:new h.UniformColor(d,n.u_color),u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_overlay:new h.Uniform1i(d,n.u_overlay),u_overlay_scale:new h.Uniform1f(d,n.u_overlay_scale)}),clippingMask:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix)}),heatmap:(d,n)=>({u_extrude_scale:new h.Uniform1f(d,n.u_extrude_scale),u_intensity:new h.Uniform1f(d,n.u_intensity),u_matrix:new h.UniformMatrix4f(d,n.u_matrix)}),heatmapTexture:(d,n)=>({u_image:new h.Uniform1i(d,n.u_image),u_color_ramp:new h.Uniform1i(d,n.u_color_ramp),u_opacity:new h.Uniform1f(d,n.u_opacity)}),hillshade:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_image:new h.Uniform1i(d,n.u_image),u_latrange:new h.Uniform2f(d,n.u_latrange),u_light:new h.Uniform2f(d,n.u_light),u_shadow:new h.UniformColor(d,n.u_shadow),u_highlight:new h.UniformColor(d,n.u_highlight),u_accent:new h.UniformColor(d,n.u_accent)}),hillshadePrepare:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_image:new h.Uniform1i(d,n.u_image),u_dimension:new h.Uniform2f(d,n.u_dimension),u_zoom:new h.Uniform1f(d,n.u_zoom),u_unpack:new h.Uniform4f(d,n.u_unpack)}),line:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_ratio:new h.Uniform1f(d,n.u_ratio),u_device_pixel_ratio:new h.Uniform1f(d,n.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(d,n.u_units_to_pixels)}),lineGradient:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_ratio:new h.Uniform1f(d,n.u_ratio),u_device_pixel_ratio:new h.Uniform1f(d,n.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(d,n.u_units_to_pixels),u_image:new h.Uniform1i(d,n.u_image),u_image_height:new h.Uniform1f(d,n.u_image_height)}),linePattern:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_texsize:new h.Uniform2f(d,n.u_texsize),u_ratio:new h.Uniform1f(d,n.u_ratio),u_device_pixel_ratio:new h.Uniform1f(d,n.u_device_pixel_ratio),u_image:new h.Uniform1i(d,n.u_image),u_units_to_pixels:new h.Uniform2f(d,n.u_units_to_pixels),u_scale:new h.Uniform3f(d,n.u_scale),u_fade:new h.Uniform1f(d,n.u_fade)}),lineSDF:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_texsize:new h.Uniform2f(d,n.u_texsize),u_ratio:new h.Uniform1f(d,n.u_ratio),u_device_pixel_ratio:new h.Uniform1f(d,n.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(d,n.u_units_to_pixels),u_image:new h.Uniform1i(d,n.u_image),u_scale:new h.Uniform3f(d,n.u_scale),u_mix:new h.Uniform1f(d,n.u_mix)}),raster:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_tl_parent:new h.Uniform2f(d,n.u_tl_parent),u_scale_parent:new h.Uniform1f(d,n.u_scale_parent),u_buffer_scale:new h.Uniform1f(d,n.u_buffer_scale),u_fade_t:new h.Uniform1f(d,n.u_fade_t),u_opacity:new h.Uniform1f(d,n.u_opacity),u_image0:new h.Uniform1i(d,n.u_image0),u_image1:new h.Uniform1i(d,n.u_image1),u_brightness_low:new h.Uniform1f(d,n.u_brightness_low),u_brightness_high:new h.Uniform1f(d,n.u_brightness_high),u_saturation_factor:new h.Uniform1f(d,n.u_saturation_factor),u_contrast_factor:new h.Uniform1f(d,n.u_contrast_factor),u_spin_weights:new h.Uniform3f(d,n.u_spin_weights)}),symbolIcon:(d,n)=>({u_is_size_zoom_constant:new h.Uniform1i(d,n.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(d,n.u_is_size_feature_constant),u_size_t:new h.Uniform1f(d,n.u_size_t),u_size:new h.Uniform1f(d,n.u_size),u_camera_to_center_distance:new h.Uniform1f(d,n.u_camera_to_center_distance),u_pitch:new h.Uniform1f(d,n.u_pitch),u_rotate_symbol:new h.Uniform1i(d,n.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(d,n.u_aspect_ratio),u_fade_change:new h.Uniform1f(d,n.u_fade_change),u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(d,n.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(d,n.u_coord_matrix),u_is_text:new h.Uniform1i(d,n.u_is_text),u_pitch_with_map:new h.Uniform1i(d,n.u_pitch_with_map),u_texsize:new h.Uniform2f(d,n.u_texsize),u_texture:new h.Uniform1i(d,n.u_texture)}),symbolSDF:(d,n)=>({u_is_size_zoom_constant:new h.Uniform1i(d,n.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(d,n.u_is_size_feature_constant),u_size_t:new h.Uniform1f(d,n.u_size_t),u_size:new h.Uniform1f(d,n.u_size),u_camera_to_center_distance:new h.Uniform1f(d,n.u_camera_to_center_distance),u_pitch:new h.Uniform1f(d,n.u_pitch),u_rotate_symbol:new h.Uniform1i(d,n.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(d,n.u_aspect_ratio),u_fade_change:new h.Uniform1f(d,n.u_fade_change),u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(d,n.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(d,n.u_coord_matrix),u_is_text:new h.Uniform1i(d,n.u_is_text),u_pitch_with_map:new h.Uniform1i(d,n.u_pitch_with_map),u_texsize:new h.Uniform2f(d,n.u_texsize),u_texture:new h.Uniform1i(d,n.u_texture),u_gamma_scale:new h.Uniform1f(d,n.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(d,n.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(d,n.u_is_halo)}),symbolTextAndIcon:(d,n)=>({u_is_size_zoom_constant:new h.Uniform1i(d,n.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(d,n.u_is_size_feature_constant),u_size_t:new h.Uniform1f(d,n.u_size_t),u_size:new h.Uniform1f(d,n.u_size),u_camera_to_center_distance:new h.Uniform1f(d,n.u_camera_to_center_distance),u_pitch:new h.Uniform1f(d,n.u_pitch),u_rotate_symbol:new h.Uniform1i(d,n.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(d,n.u_aspect_ratio),u_fade_change:new h.Uniform1f(d,n.u_fade_change),u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(d,n.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(d,n.u_coord_matrix),u_is_text:new h.Uniform1i(d,n.u_is_text),u_pitch_with_map:new h.Uniform1i(d,n.u_pitch_with_map),u_texsize:new h.Uniform2f(d,n.u_texsize),u_texsize_icon:new h.Uniform2f(d,n.u_texsize_icon),u_texture:new h.Uniform1i(d,n.u_texture),u_texture_icon:new h.Uniform1i(d,n.u_texture_icon),u_gamma_scale:new h.Uniform1f(d,n.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(d,n.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(d,n.u_is_halo)}),background:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_opacity:new h.Uniform1f(d,n.u_opacity),u_color:new h.UniformColor(d,n.u_color)}),backgroundPattern:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_opacity:new h.Uniform1f(d,n.u_opacity),u_image:new h.Uniform1i(d,n.u_image),u_pattern_tl_a:new h.Uniform2f(d,n.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f(d,n.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f(d,n.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f(d,n.u_pattern_br_b),u_texsize:new h.Uniform2f(d,n.u_texsize),u_mix:new h.Uniform1f(d,n.u_mix),u_pattern_size_a:new h.Uniform2f(d,n.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f(d,n.u_pattern_size_b),u_scale_a:new h.Uniform1f(d,n.u_scale_a),u_scale_b:new h.Uniform1f(d,n.u_scale_b),u_pixel_coord_upper:new h.Uniform2f(d,n.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(d,n.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f(d,n.u_tile_units_to_pixels)}),terrainRaster:Nt,terrainDepth:Nt,skybox:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_sun_direction:new h.Uniform3f(d,n.u_sun_direction),u_cubemap:new h.Uniform1i(d,n.u_cubemap),u_opacity:new h.Uniform1f(d,n.u_opacity),u_temporal_offset:new h.Uniform1f(d,n.u_temporal_offset)}),skyboxGradient:(d,n)=>({u_matrix:new h.UniformMatrix4f(d,n.u_matrix),u_color_ramp:new h.Uniform1i(d,n.u_color_ramp),u_center_direction:new h.Uniform3f(d,n.u_center_direction),u_radius:new h.Uniform1f(d,n.u_radius),u_opacity:new h.Uniform1f(d,n.u_opacity),u_temporal_offset:new h.Uniform1f(d,n.u_temporal_offset)}),skyboxCapture:(d,n)=>({u_matrix_3f:new h.UniformMatrix3f(d,n.u_matrix_3f),u_sun_direction:new h.Uniform3f(d,n.u_sun_direction),u_sun_intensity:new h.Uniform1f(d,n.u_sun_intensity),u_color_tint_r:new h.Uniform4f(d,n.u_color_tint_r),u_color_tint_m:new h.Uniform4f(d,n.u_color_tint_m),u_luminance:new h.Uniform1f(d,n.u_luminance)})};let So;function Qo(d,n,c,f,y,_,b){const S=d.context,k=S.gl,L=d.useProgram("collisionBox"),O=[];let U=0,q=0;for(let re=0;re<f.length;re++){const ue=f[re],te=n.getTile(ue),ee=te.getBucket(c);if(!ee)continue;let Ae=ue.projMatrix;0===y[0]&&0===y[1]||(Ae=d.translatePosMatrix(ue.projMatrix,te,y,_));const De=b?ee.textCollisionBox:ee.iconCollisionBox,Le=ee.collisionCircleArray;if(Le.length>0){const se=h.create$1(),We=Ae;h.mul$1(se,ee.placementInvProjMatrix,d.transform.glCoordMatrix),h.mul$1(se,se,ee.placementViewportMatrix),O.push({circleArray:Le,circleOffset:q,transform:We,invTransform:se}),U+=Le.length/4,q=U}De&&(d.terrain&&d.terrain.setupElevationDraw(te,L),L.draw(S,k.LINES,h.DepthMode.disabled,h.StencilMode.disabled,d.colorModeForRenderPass(),h.CullFaceMode.disabled,cl(Ae,d.transform,te),c.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,null,d.transform.zoom,null,De.collisionVertexBuffer,De.collisionVertexBufferExt))}if(!b||!O.length)return;const $=d.useProgram("collisionCircle"),Y=new h.StructArrayLayout2f1f2i16;Y.resize(4*U),Y._trim();let Q=0;for(const re of O)for(let ue=0;ue<re.circleArray.length/4;ue++){const te=4*ue,ee=re.circleArray[te+0],Ae=re.circleArray[te+1],De=re.circleArray[te+2],Le=re.circleArray[te+3];Y.emplace(Q++,ee,Ae,De,Le,0),Y.emplace(Q++,ee,Ae,De,Le,1),Y.emplace(Q++,ee,Ae,De,Le,2),Y.emplace(Q++,ee,Ae,De,Le,3)}(!So||So.length<2*U)&&(So=function(re){const ue=2*re,te=new h.StructArrayLayout3ui6;te.resize(ue),te._trim();for(let ee=0;ee<ue;ee++){const Ae=6*ee;te.uint16[Ae+0]=4*ee+0,te.uint16[Ae+1]=4*ee+1,te.uint16[Ae+2]=4*ee+2,te.uint16[Ae+3]=4*ee+2,te.uint16[Ae+4]=4*ee+3,te.uint16[Ae+5]=4*ee+0}return te}(U));const le=S.createIndexBuffer(So,!0),W=S.createVertexBuffer(Y,h.collisionCircleLayout.members,!0);for(const re of O){const ue={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(J=d.transform).cameraToCenterDistance,u_viewport_size:[J.width,J.height]};$.draw(S,k.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,d.colorModeForRenderPass(),h.CullFaceMode.disabled,ue,c.id,W,le,h.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,d.transform.zoom,null,null,null)}var J;W.destroy(),le.destroy()}const ks=h.identity(new Float32Array(16));function Pa(d,n,c,f,y,_){const{horizontalAlign:b,verticalAlign:S}=h.getAnchorAlignment(d),k=-(b-.5)*n,L=-(S-.5)*c,O=h.evaluateVariableOffset(d,f);return new h.pointGeometry((k/y+O[0])*_,(L/y+O[1])*_)}function hl(d,n,c,f,y,_,b,S,k,L,O,U){const q=d.text.placedSymbolArray,$=d.text.dynamicLayoutVertexArray,Y=d.icon.dynamicLayoutVertexArray,Q={};$.clear();for(let le=0;le<q.length;le++){const W=q.get(le),J=d.allowVerticalPlacement&&!W.placedOrientation,re=W.hidden||!W.crossTileID||J?null:f[W.crossTileID];if(re){const ue=new h.pointGeometry(W.anchorX,W.anchorY),te=U(ue),ee=Ii(ue,c?S:b,te),Ae=zt(_.cameraToCenterDistance,ee.signedDistanceFromCamera);let De=y.evaluateSizeForFeature(d.textSizeData,L,W)*Ae/h.ONE_EM;c&&(De*=d.tilePixelRatio/k);const{width:Le,height:se,anchor:We,textOffset:Ne,textScale:nt}=re,Ye=Pa(We,Le,se,Ne,nt,De),Xe=c?Ii(ue.add(Ye),b,te).point:ee.point.add(n?Ye.rotate(-_.angle):Ye),wt=d.allowVerticalPlacement&&W.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let ft=0;ft<W.numGlyphs;ft++)h.addDynamicAttributes($,Xe,wt);O&&W.associatedIconIndex>=0&&(Q[W.associatedIconIndex]={shiftedAnchor:Xe,angle:wt})}else jr(W.numGlyphs,$)}if(O){Y.clear();const le=d.icon.placedSymbolArray;for(let W=0;W<le.length;W++){const J=le.get(W);if(J.hidden)jr(J.numGlyphs,Y);else{const re=Q[W];if(re)for(let ue=0;ue<J.numGlyphs;ue++)h.addDynamicAttributes(Y,re.shiftedAnchor,re.angle);else jr(J.numGlyphs,Y)}}d.icon.dynamicLayoutVertexBuffer.updateData(Y)}d.text.dynamicLayoutVertexBuffer.updateData($)}function Da(d,n,c){return c.iconsInText&&n?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Hs(d,n,c,f,y,_,b,S,k,L,O,U){const q=d.context,$=q.gl,Y=d.transform,Q="map"===S,le="map"===k,W=Q&&"point"!==c.layout.get("symbol-placement"),J=Q&&!le&&!W,re=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let ue=!1;const te=d.depthModeForSublayer(0,h.DepthMode.ReadOnly),ee=c.layout.get("text-variable-anchor"),Ae=[],De=d.terrain&&le?["PITCH_WITH_MAP_TERRAIN"]:null;for(const Le of f){const se=n.getTile(Le),We=se.getBucket(c);if(!We)continue;const Ne=y?We.text:We.icon;if(!Ne||!Ne.segments.get().length)continue;const nt=Ne.programConfigurations.get(c.id),Ye=y||We.sdfIcons,Xe=y?We.textSizeData:We.iconSizeData,wt=le||0!==Y.pitch,ft=d.useProgram(Da(Ye,y,We),nt,De),Kt=h.evaluateSizeForZoom(Xe,Y.zoom);let _n,vn,Ft,cn,In=[0,0],cr=null;if(y){if(vn=se.glyphAtlasTexture,Ft=$.LINEAR,_n=se.glyphAtlasTexture.size,We.iconsInText){In=se.imageAtlasTexture.size,cr=se.imageAtlasTexture;const Pi="composite"===Xe.kind||"camera"===Xe.kind;cn=wt||d.options.rotating||d.options.zooming||Pi?$.LINEAR:$.NEAREST}}else{const Pi=1!==c.layout.get("icon-size").constantOr(0)||We.iconsNeedLinear;vn=se.imageAtlasTexture,Ft=Ye||d.options.rotating||d.options.zooming||Pi||wt?$.LINEAR:$.NEAREST,_n=se.imageAtlasTexture.size}const Vi=qt(se,1,d.transform.zoom),xr=St(Le.projMatrix,le,Q,d.transform,Vi),Kr=d.terrain&&le&&W?h.invert(new Float32Array(16),xr):ks,Ls=gr(Le.projMatrix,le,Q,d.transform,Vi),ln=ee&&We.hasTextData(),An="none"!==c.layout.get("icon-text-fit")&&ln&&We.hasIconData();if(W){const Pi=Y.elevation;wa(We,Le.projMatrix,d,y,xr,Ls,le,L,Pi?vi=>Pi.getAtTileOffset(Le,vi.x,vi.y):null)}const Vt=d.translatePosMatrix(Le.projMatrix,se,_,b),Ln=W||y&&ee||An?ks:xr,_i=d.translatePosMatrix(Ls,se,_,b,!0),xn=Ye&&0!==c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let wr;wr=Ye?We.iconsInText?ou(Xe.kind,Kt,J,le,d,Vt,Ln,_i,_n,In):Tc(Xe.kind,Kt,J,le,d,Vt,Ln,_i,y,_n,!0):Eo(Xe.kind,Kt,J,le,d,Vt,Ln,_i,y,_n);const us={program:ft,buffers:Ne,uniformValues:wr,atlasTexture:vn,atlasTextureIcon:cr,atlasInterpolation:Ft,atlasInterpolationIcon:cn,isSDF:Ye,hasHalo:xn,tile:se,labelPlaneMatrixInv:Kr};if(re&&We.canOverlap){ue=!0;const Pi=Ne.segments.get();for(const vi of Pi)Ae.push({segments:new h.SegmentVector([vi]),sortKey:vi.sortKey,state:us})}else Ae.push({segments:Ne.segments,sortKey:0,state:us})}ue&&Ae.sort((Le,se)=>Le.sortKey-se.sortKey);for(const Le of Ae){const se=Le.state;if(d.terrain&&d.terrain.setupElevationDraw(se.tile,se.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:se.labelPlaneMatrixInv}),q.activeTexture.set($.TEXTURE0),se.atlasTexture.bind(se.atlasInterpolation,$.CLAMP_TO_EDGE),se.atlasTextureIcon&&(q.activeTexture.set($.TEXTURE1),se.atlasTextureIcon&&se.atlasTextureIcon.bind(se.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),se.isSDF){const We=se.uniformValues;se.hasHalo&&(We.u_is_halo=1,jl(se.buffers,Le.segments,c,d,se.program,te,O,U,We)),We.u_is_halo=0}jl(se.buffers,Le.segments,c,d,se.program,te,O,U,se.uniformValues)}}function jl(d,n,c,f,y,_,b,S,k){const L=f.context;y.draw(L,L.gl.TRIANGLES,_,b,S,h.CullFaceMode.disabled,k,c.id,d.layoutVertexBuffer,d.indexBuffer,n,c.paint,f.transform.zoom,d.programConfigurations.get(c.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Ks(d,n,c,f,y,_,b){const S=d.context.gl,k=c.paint.get("fill-pattern"),L=k&&k.constantOr(1),O=c.getCrossfadeParameters();let U,q,$,Y,Q;b?(q=L&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=S.LINES):(q=L?"fillPattern":"fill",U=S.TRIANGLES);for(const le of f){const W=n.getTile(le);if(L&&!W.patternsLoaded())continue;const J=W.getBucket(c);if(!J)continue;d.prepareDrawTile(le);const re=J.programConfigurations.get(c.id),ue=d.useProgram(q,re);L&&(d.context.activeTexture.set(S.TEXTURE0),W.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),re.updatePaintBuffers(O));const te=k.constantOr(null);if(te&&W.imageAtlas){const Ae=W.imageAtlas,De=Ae.patternPositions[te.to.toString()],Le=Ae.patternPositions[te.from.toString()];De&&Le&&re.setConstantPatternPositions(De,Le)}const ee=d.translatePosMatrix(le.projMatrix,W,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(b){Y=J.indexBuffer2,Q=J.segments2;const Ae=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];$="fillOutlinePattern"===q&&L?bc(ee,d,O,W,Ae):Xo(ee,Ae)}else Y=J.indexBuffer,Q=J.segments,$=L?As(ee,d,O,W):Sn(ee);d.prepareDrawProgram(d.context,ue,le.toUnwrapped()),ue.draw(d.context,U,y,d.stencilModeForClipping(le),_,h.CullFaceMode.disabled,$,c.id,J.layoutVertexBuffer,Y,Q,c.paint,d.transform.zoom,re)}}function Wr(d,n,c,f,y,_,b){const S=d.context,k=S.gl,L=c.paint.get("fill-extrusion-pattern"),O=L.constantOr(1),U=c.getCrossfadeParameters(),q=c.paint.get("fill-extrusion-opacity");for(const $ of f){const Y=n.getTile($),Q=Y.getBucket(c);if(!Q)continue;const le=Q.programConfigurations.get(c.id),W=d.useProgram(O?"fillExtrusionPattern":"fillExtrusion",le);if(d.terrain){const ee=d.terrain;if(!Q.enableTerrain)continue;if(ee.setupElevationDraw(Y,W,{useMeterToDem:!0}),Xs(S,n,$,Q,c,ee),!Q.centroidVertexBuffer){const Ae=W.attributes.a_centroid_pos;void 0!==Ae&&k.vertexAttrib2f(Ae,0,0)}}O&&(d.context.activeTexture.set(k.TEXTURE0),Y.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),le.updatePaintBuffers(U));const J=L.constantOr(null);if(J&&Y.imageAtlas){const ee=Y.imageAtlas,Ae=ee.patternPositions[J.to.toString()],De=ee.patternPositions[J.from.toString()];Ae&&De&&le.setConstantPatternPositions(Ae,De)}const re=d.translatePosMatrix($.projMatrix,Y,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ue=c.paint.get("fill-extrusion-vertical-gradient"),te=O?Vl(re,d,ue,q,$,U,Y):wo(re,d,ue,q);d.prepareDrawProgram(S,W,$.toUnwrapped()),W.draw(S,S.gl.TRIANGLES,y,_,b,h.CullFaceMode.backCCW,te,c.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,c.paint,d.transform.zoom,le,d.terrain?Q.centroidVertexBuffer:null)}}function Xs(d,n,c,f,y,_){const b=[W=>{let J=W.canonical.x-1,re=W.wrap;return J<0&&(J=(1<<W.canonical.z)-1,re--),new h.OverscaledTileID(W.overscaledZ,re,W.canonical.z,J,W.canonical.y)},W=>{let J=W.canonical.x+1,re=W.wrap;return J===1<<W.canonical.z&&(J=0,re++),new h.OverscaledTileID(W.overscaledZ,re,W.canonical.z,J,W.canonical.y)},W=>new h.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(0===W.canonical.y?1<<W.canonical.z:W.canonical.y)-1),W=>new h.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],S=W=>{const J=n.getSource().maxzoom,re=Ae=>{const De=n.getTileByID(Ae);if(De&&De.hasData())return De.getBucket(y)};let ue,te,ee;return(W.overscaledZ===W.canonical.z||W.overscaledZ>=J)&&(ue=re(W.key)),W.overscaledZ>=J&&(te=re(W.calculateScaledKey(W.overscaledZ+1))),W.overscaledZ>J&&(ee=re(W.calculateScaledKey(W.overscaledZ-1))),ue||te||ee},k=[0,0,0],L=(W,J)=>(k[0]=Math.min(W.min.y,J.min.y),k[1]=Math.max(W.max.y,J.max.y),k[2]=h.EXTENT-J.min.x>W.max.x?J.min.x-h.EXTENT:W.max.x,k),O=(W,J)=>(k[0]=Math.min(W.min.x,J.min.x),k[1]=Math.max(W.max.x,J.max.x),k[2]=h.EXTENT-J.min.y>W.max.y?J.min.y-h.EXTENT:W.max.y,k),U=[(W,J)=>L(W,J),(W,J)=>L(J,W),(W,J)=>O(W,J),(W,J)=>O(J,W)],q=new h.pointGeometry(0,0);let $,Y,Q;const le=(W,J,re,ue,te)=>{const ee=[[ue?re:W,ue?W:re,0],[ue?re:J,ue?J:re,0]],Ae=te<0?h.EXTENT+te:te,De=[ue?Ae:(W+J)/2,ue?(W+J)/2:Ae,0];return 0===re&&te<0||0!==re&&te>0?_.getForTilePoints(Q,[De],!0,Y):ee.push(De),_.getForTilePoints(c,ee,!0,$),Math.max(ee[0][2],ee[1][2],De[2])/_.exaggeration()};for(let W=0;W<4;W++){const J=f.borders[W];if(0===J.length&&(f.borderDone[W]=!0),f.borderDone[W])continue;const re=Q=b[W](c),ue=S(re);if(!(ue&&ue.enableTerrain&&(Y=_.findDEMTileFor(re),Y&&Y.dem)))continue;if(!$){const De=_.findDEMTileFor(c);if(!De||!De.dem)return;$=De}const te=(W<2?1:5)-W,ee=ue.borders[te];let Ae=0;for(let De=0;De<J.length;De++){const Le=f.featuresOnBorder[J[De]],se=Le.borders[W];let We;for(;Ae<ee.length&&(We=ue.featuresOnBorder[ee[Ae]],!(We.borders[te][1]>se[0]+3));)ue.borderDone[te]||ue.encodeCentroid(void 0,We,!1),Ae++;if(We&&Ae<ee.length){const Ne=Ae;let nt=0;for(;!(We.borders[te][0]>se[1]-3)&&(nt++,++Ae!==ee.length);)We=ue.featuresOnBorder[ee[Ae]];if(We=ue.featuresOnBorder[ee[Ne]],Le.intersectsCount()>1||We.intersectsCount()>1||1!==nt){1!==nt&&(Ae=Ne),f.encodeCentroid(void 0,Le,!1),ue.borderDone[te]||ue.encodeCentroid(void 0,We,!1);continue}const Ye=U[W](Le,We),Xe=W%2?h.EXTENT-1:0;q.x=le(Ye[0],Math.min(h.EXTENT-1,Ye[1]),Xe,W<2,Ye[2]),q.y=0,f.encodeCentroid(q,Le,!1),ue.borderDone[te]||ue.encodeCentroid(q,We,!1)}else f.encodeCentroid(void 0,Le,!1)}f.borderDone[W]=f.needsCentroidUpdate=!0,ue.borderDone[te]||(ue.borderDone[te]=ue.needsCentroidUpdate=!0)}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&0!==f.centroidVertexArray.length)&&f.uploadCentroid(d)}const Io=new h.Color(1,0,0,1),Zt=new h.Color(0,1,0,1),za=new h.Color(0,0,1,1),Ao=new h.Color(1,0,1,1),Co=new h.Color(0,1,1,1);function Jo(d,n,c,f){La(d,0,n+c/2,d.transform.width,c,f)}function Vn(d,n,c,f){La(d,n-c/2,0,c,d.transform.height,f)}function La(d,n,c,f,y,_){const b=d.context,S=b.gl;S.enable(S.SCISSOR_TEST),S.scissor(n*h.exported.devicePixelRatio,c*h.exported.devicePixelRatio,f*h.exported.devicePixelRatio,y*h.exported.devicePixelRatio),b.clear({color:_}),S.disable(S.SCISSOR_TEST)}function Ic(d,n,c){const f=d.context,y=f.gl,_=c.projMatrix,b=d.useProgram("debug"),S=n.getTileByID(c.key);d.terrain&&d.terrain.setupElevationDraw(S,b);const k=h.DepthMode.disabled,L=h.StencilMode.disabled,O=d.colorModeForRenderPass(),U="$debug";f.activeTexture.set(y.TEXTURE0),d.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),b.draw(f,y.LINE_STRIP,k,L,O,h.CullFaceMode.disabled,Yo(_,h.Color.red),U,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments);const q=S.latestRawTileData,$=Math.floor((q&&q.byteLength||0)/1024),Y=n.getTile(c).tileSize,Q=512/Math.min(Y,512)*(c.overscaledZ/d.transform.zoom)*.5;let le=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(le+=` => ${c.overscaledZ}`),function(W,J){W.initDebugOverlayCanvas();const re=W.debugOverlayCanvas,ue=W.context.gl,te=W.debugOverlayCanvas.getContext("2d");te.clearRect(0,0,re.width,re.height),te.shadowColor="white",te.shadowBlur=2,te.lineWidth=1.5,te.strokeStyle="white",te.textBaseline="top",te.font="bold 36px Open Sans, sans-serif",te.fillText(J,5,5),te.strokeText(J,5,5),W.debugOverlayTexture.update(re),W.debugOverlayTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}(d,`${le} ${$}kb`),b.draw(f,y.TRIANGLES,k,L,h.ColorMode.alphaBlended,h.CullFaceMode.disabled,Yo(_,h.Color.transparent,Q),U,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}const lu=h.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$l}=lu;function Hr(d,n,c,f){d.emplaceBack(n,c,f)}class ea{constructor(n){this.vertexArray=new h.StructArrayLayout3f12,this.indices=new h.StructArrayLayout3ui6,Hr(this.vertexArray,-1,-1,1),Hr(this.vertexArray,1,-1,1),Hr(this.vertexArray,-1,1,1),Hr(this.vertexArray,1,1,1),Hr(this.vertexArray,-1,-1,-1),Hr(this.vertexArray,1,-1,-1),Hr(this.vertexArray,-1,1,-1),Hr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,$l),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=h.SegmentVector.simpleSegment(0,0,36,12)}}function Fr(d,n,c,f,y,_){const b=d.gl,S=n.paint.get("sky-atmosphere-color"),k=n.paint.get("sky-atmosphere-halo-color"),L=n.paint.get("sky-atmosphere-sun-intensity"),O={u_matrix_3f:h.fromMat4([],f),u_sun_direction:y,u_sun_intensity:L,u_color_tint_r:[(Y=S).r,Y.g,Y.b,Y.a],u_color_tint_m:[(Q=k).r,Q.g,Q.b,Q.a],u_luminance:5e-5};var Y,Q;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+_,n.skyboxTexture,0),c.draw(d,b.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.frontCW,O,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Ra={symbol:function(d,n,c,f,y){if("translucent"!==d.renderPass)return;const _=h.StencilMode.disabled,b=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(S,k,L,O,U,q,$){const Y=k.transform,Q="map"===U,le="map"===q;for(const W of S){const J=O.getTile(W),re=J.getBucket(L);if(!re||!re.text||!re.text.segments.get().length)continue;const ue=h.evaluateSizeForZoom(re.textSizeData,Y.zoom),te=qt(J,1,k.transform.zoom),ee=St(W.projMatrix,le,Q,k.transform,te),Ae="none"!==L.layout.get("icon-text-fit")&&re.hasIconData();if(ue){const De=Math.pow(2,Y.zoom-J.tileID.overscaledZ),Le=Y.elevation;hl(re,Q,le,$,h.symbolSize,Y,ee,W.projMatrix,De,ue,Ae,Le?se=>Le.getAtTileOffset(W,se.x,se.y):se=>0)}}}(f,d,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),0!==c.paint.get("icon-opacity").constantOr(1)&&Hs(d,n,c,f,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),_,b),0!==c.paint.get("text-opacity").constantOr(1)&&Hs(d,n,c,f,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),_,b),n.map.showCollisionBoxes&&(Qo(d,n,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Qo(d,n,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,c,f){if("translucent"!==d.renderPass)return;const y=c.paint.get("circle-opacity"),_=c.paint.get("circle-stroke-width"),b=c.paint.get("circle-stroke-opacity"),S=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===_.constantOr(1)||0===b.constantOr(1)))return;const k=d.context,L=k.gl,O=d.depthModeForSublayer(0,h.DepthMode.ReadOnly),U=h.StencilMode.disabled,q=d.colorModeForRenderPass(),$=[];for(let Y=0;Y<f.length;Y++){const Q=f[Y],le=n.getTile(Q),W=le.getBucket(c);if(!W)continue;const J=W.programConfigurations.get(c.id),re=bo(c),ue={programConfiguration:J,program:d.useProgram("circle",J,re),layoutVertexBuffer:W.layoutVertexBuffer,indexBuffer:W.indexBuffer,uniformValues:Ai(d,Q,le,c),tile:le};if(S){const te=W.segments.get();for(const ee of te)$.push({segments:new h.SegmentVector([ee]),sortKey:ee.sortKey,state:ue})}else $.push({segments:W.segments,sortKey:0,state:ue})}S&&$.sort((Y,Q)=>Y.sortKey-Q.sortKey);for(const Y of $){const{programConfiguration:Q,program:le,layoutVertexBuffer:W,indexBuffer:J,uniformValues:re,tile:ue}=Y.state,te=Y.segments;d.terrain&&d.terrain.setupElevationDraw(ue,le,{useDepthForOcclusion:!0}),d.prepareDrawProgram(k,le,ue.tileID.toUnwrapped()),le.draw(k,L.TRIANGLES,O,U,q,h.CullFaceMode.disabled,re,c.id,W,J,te,c.paint,d.transform.zoom,Q)}},heatmap:function(d,n,c,f){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===d.renderPass){const y=d.context,_=y.gl,b=h.StencilMode.disabled,S=new h.ColorMode([_.ONE,_.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(k,L,O){const U=k.gl;k.activeTexture.set(U.TEXTURE1),k.viewport.set([0,0,L.width/4,L.height/4]);let q=O.heatmapFbo;if(q)U.bindTexture(U.TEXTURE_2D,q.colorAttachment.get()),k.bindFramebuffer.set(q.framebuffer);else{const $=U.createTexture();U.bindTexture(U.TEXTURE_2D,$),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),q=O.heatmapFbo=k.createFramebuffer(L.width/4,L.height/4,!1),function(Y,Q,le,W){const J=Y.gl;J.texImage2D(J.TEXTURE_2D,0,J.RGBA,Q.width/4,Q.height/4,0,J.RGBA,Y.extRenderToTextureHalfFloat?Y.extTextureHalfFloat.HALF_FLOAT_OES:J.UNSIGNED_BYTE,null),W.colorAttachment.set(le)}(k,L,$,q)}})(y,d,c),y.clear({color:h.Color.transparent});for(let k=0;k<f.length;k++){const L=f[k];if(n.hasRenderableParent(L))continue;const O=n.getTile(L),U=O.getBucket(c);if(!U)continue;const q=U.programConfigurations.get(c.id),$=d.useProgram("heatmap",q),{zoom:Y}=d.transform;d.terrain&&d.terrain.setupElevationDraw(O,$),d.prepareDrawProgram(y,$,L.toUnwrapped()),$.draw(y,_.TRIANGLES,h.DepthMode.disabled,b,S,h.CullFaceMode.disabled,ql(L.projMatrix,O,Y,c.paint.get("heatmap-intensity")),c.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,c.paint,d.transform.zoom,q)}y.viewport.set([0,0,d.width,d.height])}else"translucent"===d.renderPass&&(d.context.setColorMode(d.colorModeForRenderPass()),function(y,_){const b=y.context,S=b.gl,k=_.heatmapFbo;if(!k)return;b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get()),b.activeTexture.set(S.TEXTURE1);let L=_.colorRampTexture;L||(L=_.colorRampTexture=new h.Texture(b,_.colorRamp,S.RGBA)),L.bind(S.LINEAR,S.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(b,S.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,y.colorModeForRenderPass(),h.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:_.paint.get("heatmap-opacity")},_.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,_.paint,y.transform.zoom)}(d,c))},line:function(d,n,c,f){if("translucent"!==d.renderPass)return;const y=c.paint.get("line-opacity"),_=c.paint.get("line-width");if(0===y.constantOr(1)||0===_.constantOr(1))return;const b=d.depthModeForSublayer(0,h.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),k=c.paint.get("line-dasharray"),L=k.constantOr(1),O=c.layout.get("line-cap"),U=c.paint.get("line-pattern"),q=U.constantOr(1),$=c.paint.get("line-gradient"),Y=c.getCrossfadeParameters(),Q=q?"linePattern":L?"lineSDF":$?"lineGradient":"line",le=d.context,W=le.gl;for(const J of f){const re=n.getTile(J);if(q&&!re.patternsLoaded())continue;const ue=re.getBucket(c);if(!ue)continue;d.prepareDrawTile(J);const te=ue.programConfigurations.get(c.id),ee=d.useProgram(Q,te),Ae=U.constantOr(null);if(Ae&&re.imageAtlas){const Ne=re.imageAtlas,nt=Ne.patternPositions[Ae.to.toString()],Ye=Ne.patternPositions[Ae.from.toString()];nt&&Ye&&te.setConstantPatternPositions(nt,Ye)}const De=k.constantOr(null),Le=O.constantOr(null);if(!q&&De&&Le&&re.lineAtlas){const Ne=re.lineAtlas,nt=Ne.getDash(De.to,Le),Ye=Ne.getDash(De.from,Le);nt&&Ye&&te.setConstantPatternPositions(nt,Ye)}const se=d.terrain?J.projMatrix:null,We=q?Cs(d,re,c,Y,se):L?Ws(d,re,c,Y,se):$?ul(d,re,c,se,ue.lineClipsArray.length):ka(d,re,c,se);if(q)le.activeTexture.set(W.TEXTURE0),re.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),te.updatePaintBuffers(Y);else if(L)le.activeTexture.set(W.TEXTURE0),re.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),te.updatePaintBuffers(Y);else if($){const Ne=ue.gradients[c.id];let nt=Ne.texture;if(c.gradientVersion!==Ne.version){let Ye=256;if(c.stepInterpolant){const Xe=n.getSource().maxzoom,wt=J.canonical.z===Xe?Math.ceil(1<<d.transform.maxZoom-J.canonical.z):1;Ye=h.clamp(h.nextPowerOfTwo(ue.maxLineLength/h.EXTENT*1024*wt),256,le.maxTextureSize)}Ne.gradient=h.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ye,image:Ne.gradient||void 0,clips:ue.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new h.Texture(le,Ne.gradient,W.RGBA),Ne.version=c.gradientVersion,nt=Ne.texture}le.activeTexture.set(W.TEXTURE0),nt.bind(c.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}d.prepareDrawProgram(le,ee,J.toUnwrapped()),ee.draw(le,W.TRIANGLES,b,d.stencilModeForClipping(J),S,h.CullFaceMode.disabled,We,c.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,c.paint,d.transform.zoom,te,ue.layoutVertexBuffer2)}},fill:function(d,n,c,f){const y=c.paint.get("fill-color"),_=c.paint.get("fill-opacity");if(0===_.constantOr(1))return;const b=d.colorModeForRenderPass(),S=c.paint.get("fill-pattern"),k=d.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===y.constantOr(h.Color.transparent).a&&1===_.constantOr(0)?"opaque":"translucent";if(d.renderPass===k){const L=d.depthModeForSublayer(1,"opaque"===d.renderPass?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly);Ks(d,n,c,f,L,b,!1)}if("translucent"===d.renderPass&&c.paint.get("fill-antialias")){const L=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,h.DepthMode.ReadOnly);Ks(d,n,c,f,L,b,!0)}},"fill-extrusion":function(d,n,c,f){const y=c.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===d.renderPass){const _=new h.DepthMode(d.context.gl.LEQUAL,h.DepthMode.ReadWrite,d.depthRangeFor3D);if(1!==y||c.paint.get("fill-extrusion-pattern").constantOr(1))Wr(d,n,c,f,_,h.StencilMode.disabled,h.ColorMode.disabled),Wr(d,n,c,f,_,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const b=d.colorModeForRenderPass();Wr(d,n,c,f,_,h.StencilMode.disabled,b)}}},hillshade:function(d,n,c,f){if("offscreen"!==d.renderPass&&"translucent"!==d.renderPass)return;const y=d.context,_=d.depthModeForSublayer(0,h.DepthMode.ReadOnly),b=d.colorModeForRenderPass(),S=d.terrain&&d.terrain.renderingToTexture,[k,L]="translucent"!==d.renderPass||S?[{},f]:d.stencilConfigForOverlap(f);for(const O of L){const U=n.getTile(O);if(U.needsHillshadePrepare&&"offscreen"===d.renderPass)Es(d,U,c,_,h.StencilMode.disabled,b);else if("translucent"===d.renderPass){const q=S&&d.terrain?d.terrain.stencilModeForRTTOverlap(O):k[O.overscaledZ];ll(d,O,U,c,_,q,b)}}y.viewport.set([0,0,d.width,d.height])},raster:function(d,n,c,f,y,_){if("translucent"!==d.renderPass||0===c.paint.get("raster-opacity")||!f.length)return;const b=d.context,S=b.gl,k=n.getSource(),L=d.useProgram("raster"),O=d.colorModeForRenderPass(),U=d.terrain&&d.terrain.renderingToTexture,[q,$]=k instanceof H||U?[{},f]:d.stencilConfigForOverlap(f),Y=$[$.length-1].overscaledZ,Q=!d.options.moving;for(const le of $){const W=U?h.DepthMode.disabled:d.depthModeForSublayer(le.overscaledZ-Y,1===c.paint.get("raster-opacity")?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly,S.LESS),J=le.toUnwrapped(),re=n.getTile(le);if(U&&(!re||!re.hasData()))continue;const ue=U?le.projMatrix:d.transform.calculateProjMatrix(J,Q),te=d.terrain&&U?d.terrain.stencilModeForRTTOverlap(le):q[le.overscaledZ],ee=_?0:c.paint.get("raster-fade-duration");re.registerFadeDuration(ee);const Ae=n.findLoadedParent(le,0),De=Ss(re,Ae,n,d.transform,ee);let Le,se;d.terrain&&d.terrain.prepareDrawTile(le);const We="nearest"===c.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;b.activeTexture.set(S.TEXTURE0),re.texture.bind(We,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(S.TEXTURE1),Ae?(Ae.texture.bind(We,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),Le=Math.pow(2,Ae.tileID.overscaledZ-re.tileID.overscaledZ),se=[re.tileID.canonical.x*Le%1,re.tileID.canonical.y*Le%1]):re.texture.bind(We,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);const Ne=Gl(ue,se||[0,0],Le||1,De,c);d.prepareDrawProgram(b,L,J),k instanceof H?L.draw(b,S.TRIANGLES,W,h.StencilMode.disabled,O,h.CullFaceMode.disabled,Ne,c.id,k.boundsBuffer,d.quadTriangleIndexBuffer,k.boundsSegments):L.draw(b,S.TRIANGLES,W,te,O,h.CullFaceMode.disabled,Ne,c.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,n,c,f){const y=c.paint.get("background-color"),_=c.paint.get("background-opacity");if(0===_)return;const b=d.context,S=b.gl,k=d.transform,L=k.tileSize,O=c.paint.get("background-pattern");if(d.isPatternMissing(O))return;const U=!O&&1===y.a&&1===_&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==U)return;const q=h.StencilMode.disabled,$=d.depthModeForSublayer(0,"opaque"===U?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly),Y=d.colorModeForRenderPass(),Q=d.useProgram(O?"backgroundPattern":"background"),le=f||k.coveringTiles({tileSize:L});O&&(b.activeTexture.set(S.TEXTURE0),d.imageManager.bind(d.context));const W=c.getCrossfadeParameters();for(const J of le){const re=J.toUnwrapped(),ue=f?J.projMatrix:d.transform.calculateProjMatrix(re);d.prepareDrawTile(J);const te=O?au(ue,_,d,O,{tileID:J,tileSize:L},W):Ec(ue,_,y);d.prepareDrawProgram(b,Q,re),Q.draw(b,S.TRIANGLES,$,q,Y,h.CullFaceMode.disabled,te,c.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}},sky:function(d,n,c){const f=c.paint.get("sky-opacity");if(0===f)return;const y=d.context,_=c.paint.get("sky-type"),b=new h.DepthMode(y.gl.LEQUAL,h.DepthMode.ReadOnly,[0,1]),S=d.frameCounter/1e3%1;"atmosphere"===_?"offscreen"===d.renderPass?c.needsSkyboxCapture(d)&&(function(k,L,O,U){const q=k.context,$=q.gl;let Y=L.skyboxFbo;if(!Y){Y=L.skyboxFbo=q.createFramebuffer(32,32,!1),L.skyboxGeometry=new ea(q),L.skyboxTexture=q.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,L.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let J=0;J<6;++J)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Y.framebuffer),q.viewport.set([0,0,32,32]);const Q=L.getCenter(k,!0),le=k.useProgram("skyboxCapture"),W=new Float64Array(16);h.identity(W),h.rotateY(W,W,.5*-Math.PI),Fr(q,L,le,W,Q,0),h.identity(W),h.rotateY(W,W,.5*Math.PI),Fr(q,L,le,W,Q,1),h.identity(W),h.rotateX(W,W,.5*-Math.PI),Fr(q,L,le,W,Q,2),h.identity(W),h.rotateX(W,W,.5*Math.PI),Fr(q,L,le,W,Q,3),h.identity(W),Fr(q,L,le,W,Q,4),h.identity(W),h.rotateY(W,W,Math.PI),Fr(q,L,le,W,Q,5),q.viewport.set([0,0,k.width,k.height])}(d,c),c.markSkyboxValid(d)):"sky"===d.renderPass&&function(k,L,O,U,q){const $=k.context,Y=$.gl,Q=k.transform,le=k.useProgram("skybox");$.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,L.skyboxTexture);const W={u_matrix:Q.skyboxMatrix,u_sun_direction:L.getCenter(k,!1),u_cubemap:0,u_opacity:U,u_temporal_offset:q};k.prepareDrawProgram($,le),le.draw($,Y.TRIANGLES,O,h.StencilMode.disabled,k.colorModeForRenderPass(),h.CullFaceMode.backCW,W,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,c,b,f,S):"gradient"===_&&"sky"===d.renderPass&&function(k,L,O,U,q){const $=k.context,Y=$.gl,Q=k.transform,le=k.useProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new ea($)),$.activeTexture.set(Y.TEXTURE0);let W=L.colorRampTexture;W||(W=L.colorRampTexture=new h.Texture($,L.colorRamp,Y.RGBA)),W.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const J=(re=Q.skyboxMatrix,ue=L.getCenter(k,!1),te=L.paint.get("sky-gradient-radius"),ee=U,Ae=q,{u_matrix:re,u_color_ramp:0,u_center_direction:ue,u_radius:h.degToRad(te),u_opacity:ee,u_temporal_offset:Ae});var re,ue,te,ee,Ae;k.prepareDrawProgram($,le),le.draw($,Y.TRIANGLES,O,h.StencilMode.disabled,k.colorModeForRenderPass(),h.CullFaceMode.backCW,J,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,c,b,f,S)},debug:function(d,n,c){for(let f=0;f<c.length;f++)Ic(d,n,c[f])},custom:function(d,n,c){const f=d.context,y=c.implementation;if("offscreen"===d.renderPass){const _=y.prerender;_&&(d.setCustomLayerDefaults(),f.setColorMode(d.colorModeForRenderPass()),_.call(y,f.gl,d.transform.customLayerMatrix()),f.setDirty(),d.setBaseState())}else if("translucent"===d.renderPass){d.setCustomLayerDefaults(),f.setColorMode(d.colorModeForRenderPass()),f.setStencilMode(h.StencilMode.disabled);const _="3d"===y.renderingMode?new h.DepthMode(d.context.gl.LEQUAL,h.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,h.DepthMode.ReadOnly);f.setDepthMode(_),y.render(f.gl,d.transform.customLayerMatrix()),f.setDirty(),d.setBaseState(),f.bindFramebuffer.set(null)}}};class Fa{constructor(n,c){this.context=new Si(n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=h.SourceCache.maxUnderzooming+h.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Aa,this.gpuTimers={},this.frameCounter=0}updateTerrain(n,c){const f=!!n&&!!n.terrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Is(this,n));const y=this._terrain;this.transform.elevation=f?y:null,y.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,y]=c.getFovAdjustedRange(this.transform._fov);if(f>y)return void(this.transform.fogCullDistSq=null);const _=f+.78*(y-f);this.transform.fogCullDistSq=_*_}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*h.exported.devicePixelRatio,this.height=c*h.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const n=this.context,c=new h.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(h.EXTENT,0),c.emplaceBack(0,h.EXTENT),c.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,h.posAttributes.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const f=new h.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(h.EXTENT,0),f.emplaceBack(0,h.EXTENT),f.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=n.createVertexBuffer(f,h.posAttributes.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const y=new h.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(h.EXTENT,0,h.EXTENT,0),y.emplaceBack(0,h.EXTENT,0,h.EXTENT),y.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(y,Dr.members),this.rasterBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const _=new h.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,h.posAttributes.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const b=new h.StructArrayLayout1ui2;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(b);const S=new h.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(S),this.emptyTexture=new h.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA),this.identityMat=h.create$1();const k=this.context.gl;this.stencilClearMode=new h.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(h.window.performance.now())}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(n,c.TRIANGLES,h.DepthMode.disabled,this.stencilClearMode,h.ColorMode.disabled,h.CullFaceMode.disabled,_o(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,c,f){if(!(c&&this.currentStencilSource!==c.id&&n.isTileClipped()&&f&&f.length))return;this.currentStencilSource=c.id;const y=this.context,_=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(h.ColorMode.disabled),y.setDepthMode(h.DepthMode.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of f){const k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++;b.draw(y,_.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:_.ALWAYS,mask:0},k,255,_.KEEP,_.KEEP,_.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,_o(S.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new h.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new h.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,f=n.sort((b,S)=>S.overscaledZ-b.overscaledZ),y=f[f.length-1].overscaledZ,_=f[0].overscaledZ-y+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const b={};for(let S=0;S<_;S++)b[S+y]=new h.StencilMode({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=_,[b,f]}return[{[y]:h.StencilMode.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new h.ColorMode([n.CONSTANT_COLOR,n.ONE],new h.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?h.ColorMode.unblended:h.ColorMode.alphaBlended}depthModeForSublayer(n,c,f){if(!this.opaquePassEnabledForLayer())return h.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new h.DepthMode(f||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const f=this.style.order,y=this.style._sourceCaches;for(const L in y){const O=y[L];O.used&&O.prepare(this.context)}const _={},b={},S={};for(const L in y){const O=y[L];_[L]=O.getVisibleCoordinates(),b[L]=_[L].slice().reverse(),S[L]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<f.length;L++)if(this.style._layers[f[L]].is3D()){this.opaquePassCutoff=L;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),!h.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const L of f){const O=this.style._layers[L],U=n._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const q=U?b[U.id]:void 0;("custom"===O.type||O.isSky()||q&&q.length)&&this.renderLayer(this,U,O,q)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let k=h.Color.transparent;if(this.style.fog&&(k=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?h.Color.black:k,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[f[this.currentLayer]],O=n._getLayerSourceCache(L);if(L.isSky())continue;const U=O?b[O.id]:void 0;this._renderTileClippingMasks(L,O,U),this.renderLayer(this,O,L,U)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const L=this.style._layers[f[this.currentLayer]],O=n._getLayerSourceCache(L);L.isSky()&&this.renderLayer(this,O,L,O?b[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const L=this.style._layers[f[this.currentLayer]],O=n._getLayerSourceCache(L);if(L.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(L)){if(L.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const U=O?("symbol"===L.type?S:b)[O.id]:void 0;this._renderTileClippingMasks(L,O,O?_[O.id]:void 0),this.renderLayer(this,O,L,U),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let L=null;h.values(this.style._layers).forEach(O=>{const U=n._getLayerSourceCache(O);U&&!O.isHidden(this.transform.zoom)&&(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U)}),L&&this.options.showTileBoundaries&&Ra.debug(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const O=L.transform.padding;Jo(L,L.transform.height-(O.top||0),3,Io),Jo(L,O.bottom||0,3,Zt),Vn(L,O.left||0,3,za),Vn(L,L.transform.width-(O.right||0),3,Ao);const U=L.transform.centerPoint;var q,$,Y,Q;La(q=L,($=U.x)-1,(Y=L.transform.height-U.y)-10,2,20,Q=Co),La(q,$-10,Y-1,20,2,Q)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%h.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(h.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,c,f,y){f.isHidden(this.transform.zoom)||("background"===f.type||"sky"===f.type||"custom"===f.type||y&&y.length)&&(this.id=f.id,this.gpuTimingStart(f),Ra[f.type](n,c,f,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let f=this.gpuTimers[n.id];f||(f=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),f.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,f.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const c={};for(const f in n){const y=n[f],_=this.context.extTimerQuery,b=_.getQueryObjectEXT(y.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(y.query),c[f]=b}return c}translatePosMatrix(n,c,f,y,_){if(!f[0]&&!f[1])return n;const b=_?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(b){const L=Math.sin(b),O=Math.cos(b);f=[f[0]*O-f[1]*L,f[0]*L+f[1]*O]}const S=[_?f[0]:qt(c,f[0],this.transform.zoom),_?f[1]:qt(c,f[1],this.transform.zoom),0],k=new Float32Array(16);return h.translate(k,n,S),k}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const c=this.imageManager.getPattern(n.from.toString()),f=this.imageManager.getPattern(n.to.toString());return!c||!f}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,f=[];return this.terrain&&!this.terrain.renderingToTexture&&f.push("TERRAIN"),c&&!n&&0!==c.getOpacity(this.transform.pitch)&&f.push("FOG"),n&&f.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&f.push("OVERDRAW_INSPECTOR"),f}useProgram(n,c,f){this.cache=this.cache||{};const y=f||[],_=this.currentGlobalDefines().concat(y),b=vo.cacheKey(n,_,c);return this.cache[b]||(this.cache[b]=new vo(this.context,n,Wo[n],c,Sc[n],_)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=h.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(n){this.terrain&&this.terrain.prepareDrawTile(n)}prepareDrawProgram(n,c,f){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const _=y.getOpacity(this.transform.pitch);0!==_&&c.setFogUniformValues(n,((b,S,k,L)=>{const O=S.properties.get("color"),U=b.frameCounter/1e3%1,q=[O.r/O.a,O.g/O.a,O.b/O.a,L];return{u_fog_matrix:k?b.transform.calculateFogTileMatrix(k):b.identityMat,u_fog_range:S.getFovAdjustedRange(b.transform._fov),u_fog_color:q,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:U}})(this,y,f,_))}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}}class ko{constructor(n=0,c=0,f=0,y=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=f,this.right=y}interpolate(n,c,f){return null!=c.top&&null!=n.top&&(this.top=h.number(n.top,c.top,f)),null!=c.bottom&&null!=n.bottom&&(this.bottom=h.number(n.bottom,c.bottom,f)),null!=c.left&&null!=n.left&&(this.left=h.number(n.left,c.left,f)),null!=c.right&&null!=n.right&&(this.right=h.number(n.right,c.right,f)),this}getCenter(n,c){const f=h.clamp((this.left+n-this.right)/2,0,n),y=h.clamp((this.top+c-this.bottom)/2,0,c);return new h.pointGeometry(f,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new ko(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ni(d,n){return[d[4*n],d[4*n+1],d[4*n+2],d[4*n+3]]}function vr(d,n,c){d[4*n+0]=c[0],d[4*n+1]=c[1],d[4*n+2]=c[2],d[4*n+3]=c[3]}function dl(d,n){const c=Ni(d,3);h.fromQuat(d,n),vr(d,3,c)}function Ba(d,n){vr(d,3,[n[0],n[1],n[2],1])}function Ys(d,n){const c=h.identity$1([]);return h.rotateZ$1(c,c,-n),h.rotateX$1(c,c,-d),c}function Ms(d,n){const c=[d[0],d[1],0],f=[n[0],n[1],0];if(h.length(c)>=1e-15){const b=h.normalize([],c);h.scale(f,b,h.dot(f,b)),n[0]=f[0],n[1]=f[1]}const y=h.cross([],n,d);if(h.len(y)<1e-15)return null;const _=Math.atan2(-y[1],y[0]);return Ys(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),_)}class Mo{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){this._position=this._renderWorldCopies?function(c){if(!c)return;const f=Array.isArray(c)?new h.MercatorCoordinate(c[0],c[1],c[2]):c;return f.x=h.wrap(f.x,0,1),f}(n):n}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const f=this._elevation?this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(n)):0,y=this.position,_=h.MercatorCoordinate.fromLngLat(n,f),b=[_.x-y.x,_.y-y.y,_.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Ms(b,c)}setPitchBearing(n,c){this.orientation=Ys(h.degToRad(n),h.degToRad(-c))}}class Qs{constructor(n,c){this._transform=h.identity([]),this._orientation=h.identity$1([]),c&&(this._orientation=c,dl(this._transform,this._orientation)),n&&Ba(this._transform,n)}get mercatorPosition(){const n=this.position;return new h.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=Ni(this._transform,3);return[n[0],n[1],n[2]]}set position(n){Ba(this._transform,n)}get orientation(){return this._orientation}set orientation(n){this._orientation=n,dl(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=Ys(n,c),dl(this._transform,this._orientation)}forward(){const n=Ni(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=Ni(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=Ni(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const f=new Float64Array(16);return h.invert(f,this.getWorldToCamera(n,c)),f}getWorldToCameraPosition(n,c,f){const y=this.position;h.scale(y,y,-n);const _=new Float64Array(16);return h.fromScaling(_,[f,f,f]),h.translate(_,_,y),_[10]*=c,_}getWorldToCamera(n,c){const f=new Float64Array(16),y=new Float64Array(4),_=this.position;return h.conjugate(y,this._orientation),h.scale(_,_,-n),h.fromQuat(f,y),h.translate(f,f,_),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(n,c,f,y){const _=new Float64Array(16);return h.perspective(_,n,c,f,y),_}getDistanceToElevation(n){const c=0===n?0:h.mercatorZfromAltitude(n,this.position[1]),f=this.forward();return(c-this.position[2])/f[2]}clone(){return new Qs([...this.position],[...this.orientation])}}class pl{constructor(n,c,f,y,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===_||_,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=null==f?0:f,this._maxPitch=null==y?60:y,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ko,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new Qs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const n=new pl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._cameraZoom=this._cameraZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,n?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(n){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),n&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return h.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(n){const c=-h.wrap(n,-180,180)*Math.PI/180;var f,y,_,b,S,k,L,O,U,q;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(f=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),y=this.rotationMatrix,b=this.angle,S=(_=this.rotationMatrix)[0],k=_[1],L=_[2],O=_[3],U=Math.sin(b),q=Math.cos(b),y[0]=S*q+L*U,y[1]=k*q+O*U,y[2]=S*-U+L*q,y[3]=k*-U+O*q)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=h.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const n=this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(this.center),-1);return-1===n?(this._cameraZoom=null,!1):(this._centerAltitude=n,!0)}_updateCameraOnTerrain(){const n=this.cameraToCenterDistance/this.worldSize,c=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(c+n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let y=0,_=0;for(let b=0;b<c.length;b++){const S=new h.pointGeometry(c[b][0]*this.width,f+c[b][1]*(this.height-f)),k=n.pointCoordinate(S);if(!k)continue;const L=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);y+=k[3]*L,_+=L}return 0===_?NaN:y/_}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const n=this._cameraZoom,c=this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(this.center)),f=h.mercatorZfromAltitude(c,this.center.lat),y=this._mercatorZfromZoom(n),_=this._mercatorZfromZoom(this._maxZoom),b=Math.max(y-f,_);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const y=h.length(h.sub([],this._camera.position,f));return h.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!h.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];h.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new Mo;return c.position=new h.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this._renderWorldCopies,c}_setCameraOrientation(n){if(!h.length$1(n))return!1;h.normalize$1(n,n);const c=h.transformQuat([],[0,0,-1],n),f=h.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const y=Ms(c,f);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=h.clamp(n[2],y/f,y/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,f){this._unmodified=!1,this._edgeInsets.interpolate(n,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new h.UnwrappedTileID(0,n)];if(this._renderWorldCopies){const f=this.pointCoordinate(new h.pointGeometry(0,0)),y=this.pointCoordinate(new h.pointGeometry(this.width,0)),_=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new h.pointGeometry(0,this.height)),S=Math.floor(Math.min(f.x,y.x,_.x,b.x)),k=Math.floor(Math.max(f.x,y.x,_.x,b.x)),L=1;for(let O=S-L;O<=k+L;O++)0!==O&&c.push(new h.UnwrappedTileID(O,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const f=c,y=this.elevation&&!n.isTerrainDEM;if(void 0!==n.minzoom&&c<n.minzoom)return[];void 0!==n.maxzoom&&c>n.maxzoom&&(c=n.maxzoom);const _=h.MercatorCoordinate.fromLngLat(this.center),b=1<<c,S=[b*_.x,b*_.y,0],k=pr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),L=this.pointCoordinate(this.getCameraPoint()),O=b*h.mercatorZfromAltitude(1,this.center.lat),U=this._camera.position[2]/h.mercatorZfromAltitude(1,this.center.lat),q=[b*L.x,b*L.y,U],$=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),Y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?c:0,Q=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=n.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,W=se=>({aabb:new Me([se*b,0,le],[(se+1)*b,b,Q]),zoom:0,x:0,y:0,wrap:se,fullyVisible:!1}),J=[],re=[],ue=c,te=n.reparseOverscaled?f:c,ee=se=>{if(!this._elevation||!se.tileID)return;const We=this._elevation.getMinMaxForTile(se.tileID),Ne=se.aabb;We?(Ne.min[2]=We.min,Ne.max[2]=We.max,Ne.center[2]=(Ne.min[2]+Ne.max[2])/2):(se.shouldSplit=Le(se),se.shouldSplit||(Ne.min[2]=Ne.max[2]=Ne.center[2]=this._centerAltitude))},Ae=se=>se*se,De=Ae((U-this._centerAltitude)*O),Le=se=>{if(se.zoom<Y)return!0;if(se.zoom===ue)return!1;if(null!=se.shouldSplit)return se.shouldSplit;const We=se.aabb.distanceX(q),Ne=se.aabb.distanceY(q);let nt=De;y&&(nt=Ae(se.aabb.distanceZ(q)*O));const Ye=We*We+Ne*Ne+nt;return Ye<Ae((1<<ue-se.zoom)*$*((Xe,wt)=>{if(wt*Ae(.707)<Xe)return 1;const ft=Math.sqrt(wt/Xe);return ft/(1.4144271570014144+(Math.pow(1.1,ft-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(nt,De),Ye))};if(this._renderWorldCopies)for(let se=1;se<=3;se++)J.push(W(-se)),J.push(W(se));for(J.push(W(0));J.length>0;){const se=J.pop(),We=se.x,Ne=se.y;let nt=se.fullyVisible;if(!nt){const Ye=se.aabb.intersects(k);if(0===Ye)continue;nt=2===Ye}if(se.zoom!==ue&&Le(se))for(let Ye=0;Ye<4;Ye++){const Xe=(We<<1)+Ye%2,wt=(Ne<<1)+(Ye>>1),ft={aabb:se.aabb.quadrant(Ye),zoom:se.zoom+1,x:Xe,y:wt,wrap:se.wrap,fullyVisible:nt,tileID:void 0,shouldSplit:void 0};y&&(ft.tileID=new h.OverscaledTileID(se.zoom+1===ue?te:se.zoom+1,se.wrap,se.zoom+1,Xe,wt),ee(ft)),J.push(ft)}else{const Ye=se.zoom===ue?te:se.zoom;if(n.minzoom&&n.minzoom>Ye)continue;const Xe=S[0]-(.5+We+(se.wrap<<se.zoom))*(1<<c-se.zoom),wt=S[1]-.5-Ne,ft=se.tileID?se.tileID:new h.OverscaledTileID(Ye,se.wrap,se.zoom,We,Ne);re.push({tileID:ft,distanceSq:Xe*Xe+wt*wt})}}if(this.fogCullDistSq){const se=this.fogCullDistSq;re.splice(0,re.length,...re.filter(We=>{const Ne=[0,0,0,1],nt=[h.EXTENT,h.EXTENT,0,1],Ye=this.calculateFogTileMatrix(We.tileID.toUnwrapped());h.transformMat4(Ne,Ne,Ye),h.transformMat4(nt,nt,Ye);const Xe=h.getAABBPointSquareDist(Ne,nt);if(0===Xe)return!0;let wt=!1;const ft=this.horizonLineFromTop();if(Xe>se&&0!==ft){const Kt=this.calculateProjMatrix(We.tileID.toUnwrapped());let _n;y&&this._elevation&&(_n=this._elevation.getMinMaxForTile(We.tileID)),_n||(_n={min:le,max:Q});const vn=h.furthestTileCorner(this.bearing),Ft=[vn[0]*h.EXTENT,vn[1]*h.EXTENT,_n.max];h.transformMat4$1(Ft,Ft,Kt),wt=(1-Ft[1])*this.height*.5<ft}return Xe<se||wt}))}return re.sort((se,We)=>se.distanceSq-We.distanceSq).map(se=>se.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=h.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new h.pointGeometry(h.mercatorXfromLng(n.lng)*this.worldSize,h.mercatorYfromLat(c)*this.worldSize)}unproject(n){return new h.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(n,c){const f=this.pointCoordinate(c),y=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(n),b=new h.MercatorCoordinate(_.x-(f.x-y.x),_.y-(f.y-y.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(n){this.center=this.coordinateLocation(n),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(n){return this._coordinatePoint(this.locationCoordinate(n),!1)}locationPoint3D(n){return this._coordinatePoint(this.locationCoordinate(n),!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n){return h.MercatorCoordinate.fromLngLat(n)}coordinateLocation(n){return n.toLngLat()}pointRayIntersection(n,c){const f=null!=c?c:this._centerAltitude,y=[n.x,n.y,0,1],_=[n.x,n.y,1,1];h.transformMat4(y,y,this.pixelMatrixInverse),h.transformMat4(_,_,this.pixelMatrixInverse);const b=_[3];h.scale$2(y,y,1/y[3]),h.scale$2(_,_,1/b);const S=y[2],k=_[2];return{p0:y,p1:_,t:S===k?0:(f-S)/(k-S)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return h.transformMat4(c,c,this.pixelMatrixInverse),h.transformMat4(f,f,this.pixelMatrixInverse),h.scale$2(c,c,1/c[3]),h.scale$2(f,f,1/f[3]),c[2]=h.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,f[2]=h.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,h.scale$2(c,c,1/this.worldSize),h.scale$2(f,f,1/this.worldSize),new kn([c[0],c[1],c[2]],h.normalize([],h.sub([],f,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:f,t:y}=n,_=h.mercatorZfromAltitude(c[2],this._center.lat),b=h.mercatorZfromAltitude(f[2],this._center.lat);return new h.MercatorCoordinate(h.number(c[0],f[0],y)/this.worldSize,h.number(c[1],f[1],y)/this.worldSize,h.number(_,b,y))}pointCoordinate(n){const c=this.horizonLineFromTop(!1),f=new h.pointGeometry(n.x,Math.max(c,n.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(f))}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);const c=this.elevation;let f=this.elevation.pointCoordinate(n);if(f)return new h.MercatorCoordinate(f[0],f[1],f[2]);let y=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const b=.02*_,S=n.clone();for(let k=0;k<10&&_-y>b;k++){S.y=h.number(y,_,.66);const L=c.pointCoordinate(S);L?(_=S.y,f=L):y=S.y}return f?new h.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){if(this.elevation)return!this.elevation.pointCoordinate(n);{const c=this.horizonLineFromTop();return n.y<c}}_coordinatePoint(n,c){const f=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return h.transformMat4(y,y,this.pixelMatrix),y[3]>0?new h.pointGeometry(y[0]/y[3],y[1]/y[3]):new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():(new h.LngLatBounds).extend(this.pointLocation(new h.pointGeometry(this._edgeInsets.left,this._edgeInsets.top))).extend(this.pointLocation(new h.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top))).extend(this.pointLocation(new h.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom))).extend(this.pointLocation(new h.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom)))}_getBounds3D(){const n=this.elevation,c=n.visibleDemTiles.reduce((y,_)=>{if(_.dem){const b=_.dem.tree;y.min=Math.min(y.min,b.minimums[0]),y.max=Math.max(y.max,b.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});c.min*=n.exaggeration(),c.max*=n.exaggeration();const f=this.horizonLineFromTop();return[new h.pointGeometry(0,f),new h.pointGeometry(this.width,f),new h.pointGeometry(this.width,this.height),new h.pointGeometry(0,this.height)].reduce((y,_)=>y.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(_,c.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(_,c.max)))),new h.LngLatBounds)}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-.97*c;return n?Math.max(0,f):f}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new h.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(n,c){const f=n.canonical,y=c/this.zoomScale(f.z),_=f.x+Math.pow(2,f.z)*n.wrap,b=h.identity(new Float64Array(16));return h.translate(b,b,[_*y,f.y*y,0]),h.scale$1(b,b,[y/h.EXTENT,y/h.EXTENT,1]),b}calculateFogTileMatrix(n){const c=n.key,f=this._fogTileMatrixCache;if(f[c])return f[c];const y=this.calculatePosMatrix(n,this.cameraWorldSize);return h.multiply(y,this.worldToFogMatrix,y),f[c]=new Float32Array(y),f[c]}calculateProjMatrix(n,c=!1){const f=n.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[f])return y[f];const _=this.calculatePosMatrix(n,this.worldSize);return h.multiply(_,c?this.alignedProjMatrix:this.projMatrix,_),y[f]=new Float32Array(_),y[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=this._camera.position,f=this._camera.forward();if(c[2]<=0||f[2]>=0)return;const y=h.mercatorZfromAltitude(1,this._center.lat);c[2]/=y,f[2]/=y,h.normalize(f,f);const _=n.raycast(c,f,n.exaggeration());if(_){const b=h.scaleAndAdd([],c,f,_),S=new h.MercatorCoordinate(b[0],b[1],h.mercatorZfromAltitude(b[2],h.latFromMercatorY(b[1]))),k=this._camera.position,L=S.z+h.length([S.x-k[0],S.y-k[1],S.z-k[2]]);this._cameraZoom=this._zoomFromMercatorZ(L),this._centerAltitude=S.toAltitude(),this._center=S.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=n.getAtPointOrZero(this._camera.mercatorPosition),f=this._minimumHeightOverTerrain()*Math.cos(h.degToRad(this._maxPitch)),y=h.mercatorZfromAltitude(c,this._center.lat),_=this._camera.position[2]-y;if(_<f){const b=h.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),S=this._camera.mercatorPosition,k=[b.x-S.x,b.y-S.y,b.z-S.z],L=h.length(k);k[2]-=f-_;const O=h.length(k);if(0===O)return;h.scale(k,k,L/O),this._camera.position=[b.x-k[0],b.y-k[1],b.z-k[2]],this._camera.orientation=Ms(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let n,c,f,y,_=-90,b=90,S=-180,k=180;const L=this.size,O=this._unmodified;if(this.latRange){const $=this.latRange;_=h.mercatorYfromLat($[1])*this.worldSize,b=h.mercatorYfromLat($[0])*this.worldSize,n=b-_<L.y?L.y/(b-_):0}if(this.lngRange){const $=this.lngRange;S=h.mercatorXfromLng($[0])*this.worldSize,k=h.mercatorXfromLng($[1])*this.worldSize,c=k-S<L.x?L.x/(k-S):0}const U=this.point,q=Math.max(c||0,n||0);if(q)return this.center=this.unproject(new h.pointGeometry(c?(k+S)/2:U.x,n?(b+_)/2:U.y)),this.zoom+=this.scaleZoom(q),this._unmodified=O,void(this._constraining=!1);if(this.latRange){const $=U.y,Y=L.y/2;$-Y<_&&(y=_+Y),$+Y>b&&(y=b-Y)}if(this.lngRange){const $=U.x,Y=L.x/2;$-Y<S&&(f=S+Y),$+Y>k&&(f=k-Y)}void 0===f&&void 0===y||(this.center=this.unproject(new h.pointGeometry(void 0!==f?f:U.x,void 0!==y?y:U.y))),this._constrainCameraAltitude(),this._unmodified=O,this._constraining=!1}_minZoomForBounds(){const n=(y,_)=>Math.log2(y/(this.tileSize*Math.abs(_[1]-_[0])));let c=0;if(this.latRange){const y=this.latRange;c=n(this.height,[h.mercatorYfromLat(y[0]),h.mercatorYfromLat(y[1])])}let f=0;if(this.lngRange){const y=this.lngRange;f=n(this.width,[h.mercatorXfromLng(y[0]),h.mercatorXfromLng(y[1])])}return Math.max(c,f)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const c=this.pixelsPerMeter;this._updateCameraState();const f=Math.PI/2+this._pitch,y=this.fovAboveCenter,_=this.elevation?this.elevation.getMinElevationBelowMSL()*c:0,b=(this._camera.position[2]*this.worldSize-_)/Math.cos(this._pitch),S=Math.sin(y)*b/Math.sin(h.clamp(Math.PI-f-y,.01,Math.PI-.01)),k=this.point,L=k.x,O=k.y,U=Math.cos(Math.PI/2-this._pitch)*S+b,q=Math.min(1.01*U,b*(1/this._horizonShift)),$=this.height/50,Y=this._camera.getWorldToCamera(this.worldSize,c),Q=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,$,q);Q[8]=2*-n.x/this.width,Q[9]=2*n.y/this.height;let le=h.mul$1([],Q,Y);this.mercatorMatrix=h.scale$1([],le,[this.worldSize,this.worldSize,this.worldSize/c]),this.projMatrix=le,this.invProjMatrix=h.invert(new Float64Array(16),this.projMatrix);const W=new Float32Array(16);h.identity(W),h.scale$1(W,W,[1,-1,1]),h.rotateX(W,W,this._pitch),h.rotateZ(W,W,this.angle);const J=h.perspective(new Float32Array(16),this._fov,this.width/this.height,$,q),re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;J[8]=2*-n.x/this.width,J[9]=2*(n.y+re)/this.height,this.skyboxMatrix=h.multiply(W,J,W);const ue=this.width%2/2,te=this.height%2/2,ee=Math.cos(this.angle),Ae=Math.sin(this.angle),De=L-Math.round(L)+ee*ue+Ae*te,Le=O-Math.round(O)+ee*te+Ae*ue,se=new Float64Array(le);if(h.translate(se,se,[De>.5?De-1:De,Le>.5?Le-1:Le,0]),this.alignedProjMatrix=se,le=h.create$1(),h.scale$1(le,le,[this.width/2,-this.height/2,1]),h.translate(le,le,[1,-1,0]),this.labelPlaneMatrix=le,le=h.create$1(),h.scale$1(le,le,[1,-1,1]),h.translate(le,le,[-1,-1,0]),h.scale$1(le,le,[2/this.width,2/this.height,1]),this.glCoordMatrix=le,this.pixelMatrix=h.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),le=h.invert(new Float64Array(16),this.pixelMatrix),!le)throw new Error("failed to invert matrix");this.pixelMatrixInverse=le,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,c=this.cameraPixelsPerMeter,f=this._camera.position,y=1/this.height,_=[n,n,c];h.scale(_,_,y),h.scale(f,f,-1),h.multiply$1(f,f,_);const b=h.create$1();h.translate(b,b,f),h.scale$1(b,b,_),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,y)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const n=this._camera.forward(),c=this.cameraToCenterDistance,f=this.point,y=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-h.mercatorZfromAltitude(this._centerAltitude,this.center.lat),_=this.cameraToCenterDistance/y;this._camera.position=[f.x/this.worldSize-n[0]*c/_,f.y/this.worldSize-n[1]*c/_,h.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-n[2]*c/_]}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=n[2];let y=1;f>0&&(y=Math.min((c-this._camera.position[2])/f,1)),this._camera.position=h.scaleAndAdd([],this._camera.position,n,y),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:y}=this._camera.getPitchBearing(),_=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat),b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.degToRad(this._maxPitch)),S=Math.max((n[2]-_)/Math.cos(f),b),k=this._zoomFromMercatorZ(S);h.scaleAndAdd(n,n,c,S),this._pitch=h.clamp(f,h.degToRad(this.minPitch),h.degToRad(this.maxPitch)),this.angle=h.wrap(y,-Math.PI,Math.PI),this._setZoom(h.clamp(k,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new h.MercatorCoordinate(n[0],n[1],n[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(n,c){const f=Math.min(n.x,c.x),y=Math.max(n.x,c.x),_=Math.min(n.y,c.y),b=Math.max(n.y,c.y),S=[new h.pointGeometry(f,_),new h.pointGeometry(y,b),new h.pointGeometry(f,b),new h.pointGeometry(y,_)],k=this._renderWorldCopies?-3:0,L=this._renderWorldCopies?4:1;for(const O of S){const U=this.pointRayIntersection(O);if(U.t<0)return!0;const q=this.rayIntersectionCoordinate(U);if(q.x<k||q.y<0||q.x>L||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new h.pointGeometry(0,0),new h.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,c){const f=h.length(h.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(y)}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,n))}}function Po(d,n){let c=!1,f=null;const y=()=>{f=null,c&&(d(),f=setTimeout(y,n),c=!1)};return()=>(c=!0,f||y(),f)}class fl{constructor(n){this._hashName=n&&encodeURIComponent(n),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Po(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,h.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return h.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const c=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,y=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,y),b=Math.round(c.lng*_)/_,S=Math.round(c.lat*_)/_,k=this._map.getBearing(),L=this._map.getPitch();let O="";if(O+=n?`/${b}/${S}/${f}`:`${f}/${S}/${b}`,(k||L)&&(O+="/"+Math.round(10*k)/10),L&&(O+=`/${Math.round(L)}`),this._hashName){const U=this._hashName;let q=!1;const $=h.window.location.hash.slice(1).split("&").map(Y=>{const Q=Y.split("=")[0];return Q===U?(q=!0,`${Q}=${O}`):Y}).filter(Y=>Y);return q||$.push(`${U}=${O}`),`#${$.join("&")}`}return`#${O}`}_getCurrentHash(){const n=h.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:c,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=h.window.location.href.replace(/(#.+)?$/,this.getHashString());h.window.history.replaceState(h.window.history.state,null,n)}}const ta={linearity:.3,easing:h.bezier(0,0,.3,1)},na=h.extend({deceleration:2500,maxSpeed:1400},ta),Ps=h.extend({deceleration:20,maxSpeed:1400},ta),Js=h.extend({deceleration:1e3,maxSpeed:360},ta),Ds=h.extend({deceleration:1e3,maxSpeed:90},ta);class C{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=h.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)c.zoom+=_.zoomDelta||0,c.bearing+=_.bearingDelta||0,c.pitch+=_.pitchDelta||0,_.panDelta&&c.pan._add(_.panDelta),_.around&&(c.around=_.around),_.pinchAround&&(c.pinchAround=_.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const _=V(c.pan.mag(),f,h.extend({},na,n||{}));y.offset=c.pan.mult(_.amount/c.pan.mag()),y.center=this._map.transform.center,A(y,_)}if(c.zoom){const _=V(c.zoom,f,Ps);y.zoom=this._map.transform.zoom+_.amount,A(y,_)}if(c.bearing){const _=V(c.bearing,f,Js);y.bearing=this._map.transform.bearing+h.clamp(_.amount,-179,179),A(y,_)}if(c.pitch){const _=V(c.pitch,f,Ds);y.pitch=this._map.transform.pitch+_.amount,A(y,_)}if(y.zoom||y.bearing){const _=void 0===c.pinchAround?c.around:c.pinchAround;y.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),h.extend(y,{noMoveStart:!0})}}function A(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function V(d,n,c){const{maxSpeed:f,linearity:y,deceleration:_}=c,b=h.clamp(d*y/(n/1e3),-f,f),S=Math.abs(b)/(_*y);return{easing:c.easing,duration:1e3*S,amount:b*(S/2)}}class ce extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,f,y={}){const _=ae.mousePos(c.getCanvasContainer(),f),b=c.unproject(_);super(n,h.extend({point:_,lngLat:b,originalEvent:f},y)),this._defaultPrevented=!1,this.target=c}}class Ue extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,f){const y="touchend"===n?f.changedTouches:f.touches,_=ae.touchPos(c.getCanvasContainer(),y),b=_.map(k=>c.unproject(k)),S=_.reduce((k,L,O,U)=>k.add(L.div(U.length)),new h.pointGeometry(0,0));super(n,{points:_,point:S,lngLats:b,lngLat:c.unproject(S),originalEvent:f}),this._defaultPrevented=!1}}class yt extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class fn{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new yt(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new ce(n.type,this._map,n))}mouseup(n){this._map.fire(new ce(n.type,this._map,n))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new ce(n.type,this._map,n))}dblclick(n){return this._firePreventable(new ce(n.type,this._map,n))}mouseover(n){this._map.fire(new ce(n.type,this._map,n))}mouseout(n){this._map.fire(new ce(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ue(n.type,this._map,n))}touchmove(n){this._map.fire(new Ue(n.type,this._map,n))}touchend(n){this._map.fire(new Ue(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ue(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ai{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new ce(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ce("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new ce(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ci{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&0===n.button&&(ae.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const f=c;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=f,this._box||(this._box=ae.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const _=Math.min(y.x,f.x),b=Math.max(y.x,f.x),S=Math.min(y.y,f.y),k=Math.max(y.y,f.y);this._map._requestDomTask(()=>{this._box&&(ae.setTransform(this._box,`translate(${_}px,${S}px)`),this._box.style.width=b-_+"px",this._box.style.height=k-S+"px")})}mouseupWindow(n,c){if(!this._active||0!==n.button)return;const f=this._startPos,y=c;if(this.reset(),ae.suppressClick(),f.x!==y.x||f.y!==y.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:_=>_.fitScreenCoordinates(f,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ae.remove(this._box),this._box=null),ae.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new h.Event(n,{originalEvent:c}))}}function ls(d,n){const c={};for(let f=0;f<d.length;f++)c[d[f].identifier]=n[f];return c}class Oa{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(y){const _=new h.pointGeometry(0,0);for(const b of y)_._add(b);return _.div(y.length)}(c),this.touches=ls(f,c)))}touchmove(n,c,f){if(this.aborted||!this.centroid)return;const y=ls(f,c);for(const _ in this.touches){const b=this.touches[_],S=y[_];(!S||S.dist(b)>30)&&(this.aborted=!0)}}touchend(n,c,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===f.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Na{constructor(n){this.singleTap=new Oa(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,c,f){this.singleTap.touchstart(n,c,f)}touchmove(n,c,f){this.singleTap.touchmove(n,c,f)}touchend(n,c,f){const y=this.singleTap.touchend(n,c,f);if(y){const _=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(y)<30;if(_&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Br{constructor(){this._zoomIn=new Na({numTouches:1,numTaps:2}),this._zoomOut=new Na({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,f){this._zoomIn.touchstart(n,c,f),this._zoomOut.touchstart(n,c,f)}touchmove(n,c,f){this._zoomIn.touchmove(n,c,f),this._zoomOut.touchmove(n,c,f)}touchend(n,c,f){const y=this._zoomIn.touchend(n,c,f),_=this._zoomOut.touchend(n,c,f);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(y)},{originalEvent:n})}):_?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(_)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const cu={0:1,2:2};class Ui{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const f=ae.mouseButton(n);this._correctButton(n,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(n,c){const f=this._lastPoint;if(f)if(n.preventDefault(),function(y,_){const b=cu[_];return void 0===y.buttons||(y.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}mouseupWindow(n){this._lastPoint&&ae.mouseButton(n)===this._eventButton&&(this._moved&&ae.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ml extends Ui{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return 0===c&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class eo extends Ui{_correctButton(n,c){return 0===c&&n.ctrlKey||2===c}_move(n,c){const f=.8*(c.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class uu extends Ui{_correctButton(n,c){return 0===c&&n.ctrlKey||2===c}_move(n,c){const f=-.5*(c.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class to{constructor(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(n,c,f){return this._calculateTransform(n,c,f)}touchmove(n,c,f){if(this._active&&!(f.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,c,f)}touchend(n,c,f){this._calculateTransform(n,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,f){f.length>0&&(this._active=!0);const y=ls(f,c),_=new h.pointGeometry(0,0),b=new h.pointGeometry(0,0);let S=0;for(const L in y){const O=y[L],U=this._touches[L];U&&(_._add(O),b._add(O.sub(U)),S++,y[L]=O)}if(this._touches=y,S<this._minTouches||!b.mag())return;const k=b.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ia{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,c,f){return{}}touchstart(n,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,f){if(!this._firstTwoTouches)return;n.preventDefault();const[y,_]=this._firstTwoTouches,b=Ac(f,c,y),S=Ac(f,c,_);if(!b||!S)return;const k=this._aroundCenter?null:b.add(S).div(2);return this._move([b,S],k,n)}touchend(n,c,f){if(!this._firstTwoTouches)return;const[y,_]=this._firstTwoTouches,b=Ac(f,c,y),S=Ac(f,c,_);b&&S||(this._active&&ae.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ac(d,n,c){for(let f=0;f<d.length;f++)if(d[f].identifier===c)return n[f]}function hu(d,n){return Math.log(d/n)/Math.LN2}class id extends ia{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(hu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hu(this._distance,f),pinchAround:c}}}function Zl(d,n){return 180*d.angleWith(n)/Math.PI}class ih extends ia{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const f=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Zl(this._vector,f),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,f=Zl(n,this._startVector);return Math.abs(f)<c}}function ra(d){return Math.abs(d.y)>Math.abs(d.x)}class Mn extends ia{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,ra(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,f){const y=n[0].sub(this._lastPoints[0]),_=n[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(y,_,f.timeStamp),this._valid)return this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+_.y)/2*-.5}}gestureBeginsVertically(n,c,f){if(void 0!==this._valid)return this._valid;const y=n.mag()>=2,_=c.mag()>=2;if(!y&&!_)return;if(!y||!_)return void 0===this._firstMove&&(this._firstMove=f),f-this._firstMove<100&&void 0;const b=n.y>0==c.y>0;return ra(n)&&ra(c)&&b}}const Ua={panStep:100,bearingStep:15,pitchStep:10};class Do{constructor(){const n=Ua;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,f=0,y=0,_=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),_=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),_=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,y=0),{cameraAnimation:S=>{const k=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Va,zoom:c?Math.round(k)+c*(n.shiftKey?2:1):k,bearing:S.getBearing()+f*this._bearingStep,pitch:S.getPitch()+y*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:S.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Va(d){return d*(2-d)}const rt=4.000244140625;class Je{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&"center"===n.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(n){if(!this.isEnabled())return;let c=n.deltaMode===h.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=h.exported.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,0!==c&&c%rt==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ae.mousePos(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,c=()=>n._terrainEnabled()?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>rt?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==L&&(L=1/L);const O=c(),U=Math.pow(2,O),q="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*L))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const f="number"==typeof this._targetZoom?this._targetZoom:c(),y=this._startZoom,_=this._easing;let b,S=!1;if("wheel"===this._type&&y&&_){const k=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),L=_(k);b=h.number(y,f,L),k<1?this._frameId||(this._frameId=!0):S=!0}else b=f,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:b-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=h.ease;if(this._prevEase){const f=this._prevEase,y=(h.exported.now()-f.start)/f.duration,_=f.easing(y+.01)-f.easing(y),b=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-b*b);c=h.bezier(b,S,.25,1)}return this._prevEase={start:h.exported.now(),duration:n,easing:c},c}reset(){this._active=!1}}class li{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zo{constructor(){this.reset()}reset(){this._active=!1}dblclick(n,c){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qa{constructor(){this._tap=new Na({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,c,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,c,f))}touchmove(n,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const y=c[0],_=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(n,c,f)}touchend(n,c,f){this._tapTime?this._swipePoint&&0===f.length&&this.reset():this._tap.touchend(n,c,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dt{constructor(n,c,f){this._el=n,this._mousePan=c,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class It{constructor(n,c,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rh{constructor(n,c,f,y){this._el=n,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const tt=d=>d.zoom||d.drag||d.pitch||d.rotate;class Ce extends h.Event{}class Ze{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const f=h.sub([],c,n);this.radius=h.length(f[2]<0?h.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){h.div(n,n,this.constants),h.normalize(n,n),h.mul$2(n,n,this.constants);const c=h.scale([],n,this.radius);if(c[2]>0){const f=h.scale([],[0,0,1],h.dot(c,[0,0,1])),y=h.scale([],h.normalize([],[c[0],c[1],0]),this.radius),_=h.add([],c,h.scale([],h.sub([],h.add([],y,f),c),2));c[0]=_[0],c[1]=_[1]}return c}}function Qn(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Wl{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new C(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ze,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),h.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[h.window.document,"mousemove",{capture:!0}],[h.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[h.window,"blur",void 0]];for(const[y,_,b]of this._listeners)ae.addEventListener(y,_,y===h.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[n,c,f]of this._listeners)ae.removeEventListener(n,c,n===h.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(n){const c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new fn(c,n));const y=c.boxZoom=new Ci(c,n);this._add("boxZoom",y);const _=new Br,b=new zo;c.doubleClickZoom=new li(b,_),this._add("tapZoom",_),this._add("clickZoom",b);const S=new qa;this._add("tapDragZoom",S);const k=c.touchPitch=new Mn;this._add("touchPitch",k);const L=new eo(n),O=new uu(n);c.dragRotate=new It(n,L,O),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const U=new ml(n),q=new to(n);c.dragPan=new dt(f,U,q),this._add("mousePan",U),this._add("touchPan",q,["touchZoom","touchRotate"]);const $=new ih,Y=new id;c.touchZoomRotate=new rh(f,Y,$,S),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ai(c));const Q=c.scrollZoom=new Je(c,this);this._add("scrollZoom",Q,["mousePan"]);const le=c.keyboard=new Do;this._add("keyboard",le);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[W]&&c[W].enable(n[W])}_add(n,c,f){this._handlers.push({handlerName:n,handler:c,allowed:f}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(tt(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,c,f){for(const y in n)if(y!==f&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const f of n)this._el.contains(f.target)&&c.push(f);return c}handleEvent(n,c){if("blur"===n.type)return void this.stop(!0);this._updatingCamera=!0;const f="renderFrame"===n.type,y=f?void 0:n,_={needsRenderFrame:!1},b={},S={},k=n.touches?this._getMapTouches(n.touches):void 0,L=k?ae.touchPos(this._el,k):f?void 0:ae.mousePos(this._el,n);for(const{handlerName:q,handler:$,allowed:Y}of this._handlers){if(!$.isEnabled())continue;let Q;this._blockedByActive(S,Y,q)?$.reset():$[c||n.type]&&(Q=$[c||n.type](n,L,k),this.mergeHandlerResult(_,b,Q,q,y),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||$.isActive())&&(S[q]=$)}const O={};for(const q in this._previousActiveHandlers)S[q]||(O[q]=y);this._previousActiveHandlers=S,(Object.keys(O).length||Qn(_))&&(this._changes.push([_,b,O]),this._triggerRenderFrame()),(Object.keys(S).length||Qn(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=_;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(n,c,f,y,_){if(!f)return;h.extend(n,f);const b={handlerName:y,originalEvent:f.originalEvent||_};void 0!==f.zoomDelta&&(c.zoom=b),void 0!==f.panDelta&&(c.drag=b),void 0!==f.pitchDelta&&(c.pitch=b),void 0!==f.bearingDelta&&(c.rotate=b)}_applyChanges(){const n={},c={},f={};for(const[y,_,b]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new h.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(n.around=y.around),void 0!==y.aroundCoord&&(n.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),h.extend(c,_),h.extend(f,b);this._updateMapTransform(n,c,f),this._changes=[]}_updateMapTransform(n,c,f){const y=this._map,_=y.transform,b=J=>[J.x,J.y,J.z];if((J=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Qn(n)){const J=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",J!==_.zoom&&this._map._update(!0)}if(!Qn(n))return this._fireEvents(c,f,!0);let{panDelta:S,zoomDelta:k,bearingDelta:L,pitchDelta:O,around:U,aroundCoord:q,pinchAround:$}=n;void 0!==$&&(U=$),(J=>c.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=b(_.pointCoordinate3D(U)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",y._stop(!0),U=U||y.transform.centerPoint,L&&(_.bearing+=L),O&&(_.pitch+=O),_._updateCameraState();const Y=[0,0,0];if(S){const J=_.screenPointToMercatorRay(U),re=_.screenPointToMercatorRay(U.sub(S)),ue=this._trackingEllipsoid.projectRay(J.dir),te=this._trackingEllipsoid.projectRay(re.dir);Y[0]=te[0]-ue[0],Y[1]=te[1]-ue[1]}const Q=_.zoom,le=[0,0,0];if(k){const J=b(q||_.pointCoordinate3D(U)),re={dir:h.normalize([],h.sub([],J,_._camera.position))},ue=_.screenPointToMercatorRay(_.centerPoint);if(re.dir[2]<0){const te=h.altitudeFromMercatorZ(J[2],J[1]),ee=_.rayIntersectionCoordinate(_.pointRayIntersection(_.centerPoint,te)),Ae=_.zoomDeltaToMovement(b(ee),k)*(ue.dir[2]/re.dir[2]);h.scale(le,re.dir,Ae)}else if(_._terrainEnabled()){const te=_.zoomDeltaToMovement(J,k);h.scale(le,re.dir,te)}}const W=h.add(Y,Y,le);_._translateCameraConstrained(W),k&&Math.abs(_.zoom-Q)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,f,!0)}_fireEvents(n,c,f){const y=tt(this._eventsInProgress),_=tt(n),b={};for(const O in n){const{originalEvent:U}=n[O];this._eventsInProgress[O]||(b[`${O}start`]=U),this._eventsInProgress[O]=n[O]}!y&&_&&this._fireEvent("movestart",_.originalEvent);for(const O in b)this._fireEvent(O,b[O]);_&&this._fireEvent("move",_.originalEvent);for(const O in n){const{originalEvent:U}=n[O];this._fireEvent(O,U)}const S={};let k;for(const O in this._eventsInProgress){const{handlerName:U,originalEvent:q}=this._eventsInProgress[O];this._handlersById[U].isActive()||(delete this._eventsInProgress[O],k=c[U]||q,S[`${O}end`]=k)}for(const O in S)this._fireEvent(O,S[O]);const L=tt(this._eventsInProgress);if(f&&(y||_)&&!L){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=q=>0!==q&&-this._bearingSnap<q&&q<this._bearingSnap;O?(U(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:k})):(this._map.fire(new h.Event("moveend",{originalEvent:k})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new h.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Ce("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class du extends h.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,f){return n=h.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,h.extend({offset:n},c),f)}panTo(n,c,f){return this.easeTo(h.extend({center:n},c),f)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,f){return this.easeTo(h.extend({zoom:n},c),f)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,f){return this.easeTo(h.extend({bearing:n},c),f)}resetNorth(n,c){return this.rotateTo(0,h.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=h.LngLatBounds.convert(n);const f=c&&c.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),f,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=h.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const f=n.padding;n.padding={top:f,bottom:f,right:f,left:f}}return n.padding=h.extend(c,n.padding),n}_cameraForBoxAndBearing(n,c,f,y){const _=this._extendCameraOptions(y),b=this.transform,S=b.padding,k=b.project(h.LngLat.convert(n)),L=b.project(h.LngLat.convert(c)),O=k.rotate(-h.degToRad(f)),U=L.rotate(-h.degToRad(f)),q=new h.pointGeometry(Math.max(O.x,U.x),Math.max(O.y,U.y)),$=new h.pointGeometry(Math.min(O.x,U.x),Math.min(O.y,U.y)),Y=q.sub($),Q=(b.width-(S.left+S.right+_.padding.left+_.padding.right))/Y.x,le=(b.height-(S.top+S.bottom+_.padding.top+_.padding.bottom))/Y.y;if(le<0||Q<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const W=Math.min(b.scaleZoom(b.scale*Math.min(Q,le)),_.maxZoom),J="number"==typeof _.offset.x?new h.pointGeometry(_.offset.x,_.offset.y):h.pointGeometry.convert(_.offset),re=new h.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(f*Math.PI/180),ue=J.add(re).mult(b.scale/b.zoomScale(W));return{center:b.unproject(k.add(L).div(2).sub(ue)),zoom:W,bearing:f}}_cameraForBox(n,c,f,y,_){const b=this._extendCameraOptions(_);f=f||0,y=y||0,n=h.LngLat.convert(n),c=h.LngLat.convert(c);const S=this.transform.clone();S.padding=b.padding;const k=this.getFreeCameraOptions(),L=new h.LngLat(.5*(n.lng+c.lng),.5*(n.lat+c.lat)),O=.5*(f+y);if(S._camera.position[2]<h.mercatorZfromAltitude(O,L.lat))return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");k.lookAtPoint(L),S.setFreeCameraOptions(k);const U=h.MercatorCoordinate.fromLngLat(n),q=h.MercatorCoordinate.fromLngLat(c),$=S.pointRayIntersection(S.centerPoint,O),Y=[(Q=S.rayIntersectionCoordinate($)).x,Q.y,Q.z];var Q;const le=S.screenPointToMercatorRay(S.centerPoint);let W,J=0;do{const re=Math.floor(S.zoom),ue=1<<re,te=Math.min(ue*U.x,ue*q.x),ee=Math.min(ue*U.y,ue*q.y),Ae=Math.max(ue*U.x,ue*q.x),De=Math.max(ue*U.y,ue*q.y),Le=new Me([te,ee,f],[Ae,De,y]),se=pr.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,re);if(2!==Le.intersects(se)){W&&(S._camera.position=h.scaleAndAdd([],S._camera.position,le.dir,-W),S._updateStateFromCamera());break}const We=h.sub([],S._camera.position,Y);W=.5*h.length(We),S._camera.position=h.scaleAndAdd([],S._camera.position,le.dir,W);try{S._updateStateFromCamera()}catch(Ne){return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++J<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(n,c,f){return this._fitInternal(this.cameraForBounds(n,c),c,f)}_raycastElevationBox(n,c){const f=this.transform.elevation;if(!f)return;const y=new h.pointGeometry(n.x,c.y),_=new h.pointGeometry(c.x,n.y),b=f.pointCoordinate(n);if(!b)return;const S=f.pointCoordinate(c);if(!S)return;const k=f.pointCoordinate(y);if(!k)return;const L=f.pointCoordinate(_);if(!L)return;const O=new h.MercatorCoordinate(b[0],b[1]).toLngLat(),U=new h.MercatorCoordinate(S[0],S[1]).toLngLat(),q=new h.MercatorCoordinate(k[0],k[1]).toLngLat(),$=new h.MercatorCoordinate(L[0],L[1]).toLngLat(),Y=Math.min(O.lng,Math.min(U.lng,Math.min(q.lng,$.lng))),Q=Math.min(O.lat,Math.min(U.lat,Math.min(q.lat,$.lat))),le=Math.max(O.lng,Math.max(U.lng,Math.max(q.lng,$.lng))),W=Math.max(O.lat,Math.max(U.lat,Math.max(q.lat,$.lat))),J=Math.min(b[3],Math.min(S[3],Math.min(k[3],L[3]))),re=Math.max(b[3],Math.max(S[3],Math.max(k[3],L[3])));return{minLngLat:new h.LngLat(Y,Q),maxLngLat:new h.LngLat(le,W),minAltitude:J,maxAltitude:re}}fitScreenCoordinates(n,c,f,y,_){let b,S,k,L;const O=h.pointGeometry.convert(n),U=h.pointGeometry.convert(c),q=this._raycastElevationBox(O,U);if(q)b=q.minLngLat,S=q.maxLngLat,k=q.minAltitude,L=q.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(O,U))return this;b=this.transform.pointLocation(O),S=this.transform.pointLocation(U)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(n)),this.transform.pointLocation(h.pointGeometry.convert(c)),f,y):this._cameraForBox(b,S,k,L,y),y,_)}_fitInternal(n,c,f){return n?(delete(c=h.extend(n,c)).padding,c.linear?this.easeTo(c,f):this.flyTo(c,f)):this}jumpTo(n,c){this.stop();const f=this.transform;let y=!1,_=!1,b=!1;return"zoom"in n&&f.zoom!==+n.zoom&&(y=!0,f.zoom=+n.zoom),void 0!==n.center&&(f.center=h.LngLat.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(_=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(b=!0,f.pitch=+n.pitch),null==n.padding||f.isPaddingEqual(n.padding)||(f.padding=n.padding),this.fire(new h.Event("movestart",c)).fire(new h.Event("move",c)),y&&this.fire(new h.Event("zoomstart",c)).fire(new h.Event("zoom",c)).fire(new h.Event("zoomend",c)),_&&this.fire(new h.Event("rotatestart",c)).fire(new h.Event("rotate",c)).fire(new h.Event("rotateend",c)),b&&this.fire(new h.Event("pitchstart",c)).fire(new h.Event("pitch",c)).fire(new h.Event("pitchend",c)),this.fire(new h.Event("moveend",c))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){this.stop();const f=this.transform,y=f.zoom,_=f.pitch,b=f.bearing;f.setFreeCameraOptions(n);const S=y!==f.zoom,k=_!==f.pitch,L=b!==f.bearing;return this.fire(new h.Event("movestart",c)).fire(new h.Event("move",c)),S&&this.fire(new h.Event("zoomstart",c)).fire(new h.Event("zoom",c)).fire(new h.Event("zoomend",c)),L&&this.fire(new h.Event("rotatestart",c)).fire(new h.Event("rotate",c)).fire(new h.Event("rotateend",c)),k&&this.fire(new h.Event("pitchstart",c)).fire(new h.Event("pitch",c)).fire(new h.Event("pitchend",c)),this.fire(new h.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),(!1===(n=h.extend({offset:[0,0],duration:500,easing:h.ease},n)).animate||!n.essential&&h.exported.prefersReducedMotion)&&(n.duration=0);const f=this.transform,y=this.getZoom(),_=this.getBearing(),b=this.getPitch(),S=this.getPadding(),k="zoom"in n?+n.zoom:y,L="bearing"in n?this._normalizeBearing(n.bearing,_):_,O="pitch"in n?+n.pitch:b,U="padding"in n?n.padding:f.padding,q=h.pointGeometry.convert(n.offset);let $=f.centerPoint.add(q);const Y=f.pointLocation($),Q=h.LngLat.convert(n.center||Y);this._normalizeCenter(Q);const le=f.project(Y),W=f.project(Q).sub(le),J=f.zoomScale(k-y);let re,ue;n.around&&(re=h.LngLat.convert(n.around),ue=f.locationPoint(re));const te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==y,this._rotating=this._rotating||_!==L,this._pitching=this._pitching||O!==b,this._padding=!f.isPaddingEqual(U),this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,te),this._ease(ee=>{if(this._zooming&&(f.zoom=h.number(y,k,ee)),this._rotating&&(f.bearing=h.number(_,L,ee)),this._pitching&&(f.pitch=h.number(b,O,ee)),this._padding&&(f.interpolatePadding(S,U,ee),$=f.centerPoint.add(q)),re)f.setLocationAtPoint(re,ue);else{const Ae=f.zoomScale(f.zoom-y),De=k>y?Math.min(2,J):Math.max(.5,J),Le=Math.pow(De,1-ee),se=f.unproject(le.add(W.mult(ee*Le)).mult(Ae));f.setLocationAtPoint(f.renderWorldCopies?se.wrap():se,$)}this._fireMoveEvents(c)},ee=>{f.recenterOnTerrain(),this._afterEase(c,ee)},n),this}_prepareEase(n,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||f.moving||this.fire(new h.Event("movestart",n)),this._zooming&&!f.zooming&&this.fire(new h.Event("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new h.Event("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new h.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new h.Event("move",n)),this._zooming&&this.fire(new h.Event("zoom",n)),this._rotating&&this.fire(new h.Event("rotate",n)),this._pitching&&this.fire(new h.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const f=this._zooming,y=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new h.Event("zoomend",n)),y&&this.fire(new h.Event("rotateend",n)),_&&this.fire(new h.Event("pitchend",n)),this.fire(new h.Event("moveend",n))}flyTo(n,c){if(!n.essential&&h.exported.prefersReducedMotion){const Xe=h.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xe,c)}this.stop(),n=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},n);const f=this.transform,y=this.getZoom(),_=this.getBearing(),b=this.getPitch(),S=this.getPadding(),k="zoom"in n?h.clamp(+n.zoom,f.minZoom,f.maxZoom):y,L="bearing"in n?this._normalizeBearing(n.bearing,_):_,O="pitch"in n?+n.pitch:b,U="padding"in n?n.padding:f.padding,q=f.zoomScale(k-y),$=h.pointGeometry.convert(n.offset);let Y=f.centerPoint.add($);const Q=f.pointLocation(Y),le=h.LngLat.convert(n.center||Q);this._normalizeCenter(le);const W=f.project(Q),J=f.project(le).sub(W);let re=n.curve;const ue=Math.max(f.width,f.height),te=ue/q,ee=J.mag();if("minZoom"in n){const Xe=h.clamp(Math.min(n.minZoom,y,k),f.minZoom,f.maxZoom),wt=ue/f.zoomScale(Xe-y);re=Math.sqrt(wt/ee*2)}const Ae=re*re;function De(Xe){const wt=(te*te-ue*ue+(Xe?-1:1)*Ae*Ae*ee*ee)/(2*(Xe?te:ue)*Ae*ee);return Math.log(Math.sqrt(wt*wt+1)-wt)}function Le(Xe){return(Math.exp(Xe)-Math.exp(-Xe))/2}function se(Xe){return(Math.exp(Xe)+Math.exp(-Xe))/2}const We=De(0);let Ne=function(Xe){return se(We)/se(We+re*Xe)},nt=function(Xe){return ue*((se(We)*(Le(wt=We+re*Xe)/se(wt))-Le(We))/Ae)/ee;var wt},Ye=(De(1)-We)/re;if(Math.abs(ee)<1e-6||!isFinite(Ye)){if(Math.abs(ue-te)<1e-6)return this.easeTo(n,c);const Xe=te<ue?-1:1;Ye=Math.abs(Math.log(te/ue))/re,nt=function(){return 0},Ne=function(wt){return Math.exp(Xe*re*wt)}}return n.duration="duration"in n?+n.duration:1e3*Ye/("screenSpeed"in n?+n.screenSpeed/re:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=_!==L,this._pitching=O!==b,this._padding=!f.isPaddingEqual(U),this._prepareEase(c,!1),this._ease(Xe=>{const wt=Xe*Ye,ft=1/Ne(wt);f.zoom=1===Xe?k:y+f.scaleZoom(ft),this._rotating&&(f.bearing=h.number(_,L,Xe)),this._pitching&&(f.pitch=h.number(b,O,Xe)),this._padding&&(f.interpolatePadding(S,U,Xe),Y=f.centerPoint.add($));const Kt=1===Xe?le:f.unproject(W.add(J.mult(nt(wt))).mult(ft));f.setLocationAtPoint(f.renderWorldCopies?Kt.wrap():Kt,Y),f._updateCenterElevation(),this._fireMoveEvents(c)},()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,c)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,c,f){!1===f.animate||0===f.duration?(n(1),c()):(this._easeStart=h.exported.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=h.wrap(n,-180,180);const f=Math.abs(n-c);return Math.abs(n-360-c)<f&&(n-=360),Math.abs(n+360-c)<f&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.lngRange)return;const f=n.lng-c.center.lng;n.lng+=f>180?-360:f<-180?360:0}}class Hl{constructor(n={}){this.options=n,h.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ae.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ae.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ae.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const f=this._map._getUIString(`AttributionControl.${c}`);n.title=f,n.setAttribute("aria-label",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.config.ACCESS_TOKEN}];if(n){const f=c.reduce((y,_,b)=>(_.value&&(y+=`${_.key}=${_.value}${b<c.length-1?"&":""}`),y),"?");n.href=`${h.config.FEEDBACK_URL}/${f}${this._map._hash?this._map._hash.getHashString(!0):""}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(y=>"string"!=typeof y?"":y)):"string"==typeof this.options.customAttribution&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const _=c[y];if(_.used){const b=_.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort((y,_)=>y.length-_.length),n=n.filter((y,_)=>{for(let b=_+1;b<n.length;b++)if(n[b].indexOf(y)>=0)return!1;return!0});const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class pu{constructor(){h.bindAll(["_updateLogo"],this),h.bindAll(["_updateCompact"],this)}onAdd(n){this._map=n,this._container=ae.create("div","mapboxgl-ctrl");const c=ae.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ae.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const c in n){const f=n[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class fu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(const y of f)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const f of c)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function mu(d,n,c){if(d=new h.LngLat(d.lng,d.lat),n){const f=new h.LngLat(d.lng-360,d.lat),y=new h.LngLat(d.lng+360,d.lat),_=360*Math.ceil(Math.abs(d.lng-c.center.lng)/360),b=c.locationPoint(d).distSqr(n),S=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(f).distSqr(n)<b&&(S||Math.abs(f.lng-c.center.lng)<_)?d=f:c.locationPoint(y).distSqr(n)<b&&(S||Math.abs(y.lng-c.center.lng)<_)&&(d=y)}for(;Math.abs(d.lng-c.center.lng)>180;){const f=c.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}const lr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gu(d,n,c){const f=d.classList;for(const y in lr)f.remove(`mapboxgl-${c}-anchor-${y}`);f.add(`mapboxgl-${c}-anchor-${n}`)}class Kl extends h.Evented{constructor(n,c){if(super(),(n instanceof h.window.HTMLElement||c)&&(n=h.extend({element:n},c)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=h.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=ae.create("div"),this._element.setAttribute("aria-label","Map marker");const f=ae.createNS("http://www.w3.org/2000/svg","svg"),y=41,_=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${y}px`),f.setAttributeNS(null,"width",`${_}px`),f.setAttributeNS(null,"viewBox",`0 0 ${_} ${y}`);const b=ae.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const S=ae.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const k=ae.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of L){const re=ae.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",J.rx),re.setAttributeNS(null,"ry",J.ry),k.appendChild(re)}const O=ae.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const U=ae.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(U);const q=ae.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const $=ae.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild($);const Y=ae.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const Q=ae.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=ae.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const W=ae.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),Q.appendChild(le),Q.appendChild(W),S.appendChild(k),S.appendChild(O),S.appendChild(q),S.appendChild(Y),S.appendChild(Q),f.appendChild(S),f.setAttributeNS(null,"height",y*this._scale+"px"),f.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(f),this._offset=h.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),gu(this._element,this._anchor,"marker"),this._popup=null}addTo(n){return this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ae.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=h.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const c=38.1,f=13.5,y=Math.sqrt(Math.pow(f,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[y,-1*(c-f+y)],"bottom-right":[-y,-1*(c-f+y)],left:[f,-1*(c-f)],right:[-f,-1*(c-f)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(n){const c=n.code,f=n.charCode||n.keyCode;"Space"!==c&&"Enter"!==c&&32!==f&&13!==f||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?n.remove():n.addTo(this._map),this):this}_evaluateOpacity(){const n=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(n))return void this._clearFadeTimer();const c=this._map.unproject(n);let f=!1;if(this._map.getTerrain()){const _=this._map.getFreeCameraOptions();if(_.position){const b=_.position.toLngLat();f=b.distanceTo(c)<.9*b.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(c))*(f?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(n){const c=this._map.transform;return!!n&&n.x>=0&&n.x<c.width&&n.y>=0&&n.y<c.height}_update(n){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=mu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let c="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?c=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?f="rotateX(0deg)":"map"===this._pitchAlignment&&(f=`rotateX(${this._map.getPitch()}deg)`),n&&"moveend"!==n.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ae.setTransform(this._element,`${lr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${c}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const n=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(n.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(n._pitch)),c}getOffset(){return this._offset}setOffset(n){return this._offset=h.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&"auto"!==n?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Ht{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=h.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,f){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+f}}const sa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:gl,HTMLElement:ki,ImageBitmap:kt}=h.window,yu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function zs(d){d.parentNode&&d.parentNode.removeChild(d)}const _u={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ga{constructor(n,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new eo({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new uu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ae.addEventListener(c,"mousedown",this.mousedown),ae.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),ae.addEventListener(c,"touchmove",this.touchmove),ae.addEventListener(c,"touchend",this.touchend),ae.addEventListener(c,"touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),ae.disableDrag()}move(n,c){const f=this.map,y=this.mouseRotate.mousemoveWindow(n,c);if(y&&y.bearingDelta&&f.setBearing(f.getBearing()+y.bearingDelta),this.mousePitch){const _=this.mousePitch.mousemoveWindow(n,c);_&&_.pitchDelta&&f.setPitch(f.getPitch()+_.pitchDelta)}}off(){const n=this.element;ae.removeEventListener(n,"mousedown",this.mousedown),ae.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),ae.removeEventListener(n,"touchmove",this.touchmove),ae.removeEventListener(n,"touchend",this.touchend),ae.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){ae.enableDrag(),ae.removeEventListener(h.window,"mousemove",this.mousemove),ae.removeEventListener(h.window,"mouseup",this.mouseup)}mousedown(n){this.down(h.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ae.mousePos(this.element,n)),ae.addEventListener(h.window,"mousemove",this.mousemove),ae.addEventListener(h.window,"mouseup",this.mouseup)}mousemove(n){this.move(n,ae.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=ae.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=ae.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const an={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let oa,Jn=0,cs=!1;const rd={maxWidth:100,unit:"metric"};function Mi(d,n,c){const f=c&&c.maxWidth||100,y=d._container.clientHeight/2,_=d.unproject([0,y]),b=d.unproject([f,y]),S=_.distanceTo(b);if(c&&"imperial"===c.unit){const k=3.2808*S;k>5280?ja(n,f,k/5280,d._getUIString("ScaleControl.Miles"),d):ja(n,f,k,d._getUIString("ScaleControl.Feet"),d)}else c&&"nautical"===c.unit?ja(n,f,S/1852,d._getUIString("ScaleControl.NauticalMiles"),d):S>=1e3?ja(n,f,S/1e3,d._getUIString("ScaleControl.Kilometers"),d):ja(n,f,S,d._getUIString("ScaleControl.Meters"),d)}function ja(d,n,c,f,y){const _=function(S){const k=Math.pow(10,`${Math.floor(S)}`.length-1);let L=S/k;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(O){const U=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*U)/U}(L),k*L}(c),b=_/c;y._requestDomTask(()=>{d.style.width=n*b+"px",d.innerHTML=`${_}&nbsp;${f}`})}const Lo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ci=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $a(d){if(d){if("number"==typeof d){const n=Math.round(Math.sqrt(.5*Math.pow(d,2)));return{center:new h.pointGeometry(0,0),top:new h.pointGeometry(0,d),"top-left":new h.pointGeometry(n,n),"top-right":new h.pointGeometry(-n,n),bottom:new h.pointGeometry(0,-d),"bottom-left":new h.pointGeometry(n,-n),"bottom-right":new h.pointGeometry(-n,-n),left:new h.pointGeometry(d,0),right:new h.pointGeometry(-d,0)}}if(d instanceof h.pointGeometry||Array.isArray(d)){const n=h.pointGeometry.convert(d);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:h.pointGeometry.convert(d.center||[0,0]),top:h.pointGeometry.convert(d.top||[0,0]),"top-left":h.pointGeometry.convert(d["top-left"]||[0,0]),"top-right":h.pointGeometry.convert(d["top-right"]||[0,0]),bottom:h.pointGeometry.convert(d.bottom||[0,0]),"bottom-left":h.pointGeometry.convert(d["bottom-left"]||[0,0]),"bottom-right":h.pointGeometry.convert(d["bottom-right"]||[0,0]),left:h.pointGeometry.convert(d.left||[0,0]),right:h.pointGeometry.convert(d.right||[0,0])}}return $a(new h.pointGeometry(0,0))}const yl={version:h.version,supported:Ee,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends du{constructor(d){if(null!=(d=h.extend({},yu,d)).minZoom&&null!=d.maxZoom&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=d.minPitch&&null!=d.maxPitch&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=d.minPitch&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=d.maxPitch&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pl(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._renderTaskQueue=new fu,this._domRenderTaskQueue=new fu,this._controls=[],this._markers=[],this._mapId=h.uniqueId(),this._locale=h.extend({},sa,d.locale),this._clickTolerance=d.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Ht(0),this._requestManager=new h.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,"string"==typeof d.container){if(this._container=h.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof ki))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==h.window&&(h.window.addEventListener("online",this._onWindowOnline,!1),h.window.addEventListener("resize",this._onWindowResize,!1),h.window.addEventListener("orientationchange",this._onWindowResize,!1),h.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Wl(this,d),this._hash=d.hash&&new fl("string"==typeof d.hash&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,h.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.attributionControl&&this.addControl(new Hl({customAttribution:d.customAttribution})),this._logoControl=new pu,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new h.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new h.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(d,n){if(void 0===n&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[n];return-1!==n.indexOf("bottom")?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){const n=this._containerDimensions(),c=n[0],f=n[1];this._resizeCanvas(c,f),this.transform.resize(c,f),this.painter.resize(c,f);const y=!this._moving;return y&&(this.stop(),this.fire(new h.Event("movestart",d)).fire(new h.Event("move",d))),this.fire(new h.Event("resize",d)),y&&this.fire(new h.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(h.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=null==d?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=null==d?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=null==d?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=null==d?85:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint3D(h.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(h.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(d,n,c){if("mouseenter"===d||"mouseover"===d){let f=!1;return{layer:n,listener:c,delegates:{mousemove:_=>{const b=this.getLayer(n)?this.queryRenderedFeatures(_.point,{layers:[n]}):[];b.length?f||(f=!0,c.call(this,new ce(d,this,_.originalEvent,{features:b}))):f=!1},mouseout:()=>{f=!1}}}}if("mouseleave"===d||"mouseout"===d){let f=!1;return{layer:n,listener:c,delegates:{mousemove:b=>{(this.getLayer(n)?this.queryRenderedFeatures(b.point,{layers:[n]}):[]).length?f=!0:f&&(f=!1,c.call(this,new ce(d,this,b.originalEvent)))},mouseout:b=>{f&&(f=!1,c.call(this,new ce(d,this,b.originalEvent)))}}}}{const f=y=>{const _=this.getLayer(n)?this.queryRenderedFeatures(y.point,{layers:[n]}):[];_.length&&(y.features=_,c.call(this,y),delete y.features)};return{layer:n,listener:c,delegates:{[d]:f}}}}on(d,n,c){if(void 0===c)return super.on(d,n);const f=this._createDelegatedListener(d,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const y in f.delegates)this.on(y,f.delegates[y]);return this}once(d,n,c){if(void 0===c)return super.once(d,n);const f=this._createDelegatedListener(d,n,c);for(const y in f.delegates)this.once(y,f.delegates[y]);return this}off(d,n,c){return void 0===c?super.off(d,n):(this._delegatedListeners&&this._delegatedListeners[d]&&(f=>{const y=this._delegatedListeners[d];for(let _=0;_<y.length;_++){const b=y[_];if(b.layer===n&&b.listener===c){for(const S in b.delegates)this.off(S,b.delegates[S]);return y.splice(_,1),this}}})(),this)}queryRenderedFeatures(d,n){return this.style?(void 0!==n||void 0===d||d instanceof h.pointGeometry||Array.isArray(d)||(n=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(d,n){return this.style.querySourceFeatures(d,n)}queryTerrainElevation(d,n){const c=this.transform.elevation;return c?(n=h.extend({},{exaggerated:!0},n),c.getAtPoint(h.MercatorCoordinate.fromLngLat(d),null,n.exaggerated)):null}setStyle(d,n){return!1!==(n=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(null==n)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),d&&(this.style=new Oi(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof d?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,n){if("string"==typeof d){const c=this._requestManager.normalizeStyleURL(d),f=this._requestManager.transformRequest(c,h.ResourceType.Style);h.getJSON(f,(y,_)=>{y?this.fire(new h.ErrorEvent(y)):_&&this._updateDiff(_,n)})}else"object"==typeof d&&this._updateDiff(d,n)}_updateDiff(d,n){try{this.style.setState(d)&&this._update(!0)}catch(c){h.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.warnOnce("There is no style added to the map.")}addSource(d,n){return this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)}isSourceLoaded(d){const n=this.style&&this.style._getSourceCaches(d);if(0!==n.length)return n.every(c=>c.loaded());this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const n in d){const c=d[n]._tiles;for(const f in c){const y=c[f];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(d,n,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,c)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,n,{pixelRatio:c=1,sdf:f=!1,stretchX:y,stretchY:_,content:b}={}){if(this._lazyInitEmptyStyle(),n instanceof gl||kt&&n instanceof kt){const{width:S,height:k,data:L}=h.exported.getImageData(n);this.style.addImage(d,{data:new h.RGBAImage({width:S,height:k},L),pixelRatio:c,stretchX:y,stretchY:_,content:b,sdf:f,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:k,data:L}=n,O=n;this.style.addImage(d,{data:new h.RGBAImage({width:S,height:k},new Uint8Array(L)),pixelRatio:c,stretchX:y,stretchY:_,content:b,sdf:f,version:0,userImage:O}),O.onAdd&&O.onAdd(this,d)}}}updateImage(d,n){const c=this.style.getImage(d);if(!c)return this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof gl||kt&&n instanceof kt?h.exported.getImageData(n):n,{width:y,height:_,data:b}=f;return void 0===y||void 0===_?this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==c.data.width||_!==c.data.height?this.fire(new h.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(b,!(n instanceof gl||kt&&n instanceof kt)),void this.style.updateImage(d,c))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){h.getImage(this._requestManager.transformRequest(d,h.ResourceType.Image),(c,f)=>{n(c,f instanceof gl?h.exported.getImageData(f):f)})}listImages(){return this.style.listImages()}addLayer(d,n){return this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)}moveLayer(d,n){return this.style.moveLayer(d,n),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,n,c){return this.style.setLayerZoomRange(d,n,c),this._update(!0)}setFilter(d,n,c={}){return this.style.setFilter(d,n,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,n,c,f={}){return this.style.setPaintProperty(d,n,c,f),this._update(!0)}getPaintProperty(d,n){return this.style.getPaintProperty(d,n)}setLayoutProperty(d,n,c,f={}){return this.style.setLayoutProperty(d,n,c,f),this._update(!0)}getLayoutProperty(d,n){return this.style.getLayoutProperty(d,n)}setLight(d,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.LngLat.convert(d),this.transform):0}setFeatureState(d,n){return this.style.setFeatureState(d,n),this._update()}removeFeatureState(d,n){return this.style.removeFeatureState(d,n),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_containerDimensions(){let d=0,n=0;return this._container&&(d=this._container.clientWidth||400,n=this._container.clientHeight||300),[d,n]}_detectMissingCSS(){"rgb(250, 128, 114)"!==h.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ae.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ae.create("div","mapboxgl-canvas-container",d);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=ae.create("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions();this._resizeCanvas(c[0],c[1]);const f=this._controlContainer=ae.create("div","mapboxgl-control-container",d),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{y[_]=ae.create("div",`mapboxgl-ctrl-${_}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const c=h.exported.devicePixelRatio||1;this._canvas.width=c*d,this._canvas.height=c*n,this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);-1!==n&&this._markers.splice(n,1)}_setupPainter(){const d=h.extend({},Ee.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);n?(h.storeAuthState(n,!0),this.painter=new Fa(n,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),h.exported$1.testSupport(n)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.isMoving()&&this.loaded()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;const c=this.painter.context.extTimerQuery,f=h.exported.now();this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n));let y=this._updateAverageElevation(f);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;let _=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,L=h.exported.now();this.style.zoomHistory.update(k,L);const O=new h.EvaluationParameters(k,{now:L,fadeDuration:b,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=O.crossFadingFactor();1===U&&U===this._crossFadingFactor||(_=!0,this._crossFadingFactor=U),this.style.update(O)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const k=h.exported.now()-f;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const L=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new h.Event("gpu-timing-frame",{cpuTime:k,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(k);this.fire(new h.Event("gpu-timing-layer",{layerTimes:L}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(S||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(y=this._updateAverageElevation(f,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new h.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new h.Event("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate()),this}_updateAverageElevation(d,n=!1){const c=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const f=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=d;const _=Math.abs(f-y);if(_>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,d,300)}else if(_>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(d)&&c(this._averageElevation.getValue(d))}_authenticate(){h.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===h.AUTH_ERR_MSG||401===d.status)){const n=this.painter.context.gl;h.storeAuthState(n,!1),this._logoControl instanceof pu&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),h.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,f=c.createFramebuffer();function y(_){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,_,0);const b=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,b),b}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(y(d),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(d,n,c){let f=c[1]-c[0];const y=d.length/4;for(let _=0;_<n.length;_++){const b=n[_];let S=0;for(let k=0;k<b.length;k+=4)b[k]===d[k]&&b[k+1]===d[k+1]&&b[k+2]===d[k+2]&&b[k+3]===d[k+3]&&(S+=1);f+=(c[_+2]-c[_+1])*(1-S/y)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==h.window&&(h.window.removeEventListener("resize",this._onWindowResize,!1),h.window.removeEventListener("orientationchange",this._onWindowResize,!1),h.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),zs(this._canvasContainer),zs(this._controlContainer),zs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),h.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=h.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,n){h.setCacheLimits(d,n)}get version(){return h.version}},NavigationControl:class{constructor(d){this.options=h.extend({},_u,d),this._container=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),ae.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),ae.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=ae.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const d=this._map.getZoom(),n=d===this._map.getMaxZoom(),c=d===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ga(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ae.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,n){const c=ae.create("button",d,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(d,n){const c=this._map._getUIString(`NavigationControl.${n}`);d.title=c,d.setAttribute("aria-label",c)}},GeolocateControl:class extends h.Evented{constructor(d){super(),this.options=h.extend({},an,d),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Po(this._updateMarkerRotation,20)}onAdd(d){var n;return this._map=d,this._container=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==oa?n(oa):void 0!==h.window.navigator.permissions?h.window.navigator.permissions.query({name:"geolocation"}).then(c=>{oa="denied"!==c.state,n(oa)}):(oa=!!h.window.navigator.geolocation,n(oa)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ae.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Jn=0,cs=!1}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),c=d.coords;return n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(d),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",d)),this._finish()}}_updateCamera(d){const n=new h.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,f=this._map.getBearing(),y=h.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),y,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new h.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._container.clientHeight/2,n=this._map.unproject([0,d]),c=this._map.unproject([100,d]),f=n.distanceTo(c)/100,y=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(1===d.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===d.code&&cs)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ae.create("button","mapboxgl-ctrl-geolocate",this._container),ae.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===d){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ae.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ae.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ae.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Kl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ae.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Kl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:!0===d.absolute&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Jn--,cs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Jn++,Jn>1?(d={maximumAge:6e5,timeout:0},cs=!0):(d=this.options.positionOptions,cs=!1),this._geolocationWatchID=h.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else h.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{h.window.addEventListener("ondeviceorientationabsolute"in h.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==h.window.DeviceMotionEvent&&"function"==typeof h.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&d()}).catch(console.error):d()}_clearWatch(){h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),h.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),h.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hl,ScaleControl:class{constructor(d){this.options=h.extend({},rd,d),h.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Mi(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ae.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,Mi(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof h.window.HTMLElement?this._container=d.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in h.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in h.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ae.remove(this._controlContainer),this._map=null,h.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!h.window.document.fullscreenEnabled&&!h.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ae.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ae.create("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden",!0),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),h.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(h.window.document.fullscreenElement||h.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?h.window.document.exitFullscreen?h.window.document.exitFullscreen():h.window.document.webkitCancelFullScreen&&h.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor(d){super(),this.options=h.extend(Object.create(Lo),d),h.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ae.remove(this._content),this._container&&(ae.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=h.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(h.window.document.createTextNode(d))}setHTML(d){const n=h.window.document.createDocumentFragment(),c=h.window.document.createElement("body");let f;for(c.innerHTML=d;f=c.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ae.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=ae.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_update(d){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=ae.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ae.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(_=>this._container.classList.add(_)),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mu(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!d))return;const n=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat);let c=this.options.anchor;const f=$a(this.options.offset);if(!c){const _=this._container.offsetWidth,b=this._container.offsetHeight;let S;S=n.y+f.bottom.y<b?["top"]:n.y>this._map.transform.height-b?["bottom"]:[],n.x<_/2?S.push("left"):n.x>this._map.transform.width-_/2&&S.push("right"),c=0===S.length?"bottom":S.join("-")}const y=n.add(f[c]).round();this._map._requestDomTask(()=>{this._container&&c&&(ae.setTransform(this._container,`${lr[c]} translate(${y.x}px,${y.y}px)`),gu(this._container,c,"popup"))})}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(ci);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._content&&(this._content.style.opacity=d),this._tip&&(this._tip.style.opacity=d)}},Marker:Kl,Style:Oi,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,FreeCameraOptions:Mo,Evented:h.Evented,config:h.config,prewarm:function(){Ge().acquire(oe)},clearPrewarmedResources:function(){const d=Ie;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(oe),Ie=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return h.config.ACCESS_TOKEN},set accessToken(d){h.config.ACCESS_TOKEN=d},get baseApiUrl(){return h.config.API_URL},set baseApiUrl(d){h.config.API_URL=d},get workerCount(){return ge.workerCount},set workerCount(d){ge.workerCount=d},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){h.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){h.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:h.exported.setNow,restoreNow:h.exported.restoreNow};return yl}),Pt}()},8259:function(nd){nd.exports=function(){"use strict";const Hi=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),ot="SweetAlert2:",ts=C=>C.charAt(0).toUpperCase()+C.slice(1),Se=C=>Array.prototype.slice.call(C),h=C=>{console.warn("".concat(ot," ").concat("object"==typeof C?C.join(" "):C))},Ee=C=>{console.error("".concat(ot," ").concat(C))},Dn=[],Be=(C,A)=>{(C=>{Dn.includes(C)||(Dn.push(C),h(C))})('"'.concat(C,'" is deprecated and will be removed in the next major release. Please use "').concat(A,'" instead.'))},ae=C=>"function"==typeof C?C():C,at=C=>C&&"function"==typeof C.toPromise,ii=C=>at(C)?C.toPromise():Promise.resolve(C),_s=C=>C&&Promise.resolve(C)===C,mi=C=>C instanceof Element||(C=>"object"==typeof C&&C.jquery)(C),pr=C=>{const A={};for(const V in C)A[C[V]]="swal2-"+C[V];return A},Me=pr(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"]),dn=pr(["success","warning","info","question","error"]),gn=()=>document.body.querySelector(".".concat(Me.container)),Sr=C=>{const A=gn();return A?A.querySelector(C):null},nn=C=>Sr(".".concat(C)),Tt=()=>nn(Me.popup),Xi=()=>nn(Me.icon),Ir=()=>nn(Me.title),Kn=()=>nn(Me["html-container"]),Mt=()=>nn(Me.image),qs=()=>nn(Me["progress-steps"]),Xn=()=>nn(Me["validation-message"]),Qe=()=>Sr(".".concat(Me.actions," .").concat(Me.confirm)),bi=()=>Sr(".".concat(Me.actions," .").concat(Me.deny)),qt=()=>Sr(".".concat(Me.loader)),Ti=()=>Sr(".".concat(Me.actions," .").concat(Me.cancel)),Qt=()=>nn(Me.actions),ir=()=>nn(Me.footer),fr=()=>nn(Me["timer-progress-bar"]),Ar=()=>nn(Me.close),Cr=()=>{const C=Se(Tt().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort((V,ce)=>(V=parseInt(V.getAttribute("tabindex")))>(ce=parseInt(ce.getAttribute("tabindex")))?1:V<ce?-1:0),A=Se(Tt().querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n')).filter(V=>"-1"!==V.getAttribute("tabindex"));return(C=>{const A=[];for(let V=0;V<C.length;V++)-1===A.indexOf(C[V])&&A.push(C[V]);return A})(C.concat(A)).filter(V=>un(V))},pt=()=>!gi()&&!document.body.classList.contains(Me["no-backdrop"]),gi=()=>document.body.classList.contains(Me["toast-shown"]),Yn={previousBodyPadding:null},Fn=(C,A)=>{if(C.textContent="",A){const ce=(new DOMParser).parseFromString(A,"text/html");Se(ce.querySelector("head").childNodes).forEach(Ue=>{C.appendChild(Ue)}),Se(ce.querySelector("body").childNodes).forEach(Ue=>{C.appendChild(Ue)})}},ri=(C,A)=>{if(!A)return!1;const V=A.split(/\s+/);for(let ce=0;ce<V.length;ce++)if(!C.classList.contains(V[ce]))return!1;return!0},Et=(C,A,V)=>{if(((C,A)=>{Se(C.classList).forEach(V=>{!Object.values(Me).includes(V)&&!Object.values(dn).includes(V)&&!Object.values(A.showClass).includes(V)&&C.classList.remove(V)})})(C,A),A.customClass&&A.customClass[V]){if("string"!=typeof A.customClass[V]&&!A.customClass[V].forEach)return h("Invalid type of customClass.".concat(V,'! Expected string or iterable object, got "').concat(typeof A.customClass[V],'"'));At(C,A.customClass[V])}},Yi=(C,A)=>{if(!A)return null;switch(A){case"select":case"textarea":case"file":return Wt(C,Me[A]);case"checkbox":return C.querySelector(".".concat(Me.checkbox," input"));case"radio":return C.querySelector(".".concat(Me.radio," input:checked"))||C.querySelector(".".concat(Me.radio," input:first-child"));case"range":return C.querySelector(".".concat(Me.range," input"));default:return Wt(C,Me.input)}},rr=C=>{if(C.focus(),"file"!==C.type){const A=C.value;C.value="",C.value=A}},zi=(C,A,V)=>{!C||!A||("string"==typeof A&&(A=A.split(/\s+/).filter(Boolean)),A.forEach(ce=>{C.forEach?C.forEach(Ue=>{V?Ue.classList.add(ce):Ue.classList.remove(ce)}):V?C.classList.add(ce):C.classList.remove(ce)}))},At=(C,A)=>{zi(C,A,!0)},Li=(C,A)=>{zi(C,A,!1)},Wt=(C,A)=>{for(let V=0;V<C.childNodes.length;V++)if(ri(C.childNodes[V],A))return C.childNodes[V]},yn=(C,A,V)=>{V==="".concat(parseInt(V))&&(V=parseInt(V)),V||0===parseInt(V)?C.style[A]="number"==typeof V?"".concat(V,"px"):V:C.style.removeProperty(A)},Dt=(C,A="flex")=>{C.style.display=A},rn=C=>{C.style.display="none"},Mr=(C,A,V,ce)=>{const Ue=C.querySelector(A);Ue&&(Ue.style[V]=ce)},sr=(C,A,V)=>{A?Dt(C,V):rn(C)},un=C=>!(!C||!(C.offsetWidth||C.offsetHeight||C.getClientRects().length)),Ei=C=>C.scrollHeight>C.clientHeight,is=C=>{const A=window.getComputedStyle(C),V=parseFloat(A.getPropertyValue("animation-duration")||"0"),ce=parseFloat(A.getPropertyValue("transition-duration")||"0");return V>0||ce>0},Ri=(C,A=!1)=>{const V=fr();un(V)&&(A&&(V.style.transition="none",V.style.width="100%"),setTimeout(()=>{V.style.transition="width ".concat(C/1e3,"s linear"),V.style.width="0%"},10))},or=()=>"undefined"==typeof window||"undefined"==typeof document,Gs='\n <div aria-labelledby="'.concat(Me.title,'" aria-describedby="').concat(Me["html-container"],'" class="').concat(Me.popup,'" tabindex="-1">\n   <button type="button" class="').concat(Me.close,'"></button>\n   <ul class="').concat(Me["progress-steps"],'"></ul>\n   <div class="').concat(Me.icon,'"></div>\n   <img class="').concat(Me.image,'" />\n   <h2 class="').concat(Me.title,'" id="').concat(Me.title,'"></h2>\n   <div class="').concat(Me["html-container"],'" id="').concat(Me["html-container"],'"></div>\n   <input class="').concat(Me.input,'" />\n   <input type="file" class="').concat(Me.file,'" />\n   <div class="').concat(Me.range,'">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="').concat(Me.select,'"></select>\n   <div class="').concat(Me.radio,'"></div>\n   <label for="').concat(Me.checkbox,'" class="').concat(Me.checkbox,'">\n     <input type="checkbox" />\n     <span class="').concat(Me.label,'"></span>\n   </label>\n   <textarea class="').concat(Me.textarea,'"></textarea>\n   <div class="').concat(Me["validation-message"],'" id="').concat(Me["validation-message"],'"></div>\n   <div class="').concat(Me.actions,'">\n     <div class="').concat(Me.loader,'"></div>\n     <button type="button" class="').concat(Me.confirm,'"></button>\n     <button type="button" class="').concat(Me.deny,'"></button>\n     <button type="button" class="').concat(Me.cancel,'"></button>\n   </div>\n   <div class="').concat(Me.footer,'"></div>\n   <div class="').concat(Me["timer-progress-bar-container"],'">\n     <div class="').concat(Me["timer-progress-bar"],'"></div>\n   </div>\n </div>\n').replace(/(^|\n)\s*/g,""),mr=()=>{Ds.isVisible()&&Ds.resetValidationMessage()},Fi=C=>{const A=(()=>{const C=gn();return!!C&&(C.remove(),Li([document.documentElement,document.body],[Me["no-backdrop"],Me["toast-shown"],Me["has-column"]]),!0)})();if(or())return void Ee("SweetAlert2 requires document to initialize");const V=document.createElement("div");V.className=Me.container,A&&At(V,Me["no-transition"]),Fn(V,Gs);const ce=(C=>"string"==typeof C?document.querySelector(C):C)(C.target);ce.appendChild(V),(C=>{const A=Tt();A.setAttribute("role",C.toast?"alert":"dialog"),A.setAttribute("aria-live",C.toast?"polite":"assertive"),C.toast||A.setAttribute("aria-modal","true")})(C),(C=>{"rtl"===window.getComputedStyle(C).direction&&At(gn(),Me.rtl)})(ce),(()=>{const C=Tt(),A=Wt(C,Me.input),V=Wt(C,Me.file),ce=C.querySelector(".".concat(Me.range," input")),Ue=C.querySelector(".".concat(Me.range," output")),yt=Wt(C,Me.select),fn=C.querySelector(".".concat(Me.checkbox," input")),ai=Wt(C,Me.textarea);A.oninput=mr,V.onchange=mr,yt.onchange=mr,fn.onchange=mr,ai.oninput=mr,ce.oninput=()=>{mr(),Ue.value=ce.value},ce.onchange=()=>{mr(),ce.nextSibling.value=ce.value}})()},Qi=(C,A)=>{C instanceof HTMLElement?A.appendChild(C):"object"==typeof C?Gr(C,A):C&&Fn(A,C)},Gr=(C,A)=>{C.jquery?rs(A,C):Fn(A,C.toString())},rs=(C,A)=>{if(C.textContent="",0 in A)for(let V=0;V in A;V++)C.appendChild(A[V].cloneNode(!0));else C.appendChild(A.cloneNode(!0))},Si=(()=>{if(or())return!1;const C=document.createElement("div"),A={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd oanimationend",animation:"animationend"};for(const V in A)if(Object.prototype.hasOwnProperty.call(A,V)&&void 0!==C.style[V])return A[V];return!1})(),$s=(C,A)=>{const V=Qt(),ce=qt(),Ue=Qe(),yt=bi(),fn=Ti();A.showConfirmButton||A.showDenyButton||A.showCancelButton?Dt(V):rn(V),Et(V,A,"actions"),H(Ue,"confirm",A),H(yt,"deny",A),H(fn,"cancel",A),function(C,A,V,ce){if(!ce.buttonsStyling)return Li([C,A,V],Me.styled);At([C,A,V],Me.styled),ce.confirmButtonColor&&(C.style.backgroundColor=ce.confirmButtonColor,At(C,Me["default-outline"])),ce.denyButtonColor&&(A.style.backgroundColor=ce.denyButtonColor,At(A,Me["default-outline"])),ce.cancelButtonColor&&(V.style.backgroundColor=ce.cancelButtonColor,At(V,Me["default-outline"]))}(Ue,yt,fn,A),A.reverseButtons&&(V.insertBefore(fn,ce),V.insertBefore(yt,ce),V.insertBefore(Ue,ce)),Fn(ce,A.loaderHtml),Et(ce,A,"loader")};function H(C,A,V){sr(C,V["show".concat(ts(A),"Button")],"inline-block"),Fn(C,V["".concat(A,"ButtonText")]),C.setAttribute("aria-label",V["".concat(A,"ButtonAriaLabel")]),C.className=Me[A],Et(C,V,"".concat(A,"Button")),At(C,V["".concat(A,"ButtonClass")])}const G=(C,A)=>{const V=gn();!V||(function(C,A){"string"==typeof A?C.style.background=A:A||At([document.documentElement,document.body],Me["no-backdrop"])}(V,A.backdrop),function(C,A){A in Me?At(C,Me[A]):(h('The "position" parameter is not valid, defaulting to "center"'),At(C,Me.center))}(V,A.position),function(C,A){if(A&&"string"==typeof A){const V="grow-".concat(A);V in Me&&At(C,Me[V])}}(V,A.grow),Et(V,A,"container"))};var Z={promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const de=["input","file","range","select","radio","checkbox","textarea"],oe=C=>{if(!be[C.input])return Ee('Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "'.concat(C.input,'"'));const A=pe(C.input),V=be[C.input](A,C);Dt(V),setTimeout(()=>{rr(V)})},Ie=(C,A)=>{const V=Yi(Tt(),C);if(V){(C=>{for(let A=0;A<C.attributes.length;A++){const V=C.attributes[A].name;["type","value","style"].includes(V)||C.removeAttribute(V)}})(V);for(const ce in A)V.setAttribute(ce,A[ce])}},Ge=C=>{const A=pe(C.input);C.customClass&&At(A,C.customClass.input)},Te=(C,A)=>{(!C.placeholder||A.inputPlaceholder)&&(C.placeholder=A.inputPlaceholder)},it=(C,A,V)=>{if(V.inputLabel){C.id=Me.input;const ce=document.createElement("label"),Ue=Me["input-label"];ce.setAttribute("for",C.id),ce.className=Ue,At(ce,V.customClass.inputLabel),ce.innerText=V.inputLabel,A.insertAdjacentElement("beforebegin",ce)}},pe=C=>{const A=Me[C]?Me[C]:Me.input;return Wt(Tt(),A)},be={};be.text=be.email=be.password=be.number=be.tel=be.url=(C,A)=>("string"==typeof A.inputValue||"number"==typeof A.inputValue?C.value=A.inputValue:_s(A.inputValue)||h('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(typeof A.inputValue,'"')),it(C,C,A),Te(C,A),C.type=A.input,C),be.file=(C,A)=>(it(C,C,A),Te(C,A),C),be.range=(C,A)=>{const V=C.querySelector("input"),ce=C.querySelector("output");return V.value=A.inputValue,V.type=A.input,ce.value=A.inputValue,it(V,C,A),C},be.select=(C,A)=>{if(C.textContent="",A.inputPlaceholder){const V=document.createElement("option");Fn(V,A.inputPlaceholder),V.value="",V.disabled=!0,V.selected=!0,C.appendChild(V)}return it(C,C,A),C},be.radio=C=>(C.textContent="",C),be.checkbox=(C,A)=>{const V=Yi(Tt(),"checkbox");V.value=1,V.id=Me.checkbox,V.checked=Boolean(A.inputValue);const ce=C.querySelector("span");return Fn(ce,A.inputPlaceholder),C},be.textarea=(C,A)=>{C.value=A.inputValue,Te(C,A),it(C,C,A);return setTimeout(()=>{if("MutationObserver"in window){const ce=parseInt(window.getComputedStyle(Tt()).width);new MutationObserver(()=>{const yt=C.offsetWidth+(ce=>parseInt(window.getComputedStyle(ce).marginLeft)+parseInt(window.getComputedStyle(ce).marginRight))(C);Tt().style.width=yt>ce?"".concat(yt,"px"):null}).observe(C,{attributes:!0,attributeFilter:["style"]})}}),C};const mt=(C,A)=>{const V=Kn();Et(V,A,"htmlContainer"),A.html?(Qi(A.html,V),Dt(V,"block")):A.text?(V.textContent=A.text,Dt(V,"block")):rn(V),((C,A)=>{const V=Tt(),ce=Z.innerParams.get(C),Ue=!ce||A.input!==ce.input;de.forEach(yt=>{const fn=Me[yt],ai=Wt(V,fn);Ie(yt,A.inputAttributes),ai.className=fn,Ue&&rn(ai)}),A.input&&(Ue&&oe(A),Ge(A))})(C,A)},Ot=(C,A)=>{for(const V in dn)A.icon!==V&&Li(C,dn[V]);At(C,dn[A.icon]),je(C,A),sn(),Et(C,A,"icon")},sn=()=>{const C=Tt(),A=window.getComputedStyle(C).getPropertyValue("background-color"),V=C.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let ce=0;ce<V.length;ce++)V[ce].style.backgroundColor=A},zr=(C,A)=>{C.textContent="",Fn(C,A.iconHtml?lt(A.iconHtml):"success"===A.icon?'\n      <div class="swal2-success-circular-line-left"></div>\n      <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n      <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n      <div class="swal2-success-circular-line-right"></div>\n    ':"error"===A.icon?'\n      <span class="swal2-x-mark">\n        <span class="swal2-x-mark-line-left"></span>\n        <span class="swal2-x-mark-line-right"></span>\n      </span>\n    ':lt({question:"?",warning:"!",info:"i"}[A.icon]))},je=(C,A)=>{if(A.iconColor){C.style.color=A.iconColor,C.style.borderColor=A.iconColor;for(const V of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Mr(C,V,"backgroundColor",A.iconColor);Mr(C,".swal2-success-ring","borderColor",A.iconColor)}},lt=C=>'<div class="'.concat(Me["icon-content"],'">').concat(C,"</div>"),zt=(C,A)=>{const V=qs();if(!A.progressSteps||0===A.progressSteps.length)return rn(V);Dt(V),V.textContent="",A.currentProgressStep>=A.progressSteps.length&&h("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),A.progressSteps.forEach((ce,Ue)=>{const yt=(C=>{const A=document.createElement("li");return At(A,Me["progress-step"]),Fn(A,C),A})(ce);if(V.appendChild(yt),Ue===A.currentProgressStep&&At(yt,Me["active-progress-step"]),Ue!==A.progressSteps.length-1){const fn=(C=>{const A=document.createElement("li");return At(A,Me["progress-step-line"]),C.progressStepsDistance&&(A.style.width=C.progressStepsDistance),A})(A);V.appendChild(fn)}})},Go=(C,A)=>{C.className="".concat(Me.popup," ").concat(un(C)?A.showClass.popup:""),A.toast?(At([document.documentElement,document.body],Me["toast-shown"]),At(C,Me.toast)):At(C,Me.modal),Et(C,A,"popup"),"string"==typeof A.customClass&&At(C,A.customClass),A.icon&&At(C,Me["icon-".concat(A.icon)])},Bi=(C,A)=>{((C,A)=>{const V=gn(),ce=Tt();A.toast?(yn(V,"width",A.width),ce.style.width="100%",ce.insertBefore(qt(),Xi())):yn(ce,"width",A.width),yn(ce,"padding",A.padding),A.background&&(ce.style.background=A.background),rn(Xn()),Go(ce,A)})(0,A),G(0,A),zt(0,A),((C,A)=>{const V=Z.innerParams.get(C),ce=Xi();V&&A.icon===V.icon?(zr(ce,A),Ot(ce,A)):A.icon||A.iconHtml?A.icon&&-1===Object.keys(dn).indexOf(A.icon)?(Ee('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(A.icon,'"')),rn(ce)):(Dt(ce),zr(ce,A),Ot(ce,A),At(ce,A.showClass.icon)):rn(ce)})(C,A),((C,A)=>{const V=Mt();if(!A.imageUrl)return rn(V);Dt(V,""),V.setAttribute("src",A.imageUrl),V.setAttribute("alt",A.imageAlt),yn(V,"width",A.imageWidth),yn(V,"height",A.imageHeight),V.className=Me.image,Et(V,A,"image")})(0,A),((C,A)=>{const V=Ir();sr(V,A.title||A.titleText,"block"),A.title&&Qi(A.title,V),A.titleText&&(V.innerText=A.titleText),Et(V,A,"title")})(0,A),((C,A)=>{const V=Ar();Fn(V,A.closeButtonHtml),Et(V,A,"closeButton"),sr(V,A.showCloseButton),V.setAttribute("aria-label",A.closeButtonAriaLabel)})(0,A),mt(C,A),$s(0,A),((C,A)=>{const V=ir();sr(V,A.footer),A.footer&&Qi(A.footer,V),Et(V,A,"footer")})(0,A),"function"==typeof A.didRender&&A.didRender(Tt())},Fl=()=>Qe()&&Qe().click();const yi=C=>{let A=Tt();A||Ds.fire(),A=Tt();const V=qt();gi()?rn(Xi()):$t(A,C),Dt(V),A.setAttribute("data-loading",!0),A.setAttribute("aria-busy",!0),A.focus()},$t=(C,A)=>{const V=Qt(),ce=qt();!A&&un(Qe())&&(A=Qe()),Dt(V),A&&(rn(A),ce.setAttribute("data-button-to-replace",A.className)),ce.parentNode.insertBefore(ce,A),At([C,V],Me.loading)},xt={},yr=C=>new Promise(A=>{if(!C)return A();const V=window.scrollX,ce=window.scrollY;xt.restoreFocusTimeout=setTimeout(()=>{xt.previousActiveElement&&xt.previousActiveElement.focus?(xt.previousActiveElement.focus(),xt.previousActiveElement=null):document.body&&document.body.focus(),A()},100),window.scrollTo(V,ce)}),jo=()=>{if(xt.timeout)return(()=>{const C=fr(),A=parseInt(window.getComputedStyle(C).width);C.style.removeProperty("transition"),C.style.width="100%";const V=parseInt(window.getComputedStyle(C).width),ce=parseInt(A/V*100);C.style.removeProperty("transition"),C.style.width="".concat(ce,"%")})(),xt.timeout.stop()},Tn=()=>{if(xt.timeout){const C=xt.timeout.start();return Ri(C),C}};let nl=!1;const _r={};const Ta=C=>{for(let A=C.target;A&&A!==document;A=A.parentNode)for(const V in _r){const ce=A.getAttribute(V);if(ce)return void _r[V].fire({template:ce})}},vs={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},xs=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],Ea={},il=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],on=C=>Object.prototype.hasOwnProperty.call(vs,C),ar=C=>Ea[C],$o=C=>{on(C)||h('Unknown parameter "'.concat(C,'"'))},Ia=C=>{il.includes(C)&&h('The parameter "'.concat(C,'" is incompatible with toasts'))},Ol=C=>{ar(C)&&Be(C,ar(C))};var Aa=Object.freeze({isValidParameter:on,isUpdatableParameter:C=>-1!==xs.indexOf(C),isDeprecatedParameter:ar,argsToParams:C=>{const A={};return"object"!=typeof C[0]||mi(C[0])?["title","html","icon"].forEach((V,ce)=>{const Ue=C[ce];"string"==typeof Ue||mi(Ue)?A[V]=Ue:void 0!==Ue&&Ee("Unexpected type of ".concat(V,'! Expected "string" or "Element", got ').concat(typeof Ue))}):Object.assign(A,C[0]),A},isVisible:()=>un(Tt()),clickConfirm:Fl,clickDeny:()=>bi()&&bi().click(),clickCancel:()=>Ti()&&Ti().click(),getContainer:gn,getPopup:Tt,getTitle:Ir,getHtmlContainer:Kn,getImage:Mt,getIcon:Xi,getInputLabel:()=>nn(Me["input-label"]),getCloseButton:Ar,getActions:Qt,getConfirmButton:Qe,getDenyButton:bi,getCancelButton:Ti,getLoader:qt,getFooter:ir,getTimerProgressBar:fr,getFocusableElements:Cr,getValidationMessage:Xn,isLoading:()=>Tt().hasAttribute("data-loading"),fire:function(...C){return new this(...C)},mixin:function(C){return class extends(this){_main(ce,Ue){return super._main(ce,Object.assign({},C,Ue))}}},showLoading:yi,enableLoading:yi,getTimerLeft:()=>xt.timeout&&xt.timeout.getTimerLeft(),stopTimer:jo,resumeTimer:Tn,toggleTimer:()=>{const C=xt.timeout;return C&&(C.running?jo():Tn())},increaseTimer:C=>{if(xt.timeout){const A=xt.timeout.increase(C);return Ri(A,!0),A}},isTimerRunning:()=>xt.timeout&&xt.timeout.isRunning(),bindClickHandler:function(C="data-swal-template"){_r[C]=this,nl||(document.body.addEventListener("click",Ta),nl=!0)}});function ws(){const C=Z.innerParams.get(this);if(!C)return;const A=Z.domCache.get(this);rn(A.loader),gi()?C.icon&&Dt(Xi()):rl(A),Li([A.popup,A.actions],Me.loading),A.popup.removeAttribute("aria-busy"),A.popup.removeAttribute("data-loading"),A.confirmButton.disabled=!1,A.denyButton.disabled=!1,A.cancelButton.disabled=!1}const rl=C=>{const A=C.popup.getElementsByClassName(C.loader.getAttribute("data-button-to-replace"));A.length?Dt(A[0],"inline-block"):!un(Qe())&&!un(bi())&&!un(Ti())&&rn(C.actions)};const sl=()=>{null===Yn.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(Yn.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(Yn.previousBodyPadding+(()=>{const C=document.createElement("div");C.className=Me["scrollbar-measure"],document.body.appendChild(C);const A=C.getBoundingClientRect().width-C.clientWidth;return document.body.removeChild(C),A})(),"px"))},al=()=>{if(!navigator.userAgent.match(/(CriOS|FxiOS|EdgiOS|YaBrowser|UCBrowser)/i)){const A=44;Tt().scrollHeight>window.innerHeight-A&&(gn().style.paddingBottom="".concat(A,"px"))}},Ul=()=>{const C=gn();let A;C.ontouchstart=V=>{A=go(V)},C.ontouchmove=V=>{A&&(V.preventDefault(),V.stopPropagation())}},go=C=>{const A=C.target,V=gn();return!(bs(C)||as(C)||A!==V&&(Ei(V)||"INPUT"===A.tagName||"TEXTAREA"===A.tagName||Ei(Kn())&&Kn().contains(A)))},bs=C=>C.touches&&C.touches.length&&"stylus"===C.touches[0].touchType,as=C=>C.touches&&C.touches.length>1,Gt=()=>{Se(document.body.children).forEach(A=>{A.hasAttribute("data-previous-aria-hidden")?(A.setAttribute("aria-hidden",A.getAttribute("data-previous-aria-hidden")),A.removeAttribute("data-previous-aria-hidden")):A.removeAttribute("aria-hidden")})};var Ho={swalPromiseResolve:new WeakMap};function Ts(C,A,V,ce){gi()?Ca(C,ce):(yr(V).then(()=>Ca(C,ce)),xt.keydownTarget.removeEventListener("keydown",xt.keydownHandler,{capture:xt.keydownListenerCapture}),xt.keydownHandlerAdded=!1),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(A.setAttribute("style","display:none !important"),A.removeAttribute("class"),A.innerHTML=""):A.remove(),pt()&&(null!==Yn.previousBodyPadding&&(document.body.style.paddingRight="".concat(Yn.previousBodyPadding,"px"),Yn.previousBodyPadding=null),(()=>{if(ri(document.body,Me.iosfix)){const C=parseInt(document.body.style.top,10);Li(document.body,Me.iosfix),document.body.style.top="",document.body.scrollTop=-1*C}})(),Gt()),Li([document.documentElement,document.body],[Me.shown,Me["height-auto"],Me["no-backdrop"],Me["toast-shown"]])}function Zr(C){const A=Tt();if(!A)return;C=Es(C);const V=Z.innerParams.get(this);if(!V||ri(A,V.hideClass.popup))return;const ce=Ho.swalPromiseResolve.get(this);Li(A,V.showClass.popup),At(A,V.hideClass.popup);const Ue=gn();Li(Ue,V.showClass.backdrop),At(Ue,V.hideClass.backdrop),Nt(this,A,V),ce(C)}const Es=C=>void 0===C?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},C),Nt=(C,A,V)=>{const ce=gn(),Ue=Si&&is(A);"function"==typeof V.willClose&&V.willClose(A),Ue?yo(C,A,ce,V.returnFocus,V.didClose):Ts(C,ce,V.returnFocus,V.didClose)},yo=(C,A,V,ce,Ue)=>{xt.swalCloseEventFinishedCallback=Ts.bind(null,C,V,ce,Ue),A.addEventListener(Si,function(yt){yt.target===A&&(xt.swalCloseEventFinishedCallback(),delete xt.swalCloseEventFinishedCallback)})},Ca=(C,A)=>{setTimeout(()=>{"function"==typeof A&&A.bind(C.params)(),C._destroy()})};function Ko(C,A,V){const ce=Z.domCache.get(C);A.forEach(Ue=>{ce[Ue].disabled=V})}function Zs(C,A){if(!C)return!1;if("radio"===C.type){const ce=C.parentNode.parentNode.querySelectorAll("input");for(let Ue=0;Ue<ce.length;Ue++)ce[Ue].disabled=A}else C.disabled=A}class xo{constructor(A,V){this.callback=A,this.remaining=V,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date-this.started),this.remaining}increase(A){const V=this.running;return V&&this.stop(),this.remaining+=A,V&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}var wo={email:(C,A)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(C)?Promise.resolve():Promise.resolve(A||"Invalid email address"),url:(C,A)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(C)?Promise.resolve():Promise.resolve(A||"Invalid URL")};function As(C){(function(C){C.inputValidator||Object.keys(wo).forEach(A=>{C.input===A&&(C.inputValidator=wo[A])})})(C),C.showLoaderOnConfirm&&!C.preConfirm&&h("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function(C){(!C.target||"string"==typeof C.target&&!document.querySelector(C.target)||"string"!=typeof C.target&&!C.target.appendChild)&&(h('Target parameter is not valid, defaulting to "body"'),C.target="body")}(C),"string"==typeof C.title&&(C.title=C.title.split("\n").join("<br />")),Fi(C)}const Xo=["swal-title","swal-html","swal-footer"],Ai=C=>{const A={};return Se(C.querySelectorAll("swal-param")).forEach(V=>{Cs(V,["name","value"]);const ce=V.getAttribute("name");let Ue=V.getAttribute("value");"boolean"==typeof vs[ce]&&"false"===Ue&&(Ue=!1),"object"==typeof vs[ce]&&(Ue=JSON.parse(Ue)),A[ce]=Ue}),A},bo=C=>{const A={};return Se(C.querySelectorAll("swal-button")).forEach(V=>{Cs(V,["type","color","aria-label"]);const ce=V.getAttribute("type");A["".concat(ce,"ButtonText")]=V.innerHTML,A["show".concat(ts(ce),"Button")]=!0,V.hasAttribute("color")&&(A["".concat(ce,"ButtonColor")]=V.getAttribute("color")),V.hasAttribute("aria-label")&&(A["".concat(ce,"ButtonAriaLabel")]=V.getAttribute("aria-label"))}),A},cl=C=>{const A={},V=C.querySelector("swal-image");return V&&(Cs(V,["src","width","height","alt"]),V.hasAttribute("src")&&(A.imageUrl=V.getAttribute("src")),V.hasAttribute("width")&&(A.imageWidth=V.getAttribute("width")),V.hasAttribute("height")&&(A.imageHeight=V.getAttribute("height")),V.hasAttribute("alt")&&(A.imageAlt=V.getAttribute("alt"))),A},Yo=C=>{const A={},V=C.querySelector("swal-icon");return V&&(Cs(V,["type","color"]),V.hasAttribute("type")&&(A.icon=V.getAttribute("type")),V.hasAttribute("color")&&(A.iconColor=V.getAttribute("color")),A.iconHtml=V.innerHTML),A},ql=C=>{const A={},V=C.querySelector("swal-input");V&&(Cs(V,["type","label","placeholder","value"]),A.input=V.getAttribute("type")||"text",V.hasAttribute("label")&&(A.inputLabel=V.getAttribute("label")),V.hasAttribute("placeholder")&&(A.inputPlaceholder=V.getAttribute("placeholder")),V.hasAttribute("value")&&(A.inputValue=V.getAttribute("value")));const ce=C.querySelectorAll("swal-input-option");return ce.length&&(A.inputOptions={},Se(ce).forEach(Ue=>{Cs(Ue,["value"]);const yt=Ue.getAttribute("value");A.inputOptions[yt]=Ue.innerHTML})),A},ka=(C,A)=>{const V={};for(const ce in A){const Ue=A[ce],yt=C.querySelector(Ue);yt&&(Cs(yt,[]),V[Ue.replace(/^swal-/,"")]=yt.innerHTML.trim())}return V},ul=C=>{const A=Xo.concat(["swal-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Se(C.children).forEach(V=>{const ce=V.tagName.toLowerCase();-1===A.indexOf(ce)&&h("Unrecognized element <".concat(ce,">"))})},Cs=(C,A)=>{Se(C.attributes).forEach(V=>{-1===A.indexOf(V.name)&&h(['Unrecognized attribute "'.concat(V.name,'" on <').concat(C.tagName.toLowerCase(),">."),"".concat(A.length?"Allowed attributes are: ".concat(A.join(", ")):"To set the value, use HTML within the element.")])})},Rr=C=>{const A=gn(),V=Tt();"function"==typeof C.willOpen&&C.willOpen(V);const Ue=window.getComputedStyle(document.body).overflowY;Eo(A,V,C),setTimeout(()=>{Gl(A,V)},10),pt()&&(To(A,C.scrollbarPadding,Ue),Se(document.body.children).forEach(A=>{A===gn()||A.contains(gn())||(A.hasAttribute("aria-hidden")&&A.setAttribute("data-previous-aria-hidden",A.getAttribute("aria-hidden")),A.setAttribute("aria-hidden","true"))})),!gi()&&!xt.previousActiveElement&&(xt.previousActiveElement=document.activeElement),"function"==typeof C.didOpen&&setTimeout(()=>C.didOpen(V)),Li(A,Me["no-transition"])},Ma=C=>{const A=Tt();if(C.target!==A)return;const V=gn();A.removeEventListener(Si,Ma),V.style.overflowY="auto"},Gl=(C,A)=>{Si&&is(A)?(C.style.overflowY="hidden",A.addEventListener(Si,Ma)):C.style.overflowY="auto"},To=(C,A,V)=>{(()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!ri(document.body,Me.iosfix)){const A=document.body.scrollTop;document.body.style.top="".concat(-1*A,"px"),At(document.body,Me.iosfix),Ul(),al()}})(),A&&"hidden"!==V&&sl(),setTimeout(()=>{C.scrollTop=0})},Eo=(C,A,V)=>{At(C,V.showClass.backdrop),A.style.setProperty("opacity","0","important"),Dt(A,"grid"),setTimeout(()=>{At(A,V.showClass.popup),A.style.removeProperty("opacity")},10),At([document.documentElement,document.body],Me.shown),V.heightAuto&&V.backdrop&&!V.toast&&At([document.documentElement,document.body],Me["height-auto"])},Ec=C=>C.checked?1:0,au=C=>C.checked?C.value:null,Sc=C=>C.files.length?null!==C.getAttribute("multiple")?C.files:C.files[0]:null,So=(C,A)=>{const V=Tt(),ce=Ue=>ks[A.input](V,Pa(Ue),A);at(A.inputOptions)||_s(A.inputOptions)?(yi(Qe()),ii(A.inputOptions).then(Ue=>{C.hideLoading(),ce(Ue)})):"object"==typeof A.inputOptions?ce(A.inputOptions):Ee("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(typeof A.inputOptions))},Qo=(C,A)=>{const V=C.getInput();rn(V),ii(A.inputValue).then(ce=>{V.value="number"===A.input?parseFloat(ce)||0:"".concat(ce),Dt(V),V.focus(),C.hideLoading()}).catch(ce=>{Ee("Error in inputValue promise: ".concat(ce)),V.value="",Dt(V),V.focus(),C.hideLoading()})},ks={select:(C,A,V)=>{const ce=Wt(C,Me.select),Ue=(yt,fn,ai)=>{const Ci=document.createElement("option");Ci.value=ai,Fn(Ci,fn),Ci.selected=hl(ai,V.inputValue),yt.appendChild(Ci)};A.forEach(yt=>{const fn=yt[0],ai=yt[1];if(Array.isArray(ai)){const Ci=document.createElement("optgroup");Ci.label=fn,Ci.disabled=!1,ce.appendChild(Ci),ai.forEach(ls=>Ue(Ci,ls[1],ls[0]))}else Ue(ce,ai,fn)}),ce.focus()},radio:(C,A,V)=>{const ce=Wt(C,Me.radio);A.forEach(yt=>{const fn=yt[0],ai=yt[1],Ci=document.createElement("input"),ls=document.createElement("label");Ci.type="radio",Ci.name=Me.radio,Ci.value=fn,hl(fn,V.inputValue)&&(Ci.checked=!0);const Oa=document.createElement("span");Fn(Oa,ai),Oa.className=Me.label,ls.appendChild(Ci),ls.appendChild(Oa),ce.appendChild(ls)});const Ue=ce.querySelectorAll("input");Ue.length&&Ue[0].focus()}},Pa=C=>{const A=[];return"undefined"!=typeof Map&&C instanceof Map?C.forEach((V,ce)=>{let Ue=V;"object"==typeof Ue&&(Ue=Pa(Ue)),A.push([ce,Ue])}):Object.keys(C).forEach(V=>{let ce=C[V];"object"==typeof ce&&(ce=Pa(ce)),A.push([V,ce])}),A},hl=(C,A)=>A&&A.toString()===C.toString(),Ks=(C,A)=>{const V=Z.innerParams.get(C),ce=((C,A)=>{const V=C.getInput();if(!V)return null;switch(A.input){case"checkbox":return Ec(V);case"radio":return au(V);case"file":return Sc(V);default:return A.inputAutoTrim?V.value.trim():V.value}})(C,V);V.inputValidator?Wr(C,ce,A):C.getInput().checkValidity()?"deny"===A?Xs(C,ce):Zt(C,ce):(C.enableButtons(),C.showValidationMessage(V.validationMessage))},Wr=(C,A,V)=>{const ce=Z.innerParams.get(C);C.disableInput(),Promise.resolve().then(()=>ii(ce.inputValidator(A,ce.validationMessage))).then(yt=>{C.enableButtons(),C.enableInput(),yt?C.showValidationMessage(yt):"deny"===V?Xs(C,A):Zt(C,A)})},Xs=(C,A)=>{const V=Z.innerParams.get(C||void 0);V.showLoaderOnDeny&&yi(bi()),V.preDeny?Promise.resolve().then(()=>ii(V.preDeny(A,V.validationMessage))).then(Ue=>{!1===Ue?C.hideLoading():C.closePopup({isDenied:!0,value:void 0===Ue?A:Ue})}):C.closePopup({isDenied:!0,value:A})},Io=(C,A)=>{C.closePopup({isConfirmed:!0,value:A})},Zt=(C,A)=>{const V=Z.innerParams.get(C||void 0);V.showLoaderOnConfirm&&yi(),V.preConfirm?(C.resetValidationMessage(),Promise.resolve().then(()=>ii(V.preConfirm(A,V.validationMessage))).then(Ue=>{un(Xn())||!1===Ue?C.hideLoading():Io(C,void 0===Ue?A:Ue)})):Io(C,A)},Ao=(C,A,V)=>{const ce=Cr();if(ce.length)return(A+=V)===ce.length?A=0:-1===A&&(A=ce.length-1),ce[A].focus();Tt().focus()},Co=["ArrowRight","ArrowDown"],Jo=["ArrowLeft","ArrowUp"],Vn=(C,A,V)=>{const ce=Z.innerParams.get(C);!ce||(ce.stopKeydownPropagation&&A.stopPropagation(),"Enter"===A.key?La(C,A,ce):"Tab"===A.key?Ic(A,ce):[...Co,...Jo].includes(A.key)?lu(A.key):"Escape"===A.key&&$l(A,ce,V))},La=(C,A,V)=>{if(!A.isComposing&&A.target&&C.getInput()&&A.target.outerHTML===C.getInput().outerHTML){if(["textarea","file"].includes(V.input))return;Fl(),A.preventDefault()}},Ic=(C,A)=>{const V=C.target,ce=Cr();let Ue=-1;for(let yt=0;yt<ce.length;yt++)if(V===ce[yt]){Ue=yt;break}Ao(0,Ue,C.shiftKey?-1:1),C.stopPropagation(),C.preventDefault()},lu=C=>{if(![Qe(),bi(),Ti()].includes(document.activeElement))return;const Ue=Co.includes(C)?"nextElementSibling":"previousElementSibling",yt=document.activeElement[Ue];yt&&yt.focus()},$l=(C,A,V)=>{ae(A.allowEscapeKey)&&(C.preventDefault(),V(Hi.esc))},ea=(C,A,V)=>{A.popup.onclick=()=>{const ce=Z.innerParams.get(C);ce.showConfirmButton||ce.showDenyButton||ce.showCancelButton||ce.showCloseButton||ce.timer||ce.input||V(Hi.close)}};let Fr=!1;const Ra=C=>{C.popup.onmousedown=()=>{C.container.onmouseup=function(A){C.container.onmouseup=void 0,A.target===C.container&&(Fr=!0)}}},Fa=C=>{C.container.onmousedown=()=>{C.popup.onmouseup=function(A){C.popup.onmouseup=void 0,(A.target===C.popup||C.popup.contains(A.target))&&(Fr=!0)}}},ko=(C,A,V)=>{A.container.onclick=ce=>{const Ue=Z.innerParams.get(C);Fr?Fr=!1:ce.target===A.container&&ae(Ue.allowOutsideClick)&&V(Hi.backdrop)}};const vr=(C,A)=>{const V=(C=>{const A="string"==typeof C.template?document.querySelector(C.template):C.template;if(!A)return{};const V=A.content;return ul(V),Object.assign(Ai(V),bo(V),cl(V),Yo(V),ql(V),ka(V,Xo))})(C),ce=Object.assign({},vs,A,V,C);return ce.showClass=Object.assign({},vs.showClass,ce.showClass),ce.hideClass=Object.assign({},vs.hideClass,ce.hideClass),ce},dl=(C,A,V)=>new Promise(ce=>{const Ue=yt=>{C.closePopup({isDismissed:!0,dismiss:yt})};Ho.swalPromiseResolve.set(C,ce),A.confirmButton.onclick=()=>(C=>{const A=Z.innerParams.get(C);C.disableButtons(),A.input?Ks(C,"confirm"):Zt(C,!0)})(C),A.denyButton.onclick=()=>(C=>{const A=Z.innerParams.get(C);C.disableButtons(),A.returnInputValueOnDeny?Ks(C,"deny"):Xs(C,!1)})(C),A.cancelButton.onclick=()=>((C,A)=>{C.disableButtons(),A(Hi.cancel)})(C,Ue),A.closeButton.onclick=()=>Ue(Hi.close),((C,A,V)=>{Z.innerParams.get(C).toast?ea(C,A,V):(Ra(A),Fa(A),ko(C,A,V))})(C,A,Ue),((C,A,V,ce)=>{A.keydownTarget&&A.keydownHandlerAdded&&(A.keydownTarget.removeEventListener("keydown",A.keydownHandler,{capture:A.keydownListenerCapture}),A.keydownHandlerAdded=!1),V.toast||(A.keydownHandler=Ue=>Vn(C,Ue,ce),A.keydownTarget=V.keydownListenerCapture?window:Tt(),A.keydownListenerCapture=V.keydownListenerCapture,A.keydownTarget.addEventListener("keydown",A.keydownHandler,{capture:A.keydownListenerCapture}),A.keydownHandlerAdded=!0)})(C,xt,V,Ue),((C,A)=>{"select"===A.input||"radio"===A.input?So(C,A):["text","email","number","tel","textarea"].includes(A.input)&&(at(A.inputValue)||_s(A.inputValue))&&(yi(Qe()),Qo(C,A))})(C,V),Rr(V),Ys(xt,V,Ue),Ms(A,V),setTimeout(()=>{A.container.scrollTop=0})}),Ba=C=>{const A={popup:Tt(),container:gn(),actions:Qt(),confirmButton:Qe(),denyButton:bi(),cancelButton:Ti(),loader:qt(),closeButton:Ar(),validationMessage:Xn(),progressSteps:qs()};return Z.domCache.set(C,A),A},Ys=(C,A,V)=>{const ce=fr();rn(ce),A.timer&&(C.timeout=new xo(()=>{V("timer"),delete C.timeout},A.timer),A.timerProgressBar&&(Dt(ce),setTimeout(()=>{C.timeout&&C.timeout.running&&Ri(A.timer)})))},Ms=(C,A)=>{if(!A.toast){if(!ae(A.allowEnterKey))return Qs();Mo(C,A)||Ao(0,-1,1)}},Mo=(C,A)=>A.focusDeny&&un(C.denyButton)?(C.denyButton.focus(),!0):A.focusCancel&&un(C.cancelButton)?(C.cancelButton.focus(),!0):!(!A.focusConfirm||!un(C.confirmButton)||(C.confirmButton.focus(),0)),Qs=()=>{document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};const fl=C=>{delete C.params,delete xt.keydownHandler,delete xt.keydownTarget,ta(Z),ta(Ho),delete xt.currentInstance},ta=C=>{for(const A in C)C[A]=new WeakMap};var na=Object.freeze({hideLoading:ws,disableLoading:ws,getInput:function(C){const A=Z.innerParams.get(C||this),V=Z.domCache.get(C||this);return V?Yi(V.popup,A.input):null},close:Zr,closePopup:Zr,closeModal:Zr,closeToast:Zr,enableButtons:function(){Ko(this,["confirmButton","denyButton","cancelButton"],!1)},disableButtons:function(){Ko(this,["confirmButton","denyButton","cancelButton"],!0)},enableInput:function(){return Zs(this.getInput(),!1)},disableInput:function(){return Zs(this.getInput(),!0)},showValidationMessage:function(C){const A=Z.domCache.get(this),V=Z.innerParams.get(this);Fn(A.validationMessage,C),A.validationMessage.className=Me["validation-message"],V.customClass&&V.customClass.validationMessage&&At(A.validationMessage,V.customClass.validationMessage),Dt(A.validationMessage);const ce=this.getInput();ce&&(ce.setAttribute("aria-invalid",!0),ce.setAttribute("aria-describedby",Me["validation-message"]),rr(ce),At(ce,Me.inputerror))},resetValidationMessage:function(){const C=Z.domCache.get(this);C.validationMessage&&rn(C.validationMessage);const A=this.getInput();A&&(A.removeAttribute("aria-invalid"),A.removeAttribute("aria-describedby"),Li(A,Me.inputerror))},getProgressSteps:function(){return Z.domCache.get(this).progressSteps},_main:function(C,A={}){(C=>{!C.backdrop&&C.allowOutsideClick&&h('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const A in C)$o(A),C.toast&&Ia(A),Ol(A)})(Object.assign({},A,C)),xt.currentInstance&&(xt.currentInstance._destroy(),pt()&&Gt()),xt.currentInstance=this;const V=vr(C,A);As(V),Object.freeze(V),xt.timeout&&(xt.timeout.stop(),delete xt.timeout),clearTimeout(xt.restoreFocusTimeout);const ce=Ba(this);return Bi(this,V),Z.innerParams.set(this,V),dl(this,ce,V)},update:function(C){const A=Tt(),V=Z.innerParams.get(this);if(!A||ri(A,V.hideClass.popup))return h("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const ce={};Object.keys(C).forEach(yt=>{Ds.isUpdatableParameter(yt)?ce[yt]=C[yt]:h('Invalid parameter to update: "'.concat(yt,'". Updatable params are listed here: https://github.com/sweetalert2/sweetalert2/blob/master/src/utils/params.js\n\nIf you think this parameter should be updatable, request it here: https://github.com/sweetalert2/sweetalert2/issues/new?template=02_feature_request.md'))});const Ue=Object.assign({},V,ce);Bi(this,Ue),Z.innerParams.set(this,Ue),Object.defineProperties(this,{params:{value:Object.assign({},this.params,C),writable:!1,enumerable:!0}})},_destroy:function(){const C=Z.domCache.get(this),A=Z.innerParams.get(this);!A||(C.popup&&xt.swalCloseEventFinishedCallback&&(xt.swalCloseEventFinishedCallback(),delete xt.swalCloseEventFinishedCallback),xt.deferDisposalTimer&&(clearTimeout(xt.deferDisposalTimer),delete xt.deferDisposalTimer),"function"==typeof A.didDestroy&&A.didDestroy(),fl(this))}});let Ps;class Js{constructor(...A){if("undefined"==typeof window)return;Ps=this;const V=Object.freeze(this.constructor.argsToParams(A));Object.defineProperties(this,{params:{value:V,writable:!1,enumerable:!0,configurable:!0}});const ce=this._main(this.params);Z.promise.set(this,ce)}then(A){return Z.promise.get(this).then(A)}finally(A){return Z.promise.get(this).finally(A)}}Object.assign(Js.prototype,na),Object.assign(Js,Aa),Object.keys(na).forEach(C=>{Js[C]=function(...A){if(Ps)return Ps[C](...A)}}),Js.DismissReason=Hi,Js.version="11.1.7";const Ds=Js;return Ds.default=Ds,Ds}(),void 0!==this&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),"undefined"!=typeof document&&function(Hi,ot){var Pt=Hi.createElement("style");if(Hi.getElementsByTagName("head")[0].appendChild(Pt),Pt.styleSheet)Pt.styleSheet.disabled||(Pt.styleSheet.cssText=ot);else try{Pt.innerHTML=ot}catch(ts){Pt.innerText=ot}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4!important;grid-row:1/4!important;grid-template-columns:1fr 99fr 1fr;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:700}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.8em;left:-.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{-webkit-animation:swal2-toast-animate-success-line-tip .75s;animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{-webkit-animation:swal2-toast-animate-success-line-long .75s;animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{-webkit-animation:swal2-toast-show .5s;animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{-webkit-animation:swal2-toast-hide .1s forwards;animation:swal2-toast-hide .1s forwards}.swal2-container{display:grid;position:fixed;z-index:1060;top:0;right:0;bottom:0;left:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(-webkit-min-content,auto) minmax(-webkit-min-content,auto) minmax(-webkit-min-content,auto);grid-template-rows:minmax(min-content,auto) minmax(min-content,auto) minmax(min-content,auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}.swal2-container.swal2-backdrop-show,.swal2-container.swal2-noanimation{background:rgba(0,0,0,.4)}.swal2-container.swal2-backdrop-hide{background:0 0!important}.swal2-container.swal2-bottom-start,.swal2-container.swal2-center-start,.swal2-container.swal2-top-start{grid-template-columns:minmax(0,1fr) auto auto}.swal2-container.swal2-bottom,.swal2-container.swal2-center,.swal2-container.swal2-top{grid-template-columns:auto minmax(0,1fr) auto}.swal2-container.swal2-bottom-end,.swal2-container.swal2-center-end,.swal2-container.swal2-top-end{grid-template-columns:auto auto minmax(0,1fr)}.swal2-container.swal2-top-start>.swal2-popup{align-self:start}.swal2-container.swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}.swal2-container.swal2-top-end>.swal2-popup,.swal2-container.swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}.swal2-container.swal2-center-left>.swal2-popup,.swal2-container.swal2-center-start>.swal2-popup{grid-row:2;align-self:center}.swal2-container.swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}.swal2-container.swal2-center-end>.swal2-popup,.swal2-container.swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}.swal2-container.swal2-bottom-left>.swal2-popup,.swal2-container.swal2-bottom-start>.swal2-popup{grid-column:1;grid-row:3;align-self:end}.swal2-container.swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}.swal2-container.swal2-bottom-end>.swal2-popup,.swal2-container.swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}.swal2-container.swal2-grow-fullscreen>.swal2-popup,.swal2-container.swal2-grow-row>.swal2-popup{grid-column:1/4;width:100%}.swal2-container.swal2-grow-column>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}.swal2-container.swal2-no-transition{transition:none!important}.swal2-popup{display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0,100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}.swal2-popup:focus{outline:0}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-title{position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:#595959;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}.swal2-actions{display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}.swal2-actions:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}.swal2-actions:not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0,0,0,.1),rgba(0,0,0,.1))}.swal2-actions:not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2))}.swal2-loader{display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;-webkit-animation:swal2-rotate-loading 1.5s linear 0s infinite normal;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 transparent #2778c4 transparent}.swal2-styled{margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px transparent;font-weight:500}.swal2-styled:not([disabled]){cursor:pointer}.swal2-styled.swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7367f0;color:#fff;font-size:1em}.swal2-styled.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(115,103,240,.5)}.swal2-styled.swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#ea5455;color:#fff;font-size:1em}.swal2-styled.swal2-deny:focus{box-shadow:0 0 0 3px rgba(234,84,85,.5)}.swal2-styled.swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7d88;color:#fff;font-size:1em}.swal2-styled.swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,125,136,.5)}.swal2-styled.swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}.swal2-styled:focus{outline:0}.swal2-styled::-moz-focus-inner{border:0}.swal2-footer{justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:#545454;font-size:1em}.swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto!important;height:.25em;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.swal2-timer-progress-bar{width:100%;height:.25em;background:rgba(0,0,0,.2)}.swal2-image{max-width:100%;margin:2em auto 1em}.swal2-close{z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:0 0;color:#ccc;font-family:serif;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}.swal2-close:hover{transform:none;background:0 0;color:#f27474}.swal2-close:focus{outline:0;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}.swal2-close::-moz-focus-inner{border:0}.swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:#545454;font-size:1.125em;font-weight:400;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}.swal2-checkbox,.swal2-file,.swal2-input,.swal2-radio,.swal2-select,.swal2-textarea{margin:1em 2em 0}.swal2-file,.swal2-input,.swal2-textarea{box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:inherit;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px transparent;color:inherit;font-size:1.125em}.swal2-file.swal2-inputerror,.swal2-input.swal2-inputerror,.swal2-textarea.swal2-inputerror{border-color:#f27474!important;box-shadow:0 0 2px #f27474!important}.swal2-file:focus,.swal2-input:focus,.swal2-textarea:focus{border:1px solid #b4dbed;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}.swal2-file::-moz-placeholder,.swal2-input::-moz-placeholder,.swal2-textarea::-moz-placeholder{color:#ccc}.swal2-file:-ms-input-placeholder,.swal2-input:-ms-input-placeholder,.swal2-textarea:-ms-input-placeholder{color:#ccc}.swal2-file::placeholder,.swal2-input::placeholder,.swal2-textarea::placeholder{color:#ccc}.swal2-range{margin:1em 2em 0;background:#fff}.swal2-range input{width:80%}.swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}.swal2-range input,.swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}.swal2-input{height:2.625em;padding:0 .75em}.swal2-file{width:75%;margin-right:auto;margin-left:auto;background:inherit;font-size:1.125em}.swal2-textarea{height:6.75em;padding:.75em}.swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:inherit;color:inherit;font-size:1.125em}.swal2-checkbox,.swal2-radio{align-items:center;justify-content:center;background:#fff;color:inherit}.swal2-checkbox label,.swal2-radio label{margin:0 .6em;font-size:1.125em}.swal2-checkbox input,.swal2-radio input{flex-shrink:0;margin:0 .4em}.swal2-input-label{display:flex;justify-content:center;margin:1em auto 0}.swal2-validation-message{align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}.swal2-validation-message::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}.swal2-icon{position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid transparent;border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}.swal2-icon.swal2-error{border-color:#f27474;color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;flex-grow:1}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}.swal2-icon.swal2-error.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-error.swal2-icon-show .swal2-x-mark{-webkit-animation:swal2-animate-error-x-mark .5s;animation:swal2-animate-error-x-mark .5s}.swal2-icon.swal2-warning{border-color:#facea8;color:#f8bb86}.swal2-icon.swal2-info{border-color:#9de0f6;color:#3fc3ee}.swal2-icon.swal2-question{border-color:#c9dae1;color:#87adbd}.swal2-icon.swal2-success{border-color:#a5dc86;color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}.swal2-icon.swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-.25em;left:-.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}.swal2-icon.swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-tip{-webkit-animation:swal2-animate-success-line-tip .75s;animation:swal2-animate-success-line-tip .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-long{-webkit-animation:swal2-animate-success-line-long .75s;animation:swal2-animate-success-line-long .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-circular-line-right{-webkit-animation:swal2-rotate-success-circular-line 4.25s ease-in;animation:swal2-rotate-success-circular-line 4.25s ease-in}.swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:inherit;font-weight:600}.swal2-progress-steps li{display:inline-block;position:relative}.swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}.swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}[class^=swal2]{-webkit-tap-highlight-color:transparent}.swal2-show{-webkit-animation:swal2-show .3s;animation:swal2-show .3s}.swal2-hide{-webkit-animation:swal2-hide .15s forwards;animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@-webkit-keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@-webkit-keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@-webkit-keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@-webkit-keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@-webkit-keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@-webkit-keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@-webkit-keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@-webkit-keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@-webkit-keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@-webkit-keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@-webkit-keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@-webkit-keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto!important}body.swal2-no-backdrop .swal2-container{background-color:transparent!important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll!important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static!important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:transparent;pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{top:0;right:auto;bottom:auto;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{top:0;right:0;bottom:auto;left:auto}body.swal2-toast-shown .swal2-container.swal2-top-left,body.swal2-toast-shown .swal2-container.swal2-top-start{top:0;right:auto;bottom:auto;left:0}body.swal2-toast-shown .swal2-container.swal2-center-left,body.swal2-toast-shown .swal2-container.swal2-center-start{top:50%;right:auto;bottom:auto;left:0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{top:50%;right:auto;bottom:auto;left:50%;transform:translate(-50%,-50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{top:50%;right:0;bottom:auto;left:auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-left,body.swal2-toast-shown .swal2-container.swal2-bottom-start{top:auto;right:auto;bottom:0;left:0}body.swal2-toast-shown .swal2-container.swal2-bottom{top:auto;right:auto;bottom:0;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{top:auto;right:0;bottom:0;left:auto}')},1045:(nd,Hi,ot)=>{"use strict";ot.r(Hi),ot.d(Hi,{MonitorViewModule:()=>B0});var Pt=ot(8583),ts=ot(6575),Se=ot(8259),h=ot.n(Se),Ee=ot(7716),Dn=ot(8002),Ki=ot(8030);let Be=(()=>{class o{constructor(i){this.socket=i}connectToRoom(i){this.socket.emit("connect-room",{roomId:i})}receiveUserPosition(){return this.socket.fromEvent("user-position")}receiveAlert(){return this.socket.fromEvent("send-alert")}receiveRecord(){return this.socket.fromEvent("send-record").pipe((0,Dn.U)(i=>i?(console.log("entre?"),{hour:i.hour,message:i.record,typeRecord:i.typeRecord}):null))}finishTravel(){return this.socket.fromEvent("send-finish")}}return o.\u0275fac=function(i){return new(i||o)(Ee.LFG(Ki.sk))},o.\u0275prov=Ee.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var ae=ot(8239);let at=(()=>{class o{constructor(){}initNotifications(){this.onLoad().then(i=>{i.init({appId:"8c55d484-271a-4eed-ae62-cf1fb7cdfa43",welcomeNotification:{title:"Gracias por suscribirte",message:"Ahora podr\xe1s recibir notificaciones si tu amigo sufre de alguna emergencia."}}),i.showSlidedownPrompt()})}showAlertNotification(){this.onLoad().then(i=>{i.sendSelfNotification("!!!Alerta!!!","Tu amigo/a ha enviado un mensaje de alerta.","https://geoen.com","https://icon-library.com/images/geolocation-icon-png/geolocation-icon-png-5.jpg")})}onLoad(){return(0,ae.Z)(function*(){return window.OneSignal=window.OneSignal||[],new Promise(i=>{window.OneSignal.push(()=>{i(window.OneSignal)})})})()}}return o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=Ee.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var Qe,ii=ot(3394),_s=ot(3637),Er=ot(7574),mi=ot(4402),Ur=ot(5917),kn=ot(9121),pr=ot(9761),Me=ot(9328),dn=ot(2145),gn=ot(7519),Sr=ot(5435),nn=ot(8939),Xi=(ot(4828),ot(8026)),Ir=ot(3910),Kn=ot(5422),Mt=ot(3854),qs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Xn={},bi=bi||{},ut=qs||self;function qt(){}function Ti(o){var e=typeof o;return"array"==(e="object"!=e?e:o?Array.isArray(o)?"array":e:"null")||"object"==e&&"number"==typeof o.length}function Qt(o){var e=typeof o;return"object"==e&&null!=o||"function"==e}var fr="closure_uid_"+(1e9*Math.random()>>>0),Ar=0;function ns(o,e,i){return o.call.apply(o.bind,arguments)}function Cr(o,e,i){if(!o)throw Error();if(2<arguments.length){var a=Array.prototype.slice.call(arguments,2);return function(){var p=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(p,a),o.apply(e,p)}}return function(){return o.apply(e,arguments)}}function pt(o,e,i){return(pt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ns:Cr).apply(null,arguments)}function gi(o,e){var i=Array.prototype.slice.call(arguments,1);return function(){var a=i.slice();return a.push.apply(a,arguments),o.apply(this,a)}}function zn(o,e){function i(){}i.prototype=e.prototype,o.Z=e.prototype,o.prototype=new i,o.prototype.constructor=o,o.Vb=function(a,p,v){for(var T=Array(arguments.length-2),M=2;M<arguments.length;M++)T[M-2]=arguments[M];return e.prototype[p].apply(a,T)}}function Yn(){this.s=this.s,this.o=this.o}var ri={};Yn.prototype.s=!1,Yn.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var o=function(o){return Object.prototype.hasOwnProperty.call(o,fr)&&o[fr]||(o[fr]=++Ar)}(this);delete ri[o]}},Yn.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const kr=Array.prototype.indexOf?function(o,e){return Array.prototype.indexOf.call(o,e,void 0)}:function(o,e){if("string"==typeof o)return"string"!=typeof e||1!=e.length?-1:o.indexOf(e,0);for(let i=0;i<o.length;i++)if(i in o&&o[i]===e)return i;return-1},Et=Array.prototype.forEach?function(o,e,i){Array.prototype.forEach.call(o,e,i)}:function(o,e,i){const a=o.length,p="string"==typeof o?o.split(""):o;for(let v=0;v<a;v++)v in p&&e.call(i,p[v],v,o)};function rr(o){return Array.prototype.concat.apply([],arguments)}function zi(o){const e=o.length;if(0<e){const i=Array(e);for(let a=0;a<e;a++)i[a]=o[a];return i}return[]}function At(o){return/^[\s\xa0]*$/.test(o)}var Dt,Li=String.prototype.trim?function(o){return o.trim()}:function(o){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(o)[1]};function Wt(o,e){return-1!=o.indexOf(e)}function yn(o,e){return o<e?-1:o>e?1:0}e:{var rn=ut.navigator;if(rn){var Mr=rn.userAgent;if(Mr){Dt=Mr;break e}}Dt=""}function sr(o,e,i){for(const a in o)e.call(i,o[a],a,o)}function un(o){const e={};for(const i in o)e[i]=o[i];return e}var Vr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ei(o,e){let i,a;for(let p=1;p<arguments.length;p++){for(i in a=arguments[p],a)o[i]=a[i];for(let v=0;v<Vr.length;v++)i=Vr[v],Object.prototype.hasOwnProperty.call(a,i)&&(o[i]=a[i])}}function is(o){return is[" "](o),o}is[" "]=qt;var si,o,ho=Wt(Dt,"Opera"),or=Wt(Dt,"Trident")||Wt(Dt,"MSIE"),Gs=Wt(Dt,"Edge"),js=Gs||or,mr=Wt(Dt,"Gecko")&&!(Wt(Dt.toLowerCase(),"webkit")&&!Wt(Dt,"Edge"))&&!(Wt(Dt,"Trident")||Wt(Dt,"MSIE"))&&!Wt(Dt,"Edge"),Bn=Wt(Dt.toLowerCase(),"webkit")&&!Wt(Dt,"Edge");function qr(){var o=ut.document;return o?o.documentMode:void 0}e:{var Pr="",Fi=(o=Dt,mr?/rv:([^\);]+)(\)|;)/.exec(o):Gs?/Edge\/([\d\.]+)/.exec(o):or?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(o):Bn?/WebKit\/(\S+)/.exec(o):ho?/(?:Version)[ \/]?(\S+)/.exec(o):void 0);if(Fi&&(Pr=Fi?Fi[1]:""),or){var Qi=qr();if(null!=Qi&&Qi>parseFloat(Pr)){si=String(Qi);break e}}si=Pr}var Gr={};function rs(){return e=Gr,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let o=0;const e=Li(String(si)).split("."),i=Li("9").split("."),a=Math.max(e.length,i.length);for(let T=0;0==o&&T<a;T++){var p=e[T]||"",v=i[T]||"";do{if(p=/(\d*)(\D*)(.*)/.exec(p)||["","","",""],v=/(\d*)(\D*)(.*)/.exec(v)||["","","",""],0==p[0].length&&0==v[0].length)break;o=yn(0==p[1].length?0:parseInt(p[1],10),0==v[1].length?0:parseInt(v[1],10))||yn(0==p[2].length,0==v[2].length)||yn(p[2],v[2]),p=p[3],v=v[3]}while(0==o)}return 0<=o}();var e}var $s=ut.document&&or&&(qr()||parseInt(si,10))||void 0,Dr=function(){if(!ut.addEventListener||!Object.defineProperty)return!1;var o=!1,e=Object.defineProperty({},"passive",{get:function(){o=!0}});try{ut.addEventListener("test",qt,e),ut.removeEventListener("test",qt,e)}catch(i){}return o}();function H(o,e){this.type=o,this.g=this.target=e,this.defaultPrevented=!1}function P(o,e){if(H.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var i=this.type=o.type,a=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=e,e=o.relatedTarget){if(mr){e:{try{is(e.nodeName);var p=!0;break e}catch(v){}p=!1}p||(e=null)}}else"mouseover"==i?e=o.fromElement:"mouseout"==i&&(e=o.toElement);this.relatedTarget=e,a?(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:D[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&P.Z.h.call(this)}}H.prototype.h=function(){this.defaultPrevented=!0},zn(P,H);var D={2:"touch",3:"pen",4:"mouse"};P.prototype.h=function(){P.Z.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),G=0;function Z(o,e,i,a,p){this.listener=o,this.proxy=null,this.src=e,this.type=i,this.capture=!!a,this.ia=p,this.key=++G,this.ca=this.fa=!1}function de(o){o.ca=!0,o.listener=null,o.proxy=null,o.src=null,o.ia=null}function fe(o){this.src=o,this.g={},this.h=0}function oe(o,e){var i=e.type;if(i in o.g){var v,a=o.g[i],p=kr(a,e);(v=0<=p)&&Array.prototype.splice.call(a,p,1),v&&(de(e),0==o.g[i].length&&(delete o.g[i],o.h--))}}function ge(o,e,i,a){for(var p=0;p<o.length;++p){var v=o[p];if(!v.ca&&v.listener==e&&v.capture==!!i&&v.ia==a)return p}return-1}fe.prototype.add=function(o,e,i,a,p){var v=o.toString();(o=this.g[v])||(o=this.g[v]=[],this.h++);var T=ge(o,e,a,p);return-1<T?(e=o[T],i||(e.fa=!1)):((e=new Z(e,this.src,v,!!a,p)).fa=i,o.push(e)),e};var Ie="closure_lm_"+(1e6*Math.random()|0),Ge={};function Te(o,e,i,a,p){if(a&&a.once)return be(o,e,i,a,p);if(Array.isArray(e)){for(var v=0;v<e.length;v++)Te(o,e[v],i,a,p);return null}return i=zr(i),o&&o[F]?o.N(e,i,Qt(a)?!!a.capture:!!a,p):it(o,e,i,!1,a,p)}function it(o,e,i,a,p,v){if(!e)throw Error("Invalid event type");var T=Qt(p)?!!p.capture:!!p,M=Ot(o);if(M||(o[Ie]=M=new fe(o)),(i=M.add(e,i,a,T,v)).proxy)return i;if(a=function(){var e=Yt;return function o(i){return e.call(o.src,o.listener,i)}}(),i.proxy=a,a.src=o,a.listener=i,o.addEventListener)Dr||(p=T),void 0===p&&(p=!1),o.addEventListener(e.toString(),a,p);else if(o.attachEvent)o.attachEvent(vt(e.toString()),a);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(a)}return i}function be(o,e,i,a,p){if(Array.isArray(e)){for(var v=0;v<e.length;v++)be(o,e[v],i,a,p);return null}return i=zr(i),o&&o[F]?o.O(e,i,Qt(a)?!!a.capture:!!a,p):it(o,e,i,!0,a,p)}function mt(o,e,i,a,p){if(Array.isArray(e))for(var v=0;v<e.length;v++)mt(o,e[v],i,a,p);else a=Qt(a)?!!a.capture:!!a,i=zr(i),o&&o[F]?(o=o.i,(e=String(e).toString())in o.g&&-1<(i=ge(v=o.g[e],i,a,p))&&(de(v[i]),Array.prototype.splice.call(v,i,1),0==v.length&&(delete o.g[e],o.h--))):o&&(o=Ot(o))&&(e=o.g[e.toString()],o=-1,e&&(o=ge(e,i,a,p)),(i=-1<o?e[o]:null)&&Ct(i))}function Ct(o){if("number"!=typeof o&&o&&!o.ca){var e=o.src;if(e&&e[F])oe(e.i,o);else{var i=o.type,a=o.proxy;e.removeEventListener?e.removeEventListener(i,a,o.capture):e.detachEvent?e.detachEvent(vt(i),a):e.addListener&&e.removeListener&&e.removeListener(a),(i=Ot(e))?(oe(i,o),0==i.h&&(i.src=null,e[Ie]=null)):de(o)}}}function vt(o){return o in Ge?Ge[o]:Ge[o]="on"+o}function Yt(o,e){if(o.ca)o=!0;else{e=new P(e,this);var i=o.listener,a=o.ia||o.src;o.fa&&Ct(o),o=i.call(a,e)}return o}function Ot(o){return(o=o[Ie])instanceof fe?o:null}var sn="__closure_events_fn_"+(1e9*Math.random()>>>0);function zr(o){return"function"==typeof o?o:(o[sn]||(o[sn]=function(e){return o.handleEvent(e)}),o[sn])}function je(){Yn.call(this),this.i=new fe(this),this.P=this,this.I=null}function lt(o,e){var i,a=o.I;if(a)for(i=[];a;a=a.I)i.push(a);if(o=o.P,a=e.type||e,"string"==typeof e)e=new H(e,o);else if(e instanceof H)e.target=e.target||o;else{var p=e;Ei(e=new H(a,o),p)}if(p=!0,i)for(var v=i.length-1;0<=v;v--){var T=e.g=i[v];p=St(T,a,!0,e)&&p}if(p=St(T=e.g=o,a,!0,e)&&p,p=St(T,a,!1,e)&&p,i)for(v=0;v<i.length;v++)p=St(T=e.g=i[v],a,!1,e)&&p}function St(o,e,i,a){if(!(e=o.i.g[String(e)]))return!0;e=e.concat();for(var p=!0,v=0;v<e.length;++v){var T=e[v];if(T&&!T.ca&&T.capture==i){var M=T.listener,N=T.ia||T.src;T.fa&&oe(o.i,T),p=!1!==M.call(N,a)&&p}}return p&&!a.defaultPrevented}zn(je,Yn),je.prototype[F]=!0,je.prototype.removeEventListener=function(o,e,i,a){mt(this,o,e,i,a)},je.prototype.M=function(){if(je.Z.M.call(this),this.i){var e,o=this.i;for(e in o.g){for(var i=o.g[e],a=0;a<i.length;a++)de(i[a]);delete o.g[e],o.h--}}this.I=null},je.prototype.N=function(o,e,i,a){return this.i.add(String(o),e,!1,i,a)},je.prototype.O=function(o,e,i,a){return this.i.add(String(o),e,!0,i,a)};var gr=ut.JSON.stringify;function Ii(){var o=tl;let e=null;return o.g&&(e=o.g,o.g=o.g.next,o.g||(o.h=null),e.next=null),e}var pn,xa=new class{constructor(o,e){this.i=o,this.j=e,this.h=0,this.g=null}get(){let o;return 0<this.h?(this.h--,o=this.g,this.g=o.next,o.next=null):o=this.i(),o}}(()=>new wa,o=>o.reset());class wa{constructor(){this.next=this.g=this.h=null}set(e,i){this.h=e,this.g=i,this.next=null}reset(){this.next=this.g=this.h=null}}function Go(o){ut.setTimeout(()=>{throw o},0)}function Bi(o,e){pn||function(){var o=ut.Promise.resolve(void 0);pn=function(){o.then(jr)}}(),os||(pn(),os=!0),tl.add(o,e)}var os=!1,tl=new class{constructor(){this.h=this.g=null}add(e,i){const a=xa.get();a.set(e,i),this.h?this.h.next=a:this.g=a,this.h=a}};function jr(){for(var o;o=Ii();){try{o.h.call(o.g)}catch(i){Go(i)}var e=xa;e.j(o),100>e.h&&(e.h++,o.next=e.g,e.g=o)}os=!1}function po(o,e){je.call(this),this.h=o||1,this.g=e||ut,this.j=pt(this.kb,this),this.l=Date.now()}function yi(o){o.da=!1,o.S&&(o.g.clearTimeout(o.S),o.S=null)}function $t(o,e,i){if("function"==typeof o)i&&(o=pt(o,i));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=pt(o.handleEvent,o)}return 2147483647<Number(e)?-1:ut.setTimeout(o,e||0)}function ba(o){o.g=$t(()=>{o.g=null,o.i&&(o.i=!1,ba(o))},o.j);const e=o.h;o.h=null,o.m.apply(null,e)}zn(po,je),(Qe=po.prototype).da=!1,Qe.S=null,Qe.kb=function(){if(this.da){var o=Date.now()-this.l;0<o&&o<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-o):(this.S&&(this.g.clearTimeout(this.S),this.S=null),lt(this,"tick"),this.da&&(yi(this),this.start()))}},Qe.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Qe.M=function(){po.Z.M.call(this),yi(this),delete this.g};class xt extends Yn{constructor(e,i){super(),this.m=e,this.j=i,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:ba(this)}M(){super.M(),this.g&&(ut.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oi(o){Yn.call(this),this.h=o,this.g={}}zn(oi,Yn);var yr=[];function Bl(o,e,i,a){Array.isArray(i)||(i&&(yr[0]=i.toString()),i=yr);for(var p=0;p<i.length;p++){var v=Te(e,i[p],a||o.handleEvent,!1,o.h||o);if(!v)break;o.g[v.key]=v}}function jo(o){sr(o.g,function(e,i){this.g.hasOwnProperty(i)&&Ct(e)},o),o.g={}}function Tn(){this.g=!0}function En(o,e,i,a){o.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(o,e){if(!o.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i)for(o=0;o<i.length;o++)if(Array.isArray(i[o])){var a=i[o];if(!(2>a.length)){var p=a[1];if(Array.isArray(p)&&!(1>p.length)){var v=p[0];if("noop"!=v&&"stop"!=v&&"close"!=v)for(var T=1;T<p.length;T++)p[T]=""}}}return gr(i)}catch(M){return e}}(o,i)+(a?" "+a:"")})}oi.prototype.M=function(){oi.Z.M.call(this),jo(this)},oi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Tn.prototype.Aa=function(){this.g=!1},Tn.prototype.info=function(){};var $r={},Ta=null;function vs(){return Ta=Ta||new je}function xs(o){H.call(this,$r.Ma,o)}function Ea(o){const e=vs();lt(e,new xs(e,o))}function il(o,e){H.call(this,$r.STAT_EVENT,o),this.stat=e}function on(o){const e=vs();lt(e,new il(e,o))}function Sa(o,e){H.call(this,$r.Na,o),this.size=e}function ar(o,e){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return ut.setTimeout(function(){o()},e)}$r.Ma="serverreachability",zn(xs,H),$r.STAT_EVENT="statevent",zn(il,H),$r.Na="timingevent",zn(Sa,H);var $o={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ia={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Ol(){}function Aa(){}Ol.prototype.h=null;var sl,ws={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function rl(){H.call(this,"d")}function Nl(){H.call(this,"c")}function ol(){}function Oi(o,e,i,a){this.l=o,this.j=e,this.m=i,this.X=a||1,this.V=new oi(this),this.P=Ul,this.W=new po(o=js?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new al}function al(){this.i=null,this.g="",this.h=!1}zn(rl,H),zn(Nl,H),zn(ol,Ol),ol.prototype.g=function(){return new XMLHttpRequest},ol.prototype.i=function(){return{}},sl=new ol;var Ul=45e3,go={},bs={};function as(o,e,i){o.K=1,o.v=As(Lr(e)),o.s=i,o.U=!0,Zo(o,null)}function Zo(o,e){o.F=Date.now(),Ts(o),o.A=Lr(o.v);var i=o.A,a=o.X;Array.isArray(a)||(a=[String(a)]),To(i.h,"t",a),o.C=0,i=o.l.H,o.h=new al,o.g=ls(o.l,i?e:null,!o.s),0<o.O&&(o.L=new xt(pt(o.Ia,o,o.g),o.O)),Bl(o.V,o.g,"readystatechange",o.gb),e=o.H?un(o.H):{},o.s?(o.u||(o.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.s,e)):(o.u="GET",o.g.ea(o.A,o.u,null,e)),Ea(1),function(o,e,i,a,p,v){o.info(function(){if(o.g)if(v)for(var T="",M=v.split("&"),N=0;N<M.length;N++){var K=M[N].split("=");if(1<K.length){var ne=K[0];K=K[1];var me=ne.split("_");T=2<=me.length&&"type"==me[1]?T+(ne+"=")+K+"&":T+(ne+"=redacted&")}}else T=null;else T=v;return"XMLHTTP REQ ("+a+") [attempt "+p+"]: "+e+"\n"+i+"\n"+T})}(o.j,o.u,o.A,o.m,o.X,o.s)}function Wo(o){return!!o.g&&"GET"==o.u&&2!=o.K&&o.l.Ba}function Gt(o,e,i){let p,a=!0;for(;!o.I&&o.C<i.length;){if(p=Ho(o,i),p==bs){4==e&&(o.o=4,on(14),a=!1),En(o.j,o.m,null,"[Incomplete Response]");break}if(p==go){o.o=4,on(15),En(o.j,o.m,i,"[Invalid Chunk]"),a=!1;break}En(o.j,o.m,p,null),yo(o,p)}Wo(o)&&p!=bs&&p!=go&&(o.h.g="",o.C=0),4!=e||0!=i.length||o.h.h||(o.o=1,on(16),a=!1),o.i=o.i&&a,a?0<i.length&&!o.aa&&(o.aa=!0,(e=o.l).g==o&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+i.length),A(e),e.L=!0,on(11))):(En(o.j,o.m,i,"[Invalid Chunked Response]"),Nt(o),Es(o))}function Ho(o,e){var i=o.C,a=e.indexOf("\n",i);return-1==a?bs:(i=Number(e.substring(i,a)),isNaN(i)?go:(a+=1)+i>e.length?bs:(e=e.substr(a,i),o.C=a+i,e))}function Ts(o){o.Y=Date.now()+o.P,ll(o,o.P)}function ll(o,e){if(null!=o.B)throw Error("WatchDog timer not null");o.B=ar(pt(o.eb,o),e)}function Zr(o){o.B&&(ut.clearTimeout(o.B),o.B=null)}function Es(o){0==o.l.G||o.I||Ue(o.l,o)}function Nt(o){Zr(o);var e=o.L;e&&"function"==typeof e.na&&e.na(),o.L=null,yi(o.W),jo(o.V),o.g&&(e=o.g,o.g=null,e.abort(),e.na())}function yo(o,e){try{var i=o.l;if(0!=i.G&&(i.g==o||Qo(i.i,o)))if(i.I=o.N,!o.J&&Qo(i.i,o)&&3==i.G){try{var a=i.Ca.g.parse(e)}catch(K){a=null}if(Array.isArray(a)&&3==a.length){var p=a;if(0==p[0])e:if(i.u)i.ta=p[1],0<i.ta-i.U&&37500>p[2]&&i.N&&0==i.A&&!i.v&&(i.v=ar(pt(i.ab,i),6e3));else{if(i.g){if(!(i.g.F+3e3<o.F))break e;ce(i),Qs(i)}C(i),on(18)}if(1>=So(i.i)&&i.ka){try{i.ka()}catch(K){}i.ka=void 0}}else fn(i,11)}else if((o.J||i.g==o)&&ce(i),!At(e))for(p=i.Ca.g.parse(e),e=0;e<p.length;e++){let K=p[e];if(i.U=K[0],K=K[1],2==i.G)if("c"==K[0]){i.J=K[1],i.la=K[2];const ne=K[3];null!=ne&&(i.ma=ne,i.h.info("VER="+i.ma));const me=K[4];null!=me&&(i.za=me,i.h.info("SVER="+i.za));const ke=K[5];null!=ke&&"number"==typeof ke&&0<ke&&(i.K=a=1.5*ke,i.h.info("backChannelRequestTimeoutMs_="+a)),a=i;const Ve=o.g;if(Ve){const et=Ve.g?Ve.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(et){var v=a.i;!v.g&&(Wt(et,"spdy")||Wt(et,"quic")||Wt(et,"h2"))&&(v.j=v.l,v.g=new Set,v.h&&(ks(v,v.h),v.h=null))}if(a.D){const ht=Ve.g?Ve.g.getResponseHeader("X-HTTP-Session-Id"):null;ht&&(a.sa=ht,Sn(a.F,a.D,ht))}}i.G=3,i.j&&i.j.xa(),i.$&&(i.O=Date.now()-o.F,i.h.info("Handshake RTT: "+i.O+"ms"));var T=o;if((a=i).oa=Ci(a,a.H?a.la:null,a.W),T.J){Pa(a.i,T);var M=T,N=a.K;N&&M.setTimeout(N),M.B&&(Zr(M),Ts(M)),a.g=T}else Ds(a);0<i.l.length&&fl(i)}else"stop"!=K[0]&&"close"!=K[0]||fn(i,7);else 3==i.G&&("stop"==K[0]||"close"==K[0]?"stop"==K[0]?fn(i,7):Mo(i):"noop"!=K[0]&&i.j&&i.j.wa(K),i.A=0)}Ea(4)}catch(K){}}function Ko(o,e){if(o.forEach&&"function"==typeof o.forEach)o.forEach(e,void 0);else if(Ti(o)||"string"==typeof o)Et(o,e,void 0);else{if(o.T&&"function"==typeof o.T)var i=o.T();else if(o.R&&"function"==typeof o.R)i=void 0;else if(Ti(o)||"string"==typeof o){i=[];for(var a=o.length,p=0;p<a;p++)i.push(p)}else for(p in i=[],a=0,o)i[a++]=p;p=(a=function(o){if(o.R&&"function"==typeof o.R)return o.R();if("string"==typeof o)return o.split("");if(Ti(o)){for(var e=[],i=o.length,a=0;a<i;a++)e.push(o[a]);return e}for(a in e=[],i=0,o)e[i++]=o[a];return e}(o)).length;for(var v=0;v<p;v++)e.call(void 0,a[v],i&&i[v],o)}}function Zs(o,e){this.h={},this.g=[],this.i=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var a=0;a<i;a+=2)this.set(arguments[a],arguments[a+1])}else if(o)if(o instanceof Zs)for(i=o.T(),a=0;a<i.length;a++)this.set(i[a],o.get(i[a]));else for(a in o)this.set(a,o[a])}function _o(o){if(o.i!=o.g.length){for(var e=0,i=0;e<o.g.length;){var a=o.g[e];Ss(o.h,a)&&(o.g[i++]=a),e++}o.g.length=i}if(o.i!=o.g.length){var p={};for(i=e=0;e<o.g.length;)Ss(p,a=o.g[e])||(o.g[i++]=a,p[a]=1),e++;o.g.length=i}}function Ss(o,e){return Object.prototype.hasOwnProperty.call(o,e)}(Qe=Oi.prototype).setTimeout=function(o){this.P=o},Qe.gb=function(o){o=o.target;const e=this.L;e&&3==Ni(o)?e.l():this.Ia(o)},Qe.Ia=function(o){try{if(o==this.g)e:{const ne=Ni(this.g);var e=this.g.Da();const me=this.g.ba();if(!(3>ne)&&(3!=ne||js||this.g&&(this.h.h||this.g.ga()||vr(this.g)))){this.I||4!=ne||7==e||Ea(8==e||0>=me?3:2),Zr(this);var i=this.g.ba();this.N=i;t:if(Wo(this)){var a=vr(this.g);o="";var p=a.length,v=4==Ni(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Nt(this),Es(this);var T="";break t}this.h.i=new ut.TextDecoder}for(e=0;e<p;e++)this.h.h=!0,o+=this.h.i.decode(a[e],{stream:v&&e==p-1});a.splice(0,p),this.h.g+=o,this.C=0,T=this.h.g}else T=this.g.ga();if(this.i=200==i,function(o,e,i,a,p,v,T){o.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+p+"]: "+e+"\n"+i+"\n"+v+" "+T})}(this.j,this.u,this.A,this.m,this.X,ne,i),this.i){if(this.$&&!this.J){t:{if(this.g){var M,N=this.g;if((M=N.g?N.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!At(M)){var K=M;break t}}K=null}if(!(i=K)){this.i=!1,this.o=3,on(12),Nt(this),Es(this);break e}En(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,yo(this,i)}this.U?(Gt(this,ne,T),js&&this.i&&3==ne&&(Bl(this.V,this.W,"tick",this.fb),this.W.start())):(En(this.j,this.m,T,null),yo(this,T)),4==ne&&Nt(this),this.i&&!this.I&&(4==ne?Ue(this.l,this):(this.i=!1,Ts(this)))}else 400==i&&0<T.indexOf("Unknown SID")?(this.o=3,on(12)):(this.o=0,on(13)),Nt(this),Es(this)}}}catch(ne){}},Qe.fb=function(){if(this.g){var o=Ni(this.g),e=this.g.ga();this.C<e.length&&(Zr(this),Gt(this,o,e),this.i&&4!=o&&Ts(this))}},Qe.cancel=function(){this.I=!0,Nt(this)},Qe.eb=function(){this.B=null;const o=Date.now();0<=o-this.Y?(function(o,e){o.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Ea(3),on(17)),Nt(this),this.o=2,Es(this)):ll(this,this.Y-o)},(Qe=Zs.prototype).R=function(){_o(this);for(var o=[],e=0;e<this.g.length;e++)o.push(this.h[this.g[e]]);return o},Qe.T=function(){return _o(this),this.g.concat()},Qe.get=function(o,e){return Ss(this.h,o)?this.h[o]:e},Qe.set=function(o,e){Ss(this.h,o)||(this.i++,this.g.push(o)),this.h[o]=e},Qe.forEach=function(o,e){for(var i=this.T(),a=0;a<i.length;a++){var p=i[a],v=this.get(p);o.call(e,v,p,this)}};var xc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Is(o,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,o instanceof Is){this.g=void 0!==e?e:o.g,vo(this,o.j),this.s=o.s,xo(this,o.i),wo(this,o.m),this.l=o.l,e=o.h;var i=new Ws;i.i=e.i,e.g&&(i.g=new Zs(e.g),i.h=e.h),Vl(this,i),this.o=o.o}else o&&(i=String(o).match(xc))?(this.g=!!e,vo(this,i[1]||"",!0),this.s=Ai(i[2]||""),xo(this,i[3]||"",!0),wo(this,i[4]),this.l=Ai(i[5]||"",!0),Vl(this,i[6]||"",!0),this.o=Ai(i[7]||"")):(this.g=!!e,this.h=new Ws(null,this.g))}function Lr(o){return new Is(o)}function vo(o,e,i){o.j=i?Ai(e,!0):e,o.j&&(o.j=o.j.replace(/:$/,""))}function xo(o,e,i){o.i=i?Ai(e,!0):e}function wo(o,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);o.m=e}else o.m=null}function Vl(o,e,i){e instanceof Ws?(o.h=e,function(o,e){e&&!o.j&&(Rr(o),o.i=null,o.g.forEach(function(i,a){var p=a.toLowerCase();a!=p&&(Ma(this,a),To(this,p,i))},o)),o.j=e}(o.h,o.g)):(i||(e=bo(e,ul)),o.h=new Ws(e,o.g))}function Sn(o,e,i){o.h.set(e,i)}function As(o){return Sn(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ai(o,e){return o?e?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function bo(o,e,i){return"string"==typeof o?(o=encodeURI(o).replace(e,cl),i&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function cl(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}Is.prototype.toString=function(){var o=[],e=this.j;e&&o.push(bo(e,Yo,!0),":");var i=this.i;return(i||"file"==e)&&(o.push("//"),(e=this.s)&&o.push(bo(e,Yo,!0),"@"),o.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&o.push(":",String(i))),(i=this.l)&&(this.i&&"/"!=i.charAt(0)&&o.push("/"),o.push(bo(i,"/"==i.charAt(0)?ka:ql,!0))),(i=this.h.toString())&&o.push("?",i),(i=this.o)&&o.push("#",bo(i,Cs)),o.join("")};var Yo=/[#\/\?@]/g,ql=/[#\?:]/g,ka=/[#\?]/g,ul=/[#\?@]/g,Cs=/#/g;function Ws(o,e){this.h=this.g=null,this.i=o||null,this.j=!!e}function Rr(o){o.g||(o.g=new Zs,o.h=0,o.i&&function(o,e){if(o){o=o.split("&");for(var i=0;i<o.length;i++){var a=o[i].indexOf("="),p=null;if(0<=a){var v=o[i].substring(0,a);p=o[i].substring(a+1)}else v=o[i];e(v,p?decodeURIComponent(p.replace(/\+/g," ")):"")}}}(o.i,function(e,i){o.add(decodeURIComponent(e.replace(/\+/g," ")),i)}))}function Ma(o,e){Rr(o),e=Eo(o,e),Ss(o.g.h,e)&&(o.i=null,o.h-=o.g.get(e).length,Ss((o=o.g).h,e)&&(delete o.h[e],o.i--,o.g.length>2*o.i&&_o(o)))}function Gl(o,e){return Rr(o),e=Eo(o,e),Ss(o.g.h,e)}function To(o,e,i){Ma(o,e),0<i.length&&(o.i=null,o.g.set(Eo(o,e),zi(i)),o.h+=i.length)}function Eo(o,e){return e=String(e),o.j&&(e=e.toLowerCase()),e}function Ec(o){this.l=o||au,o=ut.PerformanceNavigationTiming?0<(o=ut.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(ut.g&&ut.g.Ea&&ut.g.Ea()&&ut.g.Ea().Zb),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Qe=Ws.prototype).add=function(o,e){Rr(this),this.i=null,o=Eo(this,o);var i=this.g.get(o);return i||this.g.set(o,i=[]),i.push(e),this.h+=1,this},Qe.forEach=function(o,e){Rr(this),this.g.forEach(function(i,a){Et(i,function(p){o.call(e,p,a,this)},this)},this)},Qe.T=function(){Rr(this);for(var o=this.g.R(),e=this.g.T(),i=[],a=0;a<e.length;a++)for(var p=o[a],v=0;v<p.length;v++)i.push(e[a]);return i},Qe.R=function(o){Rr(this);var e=[];if("string"==typeof o)Gl(this,o)&&(e=rr(e,this.g.get(Eo(this,o))));else{o=this.g.R();for(var i=0;i<o.length;i++)e=rr(e,o[i])}return e},Qe.set=function(o,e){return Rr(this),this.i=null,Gl(this,o=Eo(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[e]),this.h+=1,this},Qe.get=function(o,e){return o&&0<(o=this.R(o)).length?String(o[0]):e},Qe.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var o=[],e=this.g.T(),i=0;i<e.length;i++){var a=e[i],p=encodeURIComponent(String(a));a=this.R(a);for(var v=0;v<a.length;v++){var T=p;""!==a[v]&&(T+="="+encodeURIComponent(String(a[v]))),o.push(T)}}return this.i=o.join("&")};var au=10;function Sc(o){return!!o.h||!!o.g&&o.g.size>=o.j}function So(o){return o.h?1:o.g?o.g.size:0}function Qo(o,e){return o.h?o.h==e:!!o.g&&o.g.has(e)}function ks(o,e){o.g?o.g.add(e):o.h=e}function Pa(o,e){o.h&&o.h==e?o.h=null:o.g&&o.g.has(e)&&o.g.delete(e)}function hl(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let e=o.i;for(const i of o.g.values())e=e.concat(i.D);return e}return zi(o.i)}function Da(){}function Hs(){this.g=new Da}function jl(o,e,i){const a=i||"";try{Ko(o,function(p,v){let T=p;Qt(p)&&(T=gr(p)),e.push(a+v+"="+encodeURIComponent(T))})}catch(p){throw e.push(a+"type="+encodeURIComponent("_badmap")),p}}function Wr(o,e,i,a,p){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,p(a)}catch(v){}}function Xs(o){this.l=o.$b||null,this.j=o.ib||!1}function Io(o,e){je.call(this),this.D=o,this.u=e,this.m=void 0,this.readyState=Zt,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ec.prototype.cancel=function(){if(this.i=hl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}},Da.prototype.stringify=function(o){return ut.JSON.stringify(o,void 0)},Da.prototype.parse=function(o){return ut.JSON.parse(o,void 0)},zn(Xs,Ol),Xs.prototype.g=function(){return new Io(this.l,this.j)},Xs.prototype.i=function(o){return function(){return o}}({}),zn(Io,je);var Zt=0;function za(o){o.j.read().then(o.Sa.bind(o)).catch(o.ha.bind(o))}function Ao(o){o.readyState=4,o.l=null,o.j=null,o.A=null,Co(o)}function Co(o){o.onreadystatechange&&o.onreadystatechange.call(o)}(Qe=Io.prototype).open=function(o,e){if(this.readyState!=Zt)throw this.abort(),Error("Error reopening a connection");this.C=o,this.B=e,this.readyState=1,Co(this)},Qe.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};o&&(e.body=o),(this.D||ut).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},Qe.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ao(this)),this.readyState=Zt},Qe.Va=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Co(this)),this.g&&(this.readyState=3,Co(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==ut.ReadableStream&&"body"in o){if(this.j=o.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;za(this)}else o.text().then(this.Ua.bind(this),this.ha.bind(this))},Qe.Sa=function(o){if(this.g){if(this.u&&o.value)this.response.push(o.value);else if(!this.u){var e=o.value?o.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!o.done}))&&(this.response=this.responseText+=e)}o.done?Ao(this):Co(this),3==this.readyState&&za(this)}},Qe.Ua=function(o){this.g&&(this.response=this.responseText=o,Ao(this))},Qe.Ta=function(o){this.g&&(this.response=o,Ao(this))},Qe.ha=function(){this.g&&Ao(this)},Qe.setRequestHeader=function(o,e){this.v.append(o,e)},Qe.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},Qe.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],e=this.h.entries();for(var i=e.next();!i.done;)o.push((i=i.value)[0]+": "+i[1]),i=e.next();return o.join("\r\n")},Object.defineProperty(Io.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}});var Jo=ut.JSON.parse;function Vn(o){je.call(this),this.headers=new Zs,this.u=o||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=La,this.K=this.L=!1}zn(Vn,je);var La="",Ic=/^https?$/i,lu=["POST","PUT"];function Hr(o){return"content-type"==o.toLowerCase()}function ea(o,e){o.h=!1,o.g&&(o.l=!0,o.g.abort(),o.l=!1),o.j=e,o.m=5,Fr(o),Fa(o)}function Fr(o){o.D||(o.D=!0,lt(o,"complete"),lt(o,"error"))}function Ra(o){if(o.h&&void 0!==bi&&(!o.C[1]||4!=Ni(o)||2!=o.ba()))if(o.v&&4==Ni(o))$t(o.Fa,0,o);else if(lt(o,"readystatechange"),4==Ni(o)){o.h=!1;try{const M=o.ba();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var i;if(!(i=e)){var a;if(a=0===M){var p=String(o.H).match(xc)[1]||null;if(!p&&ut.self&&ut.self.location){var v=ut.self.location.protocol;p=v.substr(0,v.length-1)}a=!Ic.test(p?p.toLowerCase():"")}i=a}if(i)lt(o,"complete"),lt(o,"success");else{o.m=6;try{var T=2<Ni(o)?o.g.statusText:""}catch(N){T=""}o.j=T+" ["+o.ba()+"]",Fr(o)}}finally{Fa(o)}}}function Fa(o,e){if(o.g){ko(o);const i=o.g,a=o.C[0]?qt:null;o.g=null,o.C=null,e||lt(o,"ready");try{i.onreadystatechange=a}catch(p){}}}function ko(o){o.g&&o.K&&(o.g.ontimeout=null),o.A&&(ut.clearTimeout(o.A),o.A=null)}function Ni(o){return o.g?o.g.readyState:0}function vr(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.J){case La:case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ba(o,e,i){e:{for(a in i){var a=!1;break e}a=!0}a||(i=function(o){let e="";return sr(o,function(i,a){e+=a,e+=":",e+=i,e+="\r\n"}),e}(i),"string"==typeof o?null!=i&&encodeURIComponent(String(i)):Sn(o,e,i))}function Ys(o,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[o]||e}function Ms(o){this.za=0,this.l=[],this.h=new Tn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Ys("failFast",!1,o),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Ys("baseRetryDelayMs",5e3,o),this.$a=Ys("retryDelaySeedMs",1e4,o),this.Ya=Ys("forwardChannelMaxRetries",2,o),this.ra=Ys("forwardChannelRequestTimeoutMs",2e4,o),this.qa=o&&o.xmlHttpFactory||void 0,this.Ba=o&&o.Yb||!1,this.K=void 0,this.H=o&&o.supportsCrossDomainXhr||!1,this.J="",this.i=new Ec(o&&o.concurrentRequestLimit),this.Ca=new Hs,this.ja=o&&o.fastHandshake||!1,this.Ra=o&&o.Wb||!1,o&&o.Aa&&this.h.Aa(),o&&o.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&o&&o.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!o||!1!==o.Xb}function Mo(o){if(pl(o),3==o.G){var e=o.V++,i=Lr(o.F);Sn(i,"SID",o.J),Sn(i,"RID",e),Sn(i,"TYPE","terminate"),Ps(o,i),(e=new Oi(o,o.h,e,void 0)).K=2,e.v=As(Lr(i)),i=!1,ut.navigator&&ut.navigator.sendBeacon&&(i=ut.navigator.sendBeacon(e.v.toString(),"")),!i&&ut.Image&&((new Image).src=e.v,i=!0),i||(e.g=ls(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ts(e)}ai(o)}function Qs(o){o.g&&(A(o),o.g.cancel(),o.g=null)}function pl(o){Qs(o),o.u&&(ut.clearTimeout(o.u),o.u=null),ce(o),o.i.cancel(),o.m&&("number"==typeof o.m&&ut.clearTimeout(o.m),o.m=null)}function Po(o,e){o.l.push(new class{constructor(o,e){this.h=o,this.g=e}}(o.Za++,e)),3==o.G&&fl(o)}function fl(o){Sc(o.i)||o.m||(o.m=!0,Bi(o.Ha,o),o.C=0)}function na(o,e){var i;i=e?e.m:o.V++;const a=Lr(o.F);Sn(a,"SID",o.J),Sn(a,"RID",i),Sn(a,"AID",o.U),Ps(o,a),o.o&&o.s&&Ba(a,o.o,o.s),i=new Oi(o,o.h,i,o.C+1),null===o.o&&(i.H=o.s),e&&(o.l=e.D.concat(o.l)),e=Js(o,i,1e3),i.setTimeout(Math.round(.5*o.ra)+Math.round(.5*o.ra*Math.random())),ks(o.i,i),as(i,a,e)}function Ps(o,e){o.j&&Ko({},function(i,a){Sn(e,a,i)})}function Js(o,e,i){i=Math.min(o.l.length,i);var a=o.j?pt(o.j.Oa,o.j,o):null;e:{var p=o.l;let v=-1;for(;;){const T=["count="+i];-1==v?0<i?(v=p[0].h,T.push("ofs="+v)):v=0:T.push("ofs="+v);let M=!0;for(let N=0;N<i;N++){let K=p[N].h;const ne=p[N].g;if(K-=v,0>K)v=Math.max(0,p[N].h-100),M=!1;else try{jl(ne,T,"req"+K+"_")}catch(me){a&&a(ne)}}if(M){a=T.join("&");break e}}}return o=o.l.splice(0,i),e.D=o,a}function Ds(o){o.g||o.u||(o.Y=1,Bi(o.Ga,o),o.A=0)}function C(o){return!(o.g||o.u||3<=o.A||(o.Y++,o.u=ar(pt(o.Ga,o),yt(o,o.A)),o.A++,0))}function A(o){null!=o.B&&(ut.clearTimeout(o.B),o.B=null)}function V(o){o.g=new Oi(o,o.h,"rpc",o.Y),null===o.o&&(o.g.H=o.s),o.g.O=0;var e=Lr(o.oa);Sn(e,"RID","rpc"),Sn(e,"SID",o.J),Sn(e,"CI",o.N?"0":"1"),Sn(e,"AID",o.U),Ps(o,e),Sn(e,"TYPE","xmlhttp"),o.o&&o.s&&Ba(e,o.o,o.s),o.K&&o.g.setTimeout(o.K);var i=o.g;o=o.la,i.K=1,i.v=As(Lr(e)),i.s=null,i.U=!0,Zo(i,o)}function ce(o){null!=o.v&&(ut.clearTimeout(o.v),o.v=null)}function Ue(o,e){var i=null;if(o.g==e){ce(o),A(o),o.g=null;var a=2}else{if(!Qo(o.i,e))return;i=e.D,Pa(o.i,e),a=1}if(o.I=e.N,0!=o.G)if(e.i)if(1==a){i=e.s?e.s.length:0,e=Date.now()-e.F;var p=o.C;lt(a=vs(),new Sa(a,i,e,p)),fl(o)}else Ds(o);else if(3==(p=e.o)||0==p&&0<o.I||!(1==a&&function(o,e){return!(So(o.i)>=o.i.j-(o.m?1:0)||(o.m?(o.l=e.D.concat(o.l),0):1==o.G||2==o.G||o.C>=(o.Xa?0:o.Ya)||(o.m=ar(pt(o.Ha,o,e),yt(o,o.C)),o.C++,0)))}(o,e)||2==a&&C(o)))switch(i&&0<i.length&&(e=o.i,e.i=e.i.concat(i)),p){case 1:fn(o,5);break;case 4:fn(o,10);break;case 3:fn(o,6);break;default:fn(o,2)}}function yt(o,e){let i=o.Pa+Math.floor(Math.random()*o.$a);return o.j||(i*=2),i*e}function fn(o,e){if(o.h.info("Error code "+e),2==e){var i=null;o.j&&(i=null);var a=pt(o.jb,o);i||(i=new Is("//www.google.com/images/cleardot.gif"),ut.location&&"http"==ut.location.protocol||vo(i,"https"),As(i)),function(o,e){const i=new Tn;if(ut.Image){const a=new Image;a.onload=gi(Wr,i,a,"TestLoadImage: loaded",!0,e),a.onerror=gi(Wr,i,a,"TestLoadImage: error",!1,e),a.onabort=gi(Wr,i,a,"TestLoadImage: abort",!1,e),a.ontimeout=gi(Wr,i,a,"TestLoadImage: timeout",!1,e),ut.setTimeout(function(){a.ontimeout&&a.ontimeout()},1e4),a.src=o}else e(!1)}(i.toString(),a)}else on(2);o.G=0,o.j&&o.j.va(e),ai(o),pl(o)}function ai(o){o.G=0,o.I=-1,o.j&&((0!=hl(o.i).length||0!=o.l.length)&&(o.i.i.length=0,zi(o.l),o.l.length=0),o.j.ua())}function Ci(o,e,i){let a=function(o){return o instanceof Is?Lr(o):new Is(o,void 0)}(i);if(""!=a.i)e&&xo(a,e+"."+a.i),wo(a,a.m);else{const p=ut.location;a=function(o,e,i,a){var p=new Is(null,void 0);return o&&vo(p,o),e&&xo(p,e),i&&wo(p,i),a&&(p.l=a),p}(p.protocol,e?e+"."+p.hostname:p.hostname,+p.port,i)}return o.aa&&sr(o.aa,function(p,v){Sn(a,v,p)}),i=o.sa,(e=o.D)&&i&&Sn(a,e,i),Sn(a,"VER",o.ma),Ps(o,a),a}function ls(o,e,i){if(e&&!o.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Vn(i&&o.Ba&&!o.qa?new Xs({ib:!0}):o.qa)).L=o.H,e}function Oa(){}function Na(){if(or&&!(10<=Number($s)))throw Error("Environmental error: no available transport.")}function Br(o,e){je.call(this),this.g=new Ms(e),this.l=o,this.h=e&&e.messageUrlParams||null,o=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.s=o,o=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(o?o["X-WebChannel-Content-Type"]=e.messageContentType:o={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(o?o["X-WebChannel-Client-Profile"]=e.ya:o={"X-WebChannel-Client-Profile":e.ya}),this.g.P=o,(o=e&&e.httpHeadersOverwriteParam)&&!At(o)&&(this.g.o=o),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!At(e)&&(this.g.D=e,null!==(o=this.h)&&e in o&&e in(o=this.h)&&delete o[e]),this.j=new ml(this)}function cu(o){rl.call(this);var e=o.__sm__;if(e){e:{for(const i in e){o=i;break e}o=void 0}(this.i=o)&&(o=this.i,e=null!==e&&o in e?e[o]:void 0),this.data=e}else this.data=o}function Ui(){Nl.call(this),this.status=1}function ml(o){this.g=o}(Qe=Vn.prototype).ea=function(o,e,i,a){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+o);e=e?e.toUpperCase():"GET",this.H=o,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():sl.g(),this.C=function(o){return o.h||(o.h=o.i())}(this.u?this.u:sl),this.g.onreadystatechange=pt(this.Fa,this);try{this.F=!0,this.g.open(e,String(o),!0),this.F=!1}catch(v){return void ea(this,v)}o=i||"";const p=new Zs(this.headers);a&&Ko(a,function(v,T){p.set(T,v)}),a=function(o){e:{var e=Hr;const i=o.length,a="string"==typeof o?o.split(""):o;for(let p=0;p<i;p++)if(p in a&&e.call(void 0,a[p],p,o)){e=p;break e}e=-1}return 0>e?null:"string"==typeof o?o.charAt(e):o[e]}(p.T()),i=ut.FormData&&o instanceof ut.FormData,!(0<=kr(lu,e))||a||i||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),p.forEach(function(v,T){this.g.setRequestHeader(T,v)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ko(this),0<this.B&&((this.K=function(o){return or&&rs()&&"number"==typeof o.timeout&&void 0!==o.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=pt(this.pa,this)):this.A=$t(this.pa,this.B,this)),this.v=!0,this.g.send(o),this.v=!1}catch(v){ea(this,v)}},Qe.pa=function(){void 0!==bi&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,lt(this,"timeout"),this.abort(8))},Qe.abort=function(o){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=o||7,lt(this,"complete"),lt(this,"abort"),Fa(this))},Qe.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Fa(this,!0)),Vn.Z.M.call(this)},Qe.Fa=function(){this.s||(this.F||this.v||this.l?Ra(this):this.cb())},Qe.cb=function(){Ra(this)},Qe.ba=function(){try{return 2<Ni(this)?this.g.status:-1}catch(o){return-1}},Qe.ga=function(){try{return this.g?this.g.responseText:""}catch(o){return""}},Qe.Qa=function(o){if(this.g){var e=this.g.responseText;return o&&0==e.indexOf(o)&&(e=e.substring(o.length)),Jo(e)}},Qe.Da=function(){return this.m},Qe.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Qe=Ms.prototype).ma=8,Qe.G=1,Qe.hb=function(o){try{this.h.info("Origin Trials invoked: "+o)}catch(e){}},Qe.Ha=function(o){if(this.m)if(this.m=null,1==this.G){if(!o){this.V=Math.floor(1e5*Math.random()),o=this.V++;const p=new Oi(this,this.h,o,void 0);let v=this.s;if(this.P&&(v?(v=un(v),Ei(v,this.P)):v=this.P),null===this.o&&(p.H=v),this.ja)e:{for(var e=0,i=0;i<this.l.length;i++){var a=this.l[i];if(void 0===(a="__data__"in a.g&&"string"==typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(e+=a)){e=i;break e}if(4096===e||i===this.l.length-1){e=i+1;break e}}e=1e3}else e=1e3;e=Js(this,p,e),Sn(i=Lr(this.F),"RID",o),Sn(i,"CVER",22),this.D&&Sn(i,"X-HTTP-Session-Id",this.D),Ps(this,i),this.o&&v&&Ba(i,this.o,v),ks(this.i,p),this.Ra&&Sn(i,"TYPE","init"),this.ja?(Sn(i,"$req",e),Sn(i,"SID","null"),p.$=!0,as(p,i,null)):as(p,i,e),this.G=2}}else 3==this.G&&(o?na(this,o):0==this.l.length||Sc(this.i)||na(this))},Qe.Ga=function(){if(this.u=null,V(this),this.$&&!(this.L||null==this.g||0>=this.O)){var o=2*this.O;this.h.info("BP detection timer enabled: "+o),this.B=ar(pt(this.bb,this),o)}},Qe.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,on(10),Qs(this),V(this))},Qe.ab=function(){null!=this.v&&(this.v=null,Qs(this),C(this),on(19))},Qe.jb=function(o){o?(this.h.info("Successfully pinged google.com"),on(2)):(this.h.info("Failed to ping google.com"),on(1))},(Qe=Oa.prototype).xa=function(){},Qe.wa=function(){},Qe.va=function(){},Qe.ua=function(){},Qe.Oa=function(){},Na.prototype.g=function(o,e){return new Br(o,e)},zn(Br,je),Br.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var o=this.g,e=this.l,i=this.h||void 0;o.Wa&&(o.h.info("Origin Trials enabled."),Bi(pt(o.hb,o,e))),on(0),o.W=e,o.aa=i||{},o.N=o.X,o.F=Ci(o,null,o.W),fl(o)},Br.prototype.close=function(){Mo(this.g)},Br.prototype.u=function(o){if("string"==typeof o){var e={};e.__data__=o,Po(this.g,e)}else this.v?((e={}).__data__=gr(o),Po(this.g,e)):Po(this.g,o)},Br.prototype.M=function(){this.g.j=null,delete this.j,Mo(this.g),delete this.g,Br.Z.M.call(this)},zn(cu,rl),zn(Ui,Nl),zn(ml,Oa),ml.prototype.xa=function(){lt(this.g,"a")},ml.prototype.wa=function(o){lt(this.g,new cu(o))},ml.prototype.va=function(o){lt(this.g,new Ui(o))},ml.prototype.ua=function(){lt(this.g,"b")},Na.prototype.createWebChannel=Na.prototype.g,Br.prototype.send=Br.prototype.u,Br.prototype.open=Br.prototype.m,Br.prototype.close=Br.prototype.close,$o.NO_ERROR=0,$o.TIMEOUT=8,$o.HTTP_ERROR=6,Ia.COMPLETE="complete",Aa.EventType=ws,ws.OPEN="a",ws.CLOSE="b",ws.ERROR="c",ws.MESSAGE="d",je.prototype.listen=je.prototype.N,Vn.prototype.listenOnce=Vn.prototype.O,Vn.prototype.getLastError=Vn.prototype.La,Vn.prototype.getLastErrorCode=Vn.prototype.Da,Vn.prototype.getStatus=Vn.prototype.ba,Vn.prototype.getResponseJson=Vn.prototype.Qa,Vn.prototype.getResponseText=Vn.prototype.ga,Vn.prototype.send=Vn.prototype.ea;var eo=Xn.createWebChannelTransport=function(){return new Na},uu=Xn.getStatEventTarget=function(){return vs()},to=Xn.ErrorCode=$o,ia=Xn.EventType=Ia,Ac=Xn.Event=$r,hu=Xn.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},id=Xn.FetchXmlHttpFactory=Xs,Zl=Xn.WebChannel=Aa,ih=Xn.XhrIo=Vn;const ra="@firebase/firestore";class Mn{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Mn.UNAUTHENTICATED=new Mn(null),Mn.GOOGLE_CREDENTIALS=new Mn("google-credentials-uid"),Mn.FIRST_PARTY=new Mn("first-party-uid"),Mn.MOCK_USER=new Mn("mock-user");let Ua="9.3.0";const Do=new Kn.Yd("@firebase/firestore");function Va(){return Do.logLevel}function Je(o,...e){if(Do.logLevel<=Kn.in.DEBUG){const i=e.map(qa);Do.debug(`Firestore (${Ua}): ${o}`,...i)}}function li(o,...e){if(Do.logLevel<=Kn.in.ERROR){const i=e.map(qa);Do.error(`Firestore (${Ua}): ${o}`,...i)}}function zo(o,...e){if(Do.logLevel<=Kn.in.WARN){const i=e.map(qa);Do.warn(`Firestore (${Ua}): ${o}`,...i)}}function qa(o){if("string"==typeof o)return o;try{return JSON.stringify(o)}catch(i){return o}}function dt(o="Unexpected state"){const e=`FIRESTORE (${Ua}) INTERNAL ASSERTION FAILED: `+o;throw li(e),new Error(e)}function It(o,e){o||dt()}function tt(o,e){return o}const Ce={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ze extends Error{constructor(e,i){super(i),this.code=e,this.message=i,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Qn{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}class Wl{constructor(e,i){this.user=i,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class du{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(Mn.UNAUTHENTICATED))}shutdown(){}}class Hl{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class pu{constructor(e){this.t=e,this.currentUser=Mn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){var a=this;let p=this.i;const v=K=>this.i!==p?(p=this.i,i(K)):Promise.resolve();let T=new Qn;this.o=()=>{this.i++,this.currentUser=this.u(),T.resolve(),T=new Qn,e.enqueueRetryable(()=>v(this.currentUser))};const M=()=>{const K=T;e.enqueueRetryable((0,ae.Z)(function*(){yield K.promise,yield v(a.currentUser)}))},N=K=>{Je("FirebaseCredentialsProvider","Auth detected"),this.auth=K,this.auth.addAuthTokenListener(this.o),M()};this.t.onInit(K=>N(K)),setTimeout(()=>{if(!this.auth){const K=this.t.getImmediate({optional:!0});K?N(K):(Je("FirebaseCredentialsProvider","Auth not yet detected"),T.resolve(),T=new Qn)}},0),M()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==e?(Je("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(It("string"==typeof a.accessToken),new Wl(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return It(null===e||"string"==typeof e),new Mn(e)}}class fu{constructor(e,i,a){this.h=e,this.l=i,this.m=a,this.type="FirstParty",this.user=Mn.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},i=this.h.auth.getAuthHeaderValueForFirstParty([]);return i&&(e.Authorization=i),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class mu{constructor(e,i,a){this.h=e,this.l=i,this.m=a}getToken(){return Promise.resolve(new fu(this.h,this.l,this.m))}start(e,i){e.enqueueRetryable(()=>i(Mn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class lr{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=a=>this.g(a),this.p=a=>i.writeSequenceNumber(a))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.p&&this.p(e),e}}function gu(o){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),i=new Uint8Array(o);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(i);else for(let a=0;a<o;a++)i[a]=Math.floor(256*Math.random());return i}lr.T=-1;class Kl{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/e.length)*e.length;let a="";for(;a.length<20;){const p=gu(40);for(let v=0;v<p.length;++v)a.length<20&&p[v]<i&&(a+=e.charAt(p[v]%e.length))}return a}}function Ht(o,e){return o<e?-1:o>e?1:0}function sa(o,e,i){return o.length===e.length&&o.every((a,p)=>i(a,e[p]))}function gl(o){return o+"\0"}class ki{constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Ze(Ce.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Ze(Ce.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<-62135596800)throw new Ze(Ce.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ze(Ce.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ki.fromMillis(Date.now())}static fromDate(e){return ki.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),a=Math.floor(1e6*(e-1e3*i));return new ki(i,a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ht(this.nanoseconds,e.nanoseconds):Ht(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class kt{constructor(e){this.timestamp=e}static fromTimestamp(e){return new kt(e)}static min(){return new kt(new ki(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function yu(o){let e=0;for(const i in o)Object.prototype.hasOwnProperty.call(o,i)&&e++;return e}function zs(o,e){for(const i in o)Object.prototype.hasOwnProperty.call(o,i)&&e(i,o[i])}function _u(o){for(const e in o)if(Object.prototype.hasOwnProperty.call(o,e))return!1;return!0}class Ga{constructor(e,i,a){void 0===i?i=0:i>e.length&&dt(),void 0===a?a=e.length-i:a>e.length-i&&dt(),this.segments=e,this.offset=i,this.len=a}get length(){return this.len}isEqual(e){return 0===Ga.comparator(this,e)}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof Ga?e.forEach(a=>{i.push(a)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,a=this.limit();i<a;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const a=Math.min(e.length,i.length);for(let p=0;p<a;p++){const v=e.get(p),T=i.get(p);if(v<T)return-1;if(v>T)return 1}return e.length<i.length?-1:e.length>i.length?1:0}}class an extends Ga{construct(e,i,a){return new an(e,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const i=[];for(const a of e){if(a.indexOf("//")>=0)throw new Ze(Ce.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(p=>p.length>0))}return new an(i)}static emptyPath(){return new an([])}}const oa=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Jn extends Ga{construct(e,i,a){return new Jn(e,i,a)}static isValidIdentifier(e){return oa.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Jn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Jn(["__name__"])}static fromServerFormat(e){const i=[];let a="",p=0;const v=()=>{if(0===a.length)throw new Ze(Ce.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let T=!1;for(;p<e.length;){const M=e[p];if("\\"===M){if(p+1===e.length)throw new Ze(Ce.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const N=e[p+1];if("\\"!==N&&"."!==N&&"`"!==N)throw new Ze(Ce.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=N,p+=2}else"`"===M?(T=!T,p++):"."!==M||T?(a+=M,p++):(v(),p++)}if(v(),T)throw new Ze(Ce.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Jn(i)}static emptyPath(){return new Jn([])}}class cs{constructor(e){this.fields=e,e.sort(Jn.comparator)}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return sa(this.fields,e.fields,(i,a)=>i.isEqual(a))}}class Mi{constructor(e){this.binaryString=e}static fromBase64String(e){const i=atob(e);return new Mi(i)}static fromUint8Array(e){const i=function(a){let p="";for(let v=0;v<a.length;++v)p+=String.fromCharCode(a[v]);return p}(e);return new Mi(i)}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const i=new Uint8Array(e.length);for(let a=0;a<e.length;a++)i[a]=e.charCodeAt(a);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ht(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Mi.EMPTY_BYTE_STRING=new Mi("");const ja=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lo(o){if(It(!!o),"string"==typeof o){let e=0;const i=ja.exec(o);if(It(!!i),i[1]){let p=i[1];p=(p+"000000000").substr(0,9),e=Number(p)}const a=new Date(o);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:ci(o.seconds),nanos:ci(o.nanos)}}function ci(o){return"number"==typeof o?o:"string"==typeof o?Number(o):0}function $a(o){return"string"==typeof o?Mi.fromBase64String(o):Mi.fromUint8Array(o)}function yl(o){var e,i;return"server_timestamp"===(null===(i=((null===(e=null==o?void 0:o.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===i?void 0:i.stringValue)}function d(o){const e=o.mapValue.fields.__previous_value__;return yl(e)?d(e):e}function n(o){const e=Lo(o.mapValue.fields.__local_write_time__.timestampValue);return new ki(e.seconds,e.nanos)}function c(o){return null==o}function f(o){return 0===o&&1/o==-1/0}function y(o){return"number"==typeof o&&Number.isInteger(o)&&!f(o)&&o<=Number.MAX_SAFE_INTEGER&&o>=Number.MIN_SAFE_INTEGER}class _{constructor(e){this.path=e}static fromPath(e){return new _(an.fromString(e))}static fromName(e){return new _(an.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===an.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,i){return an.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new _(new an(e.slice()))}}function b(o){return"nullValue"in o?0:"booleanValue"in o?1:"integerValue"in o||"doubleValue"in o?2:"timestampValue"in o?3:"stringValue"in o?5:"bytesValue"in o?6:"referenceValue"in o?7:"geoPointValue"in o?8:"arrayValue"in o?9:"mapValue"in o?yl(o)?4:10:dt()}function S(o,e){const i=b(o);if(i!==b(e))return!1;switch(i){case 0:return!0;case 1:return o.booleanValue===e.booleanValue;case 4:return n(o).isEqual(n(e));case 3:return function(a,p){if("string"==typeof a.timestampValue&&"string"==typeof p.timestampValue&&a.timestampValue.length===p.timestampValue.length)return a.timestampValue===p.timestampValue;const v=Lo(a.timestampValue),T=Lo(p.timestampValue);return v.seconds===T.seconds&&v.nanos===T.nanos}(o,e);case 5:return o.stringValue===e.stringValue;case 6:return p=e,$a(o.bytesValue).isEqual($a(p.bytesValue));case 7:return o.referenceValue===e.referenceValue;case 8:return function(a,p){return ci(a.geoPointValue.latitude)===ci(p.geoPointValue.latitude)&&ci(a.geoPointValue.longitude)===ci(p.geoPointValue.longitude)}(o,e);case 2:return function(a,p){if("integerValue"in a&&"integerValue"in p)return ci(a.integerValue)===ci(p.integerValue);if("doubleValue"in a&&"doubleValue"in p){const v=ci(a.doubleValue),T=ci(p.doubleValue);return v===T?f(v)===f(T):isNaN(v)&&isNaN(T)}return!1}(o,e);case 9:return sa(o.arrayValue.values||[],e.arrayValue.values||[],S);case 10:return function(a,p){const v=a.mapValue.fields||{},T=p.mapValue.fields||{};if(yu(v)!==yu(T))return!1;for(const M in v)if(v.hasOwnProperty(M)&&(void 0===T[M]||!S(v[M],T[M])))return!1;return!0}(o,e);default:return dt()}var p}function k(o,e){return void 0!==(o.values||[]).find(i=>S(i,e))}function L(o,e){const i=b(o),a=b(e);if(i!==a)return Ht(i,a);switch(i){case 0:return 0;case 1:return Ht(o.booleanValue,e.booleanValue);case 2:return function(p,v){const T=ci(p.integerValue||p.doubleValue),M=ci(v.integerValue||v.doubleValue);return T<M?-1:T>M?1:T===M?0:isNaN(T)?isNaN(M)?0:-1:1}(o,e);case 3:return O(o.timestampValue,e.timestampValue);case 4:return O(n(o),n(e));case 5:return Ht(o.stringValue,e.stringValue);case 6:return function(p,v){const T=$a(p),M=$a(v);return T.compareTo(M)}(o.bytesValue,e.bytesValue);case 7:return function(p,v){const T=p.split("/"),M=v.split("/");for(let N=0;N<T.length&&N<M.length;N++){const K=Ht(T[N],M[N]);if(0!==K)return K}return Ht(T.length,M.length)}(o.referenceValue,e.referenceValue);case 8:return function(p,v){const T=Ht(ci(p.latitude),ci(v.latitude));return 0!==T?T:Ht(ci(p.longitude),ci(v.longitude))}(o.geoPointValue,e.geoPointValue);case 9:return function(p,v){const T=p.values||[],M=v.values||[];for(let N=0;N<T.length&&N<M.length;++N){const K=L(T[N],M[N]);if(K)return K}return Ht(T.length,M.length)}(o.arrayValue,e.arrayValue);case 10:return function(p,v){const T=p.fields||{},M=Object.keys(T),N=v.fields||{},K=Object.keys(N);M.sort(),K.sort();for(let ne=0;ne<M.length&&ne<K.length;++ne){const me=Ht(M[ne],K[ne]);if(0!==me)return me;const ke=L(T[M[ne]],N[K[ne]]);if(0!==ke)return ke}return Ht(M.length,K.length)}(o.mapValue,e.mapValue);default:throw dt()}}function O(o,e){if("string"==typeof o&&"string"==typeof e&&o.length===e.length)return Ht(o,e);const i=Lo(o),a=Lo(e),p=Ht(i.seconds,a.seconds);return 0!==p?p:Ht(i.nanos,a.nanos)}function U(o){return q(o)}function q(o){return"nullValue"in o?"null":"booleanValue"in o?""+o.booleanValue:"integerValue"in o?""+o.integerValue:"doubleValue"in o?""+o.doubleValue:"timestampValue"in o?function(a){const p=Lo(a);return`time(${p.seconds},${p.nanos})`}(o.timestampValue):"stringValue"in o?o.stringValue:"bytesValue"in o?$a(o.bytesValue).toBase64():"referenceValue"in o?_.fromName(o.referenceValue).toString():"geoPointValue"in o?`geo(${(e=o.geoPointValue).latitude},${e.longitude})`:"arrayValue"in o?function(a){let p="[",v=!0;for(const T of a.values||[])v?v=!1:p+=",",p+=q(T);return p+"]"}(o.arrayValue):"mapValue"in o?function(a){const p=Object.keys(a.fields||{}).sort();let v="{",T=!0;for(const M of p)T?T=!1:v+=",",v+=`${M}:${q(a.fields[M])}`;return v+"}"}(o.mapValue):dt();var e}function $(o,e){return{referenceValue:`projects/${o.projectId}/databases/${o.database}/documents/${e.path.canonicalString()}`}}function Y(o){return!!o&&"integerValue"in o}function Q(o){return!!o&&"arrayValue"in o}function le(o){return!!o&&"nullValue"in o}function W(o){return!!o&&"doubleValue"in o&&isNaN(Number(o.doubleValue))}function J(o){return!!o&&"mapValue"in o}function re(o){if(o.geoPointValue)return{geoPointValue:Object.assign({},o.geoPointValue)};if(o.timestampValue&&"object"==typeof o.timestampValue)return{timestampValue:Object.assign({},o.timestampValue)};if(o.mapValue){const e={mapValue:{fields:{}}};return zs(o.mapValue.fields,(i,a)=>e.mapValue.fields[i]=re(a)),e}if(o.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(o.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=re(o.arrayValue.values[i]);return e}return Object.assign({},o)}class ue{constructor(e){this.value=e}static empty(){return new ue({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let a=0;a<e.length-1;++a)if(i=(i.mapValue.fields||{})[e.get(a)],!J(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=re(i)}setAll(e){let i=Jn.emptyPath(),a={},p=[];e.forEach((T,M)=>{if(!i.isImmediateParentOf(M)){const N=this.getFieldsMap(i);this.applyChanges(N,a,p),a={},p=[],i=M.popLast()}T?a[M.lastSegment()]=re(T):p.push(M.lastSegment())});const v=this.getFieldsMap(i);this.applyChanges(v,a,p)}delete(e){const i=this.field(e.popLast());J(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return S(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<e.length;++a){let p=i.mapValue.fields[e.get(a)];J(p)&&p.mapValue.fields||(p={mapValue:{fields:{}}},i.mapValue.fields[e.get(a)]=p),i=p}return i.mapValue.fields}applyChanges(e,i,a){zs(i,(p,v)=>e[p]=v);for(const p of a)delete e[p]}clone(){return new ue(re(this.value))}}function te(o){const e=[];return zs(o.fields,(i,a)=>{const p=new Jn([i]);if(J(a)){const v=te(a.mapValue).fields;if(0===v.length)e.push(p);else for(const T of v)e.push(p.child(T))}else e.push(p)}),new cs(e)}class ee{constructor(e,i,a,p,v){this.key=e,this.documentType=i,this.version=a,this.data=p,this.documentState=v}static newInvalidDocument(e){return new ee(e,0,kt.min(),ue.empty(),0)}static newFoundDocument(e,i,a){return new ee(e,1,i,a,0)}static newNoDocument(e,i){return new ee(e,2,i,ue.empty(),0)}static newUnknownDocument(e,i){return new ee(e,3,i,ue.empty(),2)}convertToFoundDocument(e,i){return this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ee&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new ee(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ae{constructor(e,i=null,a=[],p=[],v=null,T=null,M=null){this.path=e,this.collectionGroup=i,this.orderBy=a,this.filters=p,this.limit=v,this.startAt=T,this.endAt=M,this.A=null}}function De(o,e=null,i=[],a=[],p=null,v=null,T=null){return new Ae(o,e,i,a,p,v,T)}function Le(o){const e=tt(o);if(null===e.A){let i=e.path.canonicalString();null!==e.collectionGroup&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(a=>function(o){return o.field.canonicalString()+o.op.toString()+U(o.value)}(a)).join(","),i+="|ob:",i+=e.orderBy.map(a=>{return(p=a).field.canonicalString()+p.dir;var p}).join(","),c(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=cr(e.startAt)),e.endAt&&(i+="|ub:",i+=cr(e.endAt)),e.A=i}return e.A}function We(o,e){if(o.limit!==e.limit||o.orderBy.length!==e.orderBy.length)return!1;for(let p=0;p<o.orderBy.length;p++)if(!xr(o.orderBy[p],e.orderBy[p]))return!1;if(o.filters.length!==e.filters.length)return!1;for(let p=0;p<o.filters.length;p++)if((i=o.filters[p]).op!==(a=e.filters[p]).op||!i.field.isEqual(a.field)||!S(i.value,a.value))return!1;var i,a;return o.collectionGroup===e.collectionGroup&&!!o.path.isEqual(e.path)&&!!Ls(o.startAt,e.startAt)&&Ls(o.endAt,e.endAt)}function Ne(o){return _.isDocumentKey(o.path)&&null===o.collectionGroup&&0===o.filters.length}class nt extends class{}{constructor(e,i,a){super(),this.field=e,this.op=i,this.value=a}static create(e,i,a){return e.isKeyField()?"in"===i||"not-in"===i?this.R(e,i,a):new Xe(e,i,a):"array-contains"===i?new _n(e,a):"in"===i?new vn(e,a):"not-in"===i?new Ft(e,a):"array-contains-any"===i?new cn(e,a):new nt(e,i,a)}static R(e,i,a){return"in"===i?new wt(e,a):new ft(e,a)}matches(e){const i=e.data.field(this.field);return"!="===this.op?null!==i&&this.P(L(i,this.value)):null!==i&&b(this.value)===b(i)&&this.P(L(i,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return dt()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Xe extends nt{constructor(e,i,a){super(e,i,a),this.key=_.fromName(a.referenceValue)}matches(e){const i=_.comparator(e.key,this.key);return this.P(i)}}class wt extends nt{constructor(e,i){super(e,"in",i),this.keys=Kt(0,i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class ft extends nt{constructor(e,i){super(e,"not-in",i),this.keys=Kt(0,i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function Kt(o,e){var i;return((null===(i=e.arrayValue)||void 0===i?void 0:i.values)||[]).map(a=>_.fromName(a.referenceValue))}class _n extends nt{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return Q(i)&&k(i.arrayValue,this.value)}}class vn extends nt{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return null!==i&&k(this.value.arrayValue,i)}}class Ft extends nt{constructor(e,i){super(e,"not-in",i)}matches(e){if(k(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return null!==i&&!k(this.value.arrayValue,i)}}class cn extends nt{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!Q(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>k(this.value.arrayValue,a))}}class In{constructor(e,i){this.position=e,this.before=i}}function cr(o){return`${o.before?"b":"a"}:${o.position.map(e=>U(e)).join(",")}`}class Vi{constructor(e,i="asc"){this.field=e,this.dir=i}}function xr(o,e){return o.dir===e.dir&&o.field.isEqual(e.field)}function Kr(o,e,i){let a=0;for(let p=0;p<o.position.length;p++){const v=e[p],T=o.position[p];if(a=v.field.isKeyField()?_.comparator(_.fromName(T.referenceValue),i.key):L(T,i.data.field(v.field)),"desc"===v.dir&&(a*=-1),0!==a)break}return o.before?a<=0:a<0}function Ls(o,e){if(null===o)return null===e;if(null===e||o.before!==e.before||o.position.length!==e.position.length)return!1;for(let i=0;i<o.position.length;i++)if(!S(o.position[i],e.position[i]))return!1;return!0}class ln{constructor(e,i=null,a=[],p=[],v=null,T="F",M=null,N=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=p,this.limit=v,this.limitType=T,this.startAt=M,this.endAt=N,this.V=null,this.S=null}}function An(o,e,i,a,p,v,T,M){return new ln(o,e,i,a,p,v,T,M)}function Vt(o){return new ln(o)}function Ln(o){return!c(o.limit)&&"F"===o.limitType}function _i(o){return!c(o.limit)&&"L"===o.limitType}function xn(o){return o.explicitOrderBy.length>0?o.explicitOrderBy[0].field:null}function wr(o){for(const e of o.filters)if(e.v())return e.field;return null}function us(o){return null!==o.collectionGroup}function Pi(o){const e=tt(o);if(null===e.V){e.V=[];const i=wr(e),a=xn(e);if(null!==i&&null===a)i.isKeyField()||e.V.push(new Vi(i)),e.V.push(new Vi(Jn.keyField(),"asc"));else{let p=!1;for(const v of e.explicitOrderBy)e.V.push(v),v.field.isKeyField()&&(p=!0);if(!p){const v=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.V.push(new Vi(Jn.keyField(),v))}}}return e.V}function vi(o){const e=tt(o);if(!e.S)if("F"===e.limitType)e.S=De(e.path,e.collectionGroup,Pi(e),e.filters,e.limit,e.startAt,e.endAt);else{const i=[];for(const v of Pi(e))i.push(new Vi(v.field,"desc"===v.dir?"asc":"desc"));const a=e.endAt?new In(e.endAt.position,!e.endAt.before):null,p=e.startAt?new In(e.startAt.position,!e.startAt.before):null;e.S=De(e.path,e.collectionGroup,i,e.filters,e.limit,a,p)}return e.S}function vu(o,e,i){return new ln(o.path,o.collectionGroup,o.explicitOrderBy.slice(),o.filters.slice(),e,i,o.startAt,o.endAt)}function Ro(o,e){return We(vi(o),vi(e))&&o.limitType===e.limitType}function Za(o){return`${Le(vi(o))}|lt:${o.limitType}`}function Cc(o){return`Query(target=${function(o){let e=o.path.canonicalString();return null!==o.collectionGroup&&(e+=" collectionGroup="+o.collectionGroup),o.filters.length>0&&(e+=`, filters: [${o.filters.map(i=>{return`${(a=i).field.canonicalString()} ${a.op} ${U(a.value)}`;var a}).join(", ")}]`),c(o.limit)||(e+=", limit: "+o.limit),o.orderBy.length>0&&(e+=`, orderBy: [${o.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),o.startAt&&(e+=", startAt: "+cr(o.startAt)),o.endAt&&(e+=", endAt: "+cr(o.endAt)),`Target(${e})`}(vi(o))}; limitType=${o.limitType})`}function Fo(o,e){return e.isFoundDocument()&&function(i,a){const p=a.key.path;return null!==i.collectionGroup?a.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(p):_.isDocumentKey(i.path)?i.path.isEqual(p):i.path.isImmediateParentOf(p)}(o,e)&&function(i,a){for(const p of i.explicitOrderBy)if(!p.field.isKeyField()&&null===a.data.field(p.field))return!1;return!0}(o,e)&&function(i,a){for(const p of i.filters)if(!p.matches(a))return!1;return!0}(o,e)&&(a=e,!((i=o).startAt&&!Kr(i.startAt,Pi(i),a)||i.endAt&&Kr(i.endAt,Pi(i),a)));var i,a}function Xl(o){return(e,i)=>{let a=!1;for(const p of Pi(o)){const v=kp(p,e,i);if(0!==v)return v;a=a||p.field.isKeyField()}return 0}}function kp(o,e,i){const a=o.field.isKeyField()?_.comparator(e.key,i.key):function(p,v,T){const M=v.data.field(p),N=T.data.field(p);return null!==M&&null!==N?L(M,N):dt()}(o.field,e,i);switch(o.dir){case"asc":return a;case"desc":return-1*a;default:return dt()}}function sd(o,e){if(o.D){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:f(e)?"-0":e}}function od(o){return{integerValue:""+o}}function ad(o,e){return y(e)?od(e):sd(o,e)}class xu{constructor(){this._=void 0}}function Mp(o,e,i){return o instanceof Yl?function(a,p){const v={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return p&&(v.fields.__previous_value__=p),{mapValue:v}}(i,e):o instanceof Ql?kc(o,e):o instanceof Jl?wu(o,e):function(a,p){const v=Pp(a,p),T=sh(v)+sh(a.C);return Y(v)&&Y(a.C)?od(T):sd(a.N,T)}(o,e)}function em(o,e,i){return o instanceof Ql?kc(o,e):o instanceof Jl?wu(o,e):i}function Pp(o,e){return o instanceof ec?Y(i=e)||(a=i)&&"doubleValue"in a?e:{integerValue:0}:null;var a,i}class Yl extends xu{}class Ql extends xu{constructor(e){super(),this.elements=e}}function kc(o,e){const i=bu(e);for(const a of o.elements)i.some(p=>S(p,a))||i.push(a);return{arrayValue:{values:i}}}class Jl extends xu{constructor(e){super(),this.elements=e}}function wu(o,e){let i=bu(e);for(const a of o.elements)i=i.filter(p=>!S(p,a));return{arrayValue:{values:i}}}class ec extends xu{constructor(e,i){super(),this.N=e,this.C=i}}function sh(o){return ci(o.integerValue||o.doubleValue)}function bu(o){return Q(o)&&o.arrayValue.values?o.arrayValue.values.slice():[]}class no{constructor(e,i){this.field=e,this.transform=i}}class Dp{constructor(e,i){this.version=e,this.transformResults=i}}class Di{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Di}static exists(e){return new Di(void 0,e)}static updateTime(e){return new Di(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ah(o,e){return void 0!==o.updateTime?e.isFoundDocument()&&e.version.isEqual(o.updateTime):void 0===o.exists||o.exists===e.isFoundDocument()}class lh{}function ld(o,e,i){o instanceof ro?function(a,p,v){const T=a.value.clone(),M=zp(a.fieldTransforms,p,v.transformResults);T.setAll(M),p.convertToFoundDocument(v.version,T).setHasCommittedMutations()}(o,e,i):o instanceof Or?function(a,p,v){if(!ah(a.precondition,p))return void p.convertToUnknownDocument(v.version);const T=zp(a.fieldTransforms,p,v.transformResults),M=p.data;M.setAll(_l(a)),M.setAll(T),p.convertToFoundDocument(v.version,M).setHasCommittedMutations()}(o,e,i):e.convertToNoDocument(i.version).setHasCommittedMutations()}function tc(o,e,i){var p;o instanceof ro?function(a,p,v){if(!ah(a.precondition,p))return;const T=a.value.clone(),M=Lp(a.fieldTransforms,v,p);T.setAll(M),p.convertToFoundDocument(io(p),T).setHasLocalMutations()}(o,e,i):o instanceof Or?function(a,p,v){if(!ah(a.precondition,p))return;const T=Lp(a.fieldTransforms,v,p),M=p.data;M.setAll(_l(a)),M.setAll(T),p.convertToFoundDocument(io(p),M).setHasLocalMutations()}(o,e,i):ah(o.precondition,p=e)&&p.convertToNoDocument(kt.min())}function Mc(o,e){let i=null;for(const a of o.fieldTransforms){const p=e.data.field(a.field),v=Pp(a.transform,p||null);null!=v&&(null==i&&(i=ue.empty()),i.set(a.field,v))}return i||null}function aa(o,e){return o.type===e.type&&!!o.key.isEqual(e.key)&&!!o.precondition.isEqual(e.precondition)&&(a=e.fieldTransforms,!!(void 0===(i=o.fieldTransforms)&&void 0===a||i&&a&&sa(i,a,(p,v)=>function(o,e){return o.field.isEqual(e.field)&&(a=e.transform,(i=o.transform)instanceof Ql&&a instanceof Ql||i instanceof Jl&&a instanceof Jl?sa(i.elements,a.elements,S):i instanceof ec&&a instanceof ec?S(i.C,a.C):i instanceof Yl&&a instanceof Yl);var i,a}(p,v))))&&(0===o.type?o.value.isEqual(e.value):1!==o.type||o.data.isEqual(e.data)&&o.fieldMask.isEqual(e.fieldMask));var i,a}function io(o){return o.isFoundDocument()?o.version:kt.min()}class ro extends lh{constructor(e,i,a,p=[]){super(),this.key=e,this.value=i,this.precondition=a,this.fieldTransforms=p,this.type=0}}class Or extends lh{constructor(e,i,a,p,v=[]){super(),this.key=e,this.data=i,this.fieldMask=a,this.precondition=p,this.fieldTransforms=v,this.type=1}}function _l(o){const e=new Map;return o.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=o.data.field(i);e.set(i,a)}}),e}function zp(o,e,i){const a=new Map;It(o.length===i.length);for(let p=0;p<i.length;p++){const v=o[p],T=v.transform,M=e.data.field(v.field);a.set(v.field,em(T,M,i[p]))}return a}function Lp(o,e,i){const a=new Map;for(const p of o){const v=p.transform,T=i.data.field(p.field);a.set(p.field,Mp(v,T,e))}return a}class Tu extends lh{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}}class cd extends lh{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}}class Rp{constructor(e){this.count=e}}var ui,Ut;function Fp(o){switch(o){default:return dt();case Ce.CANCELLED:case Ce.UNKNOWN:case Ce.DEADLINE_EXCEEDED:case Ce.RESOURCE_EXHAUSTED:case Ce.INTERNAL:case Ce.UNAVAILABLE:case Ce.UNAUTHENTICATED:return!1;case Ce.INVALID_ARGUMENT:case Ce.NOT_FOUND:case Ce.ALREADY_EXISTS:case Ce.PERMISSION_DENIED:case Ce.FAILED_PRECONDITION:case Ce.ABORTED:case Ce.OUT_OF_RANGE:case Ce.UNIMPLEMENTED:case Ce.DATA_LOSS:return!0}}function Bp(o){if(void 0===o)return li("GRPC error has no .code"),Ce.UNKNOWN;switch(o){case ui.OK:return Ce.OK;case ui.CANCELLED:return Ce.CANCELLED;case ui.UNKNOWN:return Ce.UNKNOWN;case ui.DEADLINE_EXCEEDED:return Ce.DEADLINE_EXCEEDED;case ui.RESOURCE_EXHAUSTED:return Ce.RESOURCE_EXHAUSTED;case ui.INTERNAL:return Ce.INTERNAL;case ui.UNAVAILABLE:return Ce.UNAVAILABLE;case ui.UNAUTHENTICATED:return Ce.UNAUTHENTICATED;case ui.INVALID_ARGUMENT:return Ce.INVALID_ARGUMENT;case ui.NOT_FOUND:return Ce.NOT_FOUND;case ui.ALREADY_EXISTS:return Ce.ALREADY_EXISTS;case ui.PERMISSION_DENIED:return Ce.PERMISSION_DENIED;case ui.FAILED_PRECONDITION:return Ce.FAILED_PRECONDITION;case ui.ABORTED:return Ce.ABORTED;case ui.OUT_OF_RANGE:return Ce.OUT_OF_RANGE;case ui.UNIMPLEMENTED:return Ce.UNIMPLEMENTED;case ui.DATA_LOSS:return Ce.DATA_LOSS;default:return dt()}}(Ut=ui||(ui={}))[Ut.OK=0]="OK",Ut[Ut.CANCELLED=1]="CANCELLED",Ut[Ut.UNKNOWN=2]="UNKNOWN",Ut[Ut.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ut[Ut.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ut[Ut.NOT_FOUND=5]="NOT_FOUND",Ut[Ut.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ut[Ut.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ut[Ut.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ut[Ut.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ut[Ut.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ut[Ut.ABORTED=10]="ABORTED",Ut[Ut.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ut[Ut.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ut[Ut.INTERNAL=13]="INTERNAL",Ut[Ut.UNAVAILABLE=14]="UNAVAILABLE",Ut[Ut.DATA_LOSS=15]="DATA_LOSS";class en{constructor(e,i){this.comparator=e,this.root=i||Ji.EMPTY}insert(e,i){return new en(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Ji.BLACK,null,null))}remove(e){return new en(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ji.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(0===a)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(e){let i=0,a=this.root;for(;!a.isEmpty();){const p=this.comparator(e,a.key);if(0===p)return i+a.left.size;p<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,a)=>(e(i,a),!1))}toString(){const e=[];return this.inorderTraversal((i,a)=>(e.push(`${i}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Jt(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Jt(this.root,e,this.comparator,!1)}getReverseIterator(){return new Jt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Jt(this.root,e,this.comparator,!0)}}class Jt{constructor(e,i,a,p){this.isReverse=p,this.nodeStack=[];let v=1;for(;!e.isEmpty();)if(v=i?a(e.key,i):1,p&&(v*=-1),v<0)e=this.isReverse?e.left:e.right;else{if(0===v){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ji{constructor(e,i,a,p,v){this.key=e,this.value=i,this.color=null!=a?a:Ji.RED,this.left=null!=p?p:Ji.EMPTY,this.right=null!=v?v:Ji.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,a,p,v){return new Ji(null!=e?e:this.key,null!=i?i:this.value,null!=a?a:this.color,null!=p?p:this.left,null!=v?v:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,a){let p=this;const v=a(e,p.key);return p=v<0?p.copy(null,null,null,p.left.insert(e,i,a),null):0===v?p.copy(null,i,null,null,null):p.copy(null,null,null,null,p.right.insert(e,i,a)),p.fixUp()}removeMin(){if(this.left.isEmpty())return Ji.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let a,p=this;if(i(e,p.key)<0)p.left.isEmpty()||p.left.isRed()||p.left.left.isRed()||(p=p.moveRedLeft()),p=p.copy(null,null,null,p.left.remove(e,i),null);else{if(p.left.isRed()&&(p=p.rotateRight()),p.right.isEmpty()||p.right.isRed()||p.right.left.isRed()||(p=p.moveRedRight()),0===i(e,p.key)){if(p.right.isEmpty())return Ji.EMPTY;a=p.right.min(),p=p.copy(a.key,a.value,null,null,p.right.removeMin())}p=p.copy(null,null,null,null,p.right.remove(e,i))}return p.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ji.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ji.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw dt();const e=this.left.check();if(e!==this.right.check())throw dt();return e+(this.isRed()?0:1)}}Ji.EMPTY=null,Ji.RED=!0,Ji.BLACK=!1,Ji.EMPTY=new class{constructor(){this.size=0}get key(){throw dt()}get value(){throw dt()}get color(){throw dt()}get left(){throw dt()}get right(){throw dt()}copy(o,e,i,a,p){return this}insert(o,e,i){return new Ji(o,e)}remove(o,e){return this}isEmpty(){return!0}inorderTraversal(o){return!1}reverseTraversal(o){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class hi{constructor(e){this.comparator=e,this.data=new en(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,a)=>(e(i),!1))}forEachInRange(e,i){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const p=a.getNext();if(this.comparator(p.key,e[1])>=0)return;i(p.key)}}forEachWhile(e,i){let a;for(a=void 0!==i?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new vl(this.data.getIterator())}getIteratorFrom(e){return new vl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(a=>{i=i.add(a)}),i}isEqual(e){if(!(e instanceof hi)||this.size!==e.size)return!1;const i=this.data.getIterator(),a=e.data.getIterator();for(;i.hasNext();){const p=i.getNext().key,v=a.getNext().key;if(0!==this.comparator(p,v))return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new hi(this.comparator);return i.data=e,i}}class vl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const nc=new en(_.comparator);function Xr(){return nc}const ud=new en(_.comparator);function ch(){return ud}const tm=new en(_.comparator);function hd(){return tm}const nm=new hi(_.comparator);function mn(...o){let e=nm;for(const i of o)e=e.add(i);return e}const im=new hi(Ht);function Pc(){return im}class Dc{constructor(e,i,a,p,v){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=p,this.resolvedLimboDocuments=v}static createSynthesizedRemoteEventForCurrentChange(e,i){const a=new Map;return a.set(e,zc.createSynthesizedTargetChangeForCurrentChange(e,i)),new Dc(kt.min(),a,Pc(),Xr(),mn())}}class zc{constructor(e,i,a,p,v){this.resumeToken=e,this.current=i,this.addedDocuments=a,this.modifiedDocuments=p,this.removedDocuments=v}static createSynthesizedTargetChangeForCurrentChange(e,i){return new zc(Mi.EMPTY_BYTE_STRING,i,mn(),mn(),mn())}}class Wa{constructor(e,i,a,p){this.k=e,this.removedTargetIds=i,this.key=a,this.$=p}}class dd{constructor(e,i){this.targetId=e,this.O=i}}class Op{constructor(e,i,a=Mi.EMPTY_BYTE_STRING,p=null){this.state=e,this.targetIds=i,this.resumeToken=a,this.cause=p}}class Lc{constructor(){this.F=0,this.M=fd(),this.L=Mi.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(e){e.approximateByteSize()>0&&(this.U=!0,this.L=e)}W(){let e=mn(),i=mn(),a=mn();return this.M.forEach((p,v)=>{switch(v){case 0:e=e.add(p);break;case 2:i=i.add(p);break;case 1:a=a.add(p);break;default:dt()}}),new zc(this.L,this.B,e,i,a)}G(){this.U=!1,this.M=fd()}H(e,i){this.U=!0,this.M=this.M.insert(e,i)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class uh{constructor(e){this.tt=e,this.et=new Map,this.nt=Xr(),this.st=pd(),this.it=new hi(Ht)}rt(e){for(const i of e.k)e.$&&e.$.isFoundDocument()?this.ot(i,e.$):this.ct(i,e.key,e.$);for(const i of e.removedTargetIds)this.ct(i,e.key,e.$)}at(e){this.forEachTarget(e,i=>{const a=this.ut(i);switch(e.state){case 0:this.ht(i)&&a.j(e.resumeToken);break;case 1:a.X(),a.q||a.G(),a.j(e.resumeToken);break;case 2:a.X(),a.q||this.removeTarget(i);break;case 3:this.ht(i)&&(a.Z(),a.j(e.resumeToken));break;case 4:this.ht(i)&&(this.lt(i),a.j(e.resumeToken));break;default:dt()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.et.forEach((a,p)=>{this.ht(p)&&i(p)})}ft(e){const i=e.targetId,a=e.O.count,p=this.dt(i);if(p){const v=p.target;if(Ne(v))if(0===a){const T=new _(v.path);this.ct(i,T,ee.newNoDocument(T,kt.min()))}else It(1===a);else this.wt(i)!==a&&(this.lt(i),this.it=this.it.add(i))}}_t(e){const i=new Map;this.et.forEach((v,T)=>{const M=this.dt(T);if(M){if(v.current&&Ne(M.target)){const N=new _(M.target.path);null!==this.nt.get(N)||this.gt(T,N)||this.ct(T,N,ee.newNoDocument(N,e))}v.K&&(i.set(T,v.W()),v.G())}});let a=mn();this.st.forEach((v,T)=>{let M=!0;T.forEachWhile(N=>{const K=this.dt(N);return!K||2===K.purpose||(M=!1,!1)}),M&&(a=a.add(v))});const p=new Dc(e,i,this.it,this.nt,a);return this.nt=Xr(),this.st=pd(),this.it=new hi(Ht),p}ot(e,i){if(!this.ht(e))return;const a=this.gt(e,i.key)?2:0;this.ut(e).H(i.key,a),this.nt=this.nt.insert(i.key,i),this.st=this.st.insert(i.key,this.yt(i.key).add(e))}ct(e,i,a){if(!this.ht(e))return;const p=this.ut(e);this.gt(e,i)?p.H(i,1):p.J(i),this.st=this.st.insert(i,this.yt(i).delete(e)),a&&(this.nt=this.nt.insert(i,a))}removeTarget(e){this.et.delete(e)}wt(e){const i=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let i=this.et.get(e);return i||(i=new Lc,this.et.set(e,i)),i}yt(e){let i=this.st.get(e);return i||(i=new hi(Ht),this.st=this.st.insert(e,i)),i}ht(e){const i=null!==this.dt(e);return i||Je("WatchChangeAggregator","Detected inactive target",e),i}dt(e){const i=this.et.get(e);return i&&i.q?null:this.tt.Tt(e)}lt(e){this.et.set(e,new Lc),this.tt.getRemoteKeysForTarget(e).forEach(i=>{this.ct(e,i,null)})}gt(e,i){return this.tt.getRemoteKeysForTarget(e).has(i)}}function pd(){return new en(_.comparator)}function fd(){return new en(_.comparator)}const rm={asc:"ASCENDING",desc:"DESCENDING"},sm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class hs{constructor(e,i){this.databaseId=e,this.D=i}}function Rc(o,e){return o.D?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hh(o,e){return o.D?e.toBase64():e.toUint8Array()}function Np(o,e){return Rc(o,e.toTimestamp())}function ur(o){return It(!!o),kt.fromTimestamp(function(e){const i=Lo(e);return new ki(i.seconds,i.nanos)}(o))}function Fc(o,e){return(i=o,new an(["projects",i.projectId,"databases",i.database])).child("documents").child(e).canonicalString();var i}function md(o){const e=an.fromString(o);return It($p(e)),e}function la(o,e){return Fc(o.databaseId,e.path)}function Bo(o,e){const i=md(e);if(i.get(1)!==o.databaseId.projectId)throw new Ze(Ce.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+o.databaseId.projectId);if(i.get(3)!==o.databaseId.database)throw new Ze(Ce.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+o.databaseId.database);return new _(yd(i))}function dh(o,e){return Fc(o.databaseId,e)}function gd(o){const e=md(o);return 4===e.length?an.emptyPath():yd(e)}function Bc(o){return new an(["projects",o.databaseId.projectId,"databases",o.databaseId.database]).canonicalString()}function yd(o){return It(o.length>4&&"documents"===o.get(4)),o.popFirst(5)}function Oc(o,e,i){return{name:la(o,e),fields:i.value.mapValue.fields}}function Up(o,e,i){const a=Bo(o,e.name),p=ur(e.updateTime),v=new ue({mapValue:{fields:e.fields}}),T=ee.newFoundDocument(a,p,v);return i&&T.setHasCommittedMutations(),i?T.setHasCommittedMutations():T}function xl(o,e){let i;if(e instanceof ro)i={update:Oc(o,e.key,e.value)};else if(e instanceof Tu)i={delete:la(o,e.key)};else if(e instanceof Or)i={update:Oc(o,e.key,e.data),updateMask:um(e.fieldMask)};else{if(!(e instanceof cd))return dt();i={verify:la(o,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(a=>function(p,v){const T=v.transform;if(T instanceof Yl)return{fieldPath:v.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(T instanceof Ql)return{fieldPath:v.field.canonicalString(),appendMissingElements:{values:T.elements}};if(T instanceof Jl)return{fieldPath:v.field.canonicalString(),removeAllFromArray:{values:T.elements}};if(T instanceof ec)return{fieldPath:v.field.canonicalString(),increment:T.C};throw dt()}(0,a))),e.precondition.isNone||(i.currentDocument=void 0!==(p=e.precondition).updateTime?{updateTime:Np(o,p.updateTime)}:void 0!==p.exists?{exists:p.exists}:dt()),i;var p}function ph(o,e){const i=e.currentDocument?void 0!==(p=e.currentDocument).updateTime?Di.updateTime(ur(p.updateTime)):void 0!==p.exists?Di.exists(p.exists):Di.none():Di.none(),a=e.updateTransforms?e.updateTransforms.map(p=>function(v,T){let M=null;"setToServerValue"in T?(It("REQUEST_TIME"===T.setToServerValue),M=new Yl):"appendMissingElements"in T?M=new Ql(T.appendMissingElements.values||[]):"removeAllFromArray"in T?M=new Jl(T.removeAllFromArray.values||[]):"increment"in T?M=new ec(v,T.increment):dt();const N=Jn.fromServerFormat(T.fieldPath);return new no(N,M)}(o,p)):[];var p;if(e.update){const p=Bo(o,e.update.name),v=new ue({mapValue:{fields:e.update.fields}});if(e.updateMask){const T=new cs((e.updateMask.fieldPaths||[]).map(K=>Jn.fromServerFormat(K)));return new Or(p,v,T,i,a)}return new ro(p,v,i,a)}if(e.delete){const p=Bo(o,e.delete);return new Tu(p,i)}if(e.verify){const p=Bo(o,e.verify);return new cd(p,i)}return dt()}function _d(o,e){return{documents:[dh(o,e.path)]}}function qp(o,e){const i={structuredQuery:{}},a=e.path;null!==e.collectionGroup?(i.parent=dh(o,a),i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i.parent=dh(o,a.popLast()),i.structuredQuery.from=[{collectionId:a.lastSegment()}]);const p=function(M){if(0===M.length)return;const N=M.map(K=>function(ne){if("=="===ne.op){if(W(ne.value))return{unaryFilter:{field:Rs(ne.field),op:"IS_NAN"}};if(le(ne.value))return{unaryFilter:{field:Rs(ne.field),op:"IS_NULL"}}}else if("!="===ne.op){if(W(ne.value))return{unaryFilter:{field:Rs(ne.field),op:"IS_NOT_NAN"}};if(le(ne.value))return{unaryFilter:{field:Rs(ne.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rs(ne.field),op:wd(ne.op),value:ne.value}}}(K));return 1===N.length?N[0]:{compositeFilter:{op:"AND",filters:N}}}(e.filters);p&&(i.structuredQuery.where=p);const v=function(M){if(0!==M.length)return M.map(N=>{return{field:Rs((K=N).field),direction:jp(K.dir)};var K})}(e.orderBy);v&&(i.structuredQuery.orderBy=v);const T=(N=e.limit,o.D||c(N)?N:{value:N});var N;return null!==T&&(i.structuredQuery.limit=T),e.startAt&&(i.structuredQuery.startAt=xd(e.startAt)),e.endAt&&(i.structuredQuery.endAt=xd(e.endAt)),i}function vd(o){let e=gd(o.parent);const i=o.structuredQuery,a=i.from?i.from.length:0;let p=null;if(a>0){It(1===a);const ne=i.from[0];ne.allDescendants?p=ne.collectionId:e=e.child(ne.collectionId)}let v=[];i.where&&(v=Gp(i.where));let T=[];i.orderBy&&(T=i.orderBy.map(ne=>{return new Vi(hr((me=ne).field),function(ke){switch(ke){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(me.direction));var me}));let M=null;i.limit&&(M=function(ne){let me;return me="object"==typeof ne?ne.value:ne,c(me)?null:me}(i.limit));let N=null;i.startAt&&(N=fh(i.startAt));let K=null;return i.endAt&&(K=fh(i.endAt)),An(e,p,T,v,M,"F",N,K)}function Gp(o){return o?void 0!==o.unaryFilter?[bd(o)]:void 0!==o.fieldFilter?[cm(o)]:void 0!==o.compositeFilter?o.compositeFilter.filters.map(e=>Gp(e)).reduce((e,i)=>e.concat(i)):dt():[]}function xd(o){return{before:o.before,values:o.position}}function fh(o){return new In(o.values||[],!!o.before)}function jp(o){return rm[o]}function wd(o){return sm[o]}function Rs(o){return{fieldPath:o.canonicalString()}}function hr(o){return Jn.fromServerFormat(o.fieldPath)}function cm(o){return nt.create(hr(o.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return dt()}}(o.fieldFilter.op),o.fieldFilter.value)}function bd(o){switch(o.unaryFilter.op){case"IS_NAN":const e=hr(o.unaryFilter.field);return nt.create(e,"==",{doubleValue:NaN});case"IS_NULL":const i=hr(o.unaryFilter.field);return nt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=hr(o.unaryFilter.field);return nt.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=hr(o.unaryFilter.field);return nt.create(p,"!=",{nullValue:"NULL_VALUE"});default:return dt()}}function um(o){const e=[];return o.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function $p(o){return o.length>=4&&"projects"===o.get(0)&&"databases"===o.get(2)}function Oo(o){let e="";for(let i=0;i<o.length;i++)e.length>0&&(e=Zp(e)),e=Td(o.get(i),e);return Zp(e)}function Td(o,e){let i=e;const a=o.length;for(let p=0;p<a;p++){const v=o.charAt(p);switch(v){case"\0":i+="\x01\x10";break;case"\x01":i+="\x01\x11";break;default:i+=v}}return i}function Zp(o){return o+"\x01\x01"}function so(o){const e=o.length;if(It(e>=2),2===e)return It("\x01"===o.charAt(0)&&"\x01"===o.charAt(1)),an.emptyPath();const i=e-2,a=[];let p="";for(let v=0;v<e;){const T=o.indexOf("\x01",v);switch((T<0||T>i)&&dt(),o.charAt(T+1)){case"\x01":const M=o.substring(v,T);let N;0===p.length?N=M:(p+=M,N=p,p=""),a.push(N);break;case"\x10":p+=o.substring(v,T),p+="\0";break;case"\x11":p+=o.substring(v,T+1);break;default:dt()}v=T+2}return new an(a)}class Wp{constructor(e,i){this.seconds=e,this.nanoseconds=i}}class qi{constructor(e,i,a){this.ownerId=e,this.allowTabSynchronization=i,this.leaseTimestampMs=a}}qi.store="owner",qi.key="owner";class oo{constructor(e,i,a){this.userId=e,this.lastAcknowledgedBatchId=i,this.lastStreamToken=a}}oo.store="mutationQueues",oo.keyPath="userId";class qn{constructor(e,i,a,p,v){this.userId=e,this.batchId=i,this.localWriteTimeMs=a,this.baseMutations=p,this.mutations=v}}qn.store="mutations",qn.keyPath="batchId",qn.userMutationsIndex="userMutationsIndex",qn.userMutationsKeyPath=["userId","batchId"];class Nr{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,i){return[e,Oo(i)]}static key(e,i,a){return[e,Oo(i),a]}}Nr.store="documentMutations",Nr.PLACEHOLDER=new Nr;class hm{constructor(e,i){this.path=e,this.readTime=i}}class dm{constructor(e,i){this.path=e,this.version=i}}class xi{constructor(e,i,a,p,v,T){this.unknownDocument=e,this.noDocument=i,this.document=a,this.hasCommittedMutations=p,this.readTime=v,this.parentPath=T}}xi.store="remoteDocuments",xi.readTimeIndex="readTimeIndex",xi.readTimeIndexPath="readTime",xi.collectionReadTimeIndex="collectionReadTimeIndex",xi.collectionReadTimeIndexPath=["parentPath","readTime"];class ca{constructor(e){this.byteSize=e}}ca.store="remoteDocumentGlobal",ca.key="remoteDocumentGlobalKey";class ds{constructor(e,i,a,p,v,T,M){this.targetId=e,this.canonicalId=i,this.readTime=a,this.resumeToken=p,this.lastListenSequenceNumber=v,this.lastLimboFreeSnapshotVersion=T,this.query=M}}ds.store="targets",ds.keyPath="targetId",ds.queryTargetsIndexName="queryTargetsIndex",ds.queryTargetsKeyPath=["canonicalId","targetId"];class er{constructor(e,i,a){this.targetId=e,this.path=i,this.sequenceNumber=a}}er.store="targetDocuments",er.keyPath=["targetId","path"],er.documentTargetsIndex="documentTargetsIndex",er.documentTargetsKeyPath=["path","targetId"];class Fs{constructor(e,i,a,p){this.highestTargetId=e,this.highestListenSequenceNumber=i,this.lastRemoteSnapshotVersion=a,this.targetCount=p}}Fs.key="targetGlobalKey",Fs.store="targetGlobal";class ao{constructor(e,i){this.collectionId=e,this.parent=i}}ao.store="collectionParents",ao.keyPath=["collectionId","parent"];class Ha{constructor(e,i,a,p){this.clientId=e,this.updateTimeMs=i,this.networkEnabled=a,this.inForeground=p}}Ha.store="clientMetadata",Ha.keyPath="clientId";class Pn{constructor(e,i,a){this.bundleId=e,this.createTime=i,this.version=a}}Pn.store="bundles",Pn.keyPath="bundleId";class Ka{constructor(e,i,a){this.name=e,this.readTime=i,this.bundledQuery=a}}Ka.store="namedQueries",Ka.keyPath="name";const Hp=[oo.store,qn.store,Nr.store,xi.store,ds.store,qi.store,Fs.store,er.store,Ha.store,ca.store,ao.store,Pn.store,Ka.store],Eu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Su{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class $e{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&dt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new $e((a,p)=>{this.nextCallback=v=>{this.wrapSuccess(e,v).next(a,p)},this.catchCallback=v=>{this.wrapFailure(i,v).next(a,p)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof $e?i:$e.resolve(i)}catch(i){return $e.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):$e.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):$e.reject(i)}static resolve(e){return new $e((i,a)=>{i(e)})}static reject(e){return new $e((i,a)=>{a(e)})}static waitFor(e){return new $e((i,a)=>{let p=0,v=0,T=!1;e.forEach(M=>{++p,M.next(()=>{++v,T&&v===p&&i()},N=>a(N))}),T=!0,v===p&&i()})}static or(e){let i=$e.resolve(!1);for(const a of e)i=i.next(p=>p?$e.resolve(p):a());return i}static forEach(e,i){const a=[];return e.forEach((p,v)=>{a.push(i.call(this,p,v))}),this.waitFor(a)}}class Iu{constructor(e,i){this.action=e,this.transaction=i,this.aborted=!1,this.Et=new Qn,this.transaction.oncomplete=()=>{this.Et.resolve()},this.transaction.onabort=()=>{i.error?this.Et.reject(new ic(e,i.error)):this.Et.resolve()},this.transaction.onerror=a=>{const p=Ed(a.target.error);this.Et.reject(new ic(e,p))}}static open(e,i,a,p){try{return new Iu(i,e.transaction(p,a))}catch(v){throw new ic(i,v)}}get It(){return this.Et.promise}abort(e){e&&this.Et.reject(e),this.aborted||(Je("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const i=this.transaction.objectStore(e);return new pm(i)}}class lo{constructor(e,i,a){this.name=e,this.version=i,this.At=a,12.2===lo.Rt((0,Mt.z$)())&&li("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Je("SimpleDb","Removing database:",e),wl(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if(!(0,Mt.hl)())return!1;if(lo.Pt())return!0;const e=(0,Mt.z$)(),i=lo.Rt(e),a=0<i&&i<10,p=lo.vt(e),v=0<p&&p<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||a||v)}static Pt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Vt)}static St(e,i){return e.store(i)}static Rt(e){const i=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),a=i?i[1].split("_").slice(0,2).join("."):"-1";return Number(a)}static vt(e){const i=e.match(/Android ([\d.]+)/i),a=i?i[1].split(".").slice(0,2).join("."):"-1";return Number(a)}Dt(e){var i=this;return(0,ae.Z)(function*(){return i.db||(Je("SimpleDb","Opening database:",i.name),i.db=yield new Promise((a,p)=>{const v=indexedDB.open(i.name,i.version);v.onsuccess=T=>{a(T.target.result)},v.onblocked=()=>{p(new ic(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},v.onerror=T=>{const M=T.target.error;p("VersionError"===M.name?new Ze(Ce.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===M.name?new Ze(Ce.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+M):new ic(e,M))},v.onupgradeneeded=T=>{Je("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',T.oldVersion),i.At.Ct(T.target.result,v.transaction,T.oldVersion,i.version).next(()=>{Je("SimpleDb","Database upgrade to version "+i.version+" complete")})}})),i.Nt&&(i.db.onversionchange=a=>i.Nt(a)),i.db})()}xt(e){this.Nt=e,this.db&&(this.db.onversionchange=i=>e(i))}runTransaction(e,i,a,p){var v=this;return(0,ae.Z)(function*(){const T="readonly"===i;let M=0;for(;;){++M;try{v.db=yield v.Dt(e);const N=Iu.open(v.db,e,T?"readonly":"readwrite",a),K=p(N).catch(ne=>(N.abort(ne),$e.reject(ne))).toPromise();return K.catch(()=>{}),yield N.It,K}catch(N){const K="FirebaseError"!==N.name&&M<3;if(Je("SimpleDb","Transaction failed with error:",N.message,"Retrying:",K),v.close(),!K)return Promise.reject(N)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Au{constructor(e){this.kt=e,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(e){this.kt=e}done(){this.$t=!0}Mt(e){this.Ot=e}delete(){return wl(this.kt.delete())}}class ic extends Ze{constructor(e,i){super(Ce.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${i}`),this.name="IndexedDbTransactionError"}}function Xa(o){return"IndexedDbTransactionError"===o.name}class pm{constructor(e){this.store=e}put(e,i){let a;return void 0!==i?(Je("SimpleDb","PUT",this.store.name,e,i),a=this.store.put(i,e)):(Je("SimpleDb","PUT",this.store.name,"<auto-key>",e),a=this.store.put(e)),wl(a)}add(e){return Je("SimpleDb","ADD",this.store.name,e,e),wl(this.store.add(e))}get(e){return wl(this.store.get(e)).next(i=>(void 0===i&&(i=null),Je("SimpleDb","GET",this.store.name,e,i),i))}delete(e){return Je("SimpleDb","DELETE",this.store.name,e),wl(this.store.delete(e))}count(){return Je("SimpleDb","COUNT",this.store.name),wl(this.store.count())}Lt(e,i){const a=this.cursor(this.options(e,i)),p=[];return this.Bt(a,(v,T)=>{p.push(T)}).next(()=>p)}Ut(e,i){Je("SimpleDb","DELETE ALL",this.store.name);const a=this.options(e,i);a.qt=!1;const p=this.cursor(a);return this.Bt(p,(v,T,M)=>M.delete())}Kt(e,i){let a;i?a=e:(a={},i=e);const p=this.cursor(a);return this.Bt(p,i)}jt(e){const i=this.cursor({});return new $e((a,p)=>{i.onerror=v=>{const T=Ed(v.target.error);p(T)},i.onsuccess=v=>{const T=v.target.result;T?e(T.primaryKey,T.value).next(M=>{M?T.continue():a()}):a()}})}Bt(e,i){const a=[];return new $e((p,v)=>{e.onerror=T=>{v(T.target.error)},e.onsuccess=T=>{const M=T.target.result;if(!M)return void p();const N=new Au(M),K=i(M.primaryKey,M.value,N);if(K instanceof $e){const ne=K.catch(me=>(N.done(),$e.reject(me)));a.push(ne)}N.isDone?p():null===N.Ft?M.continue():M.continue(N.Ft)}}).next(()=>$e.waitFor(a))}options(e,i){let a;return void 0!==e&&("string"==typeof e?a=e:i=e),{index:a,range:i}}cursor(e){let i="next";if(e.reverse&&(i="prev"),e.index){const a=this.store.index(e.index);return e.qt?a.openKeyCursor(e.range,i):a.openCursor(e.range,i)}return this.store.openCursor(e.range,i)}}function wl(o){return new $e((e,i)=>{o.onsuccess=a=>{e(a.target.result)},o.onerror=a=>{const p=Ed(a.target.error);i(p)}})}let Nc=!1;function Ed(o){const e=lo.Rt((0,Mt.z$)());if(e>=12.2&&e<13){const i="An internal error was encountered in the Indexed Database server";if(o.message.indexOf(i)>=0){const a=new Ze("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${i}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Nc||(Nc=!0,setTimeout(()=>{throw a},0)),a}}return o}class mh extends Su{constructor(e,i){super(),this.Qt=e,this.currentSequenceNumber=i}}function ps(o,e){const i=tt(o);return lo.St(i.Qt,e)}class Cu{constructor(e,i,a,p){this.batchId=e,this.localWriteTime=i,this.baseMutations=a,this.mutations=p}applyToRemoteDocument(e,i){const a=i.mutationResults;for(let p=0;p<this.mutations.length;p++){const v=this.mutations[p];v.key.isEqual(e.key)&&ld(v,e,a[p])}}applyToLocalView(e){for(const i of this.baseMutations)i.key.isEqual(e.key)&&tc(i,e,this.localWriteTime);for(const i of this.mutations)i.key.isEqual(e.key)&&tc(i,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(i=>{const a=e.get(i.key),p=a;this.applyToLocalView(p),a.isValidDocument()||p.convertToNoDocument(kt.min())})}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),mn())}isEqual(e){return this.batchId===e.batchId&&sa(this.mutations,e.mutations,(i,a)=>aa(i,a))&&sa(this.baseMutations,e.baseMutations,(i,a)=>aa(i,a))}}class ku{constructor(e,i,a,p){this.batch=e,this.commitVersion=i,this.mutationResults=a,this.docVersions=p}static from(e,i,a){It(e.mutations.length===a.length);let p=hd();const v=e.mutations;for(let T=0;T<v.length;T++)p=p.insert(v[T].key,a[T].version);return new ku(e,i,a,p)}}class ua{constructor(e,i,a,p,v=kt.min(),T=kt.min(),M=Mi.EMPTY_BYTE_STRING){this.target=e,this.targetId=i,this.purpose=a,this.sequenceNumber=p,this.snapshotVersion=v,this.lastLimboFreeSnapshotVersion=T,this.resumeToken=M}withSequenceNumber(e){return new ua(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,i){return new ua(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ua(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Kp{constructor(e){this.Wt=e}}function Sd(o,e){if(e.document)return Up(o.Wt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const i=_.fromSegments(e.noDocument.path),a=No(e.noDocument.readTime),p=ee.newNoDocument(i,a);return e.hasCommittedMutations?p.setHasCommittedMutations():p}if(e.unknownDocument){const i=_.fromSegments(e.unknownDocument.path),a=No(e.unknownDocument.version);return ee.newUnknownDocument(i,a)}return dt()}function Xp(o,e,i){const a=Id(i),p=e.key.path.popLast().toArray();if(e.isFoundDocument()){const v={name:la(M=o.Wt,(N=e).key),fields:N.data.value.mapValue.fields,updateTime:Rc(M,N.version.toTimestamp())};return new xi(null,null,v,e.hasCommittedMutations,a,p)}var M,N;if(e.isNoDocument()){const v=e.key.path.toArray(),T=rc(e.version),M=e.hasCommittedMutations;return new xi(null,new hm(v,T),null,M,a,p)}if(e.isUnknownDocument()){const v=e.key.path.toArray(),T=rc(e.version);return new xi(new dm(v,T),null,null,!0,a,p)}return dt()}function Id(o){const e=o.toTimestamp();return[e.seconds,e.nanoseconds]}function Yp(o){const e=new ki(o[0],o[1]);return kt.fromTimestamp(e)}function rc(o){const e=o.toTimestamp();return new Wp(e.seconds,e.nanoseconds)}function No(o){const e=new ki(o.seconds,o.nanoseconds);return kt.fromTimestamp(e)}function Uc(o,e){const i=(e.baseMutations||[]).map(v=>ph(o.Wt,v));for(let v=0;v<e.mutations.length-1;++v){const T=e.mutations[v];v+1<e.mutations.length&&void 0!==e.mutations[v+1].transform&&(T.updateTransforms=e.mutations[v+1].transform.fieldTransforms,e.mutations.splice(v+1,1),++v)}const a=e.mutations.map(v=>ph(o.Wt,v)),p=ki.fromMillis(e.localWriteTimeMs);return new Cu(e.batchId,p,i,a)}function Mu(o){const e=No(o.readTime),i=void 0!==o.lastLimboFreeSnapshotVersion?No(o.lastLimboFreeSnapshotVersion):kt.min();let a;var p;return void 0!==o.query.documents?(It(1===(p=o.query).documents.length),a=vi(Vt(gd(p.documents[0])))):a=vi(vd(o.query)),new ua(a,o.targetId,0,o.lastListenSequenceNumber,e,i,Mi.fromBase64String(o.resumeToken))}function Ad(o,e){const i=rc(e.snapshotVersion),a=rc(e.lastLimboFreeSnapshotVersion);let p;p=Ne(e.target)?_d(o.Wt,e.target):qp(o.Wt,e.target);const v=e.resumeToken.toBase64();return new ds(e.targetId,Le(e.target),i,v,e.sequenceNumber,a,p)}function gh(o){const e=vd({parent:o.parent,structuredQuery:o.structuredQuery});return"LAST"===o.limitType?vu(e,e.limit,"L"):e}class fm{getBundleMetadata(e,i){return Qp(e).get(i).next(a=>{if(a)return{id:(p=a).bundleId,createTime:No(p.createTime),version:p.version};var p})}saveBundleMetadata(e,i){return Qp(e).put({bundleId:(a=i).id,createTime:rc(ur(a.createTime)),version:a.version});var a}getNamedQuery(e,i){return bl(e).get(i).next(a=>{if(a)return{name:(p=a).name,query:gh(p.bundledQuery),readTime:No(p.readTime)};var p})}saveNamedQuery(e,i){return bl(e).put({name:(a=i).name,readTime:rc(ur(a.readTime)),bundledQuery:a.bundledQuery});var a}}function Qp(o){return ps(o,Pn.store)}function bl(o){return ps(o,Ka.store)}class mm{constructor(){this.Gt=new Cd}addToCollectionParentIndex(e,i){return this.Gt.add(i),$e.resolve()}getCollectionParents(e,i){return $e.resolve(this.Gt.getEntries(i))}}class Cd{constructor(){this.index={}}add(e){const i=e.lastSegment(),a=e.popLast(),p=this.index[i]||new hi(an.comparator),v=!p.has(a);return this.index[i]=p.add(a),v}has(e){const i=e.lastSegment(),a=e.popLast(),p=this.index[i];return p&&p.has(a)}getEntries(e){return(this.index[e]||new hi(an.comparator)).toArray()}}class Pu{constructor(){this.zt=new Cd}addToCollectionParentIndex(e,i){if(!this.zt.has(i)){const a=i.lastSegment(),p=i.popLast();e.addOnCommittedListener(()=>{this.zt.add(i)});const v={collectionId:a,parent:Oo(p)};return kd(e).put(v)}return $e.resolve()}getCollectionParents(e,i){const a=[],p=IDBKeyRange.bound([i,""],[gl(i),""],!1,!0);return kd(e).Lt(p).next(v=>{for(const T of v){if(T.collectionId!==i)break;a.push(so(T.parent))}return a})}}function kd(o){return ps(o,ao.store)}const yh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class fs{constructor(e,i,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}static withCacheSize(e){return new fs(e,fs.DEFAULT_COLLECTION_PERCENTILE,fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Jp(o,e,i){const a=o.store(qn.store),p=o.store(Nr.store),v=[],T=IDBKeyRange.only(i.batchId);let M=0;const N=a.Kt({range:T},(ne,me,ke)=>(M++,ke.delete()));v.push(N.next(()=>{It(1===M)}));const K=[];for(const ne of i.mutations){const me=Nr.key(e,ne.key.path,i.batchId);v.push(p.delete(me)),K.push(ne.key)}return $e.waitFor(v).next(()=>K)}function Tl(o){if(!o)return 0;let e;if(o.document)e=o.document;else if(o.unknownDocument)e=o.unknownDocument;else{if(!o.noDocument)throw dt();e=o.noDocument}return JSON.stringify(e).length}fs.DEFAULT_COLLECTION_PERCENTILE=10,fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,fs.DEFAULT=new fs(41943040,fs.DEFAULT_COLLECTION_PERCENTILE,fs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),fs.DISABLED=new fs(-1,0,0);class _h{constructor(e,i,a,p){this.userId=e,this.N=i,this.Ht=a,this.referenceDelegate=p,this.Jt={}}static Yt(e,i,a,p){It(""!==e.uid);const v=e.isAuthenticated()?e.uid:"";return new _h(v,i,a,p)}checkEmpty(e){let i=!0;const a=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return El(e).Kt({index:qn.userMutationsIndex,range:a},(p,v,T)=>{i=!1,T.done()}).next(()=>i)}addMutationBatch(e,i,a,p){const v=Vc(e),T=El(e);return T.add({}).next(M=>{It("number"==typeof M);const N=new Cu(M,i,a,p),K=function(ke,Ve,et){const ht=et.baseMutations.map(Hn=>xl(ke.Wt,Hn)),Bt=et.mutations.map(Hn=>xl(ke.Wt,Hn));return new qn(Ve,et.batchId,et.localWriteTime.toMillis(),ht,Bt)}(this.N,this.userId,N),ne=[];let me=new hi((ke,Ve)=>Ht(ke.canonicalString(),Ve.canonicalString()));for(const ke of p){const Ve=Nr.key(this.userId,ke.key.path,M);me=me.add(ke.key.path.popLast()),ne.push(T.put(K)),ne.push(v.put(Ve,Nr.PLACEHOLDER))}return me.forEach(ke=>{ne.push(this.Ht.addToCollectionParentIndex(e,ke))}),e.addOnCommittedListener(()=>{this.Jt[M]=N.keys()}),$e.waitFor(ne).next(()=>N)})}lookupMutationBatch(e,i){return El(e).get(i).next(a=>a?(It(a.userId===this.userId),Uc(this.N,a)):null)}Xt(e,i){return this.Jt[i]?$e.resolve(this.Jt[i]):this.lookupMutationBatch(e,i).next(a=>{if(a){const p=a.keys();return this.Jt[i]=p,p}return null})}getNextMutationBatchAfterBatchId(e,i){const a=i+1,p=IDBKeyRange.lowerBound([this.userId,a]);let v=null;return El(e).Kt({index:qn.userMutationsIndex,range:p},(T,M,N)=>{M.userId===this.userId&&(It(M.batchId>=a),v=Uc(this.N,M)),N.done()}).next(()=>v)}getHighestUnacknowledgedBatchId(e){const i=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let a=-1;return El(e).Kt({index:qn.userMutationsIndex,range:i,reverse:!0},(p,v,T)=>{a=v.batchId,T.done()}).next(()=>a)}getAllMutationBatches(e){const i=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return El(e).Lt(qn.userMutationsIndex,i).next(a=>a.map(p=>Uc(this.N,p)))}getAllMutationBatchesAffectingDocumentKey(e,i){const a=Nr.prefixForPath(this.userId,i.path),p=IDBKeyRange.lowerBound(a),v=[];return Vc(e).Kt({range:p},(T,M,N)=>{const[K,ne,me]=T,ke=so(ne);if(K===this.userId&&i.path.isEqual(ke))return El(e).get(me).next(Ve=>{if(!Ve)throw dt();It(Ve.userId===this.userId),v.push(Uc(this.N,Ve))});N.done()}).next(()=>v)}getAllMutationBatchesAffectingDocumentKeys(e,i){let a=new hi(Ht);const p=[];return i.forEach(v=>{const T=Nr.prefixForPath(this.userId,v.path),M=IDBKeyRange.lowerBound(T),N=Vc(e).Kt({range:M},(K,ne,me)=>{const[ke,Ve,et]=K,ht=so(Ve);ke===this.userId&&v.path.isEqual(ht)?a=a.add(et):me.done()});p.push(N)}),$e.waitFor(p).next(()=>this.Zt(e,a))}getAllMutationBatchesAffectingQuery(e,i){const a=i.path,p=a.length+1,v=Nr.prefixForPath(this.userId,a),T=IDBKeyRange.lowerBound(v);let M=new hi(Ht);return Vc(e).Kt({range:T},(N,K,ne)=>{const[me,ke,Ve]=N,et=so(ke);me===this.userId&&a.isPrefixOf(et)?et.length===p&&(M=M.add(Ve)):ne.done()}).next(()=>this.Zt(e,M))}Zt(e,i){const a=[],p=[];return i.forEach(v=>{p.push(El(e).get(v).next(T=>{if(null===T)throw dt();It(T.userId===this.userId),a.push(Uc(this.N,T))}))}),$e.waitFor(p).next(()=>a)}removeMutationBatch(e,i){return Jp(e.Qt,this.userId,i).next(a=>(e.addOnCommittedListener(()=>{this.te(i.batchId)}),$e.forEach(a,p=>this.referenceDelegate.markPotentiallyOrphaned(e,p))))}te(e){delete this.Jt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(i=>{if(!i)return $e.resolve();const a=IDBKeyRange.lowerBound(Nr.prefixForUser(this.userId)),p=[];return Vc(e).Kt({range:a},(v,T,M)=>{if(v[0]===this.userId){const N=so(v[1]);p.push(N)}else M.done()}).next(()=>{It(0===p.length)})})}containsKey(e,i){return Md(e,this.userId,i)}ee(e){return ef(e).get(this.userId).next(i=>i||new oo(this.userId,-1,""))}}function Md(o,e,i){const a=Nr.prefixForPath(e,i.path),p=a[1],v=IDBKeyRange.lowerBound(a);let T=!1;return Vc(o).Kt({range:v,qt:!0},(M,N,K)=>{const[ne,me,ke]=M;ne===e&&me===p&&(T=!0),K.done()}).next(()=>T)}function El(o){return ps(o,qn.store)}function Vc(o){return ps(o,Nr.store)}function ef(o){return ps(o,oo.store)}class sc{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new sc(0)}static ie(){return new sc(-1)}}class gm{constructor(e,i){this.referenceDelegate=e,this.N=i}allocateTargetId(e){return this.re(e).next(i=>{const a=new sc(i.highestTargetId);return i.highestTargetId=a.next(),this.oe(e,i).next(()=>i.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.re(e).next(i=>kt.fromTimestamp(new ki(i.lastRemoteSnapshotVersion.seconds,i.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.re(e).next(i=>i.highestListenSequenceNumber)}setTargetsMetadata(e,i,a){return this.re(e).next(p=>(p.highestListenSequenceNumber=i,a&&(p.lastRemoteSnapshotVersion=a.toTimestamp()),i>p.highestListenSequenceNumber&&(p.highestListenSequenceNumber=i),this.oe(e,p)))}addTargetData(e,i){return this.ce(e,i).next(()=>this.re(e).next(a=>(a.targetCount+=1,this.ae(i,a),this.oe(e,a))))}updateTargetData(e,i){return this.ce(e,i)}removeTargetData(e,i){return this.removeMatchingKeysForTargetId(e,i.targetId).next(()=>qc(e).delete(i.targetId)).next(()=>this.re(e)).next(a=>(It(a.targetCount>0),a.targetCount-=1,this.oe(e,a)))}removeTargets(e,i,a){let p=0;const v=[];return qc(e).Kt((T,M)=>{const N=Mu(M);N.sequenceNumber<=i&&null===a.get(N.targetId)&&(p++,v.push(this.removeTargetData(e,N)))}).next(()=>$e.waitFor(v)).next(()=>p)}forEachTarget(e,i){return qc(e).Kt((a,p)=>{const v=Mu(p);i(v)})}re(e){return tf(e).get(Fs.key).next(i=>(It(null!==i),i))}oe(e,i){return tf(e).put(Fs.key,i)}ce(e,i){return qc(e).put(Ad(this.N,i))}ae(e,i){let a=!1;return e.targetId>i.highestTargetId&&(i.highestTargetId=e.targetId,a=!0),e.sequenceNumber>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e.sequenceNumber,a=!0),a}getTargetCount(e){return this.re(e).next(i=>i.targetCount)}getTargetData(e,i){const a=Le(i),p=IDBKeyRange.bound([a,Number.NEGATIVE_INFINITY],[a,Number.POSITIVE_INFINITY]);let v=null;return qc(e).Kt({range:p,index:ds.queryTargetsIndexName},(T,M,N)=>{const K=Mu(M);We(i,K.target)&&(v=K,N.done())}).next(()=>v)}addMatchingKeys(e,i,a){const p=[],v=ha(e);return i.forEach(T=>{const M=Oo(T.path);p.push(v.put(new er(a,M))),p.push(this.referenceDelegate.addReference(e,a,T))}),$e.waitFor(p)}removeMatchingKeys(e,i,a){const p=ha(e);return $e.forEach(i,v=>{const T=Oo(v.path);return $e.waitFor([p.delete([a,T]),this.referenceDelegate.removeReference(e,a,v)])})}removeMatchingKeysForTargetId(e,i){const a=ha(e),p=IDBKeyRange.bound([i],[i+1],!1,!0);return a.delete(p)}getMatchingKeysForTargetId(e,i){const a=IDBKeyRange.bound([i],[i+1],!1,!0),p=ha(e);let v=mn();return p.Kt({range:a,qt:!0},(T,M,N)=>{const K=so(T[1]),ne=new _(K);v=v.add(ne)}).next(()=>v)}containsKey(e,i){const a=Oo(i.path),p=IDBKeyRange.bound([a],[gl(a)],!1,!0);let v=0;return ha(e).Kt({index:er.documentTargetsIndex,qt:!0,range:p},([T,M],N,K)=>{0!==T&&(v++,K.done())}).next(()=>v>0)}Tt(e,i){return qc(e).get(i).next(a=>a?Mu(a):null)}}function qc(o){return ps(o,ds.store)}function tf(o){return ps(o,Fs.store)}function ha(o){return ps(o,er.store)}function oc(o){return vh.apply(this,arguments)}function vh(){return(vh=(0,ae.Z)(function*(o){if(o.code!==Ce.FAILED_PRECONDITION||o.message!==Eu)throw o;Je("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}function Pd([o,e],[i,a]){const p=Ht(o,i);return 0===p?Ht(e,a):p}class nf{constructor(e){this.ue=e,this.buffer=new hi(Pd),this.he=0}le(){return++this.he}fe(e){const i=[e,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();Pd(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class ym{constructor(e,i){this.garbageCollector=e,this.asyncQueue=i,this.de=!1,this.we=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(e){var i=this;const a=this.de?3e5:6e4;Je("LruGarbageCollector",`Garbage collection scheduled in ${a}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",a,(0,ae.Z)(function*(){i.we=null,i.de=!0;try{yield e.collectGarbage(i.garbageCollector)}catch(p){Xa(p)?Je("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",p):yield oc(p)}yield i._e(e)}))}}class _m{constructor(e,i){this.me=e,this.params=i}calculateTargetCount(e,i){return this.me.ge(e).next(a=>Math.floor(i/100*a))}nthSequenceNumber(e,i){if(0===i)return $e.resolve(lr.T);const a=new nf(i);return this.me.forEachTarget(e,p=>a.fe(p.sequenceNumber)).next(()=>this.me.ye(e,p=>a.fe(p))).next(()=>a.maxValue)}removeTargets(e,i,a){return this.me.removeTargets(e,i,a)}removeOrphanedDocuments(e,i){return this.me.removeOrphanedDocuments(e,i)}collect(e,i){return-1===this.params.cacheSizeCollectionThreshold?(Je("LruGarbageCollector","Garbage collection skipped; disabled"),$e.resolve(yh)):this.getCacheSize(e).next(a=>a<this.params.cacheSizeCollectionThreshold?(Je("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),yh):this.pe(e,i))}getCacheSize(e){return this.me.getCacheSize(e)}pe(e,i){let a,p,v,T,M,N,K;const ne=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(me=>(me>this.params.maximumSequenceNumbersToCollect?(Je("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${me}`),p=this.params.maximumSequenceNumbersToCollect):p=me,T=Date.now(),this.nthSequenceNumber(e,p))).next(me=>(a=me,M=Date.now(),this.removeTargets(e,a,i))).next(me=>(v=me,N=Date.now(),this.removeOrphanedDocuments(e,a))).next(me=>(K=Date.now(),Va()<=Kn.in.DEBUG&&Je("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${T-ne}ms\n\tDetermined least recently used ${p} in `+(M-T)+`ms\n\tRemoved ${v} targets in `+(N-M)+`ms\n\tRemoved ${me} documents in `+(K-N)+`ms\nTotal Duration: ${K-ne}ms`),$e.resolve({didRun:!0,sequenceNumbersCollected:p,targetsRemoved:v,documentsRemoved:me})))}}class vm{constructor(e,i){this.db=e,this.garbageCollector=new _m(this,i)}ge(e){const i=this.Te(e);return this.db.getTargetCache().getTargetCount(e).next(a=>i.next(p=>a+p))}Te(e){let i=0;return this.ye(e,a=>{i++}).next(()=>i)}forEachTarget(e,i){return this.db.getTargetCache().forEachTarget(e,i)}ye(e,i){return this.Ee(e,(a,p)=>i(p))}addReference(e,i,a){return xh(e,a)}removeReference(e,i,a){return xh(e,a)}removeTargets(e,i,a){return this.db.getTargetCache().removeTargets(e,i,a)}markPotentiallyOrphaned(e,i){return xh(e,i)}Ie(e,i){return function(a,p){let v=!1;return ef(a).jt(T=>Md(a,T,p).next(M=>(M&&(v=!0),$e.resolve(!M)))).next(()=>v)}(e,i)}removeOrphanedDocuments(e,i){const a=this.db.getRemoteDocumentCache().newChangeBuffer(),p=[];let v=0;return this.Ee(e,(T,M)=>{if(M<=i){const N=this.Ie(e,T).next(K=>{if(!K)return v++,a.getEntry(e,T).next(()=>(a.removeEntry(T),ha(e).delete([0,Oo(T.path)])))});p.push(N)}}).next(()=>$e.waitFor(p)).next(()=>a.apply(e)).next(()=>v)}removeTarget(e,i){const a=i.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,a)}updateLimboDocument(e,i){return xh(e,i)}Ee(e,i){const a=ha(e);let p,v=lr.T;return a.Kt({index:er.documentTargetsIndex},([T,M],{path:N,sequenceNumber:K})=>{0===T?(v!==lr.T&&i(new _(so(p)),v),v=K,p=N):v=lr.T}).next(()=>{v!==lr.T&&i(new _(so(p)),v)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function xh(o,e){return ha(o).put((a=o.currentSequenceNumber,new er(0,Oo(e.path),a)));var a}class ac{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={}}get(e){const i=this.mapKeyFn(e),a=this.inner[i];if(void 0!==a)for(const[p,v]of a)if(this.equalsFn(p,e))return v}has(e){return void 0!==this.get(e)}set(e,i){const a=this.mapKeyFn(e),p=this.inner[a];if(void 0!==p){for(let v=0;v<p.length;v++)if(this.equalsFn(p[v][0],e))return void(p[v]=[e,i]);p.push([e,i])}else this.inner[a]=[[e,i]]}delete(e){const i=this.mapKeyFn(e),a=this.inner[i];if(void 0===a)return!1;for(let p=0;p<a.length;p++)if(this.equalsFn(a[p][0],e))return 1===a.length?delete this.inner[i]:a.splice(p,1),!0;return!1}forEach(e){zs(this.inner,(i,a)=>{for(const[p,v]of a)e(p,v)})}isEmpty(){return _u(this.inner)}}class rf{constructor(){this.changes=new ac(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}getReadTime(e){const i=this.changes.get(e);return i?i.readTime:kt.min()}addEntry(e,i){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:i})}removeEntry(e,i=null){this.assertNotApplied(),this.changes.set(e,{document:ee.newInvalidDocument(e),readTime:i})}getEntry(e,i){this.assertNotApplied();const a=this.changes.get(i);return void 0!==a?$e.resolve(a.document):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class tr{constructor(e,i){this.N=e,this.Ht=i}addEntry(e,i,a){return Uo(e).put(Ya(i),a)}removeEntry(e,i){const a=Uo(e),p=Ya(i);return a.delete(p)}updateMetadata(e,i){return this.getMetadata(e).next(a=>(a.byteSize+=i,this.Ae(e,a)))}getEntry(e,i){return Uo(e).get(Ya(i)).next(a=>this.Re(i,a))}be(e,i){return Uo(e).get(Ya(i)).next(a=>({document:this.Re(i,a),size:Tl(a)}))}getEntries(e,i){let a=Xr();return this.Pe(e,i,(p,v)=>{const T=this.Re(p,v);a=a.insert(p,T)}).next(()=>a)}ve(e,i){let a=Xr(),p=new en(_.comparator);return this.Pe(e,i,(v,T)=>{const M=this.Re(v,T);a=a.insert(v,M),p=p.insert(v,Tl(T))}).next(()=>({documents:a,Ve:p}))}Pe(e,i,a){if(i.isEmpty())return $e.resolve();const p=IDBKeyRange.bound(i.first().path.toArray(),i.last().path.toArray()),v=i.getIterator();let T=v.getNext();return Uo(e).Kt({range:p},(M,N,K)=>{const ne=_.fromSegments(M);for(;T&&_.comparator(T,ne)<0;)a(T,null),T=v.getNext();T&&T.isEqual(ne)&&(a(T,N),T=v.hasNext()?v.getNext():null),T?K.Mt(T.path.toArray()):K.done()}).next(()=>{for(;T;)a(T,null),T=v.hasNext()?v.getNext():null})}getDocumentsMatchingQuery(e,i,a){let p=Xr();const v=i.path.length+1,T={};if(a.isEqual(kt.min())){const M=i.path.toArray();T.range=IDBKeyRange.lowerBound(M)}else{const M=i.path.toArray(),N=Id(a);T.range=IDBKeyRange.lowerBound([M,N],!0),T.index=xi.collectionReadTimeIndex}return Uo(e).Kt(T,(M,N,K)=>{if(M.length!==v)return;const ne=Sd(this.N,N);i.path.isPrefixOf(ne.key.path)?Fo(i,ne)&&(p=p.insert(ne.key,ne)):K.done()}).next(()=>p)}newChangeBuffer(e){return new da(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(i=>i.byteSize)}getMetadata(e){return wh(e).get(ca.key).next(i=>(It(!!i),i))}Ae(e,i){return wh(e).put(ca.key,i)}Re(e,i){if(i){const a=Sd(this.N,i);if(!a.isNoDocument()||!a.version.isEqual(kt.min()))return a}return ee.newInvalidDocument(e)}}class da extends rf{constructor(e,i){super(),this.Se=e,this.trackRemovals=i,this.De=new ac(a=>a.toString(),(a,p)=>a.isEqual(p))}applyChanges(e){const i=[];let a=0,p=new hi((v,T)=>Ht(v.canonicalString(),T.canonicalString()));return this.changes.forEach((v,T)=>{const M=this.De.get(v);if(T.document.isValidDocument()){const N=Xp(this.Se.N,T.document,this.getReadTime(v));p=p.add(v.path.popLast()),a+=Tl(N)-M,i.push(this.Se.addEntry(e,v,N))}else if(a-=M,this.trackRemovals){const N=Xp(this.Se.N,ee.newNoDocument(v,kt.min()),this.getReadTime(v));i.push(this.Se.addEntry(e,v,N))}else i.push(this.Se.removeEntry(e,v))}),p.forEach(v=>{i.push(this.Se.Ht.addToCollectionParentIndex(e,v))}),i.push(this.Se.updateMetadata(e,a)),$e.waitFor(i)}getFromCache(e,i){return this.Se.be(e,i).next(a=>(this.De.set(i,a.size),a.document))}getAllFromCache(e,i){return this.Se.ve(e,i).next(({documents:a,Ve:p})=>(p.forEach((v,T)=>{this.De.set(v,T)}),a))}}function wh(o){return ps(o,ca.store)}function Uo(o){return ps(o,xi.store)}function Ya(o){return o.path.toArray()}class xm{constructor(e){this.N=e}Ct(e,i,a,p){It(a<p&&a>=0&&p<=11);const v=new Iu("createOrUpgrade",i);var M;a<1&&p>=1&&(e.createObjectStore(qi.store),(M=e).createObjectStore(oo.store,{keyPath:oo.keyPath}),M.createObjectStore(qn.store,{keyPath:qn.keyPath,autoIncrement:!0}).createIndex(qn.userMutationsIndex,qn.userMutationsKeyPath,{unique:!0}),M.createObjectStore(Nr.store),sf(e),function(M){M.createObjectStore(xi.store)}(e));let T=$e.resolve();return a<3&&p>=3&&(0!==a&&(function(M){M.deleteObjectStore(er.store),M.deleteObjectStore(ds.store),M.deleteObjectStore(Fs.store)}(e),sf(e)),T=T.next(()=>function(M){const N=M.store(Fs.store),K=new Fs(0,0,kt.min().toTimestamp(),0);return N.put(Fs.key,K)}(v))),a<4&&p>=4&&(0!==a&&(T=T.next(()=>function(M,N){return N.store(qn.store).Lt().next(K=>{M.deleteObjectStore(qn.store),M.createObjectStore(qn.store,{keyPath:qn.keyPath,autoIncrement:!0}).createIndex(qn.userMutationsIndex,qn.userMutationsKeyPath,{unique:!0});const ne=N.store(qn.store),me=K.map(ke=>ne.put(ke));return $e.waitFor(me)})}(e,v))),T=T.next(()=>{!function(M){M.createObjectStore(Ha.store,{keyPath:Ha.keyPath})}(e)})),a<5&&p>=5&&(T=T.next(()=>this.Ce(v))),a<6&&p>=6&&(T=T.next(()=>(function(M){M.createObjectStore(ca.store)}(e),this.Ne(v)))),a<7&&p>=7&&(T=T.next(()=>this.xe(v))),a<8&&p>=8&&(T=T.next(()=>this.ke(e,v))),a<9&&p>=9&&(T=T.next(()=>{(function(M){M.objectStoreNames.contains("remoteDocumentChanges")&&M.deleteObjectStore("remoteDocumentChanges")})(e),function(M){const N=M.objectStore(xi.store);N.createIndex(xi.readTimeIndex,xi.readTimeIndexPath,{unique:!1}),N.createIndex(xi.collectionReadTimeIndex,xi.collectionReadTimeIndexPath,{unique:!1})}(i)})),a<10&&p>=10&&(T=T.next(()=>this.$e(v))),a<11&&p>=11&&(T=T.next(()=>{(function(M){M.createObjectStore(Pn.store,{keyPath:Pn.keyPath})})(e),function(M){M.createObjectStore(Ka.store,{keyPath:Ka.keyPath})}(e)})),T}Ne(e){let i=0;return e.store(xi.store).Kt((a,p)=>{i+=Tl(p)}).next(()=>{const a=new ca(i);return e.store(ca.store).put(ca.key,a)})}Ce(e){const i=e.store(oo.store),a=e.store(qn.store);return i.Lt().next(p=>$e.forEach(p,v=>{const T=IDBKeyRange.bound([v.userId,-1],[v.userId,v.lastAcknowledgedBatchId]);return a.Lt(qn.userMutationsIndex,T).next(M=>$e.forEach(M,N=>{It(N.userId===v.userId);const K=Uc(this.N,N);return Jp(e,v.userId,K).next(()=>{})}))}))}xe(e){const i=e.store(er.store),a=e.store(xi.store);return e.store(Fs.store).get(Fs.key).next(p=>{const v=[];return a.Kt((T,M)=>{const N=new an(T),K=[0,Oo(N)];v.push(i.get(K).next(ne=>ne?$e.resolve():i.put(new er(0,Oo(N),p.highestListenSequenceNumber))))}).next(()=>$e.waitFor(v))})}ke(e,i){e.createObjectStore(ao.store,{keyPath:ao.keyPath});const a=i.store(ao.store),p=new Cd,v=T=>{if(p.add(T)){const M=T.lastSegment(),N=T.popLast();return a.put({collectionId:M,parent:Oo(N)})}};return i.store(xi.store).Kt({qt:!0},(T,M)=>{const N=new an(T);return v(N.popLast())}).next(()=>i.store(Nr.store).Kt({qt:!0},([T,M,N],K)=>{const ne=so(M);return v(ne.popLast())}))}$e(e){const i=e.store(ds.store);return i.Kt((a,p)=>{const v=Mu(p),T=Ad(this.N,v);return i.put(T)})}}function sf(o){o.createObjectStore(er.store,{keyPath:er.keyPath}).createIndex(er.documentTargetsIndex,er.documentTargetsKeyPath,{unique:!0}),o.createObjectStore(ds.store,{keyPath:ds.keyPath}).createIndex(ds.queryTargetsIndexName,ds.queryTargetsKeyPath,{unique:!0}),o.createObjectStore(Fs.store)}const lc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Dd{constructor(e,i,a,p,v,T,M,N,K,ne){if(this.allowTabSynchronization=e,this.persistenceKey=i,this.clientId=a,this.Oe=v,this.window=T,this.document=M,this.Fe=K,this.Me=ne,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=me=>Promise.resolve(),!Dd.bt())throw new Ze(Ce.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new vm(this,p),this.We=i+"main",this.N=new Kp(N),this.Ge=new lo(this.We,11,new xm(this.N)),this.ze=new gm(this.referenceDelegate,this.N),this.Ht=new Pu,this.He=new tr(this.N,this.Ht),this.Je=new fm,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===ne&&li("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ze(Ce.FAILED_PRECONDITION,lc);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ze.getHighestSequenceNumber(e))}).then(e=>{this.Le=new lr(e,this.Fe)}).then(()=>{this.Be=!0}).catch(e=>(this.Ge&&this.Ge.close(),Promise.reject(e)))}nn(e){var i=this;return this.Qe=function(){var a=(0,ae.Z)(function*(p){if(i.started)return e(p)});return function(p){return a.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ge.xt(function(){var i=(0,ae.Z)(function*(a){null===a.newVersion&&(yield e())});return function(a){return i.apply(this,arguments)}}())}setNetworkEnabled(e){var i=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((0,ae.Z)(function*(){i.started&&(yield i.Xe())})))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>zu(e).put(new Ha(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(e).next(i=>{i||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(e)).next(i=>this.isPrimary&&!i?this.on(e).next(()=>!1):!!i&&this.cn(e).next(()=>!0))).catch(e=>{if(Xa(e))return Je("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Je("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.Qe(e)),this.isPrimary=e})}sn(e){return Du(e).get(qi.key).next(i=>$e.resolve(this.an(i)))}un(e){return zu(e).delete(this.clientId)}hn(){var e=this;return(0,ae.Z)(function*(){if(e.isPrimary&&!e.ln(e.je,18e5)){e.je=Date.now();const i=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",a=>{const p=ps(a,Ha.store);return p.Lt().next(v=>{const T=e.fn(v,18e5),M=v.filter(N=>-1===T.indexOf(N));return $e.forEach(M,N=>p.delete(N.clientId)).next(()=>M)})}).catch(()=>[]);if(e.Ye)for(const a of i)e.Ye.removeItem(e.dn(a.clientId))}})()}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}an(e){return!!e&&e.ownerId===this.clientId}rn(e){return this.Me?$e.resolve(!0):Du(e).get(qi.key).next(i=>{if(null!==i&&this.ln(i.leaseTimestampMs,5e3)&&!this.wn(i.ownerId)){if(this.an(i)&&this.networkEnabled)return!0;if(!this.an(i)){if(!i.allowTabSynchronization)throw new Ze(Ce.FAILED_PRECONDITION,lc);return!1}}return!(!this.networkEnabled||!this.inForeground)||zu(e).Lt().next(a=>void 0===this.fn(a,5e3).find(p=>{if(this.clientId!==p.clientId){const T=!this.inForeground&&p.inForeground,M=this.networkEnabled===p.networkEnabled;if(!this.networkEnabled&&p.networkEnabled||T&&M)return!0}return!1}))}).next(i=>(this.isPrimary!==i&&Je("IndexedDbPersistence",`Client ${i?"is":"is not"} eligible for a primary lease.`),i))}shutdown(){var e=this;return(0,ae.Z)(function*(){e.Be=!1,e._n(),e.Ke&&(e.Ke.cancel(),e.Ke=null),e.mn(),e.gn(),yield e.Ge.runTransaction("shutdown","readwrite",[qi.store,Ha.store],i=>{const a=new mh(i,lr.T);return e.on(a).next(()=>e.un(a))}),e.Ge.close(),e.yn()})()}fn(e,i){return e.filter(a=>this.ln(a.updateTimeMs,i)&&!this.wn(a.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",e=>zu(e).Lt().next(i=>this.fn(i,18e5).map(a=>a.clientId)))}get started(){return this.Be}getMutationQueue(e){return _h.Yt(e,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(e,i,a){let v;return Je("IndexedDbPersistence","Starting transaction:",e),this.Ge.runTransaction(e,"readonly"===i?"readonly":"readwrite",Hp,T=>(v=new mh(T,this.Le?this.Le.next():lr.T),"readwrite-primary"===i?this.sn(v).next(M=>!!M||this.rn(v)).next(M=>{if(!M)throw li(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new Ze(Ce.FAILED_PRECONDITION,Eu);return a(v)}).next(M=>this.cn(v).next(()=>M)):this.Tn(v).next(()=>a(v)))).then(T=>(v.raiseOnCommittedEvent(),T))}Tn(e){return Du(e).get(qi.key).next(i=>{if(null!==i&&this.ln(i.leaseTimestampMs,5e3)&&!this.wn(i.ownerId)&&!this.an(i)&&!(this.Me||this.allowTabSynchronization&&i.allowTabSynchronization))throw new Ze(Ce.FAILED_PRECONDITION,lc)})}cn(e){const i=new qi(this.clientId,this.allowTabSynchronization,Date.now());return Du(e).put(qi.key,i)}static bt(){return lo.bt()}on(e){const i=Du(e);return i.get(qi.key).next(a=>this.an(a)?(Je("IndexedDbPersistence","Releasing primary lease."),i.delete(qi.key)):$e.resolve())}ln(e,i){const a=Date.now();return!(e<a-i||e>a&&(li(`Detected an update time that is in the future: ${e} > ${a}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=()=>{this._n(),(0,Mt.G6)()&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(e){var i;try{const a=null!==(null===(i=this.Ye)||void 0===i?void 0:i.getItem(this.dn(e)));return Je("IndexedDbPersistence",`Client '${e}' ${a?"is":"is not"} zombied in LocalStorage`),a}catch(a){return li("IndexedDbPersistence","Failed to get zombied client id.",a),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(e){li("Failed to set zombie client id.",e)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(e){}}dn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Du(o){return ps(o,qi.store)}function zu(o){return ps(o,Ha.store)}function bh(o,e){let i=o.projectId;return o.isDefaultDatabase||(i+="."+o.database),"firestore/"+e+"/"+i+"/"}class Lu{constructor(e,i){this.progress=e,this.En=i}}class hn{constructor(e,i,a){this.He=e,this.In=i,this.Ht=a}An(e,i){return this.In.getAllMutationBatchesAffectingDocumentKey(e,i).next(a=>this.Rn(e,i,a))}Rn(e,i,a){return this.He.getEntry(e,i).next(p=>{for(const v of a)v.applyToLocalView(p);return p})}bn(e,i){e.forEach((a,p)=>{for(const v of i)v.applyToLocalView(p)})}Pn(e,i){return this.He.getEntries(e,i).next(a=>this.vn(e,a).next(()=>a))}vn(e,i){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,i).next(a=>this.bn(i,a))}getDocumentsMatchingQuery(e,i,a){return _.isDocumentKey((p=i).path)&&null===p.collectionGroup&&0===p.filters.length?this.Vn(e,i.path):us(i)?this.Sn(e,i,a):this.Dn(e,i,a);var p}Vn(e,i){return this.An(e,new _(i)).next(a=>{let p=ch();return a.isFoundDocument()&&(p=p.insert(a.key,a)),p})}Sn(e,i,a){const p=i.collectionGroup;let v=ch();return this.Ht.getCollectionParents(e,p).next(T=>$e.forEach(T,M=>{const N=(K=i,ne=M.child(p),new ln(ne,null,K.explicitOrderBy.slice(),K.filters.slice(),K.limit,K.limitType,K.startAt,K.endAt));var K,ne;return this.Dn(e,N,a).next(K=>{K.forEach((ne,me)=>{v=v.insert(ne,me)})})}).next(()=>v))}Dn(e,i,a){let p,v;return this.He.getDocumentsMatchingQuery(e,i,a).next(T=>(p=T,this.In.getAllMutationBatchesAffectingQuery(e,i))).next(T=>(v=T,this.Cn(e,v,p).next(M=>{p=M;for(const N of v)for(const K of N.mutations){const ne=K.key;let me=p.get(ne);null==me&&(me=ee.newInvalidDocument(ne),p=p.insert(ne,me)),tc(K,me,N.localWriteTime),me.isFoundDocument()||(p=p.remove(ne))}}))).next(()=>(p.forEach((T,M)=>{Fo(i,M)||(p=p.remove(T))}),p))}Cn(e,i,a){let p=mn();for(const T of i)for(const M of T.mutations)M instanceof Or&&null===a.get(M.key)&&(p=p.add(M.key));let v=a;return this.He.getEntries(e,p).next(T=>(T.forEach((M,N)=>{N.isFoundDocument()&&(v=v.insert(M,N))}),v))}}class Ru{constructor(e,i,a,p){this.targetId=e,this.fromCache=i,this.Nn=a,this.xn=p}static kn(e,i){let a=mn(),p=mn();for(const v of i.docChanges)switch(v.type){case 0:a=a.add(v.doc.key);break;case 1:p=p.add(v.doc.key)}return new Ru(e,i.fromCache,a,p)}}class zd{$n(e){this.On=e}getDocumentsMatchingQuery(e,i,a,p){return 0===(v=i).filters.length&&null===v.limit&&null==v.startAt&&null==v.endAt&&(0===v.explicitOrderBy.length||1===v.explicitOrderBy.length&&v.explicitOrderBy[0].field.isKeyField())||a.isEqual(kt.min())?this.Fn(e,i):this.On.Pn(e,p).next(v=>{const T=this.Mn(i,v);return(Ln(i)||_i(i))&&this.Ln(i.limitType,T,p,a)?this.Fn(e,i):(Va()<=Kn.in.DEBUG&&Je("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),Cc(i)),this.On.getDocumentsMatchingQuery(e,i,a).next(M=>(T.forEach(N=>{M=M.insert(N.key,N)}),M)))});var v}Mn(e,i){let a=new hi(Xl(e));return i.forEach((p,v)=>{Fo(e,v)&&(a=a.add(v))}),a}Ln(e,i,a,p){if(a.size!==i.size)return!0;const v="F"===e?i.last():i.first();return!!v&&(v.hasPendingWrites||v.version.compareTo(p)>0)}Fn(e,i){return Va()<=Kn.in.DEBUG&&Je("QueryEngine","Using full collection scan to execute query:",Cc(i)),this.On.getDocumentsMatchingQuery(e,i,kt.min())}}class of{constructor(e,i,a,p){this.persistence=e,this.Bn=i,this.N=p,this.Un=new en(Ht),this.qn=new ac(v=>Le(v),We),this.Kn=kt.min(),this.In=e.getMutationQueue(a),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new hn(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Un))}}function pa(o,e,i,a){return new of(o,e,i,a)}function cc(o,e){return Th.apply(this,arguments)}function Th(){return(Th=(0,ae.Z)(function*(o,e){const i=tt(o);let a=i.In,p=i.Qn;const v=yield i.persistence.runTransaction("Handle user change","readonly",T=>{let M;return i.In.getAllMutationBatches(T).next(N=>(M=N,a=i.persistence.getMutationQueue(e),p=new hn(i.jn,a,i.persistence.getIndexManager()),a.getAllMutationBatches(T))).next(N=>{const K=[],ne=[];let me=mn();for(const ke of M){K.push(ke.batchId);for(const Ve of ke.mutations)me=me.add(Ve.key)}for(const ke of N){ne.push(ke.batchId);for(const Ve of ke.mutations)me=me.add(Ve.key)}return p.Pn(T,me).next(ke=>({Wn:ke,removedBatchIds:K,addedBatchIds:ne}))})});return i.In=a,i.Qn=p,i.Bn.$n(i.Qn),v})).apply(this,arguments)}function wm(o,e){const i=tt(o);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const p=e.batch.keys(),v=i.jn.newChangeBuffer({trackRemovals:!0});return function(T,M,N,K){const ne=N.batch,me=ne.keys();let ke=$e.resolve();return me.forEach(Ve=>{ke=ke.next(()=>K.getEntry(M,Ve)).next(et=>{const ht=N.docVersions.get(Ve);It(null!==ht),et.version.compareTo(ht)<0&&(ne.applyToRemoteDocument(et,N),et.isValidDocument()&&K.addEntry(et,N.commitVersion))})}),ke.next(()=>T.In.removeMutationBatch(M,ne))}(i,a,e,v).next(()=>v.apply(a)).next(()=>i.In.performConsistencyCheck(a)).next(()=>i.Qn.Pn(a,p))})}function af(o){const e=tt(o);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.ze.getLastRemoteSnapshotVersion(i))}function bm(o,e){const i=tt(o),a=e.snapshotVersion;let p=i.Un;return i.persistence.runTransaction("Apply remote event","readwrite-primary",v=>{const T=i.jn.newChangeBuffer({trackRemovals:!0});p=i.Un;const M=[];e.targetChanges.forEach((K,ne)=>{const me=p.get(ne);if(!me)return;M.push(i.ze.removeMatchingKeys(v,K.removedDocuments,ne).next(()=>i.ze.addMatchingKeys(v,K.addedDocuments,ne)));const ke=K.resumeToken;if(ke.approximateByteSize()>0){const Ve=me.withResumeToken(ke,a).withSequenceNumber(v.currentSequenceNumber);p=p.insert(ne,Ve),et=me,Bt=K,It((ht=Ve).resumeToken.approximateByteSize()>0),(0===et.resumeToken.approximateByteSize()||ht.snapshotVersion.toMicroseconds()-et.snapshotVersion.toMicroseconds()>=3e8||Bt.addedDocuments.size+Bt.modifiedDocuments.size+Bt.removedDocuments.size>0)&&M.push(i.ze.updateTargetData(v,Ve))}var et,ht,Bt});let N=Xr();if(e.documentUpdates.forEach((K,ne)=>{e.resolvedLimboDocuments.has(K)&&M.push(i.persistence.referenceDelegate.updateLimboDocument(v,K))}),M.push(lf(v,T,e.documentUpdates,a,void 0).next(K=>{N=K})),!a.isEqual(kt.min())){const K=i.ze.getLastRemoteSnapshotVersion(v).next(ne=>i.ze.setTargetsMetadata(v,v.currentSequenceNumber,a));M.push(K)}return $e.waitFor(M).next(()=>T.apply(v)).next(()=>i.Qn.vn(v,N)).next(()=>N)}).then(v=>(i.Un=p,v))}function lf(o,e,i,a,p){let v=mn();return i.forEach(T=>v=v.add(T)),e.getEntries(o,v).next(T=>{let M=Xr();return i.forEach((N,K)=>{const ne=T.get(N),me=(null==p?void 0:p.get(N))||a;K.isNoDocument()&&K.version.isEqual(kt.min())?(e.removeEntry(N,me),M=M.insert(N,K)):!ne.isValidDocument()||K.version.compareTo(ne.version)>0||0===K.version.compareTo(ne.version)&&ne.hasPendingWrites?(e.addEntry(K,me),M=M.insert(N,K)):Je("LocalStore","Ignoring outdated watch update for ",N,". Current version:",ne.version," Watch version:",K.version)}),M})}function Tm(o,e){const i=tt(o);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(void 0===e&&(e=-1),i.In.getNextMutationBatchAfterBatchId(a,e)))}function Gc(o,e){const i=tt(o);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let p;return i.ze.getTargetData(a,e).next(v=>v?(p=v,$e.resolve(p)):i.ze.allocateTargetId(a).next(T=>(p=new ua(e,T,0,a.currentSequenceNumber),i.ze.addTargetData(a,p).next(()=>p))))}).then(a=>{const p=i.Un.get(a.targetId);return(null===p||a.snapshotVersion.compareTo(p.snapshotVersion)>0)&&(i.Un=i.Un.insert(a.targetId,a),i.qn.set(e,a.targetId)),a})}function jc(o,e,i){return Ld.apply(this,arguments)}function Ld(){return(Ld=(0,ae.Z)(function*(o,e,i){const a=tt(o),p=a.Un.get(e),v=i?"readwrite":"readwrite-primary";try{i||(yield a.persistence.runTransaction("Release target",v,T=>a.persistence.referenceDelegate.removeTarget(T,p)))}catch(T){if(!Xa(T))throw T;Je("LocalStore",`Failed to update sequence numbers for target ${e}: ${T}`)}a.Un=a.Un.remove(e),a.qn.delete(p.target)})).apply(this,arguments)}function Eh(o,e,i){const a=tt(o);let p=kt.min(),v=mn();return a.persistence.runTransaction("Execute query","readonly",T=>function(M,N,K){const ne=tt(M),me=ne.qn.get(K);return void 0!==me?$e.resolve(ne.Un.get(me)):ne.ze.getTargetData(N,K)}(a,T,vi(e)).next(M=>{if(M)return p=M.lastLimboFreeSnapshotVersion,a.ze.getMatchingKeysForTargetId(T,M.targetId).next(N=>{v=N})}).next(()=>a.Bn.getDocumentsMatchingQuery(T,e,i?p:kt.min(),i?v:mn())).next(M=>({documents:M,Gn:v})))}function Fu(o,e){const i=tt(o),a=tt(i.ze),p=i.Un.get(e);return p?Promise.resolve(p.target):i.persistence.runTransaction("Get target data","readonly",v=>a.Tt(v,e).next(T=>T?T.target:null))}function uc(o){const e=tt(o);return e.persistence.runTransaction("Get new document changes","readonly",i=>function(a,p,v){const T=tt(a);let M=Xr(),N=Id(v);const K=Uo(p),ne=IDBKeyRange.lowerBound(N,!0);return K.Kt({index:xi.readTimeIndex,range:ne},(me,ke)=>{const Ve=Sd(T.N,ke);M=M.insert(Ve.key,Ve),N=ke.readTime}).next(()=>({En:M,readTime:Yp(N)}))}(e.jn,i,e.Kn)).then(({En:i,readTime:a})=>(e.Kn=a,i))}function Rd(){return(Rd=(0,ae.Z)(function*(o){const e=tt(o);return e.persistence.runTransaction("Synchronize last document change read time","readonly",i=>function(a){const p=Uo(a);let v=kt.min();return p.Kt({index:xi.readTimeIndex,reverse:!0},(T,M,N)=>{M.readTime&&(v=Yp(M.readTime)),N.done()}).next(()=>v)}(i)).then(i=>{e.Kn=i})})).apply(this,arguments)}function Fd(){return(Fd=(0,ae.Z)(function*(o,e,i,a){const p=tt(o);let v=mn(),T=Xr(),M=hd();for(const ne of i){const me=e.zn(ne.metadata.name);ne.document&&(v=v.add(me)),T=T.insert(me,e.Hn(ne)),M=M.insert(me,e.Jn(ne.metadata.readTime))}const N=p.jn.newChangeBuffer({trackRemovals:!0}),K=yield Gc(p,(ne=a,vi(Vt(an.fromString(`__bundle__/docs/${ne}`)))));var ne;return p.persistence.runTransaction("Apply bundle documents","readwrite",ne=>lf(ne,N,T,kt.min(),M).next(me=>(N.apply(ne),me)).next(me=>p.ze.removeMatchingKeysForTargetId(ne,K.targetId).next(()=>p.ze.addMatchingKeys(ne,v,K.targetId)).next(()=>p.Qn.vn(ne,me)).next(()=>me)))})).apply(this,arguments)}function Bd(o,e){return Bu.apply(this,arguments)}function Bu(){return(Bu=(0,ae.Z)(function*(o,e,i=mn()){const a=yield Gc(o,vi(gh(e.bundledQuery))),p=tt(o);return p.persistence.runTransaction("Save named query","readwrite",v=>{const T=ur(e.readTime);if(a.snapshotVersion.compareTo(T)>=0)return p.Je.saveNamedQuery(v,e);const M=a.withResumeToken(Mi.EMPTY_BYTE_STRING,T);return p.Un=p.Un.insert(M.targetId,M),p.ze.updateTargetData(v,M).next(()=>p.ze.removeMatchingKeysForTargetId(v,a.targetId)).next(()=>p.ze.addMatchingKeys(v,i,a.targetId)).next(()=>p.Je.saveNamedQuery(v,e))})})).apply(this,arguments)}class uf{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,i){return $e.resolve(this.Yn.get(i))}saveBundleMetadata(e,i){var a;return this.Yn.set(i.id,{id:(a=i).id,version:a.version,createTime:ur(a.createTime)}),$e.resolve()}getNamedQuery(e,i){return $e.resolve(this.Xn.get(i))}saveNamedQuery(e,i){return this.Xn.set(i.name,{name:(a=i).name,query:gh(a.bundledQuery),readTime:ur(a.readTime)}),$e.resolve();var a}}class Yr{constructor(){this.Zn=new hi(wi.ts),this.es=new hi(wi.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,i){const a=new wi(e,i);this.Zn=this.Zn.add(a),this.es=this.es.add(a)}ss(e,i){e.forEach(a=>this.addReference(a,i))}removeReference(e,i){this.rs(new wi(e,i))}os(e,i){e.forEach(a=>this.removeReference(a,i))}cs(e){const i=new _(new an([])),a=new wi(i,e),p=new wi(i,e+1),v=[];return this.es.forEachInRange([a,p],T=>{this.rs(T),v.push(T.key)}),v}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const i=new _(new an([])),a=new wi(i,e),p=new wi(i,e+1);let v=mn();return this.es.forEachInRange([a,p],T=>{v=v.add(T.key)}),v}containsKey(e){const i=new wi(e,0),a=this.Zn.firstAfterOrEqual(i);return null!==a&&e.isEqual(a.key)}}class wi{constructor(e,i){this.key=e,this.ls=i}static ts(e,i){return _.comparator(e.key,i.key)||Ht(e.ls,i.ls)}static ns(e,i){return Ht(e.ls,i.ls)||_.comparator(e.key,i.key)}}class $c{constructor(e,i){this.Ht=e,this.referenceDelegate=i,this.In=[],this.fs=1,this.ds=new hi(wi.ts)}checkEmpty(e){return $e.resolve(0===this.In.length)}addMutationBatch(e,i,a,p){const v=this.fs;this.fs++;const T=new Cu(v,i,a,p);this.In.push(T);for(const M of p)this.ds=this.ds.add(new wi(M.key,v)),this.Ht.addToCollectionParentIndex(e,M.key.path.popLast());return $e.resolve(T)}lookupMutationBatch(e,i){return $e.resolve(this.ws(i))}getNextMutationBatchAfterBatchId(e,i){const p=this._s(i+1),v=p<0?0:p;return $e.resolve(this.In.length>v?this.In[v]:null)}getHighestUnacknowledgedBatchId(){return $e.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(e){return $e.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const a=new wi(i,0),p=new wi(i,Number.POSITIVE_INFINITY),v=[];return this.ds.forEachInRange([a,p],T=>{const M=this.ws(T.ls);v.push(M)}),$e.resolve(v)}getAllMutationBatchesAffectingDocumentKeys(e,i){let a=new hi(Ht);return i.forEach(p=>{const v=new wi(p,0),T=new wi(p,Number.POSITIVE_INFINITY);this.ds.forEachInRange([v,T],M=>{a=a.add(M.ls)})}),$e.resolve(this.gs(a))}getAllMutationBatchesAffectingQuery(e,i){const a=i.path,p=a.length+1;let v=a;_.isDocumentKey(v)||(v=v.child(""));const T=new wi(new _(v),0);let M=new hi(Ht);return this.ds.forEachWhile(N=>{const K=N.key.path;return!!a.isPrefixOf(K)&&(K.length===p&&(M=M.add(N.ls)),!0)},T),$e.resolve(this.gs(M))}gs(e){const i=[];return e.forEach(a=>{const p=this.ws(a);null!==p&&i.push(p)}),i}removeMutationBatch(e,i){It(0===this.ys(i.batchId,"removed")),this.In.shift();let a=this.ds;return $e.forEach(i.mutations,p=>{const v=new wi(p.key,i.batchId);return a=a.delete(v),this.referenceDelegate.markPotentiallyOrphaned(e,p.key)}).next(()=>{this.ds=a})}te(e){}containsKey(e,i){const a=new wi(i,0),p=this.ds.firstAfterOrEqual(a);return $e.resolve(i.isEqual(p&&p.key))}performConsistencyCheck(e){return $e.resolve()}ys(e,i){return this._s(e)}_s(e){return 0===this.In.length?0:e-this.In[0].batchId}ws(e){const i=this._s(e);return i<0||i>=this.In.length?null:this.In[i]}}class Od{constructor(e,i){this.Ht=e,this.ps=i,this.docs=new en(_.comparator),this.size=0}addEntry(e,i,a){const p=i.key,v=this.docs.get(p),T=v?v.size:0,M=this.ps(i);return this.docs=this.docs.insert(p,{document:i.clone(),size:M,readTime:a}),this.size+=M-T,this.Ht.addToCollectionParentIndex(e,p.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const a=this.docs.get(i);return $e.resolve(a?a.document.clone():ee.newInvalidDocument(i))}getEntries(e,i){let a=Xr();return i.forEach(p=>{const v=this.docs.get(p);a=a.insert(p,v?v.document.clone():ee.newInvalidDocument(p))}),$e.resolve(a)}getDocumentsMatchingQuery(e,i,a){let p=Xr();const v=new _(i.path.child("")),T=this.docs.getIteratorFrom(v);for(;T.hasNext();){const{key:M,value:{document:N,readTime:K}}=T.getNext();if(!i.path.isPrefixOf(M.path))break;K.compareTo(a)<=0||Fo(i,N)&&(p=p.insert(N.key,N.clone()))}return $e.resolve(p)}Ts(e,i){return $e.forEach(this.docs,a=>i(a))}newChangeBuffer(e){return new Sh(this)}getSize(e){return $e.resolve(this.size)}}class Sh extends rf{constructor(e){super(),this.Se=e}applyChanges(e){const i=[];return this.changes.forEach((a,p)=>{p.document.isValidDocument()?i.push(this.Se.addEntry(e,p.document,this.getReadTime(a))):this.Se.removeEntry(a)}),$e.waitFor(i)}getFromCache(e,i){return this.Se.getEntry(e,i)}getAllFromCache(e,i){return this.Se.getEntries(e,i)}}class Sm{constructor(e){this.persistence=e,this.Es=new ac(i=>Le(i),We),this.lastRemoteSnapshotVersion=kt.min(),this.highestTargetId=0,this.Is=0,this.As=new Yr,this.targetCount=0,this.Rs=sc.se()}forEachTarget(e,i){return this.Es.forEach((a,p)=>i(p)),$e.resolve()}getLastRemoteSnapshotVersion(e){return $e.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $e.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),$e.resolve(this.highestTargetId)}setTargetsMetadata(e,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.Is&&(this.Is=i),$e.resolve()}ce(e){this.Es.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Rs=new sc(i),this.highestTargetId=i),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,i){return this.ce(i),this.targetCount+=1,$e.resolve()}updateTargetData(e,i){return this.ce(i),$e.resolve()}removeTargetData(e,i){return this.Es.delete(i.target),this.As.cs(i.targetId),this.targetCount-=1,$e.resolve()}removeTargets(e,i,a){let p=0;const v=[];return this.Es.forEach((T,M)=>{M.sequenceNumber<=i&&null===a.get(M.targetId)&&(this.Es.delete(T),v.push(this.removeMatchingKeysForTargetId(e,M.targetId)),p++)}),$e.waitFor(v).next(()=>p)}getTargetCount(e){return $e.resolve(this.targetCount)}getTargetData(e,i){const a=this.Es.get(i)||null;return $e.resolve(a)}addMatchingKeys(e,i,a){return this.As.ss(i,a),$e.resolve()}removeMatchingKeys(e,i,a){this.As.os(i,a);const p=this.persistence.referenceDelegate,v=[];return p&&i.forEach(T=>{v.push(p.markPotentiallyOrphaned(e,T))}),$e.waitFor(v)}removeMatchingKeysForTargetId(e,i){return this.As.cs(i),$e.resolve()}getMatchingKeysForTargetId(e,i){const a=this.As.hs(i);return $e.resolve(a)}containsKey(e,i){return $e.resolve(this.As.containsKey(i))}}class hf{constructor(e,i){this.bs={},this.Le=new lr(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new Sm(this),this.Ht=new mm,this.He=new Od(this.Ht,a=>this.referenceDelegate.Ps(a)),this.N=new Kp(i),this.Je=new uf(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let i=this.bs[e.toKey()];return i||(i=new $c(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=i),i}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,i,a){Je("MemoryPersistence","Starting transaction:",e);const p=new df(this.Le.next());return this.referenceDelegate.vs(),a(p).next(v=>this.referenceDelegate.Vs(p).next(()=>v)).toPromise().then(v=>(p.raiseOnCommittedEvent(),v))}Ss(e,i){return $e.or(Object.values(this.bs).map(a=>()=>a.containsKey(e,i)))}}class df extends Su{constructor(e){super(),this.currentSequenceNumber=e}}class Nd{constructor(e){this.persistence=e,this.Ds=new Yr,this.Cs=null}static Ns(e){return new Nd(e)}get xs(){if(this.Cs)return this.Cs;throw dt()}addReference(e,i,a){return this.Ds.addReference(a,i),this.xs.delete(a.toString()),$e.resolve()}removeReference(e,i,a){return this.Ds.removeReference(a,i),this.xs.add(a.toString()),$e.resolve()}markPotentiallyOrphaned(e,i){return this.xs.add(i.toString()),$e.resolve()}removeTarget(e,i){this.Ds.cs(i.targetId).forEach(p=>this.xs.add(p.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,i.targetId).next(p=>{p.forEach(v=>this.xs.add(v.toString()))}).next(()=>a.removeTargetData(e,i))}vs(){this.Cs=new Set}Vs(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $e.forEach(this.xs,a=>{const p=_.fromPath(a);return this.ks(e,p).next(v=>{v||i.removeEntry(p)})}).next(()=>(this.Cs=null,i.apply(e)))}updateLimboDocument(e,i){return this.ks(e,i).next(a=>{a?this.xs.delete(i.toString()):this.xs.add(i.toString())})}Ps(e){return 0}ks(e,i){return $e.or([()=>$e.resolve(this.Ds.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Ss(e,i)])}}function Ud(o,e){return`firestore_clients_${o}_${e}`}function Vd(o,e,i){let a=`firestore_mutations_${o}_${i}`;return e.isAuthenticated()&&(a+=`_${e.uid}`),a}function Ou(o,e){return`firestore_targets_${o}_${e}`}class Zc{constructor(e,i,a,p){this.user=e,this.batchId=i,this.state=a,this.error=p}static $s(e,i,a){const p=JSON.parse(a);let v,T="object"==typeof p&&-1!==["pending","acknowledged","rejected"].indexOf(p.state)&&(void 0===p.error||"object"==typeof p.error);return T&&p.error&&(T="string"==typeof p.error.message&&"string"==typeof p.error.code,T&&(v=new Ze(p.error.code,p.error.message))),T?new Zc(e,i,p.state,v):(li("SharedClientState",`Failed to parse mutation state for ID '${i}': ${a}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Wc{constructor(e,i,a){this.targetId=e,this.state=i,this.error=a}static $s(e,i){const a=JSON.parse(i);let p,v="object"==typeof a&&-1!==["not-current","current","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return v&&a.error&&(v="string"==typeof a.error.message&&"string"==typeof a.error.code,v&&(p=new Ze(a.error.code,a.error.message))),v?new Wc(e,a.state,p):(li("SharedClientState",`Failed to parse target state for ID '${e}': ${i}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ih{constructor(e,i){this.clientId=e,this.activeTargetIds=i}static $s(e,i){const a=JSON.parse(i);let p="object"==typeof a&&a.activeTargetIds instanceof Array,v=Pc();for(let T=0;p&&T<a.activeTargetIds.length;++T)p=y(a.activeTargetIds[T]),v=v.add(a.activeTargetIds[T]);return p?new Ih(e,v):(li("SharedClientState",`Failed to parse client data for instance '${e}': ${i}`),null)}}class Ah{constructor(e,i){this.clientId=e,this.onlineState=i}static $s(e){const i=JSON.parse(e);return"object"==typeof i&&-1!==["Unknown","Online","Offline"].indexOf(i.onlineState)&&"string"==typeof i.clientId?new Ah(i.clientId,i.onlineState):(li("SharedClientState",`Failed to parse online state: ${e}`),null)}}class fa{constructor(){this.activeTargetIds=Pc()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ch{constructor(e,i,a,p,v){this.window=e,this.Oe=i,this.persistenceKey=a,this.Ls=p,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new en(Ht),this.started=!1,this.Ks=[];const T=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=v,this.js=Ud(this.persistenceKey,this.Ls),this.Qs=`firestore_sequence_number_${this.persistenceKey}`,this.qs=this.qs.insert(this.Ls,new fa),this.Ws=new RegExp(`^firestore_clients_${T}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${T}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${T}_(\\d+)$`),this.Hs=`firestore_online_state_${this.persistenceKey}`,this.Js=function(M){return`firestore_bundle_loaded_${M}`}(this.persistenceKey),this.window.addEventListener("storage",this.Bs)}static bt(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,ae.Z)(function*(){const i=yield e.syncEngine.pn();for(const p of i){if(p===e.Ls)continue;const v=e.getItem(Ud(e.persistenceKey,p));if(v){const T=Ih.$s(p,v);T&&(e.qs=e.qs.insert(T.clientId,T))}}e.Ys();const a=e.storage.getItem(e.Hs);if(a){const p=e.Xs(a);p&&e.Zs(p)}for(const p of e.Ks)e.Us(p);e.Ks=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Qs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(e){let i=!1;return this.qs.forEach((a,p)=>{p.activeTargetIds.has(e)&&(i=!0)}),i}addPendingMutation(e){this.ei(e,"pending")}updateMutationState(e,i,a){this.ei(e,i,a),this.ni(e)}addLocalQueryTarget(e){let i="not-current";if(this.isActiveQueryTarget(e)){const a=this.storage.getItem(Ou(this.persistenceKey,e));if(a){const p=Wc.$s(e,a);p&&(i=p.state)}}return this.si.Fs(e),this.Ys(),i}removeLocalQueryTarget(e){this.si.Ms(e),this.Ys()}isLocalQueryTarget(e){return this.si.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ou(this.persistenceKey,e))}updateQueryState(e,i,a){this.ii(e,i,a)}handleUserChange(e,i,a){i.forEach(p=>{this.ni(p)}),this.currentUser=e,a.forEach(p=>{this.addPendingMutation(p)})}setOnlineState(e){this.ri(e)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(e){const i=this.storage.getItem(e);return Je("SharedClientState","READ",e,i),i}setItem(e,i){Je("SharedClientState","SET",e,i),this.storage.setItem(e,i)}removeItem(e){Je("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Us(e){var i=this;const a=e;if(a.storageArea===this.storage){if(Je("SharedClientState","EVENT",a.key,a.newValue),a.key===this.js)return void li("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,ae.Z)(function*(){if(i.started){if(null!==a.key)if(i.Ws.test(a.key)){if(null==a.newValue){const p=i.ci(a.key);return i.ai(p,null)}{const p=i.ui(a.key,a.newValue);if(p)return i.ai(p.clientId,p)}}else if(i.Gs.test(a.key)){if(null!==a.newValue){const p=i.hi(a.key,a.newValue);if(p)return i.li(p)}}else if(i.zs.test(a.key)){if(null!==a.newValue){const p=i.fi(a.key,a.newValue);if(p)return i.di(p)}}else if(a.key===i.Hs){if(null!==a.newValue){const p=i.Xs(a.newValue);if(p)return i.Zs(p)}}else if(a.key===i.Qs){const p=function(v){let T=lr.T;if(null!=v)try{const M=JSON.parse(v);It("number"==typeof M),T=M}catch(M){li("SharedClientState","Failed to read sequence number from WebStorage",M)}return T}(a.newValue);p!==lr.T&&i.sequenceNumberHandler(p)}else if(a.key===i.Js)return i.syncEngine.wi()}else i.Ks.push(a)}))}}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(e,i,a){const p=new Zc(this.currentUser,e,i,a),v=Vd(this.persistenceKey,this.currentUser,e);this.setItem(v,p.Os())}ni(e){const i=Vd(this.persistenceKey,this.currentUser,e);this.removeItem(i)}ri(e){this.storage.setItem(this.Hs,JSON.stringify({clientId:this.Ls,onlineState:e}))}ii(e,i,a){const p=Ou(this.persistenceKey,e),v=new Wc(e,i,a);this.setItem(p,v.Os())}oi(){this.setItem(this.Js,"value-not-used")}ci(e){const i=this.Ws.exec(e);return i?i[1]:null}ui(e,i){const a=this.ci(e);return Ih.$s(a,i)}hi(e,i){const a=this.Gs.exec(e),p=Number(a[1]);return Zc.$s(new Mn(void 0!==a[2]?a[2]:null),p,i)}fi(e,i){const a=this.zs.exec(e),p=Number(a[1]);return Wc.$s(p,i)}Xs(e){return Ah.$s(e)}li(e){var i=this;return(0,ae.Z)(function*(){if(e.user.uid===i.currentUser.uid)return i.syncEngine._i(e.batchId,e.state,e.error);Je("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}di(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}ai(e,i){const a=i?this.qs.insert(e,i):this.qs.remove(e),p=this.ti(this.qs),v=this.ti(a),T=[],M=[];return v.forEach(N=>{p.has(N)||T.push(N)}),p.forEach(N=>{v.has(N)||M.push(N)}),this.syncEngine.gi(T,M).then(()=>{this.qs=a})}Zs(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ti(e){let i=Pc();return e.forEach((a,p)=>{i=i.unionWith(p.activeTargetIds)}),i}}class qd{constructor(){this.yi=new fa,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,a){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,i,a){this.pi[e]=i}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new fa,Promise.resolve()}handleUserChange(e,i,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class pf{Ti(e){}shutdown(){}}class Gd{constructor(){this.Ei=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ti(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}Ii(){Je("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Ri(){Je("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Im={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Am{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}class ff extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(e,i,a,p){const v=this.Bi(e,i);Je("RestConnection","Sending: ",v,a);const T={};return this.Ui(T,p),this.qi(e,v,T,a).then(M=>(Je("RestConnection","Received: ",M),M),M=>{throw zo("RestConnection",`${e} failed with error: `,M,"url: ",v,"request:",a),M})}Ki(e,i,a,p){return this.Li(e,i,a,p)}Ui(e,i){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+Ua,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i)for(const a in i.authHeaders)i.authHeaders.hasOwnProperty(a)&&(e[a]=i.authHeaders[a])}Bi(e,i){return`${this.Fi}/v1/${i}:${Im[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(e,i,a,p){return new Promise((v,T)=>{const M=new ih;M.listenOnce(ia.COMPLETE,()=>{try{switch(M.getLastErrorCode()){case to.NO_ERROR:const K=M.getResponseJson();Je("Connection","XHR received:",JSON.stringify(K)),v(K);break;case to.TIMEOUT:Je("Connection",'RPC "'+e+'" timed out'),T(new Ze(Ce.DEADLINE_EXCEEDED,"Request time out"));break;case to.HTTP_ERROR:const ne=M.getStatus();if(Je("Connection",'RPC "'+e+'" failed with status:',ne,"response text:",M.getResponseText()),ne>0){const me=M.getResponseJson().error;if(me&&me.status&&me.message){const ke=function(Ve){const et=Ve.toLowerCase().replace(/_/g,"-");return Object.values(Ce).indexOf(et)>=0?et:Ce.UNKNOWN}(me.status);T(new Ze(ke,me.message))}else T(new Ze(Ce.UNKNOWN,"Server responded with status "+M.getStatus()))}else T(new Ze(Ce.UNAVAILABLE,"Connection failed."));break;default:dt()}}finally{Je("Connection",'RPC "'+e+'" completed.')}});const N=JSON.stringify(p);M.send(i,"POST",N,a,15)})}ji(e,i){const a=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=eo(),v=uu(),T={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(T.xmlHttpFactory=new id({})),this.Ui(T.initMessageHeaders,i),(0,Mt.uI)()||(0,Mt.b$)()||(0,Mt.d)()||(0,Mt.w1)()||(0,Mt.Mn)()||(0,Mt.ru)()||(T.httpHeadersOverwriteParam="$httpHeaders");const M=a.join("");Je("Connection","Creating WebChannel: "+M,T);const N=p.createWebChannel(M,T);let K=!1,ne=!1;const me=new Am({vi:Ve=>{ne?Je("Connection","Not sending because WebChannel is closed:",Ve):(K||(Je("Connection","Opening WebChannel transport."),N.open(),K=!0),Je("Connection","WebChannel sending:",Ve),N.send(Ve))},Vi:()=>N.close()}),ke=(Ve,et,ht)=>{Ve.listen(et,Bt=>{try{ht(Bt)}catch(Hn){setTimeout(()=>{throw Hn},0)}})};return ke(N,Zl.EventType.OPEN,()=>{ne||Je("Connection","WebChannel transport opened.")}),ke(N,Zl.EventType.CLOSE,()=>{ne||(ne=!0,Je("Connection","WebChannel transport closed"),me.$i())}),ke(N,Zl.EventType.ERROR,Ve=>{ne||(ne=!0,zo("Connection","WebChannel transport errored:",Ve),me.$i(new Ze(Ce.UNAVAILABLE,"The operation could not be completed")))}),ke(N,Zl.EventType.MESSAGE,Ve=>{var et;if(!ne){const ht=Ve.data[0];It(!!ht);const Bt=ht,Hn=Bt.error||(null===(et=Bt[0])||void 0===et?void 0:et.error);if(Hn){Je("Connection","WebChannel received error:",Hn);const Vs=Hn.status;let uo=function(Tr){const va=ui[Tr];if(void 0!==va)return Bp(va)}(Vs),Un=Hn.message;void 0===uo&&(uo=Ce.INTERNAL,Un="Unknown error status: "+Vs+" with message "+Hn.message),ne=!0,me.$i(new Ze(uo,Un)),N.close()}else Je("Connection","WebChannel received:",ht),me.Oi(ht)}}),ke(v,Ac.STAT_EVENT,Ve=>{Ve.stat===hu.PROXY?Je("Connection","Detected buffering proxy"):Ve.stat===hu.NOPROXY&&Je("Connection","Detected no buffering proxy")}),setTimeout(()=>{me.ki()},0),me}}function jd(){return"undefined"!=typeof window?window:null}function Nu(){return"undefined"!=typeof document?document:null}function Uu(o){return new hs(o,!0)}class Sl{constructor(e,i,a=1e3,p=1.5,v=6e4){this.Oe=e,this.timerId=i,this.Qi=a,this.Wi=p,this.Gi=v,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();const i=Math.floor(this.zi+this.Zi()),a=Math.max(0,Date.now()-this.Ji),p=Math.max(0,i-a);p>0&&Je("ExponentialBackoff",`Backing off for ${p} ms (base delay: ${this.zi} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,p,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class Hc{constructor(e,i,a,p,v,T,M){this.Oe=e,this.er=a,this.nr=p,this.sr=v,this.credentialsProvider=T,this.listener=M,this.state=0,this.ir=0,this.rr=null,this.cr=null,this.stream=null,this.ar=new Sl(e,i)}ur(){return 1===this.state||5===this.state||this.hr()}hr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.lr()}stop(){var e=this;return(0,ae.Z)(function*(){e.ur()&&(yield e.close(0))})()}dr(){this.state=0,this.ar.reset()}wr(){this.hr()&&null===this.rr&&(this.rr=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this._r()))}mr(e){this.gr(),this.stream.send(e)}_r(){var e=this;return(0,ae.Z)(function*(){if(e.hr())return e.close(0)})()}gr(){this.rr&&(this.rr.cancel(),this.rr=null)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}close(e,i){var a=this;return(0,ae.Z)(function*(){a.gr(),a.yr(),a.ar.cancel(),a.ir++,4!==e?a.ar.reset():i&&i.code===Ce.RESOURCE_EXHAUSTED?(li(i.toString()),li("Using maximum backoff delay to prevent overloading the backend."),a.ar.Yi()):i&&i.code===Ce.UNAUTHENTICATED&&3!==a.state&&a.credentialsProvider.invalidateToken(),null!==a.stream&&(a.pr(),a.stream.close(),a.stream=null),a.state=e,yield a.listener.Ci(i)})()}pr(){}auth(){this.state=1;const e=this.Tr(this.ir),i=this.ir;this.credentialsProvider.getToken().then(a=>{this.ir===i&&this.Er(a)},a=>{e(()=>{const p=new Ze(Ce.UNKNOWN,"Fetching auth token failed: "+a.message);return this.Ir(p)})})}Er(e){const i=this.Tr(this.ir);this.stream=this.Ar(e),this.stream.Si(()=>{i(()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.nr,1e4,()=>(this.hr()&&(this.state=3),Promise.resolve())),this.listener.Si()))}),this.stream.Ci(a=>{i(()=>this.Ir(a))}),this.stream.onMessage(a=>{i(()=>this.onMessage(a))})}lr(){var e=this;this.state=5,this.ar.Xi((0,ae.Z)(function*(){e.state=0,e.start()}))}Ir(e){return Je("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Tr(e){return i=>{this.Oe.enqueueAndForget(()=>this.ir===e?i():(Je("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class mf extends Hc{constructor(e,i,a,p,v){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,v),this.N=p}Ar(e){return this.sr.ji("Listen",e)}onMessage(e){this.ar.reset();const i=function(o,e){let i;if("targetChange"in e){const a="NO_CHANGE"===(N=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===N?1:"REMOVE"===N?2:"CURRENT"===N?3:"RESET"===N?4:dt(),p=e.targetChange.targetIds||[],v=function(N,K){return N.D?(It(void 0===K||"string"==typeof K),Mi.fromBase64String(K||"")):(It(void 0===K||K instanceof Uint8Array),Mi.fromUint8Array(K||new Uint8Array))}(o,e.targetChange.resumeToken),T=e.targetChange.cause,M=T&&function(N){const K=void 0===N.code?Ce.UNKNOWN:Bp(N.code);return new Ze(K,N.message||"")}(T);i=new Op(a,p,v,M||null)}else if("documentChange"in e){const a=e.documentChange,p=Bo(o,a.document.name),v=ur(a.document.updateTime),T=new ue({mapValue:{fields:a.document.fields}}),M=ee.newFoundDocument(p,v,T);i=new Wa(a.targetIds||[],a.removedTargetIds||[],M.key,M)}else if("documentDelete"in e){const a=e.documentDelete,p=Bo(o,a.document),v=a.readTime?ur(a.readTime):kt.min(),T=ee.newNoDocument(p,v);i=new Wa([],a.removedTargetIds||[],T.key,T)}else if("documentRemove"in e){const a=e.documentRemove,p=Bo(o,a.document);i=new Wa([],a.removedTargetIds||[],p,null)}else{if(!("filter"in e))return dt();{const a=e.filter,v=new Rp(a.count||0);i=new dd(a.targetId,v)}}var N;return i}(this.N,e),a=function(p){if(!("targetChange"in p))return kt.min();const v=p.targetChange;return v.targetIds&&v.targetIds.length?kt.min():v.readTime?ur(v.readTime):kt.min()}(e);return this.listener.Rr(i,a)}br(e){const i={};i.database=Bc(this.N),i.addTarget=function(p,v){let T;const M=v.target;return T=Ne(M)?{documents:_d(p,M)}:{query:qp(p,M)},T.targetId=v.targetId,v.resumeToken.approximateByteSize()>0?T.resumeToken=hh(p,v.resumeToken):v.snapshotVersion.compareTo(kt.min())>0&&(T.readTime=Rc(p,v.snapshotVersion.toTimestamp())),T}(this.N,e);const a=function(o,e){const i=function(a,p){switch(p){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return dt()}}(0,e.purpose);return null==i?null:{"goog-listen-tags":i}}(0,e);a&&(i.labels=a),this.mr(i)}Pr(e){const i={};i.database=Bc(this.N),i.removeTarget=e,this.mr(i)}}class gf extends Hc{constructor(e,i,a,p,v){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,v),this.N=p,this.vr=!1}get Vr(){return this.vr}start(){this.vr=!1,this.lastStreamToken=void 0,super.start()}pr(){this.vr&&this.Sr([])}Ar(e){return this.sr.ji("Write",e)}onMessage(e){if(It(!!e.streamToken),this.lastStreamToken=e.streamToken,this.vr){this.ar.reset();const i=function(o,e){return o&&o.length>0?(It(void 0!==e),o.map(i=>function(a,p){let v=ur(a.updateTime?a.updateTime:p);return v.isEqual(kt.min())&&(v=ur(p)),new Dp(v,a.transformResults||[])}(i,e))):[]}(e.writeResults,e.commitTime),a=ur(e.commitTime);return this.listener.Dr(a,i)}return It(!e.writeResults||0===e.writeResults.length),this.vr=!0,this.listener.Cr()}Nr(){const e={};e.database=Bc(this.N),this.mr(e)}Sr(e){const i={streamToken:this.lastStreamToken,writes:e.map(a=>xl(this.N,a))};this.mr(i)}}class $d extends class{}{constructor(e,i,a){super(),this.credentials=e,this.sr=i,this.N=a,this.kr=!1}$r(){if(this.kr)throw new Ze(Ce.FAILED_PRECONDITION,"The client has already been terminated.")}Li(e,i,a){return this.$r(),this.credentials.getToken().then(p=>this.sr.Li(e,i,a,p)).catch(p=>{throw"FirebaseError"===p.name?(p.code===Ce.UNAUTHENTICATED&&this.credentials.invalidateToken(),p):new Ze(Ce.UNKNOWN,p.toString())})}Ki(e,i,a){return this.$r(),this.credentials.getToken().then(p=>this.sr.Ki(e,i,a,p)).catch(p=>{throw"FirebaseError"===p.name?(p.code===Ce.UNAUTHENTICATED&&this.credentials.invalidateToken(),p):new Ze(Ce.UNKNOWN,p.toString())})}terminate(){this.kr=!0}}class Kc{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.Or=0,this.Fr=null,this.Mr=!0}Lr(){0===this.Or&&(this.Br("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.Ur("Backend didn't respond within 10 seconds."),this.Br("Offline"),Promise.resolve())))}qr(e){"Online"===this.state?this.Br("Unknown"):(this.Or++,this.Or>=1&&(this.Kr(),this.Ur(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Br("Offline")))}set(e){this.Kr(),this.Or=0,"Online"===e&&(this.Mr=!1),this.Br(e)}Br(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Ur(e){const i=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Mr?(li(i),this.Mr=!1):Je("OnlineStateTracker",i)}Kr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class yf{constructor(e,i,a,p,v){var T=this;this.localStore=e,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.jr=[],this.Qr=new Map,this.Wr=new Set,this.Gr=[],this.zr=v,this.zr.Ti(M=>{a.enqueueAndForget((0,ae.Z)(function*(){var N;ma(T)&&(Je("RemoteStore","Restarting streams for network reachability change."),yield(N=(0,ae.Z)(function*(K){const ne=tt(K);ne.Wr.add(4),yield Qa(ne),ne.Hr.set("Unknown"),ne.Wr.delete(4),yield Il(ne)}),function(K){return N.apply(this,arguments)})(T))}))}),this.Hr=new Kc(a,p)}}function Il(o){return kh.apply(this,arguments)}function kh(){return(kh=(0,ae.Z)(function*(o){if(ma(o))for(const e of o.Gr)yield e(!0)})).apply(this,arguments)}function Qa(o){return Xc.apply(this,arguments)}function Xc(){return(Xc=(0,ae.Z)(function*(o){for(const e of o.Gr)yield e(!1)})).apply(this,arguments)}function Mh(o,e){const i=tt(o);i.Qr.has(e.targetId)||(i.Qr.set(e.targetId,e),Al(i)?Wd(i):Jc(i).hr()&&Zd(i,e))}function Vu(o,e){const i=tt(o),a=Jc(i);i.Qr.delete(e),a.hr()&&_f(i,e),0===i.Qr.size&&(a.hr()?a.wr():ma(i)&&i.Hr.set("Unknown"))}function Zd(o,e){o.Jr.Y(e.targetId),Jc(o).br(e)}function _f(o,e){o.Jr.Y(e),Jc(o).Pr(e)}function Wd(o){o.Jr=new uh({getRemoteKeysForTarget:e=>o.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>o.Qr.get(e)||null}),Jc(o).start(),o.Hr.Lr()}function Al(o){return ma(o)&&!Jc(o).ur()&&o.Qr.size>0}function ma(o){return 0===tt(o).Wr.size}function vf(o){o.Jr=void 0}function xf(o){return Hd.apply(this,arguments)}function Hd(){return(Hd=(0,ae.Z)(function*(o){o.Qr.forEach((e,i)=>{Zd(o,e)})})).apply(this,arguments)}function Kd(o,e){return Xd.apply(this,arguments)}function Xd(){return(Xd=(0,ae.Z)(function*(o,e){vf(o),Al(o)?(o.Hr.qr(e),Wd(o)):o.Hr.set("Unknown")})).apply(this,arguments)}function Cl(o,e,i){return Ph.apply(this,arguments)}function Ph(){return(Ph=(0,ae.Z)(function*(o,e,i){if(o.Hr.set("Online"),e instanceof Op&&2===e.state&&e.cause)try{yield(a=(0,ae.Z)(function*(p,v){const T=v.cause;for(const M of v.targetIds)p.Qr.has(M)&&(yield p.remoteSyncer.rejectListen(M,T),p.Qr.delete(M),p.Jr.removeTarget(M))}),function(p,v){return a.apply(this,arguments)})(o,e)}catch(a){Je("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),a),yield qu(o,a)}else if(e instanceof Wa?o.Jr.rt(e):e instanceof dd?o.Jr.ft(e):o.Jr.at(e),!i.isEqual(kt.min()))try{const a=yield af(o.localStore);i.compareTo(a)>=0&&(yield function(p,v){const T=p.Jr._t(v);return T.targetChanges.forEach((M,N)=>{if(M.resumeToken.approximateByteSize()>0){const K=p.Qr.get(N);K&&p.Qr.set(N,K.withResumeToken(M.resumeToken,v))}}),T.targetMismatches.forEach(M=>{const N=p.Qr.get(M);if(!N)return;p.Qr.set(M,N.withResumeToken(Mi.EMPTY_BYTE_STRING,N.snapshotVersion)),_f(p,M);const K=new ua(N.target,M,1,N.sequenceNumber);Zd(p,K)}),p.remoteSyncer.applyRemoteEvent(T)}(o,i))}catch(a){Je("RemoteStore","Failed to raise snapshot:",a),yield qu(o,a)}var a})).apply(this,arguments)}function qu(o,e,i){return Yc.apply(this,arguments)}function Yc(){return(Yc=(0,ae.Z)(function*(o,e,i){if(!Xa(e))throw e;o.Wr.add(1),yield Qa(o),o.Hr.set("Offline"),i||(i=()=>af(o.localStore)),o.asyncQueue.enqueueRetryable((0,ae.Z)(function*(){Je("RemoteStore","Retrying IndexedDB access"),yield i(),o.Wr.delete(1),yield Il(o)}))})).apply(this,arguments)}function Dh(o,e){return e().catch(i=>qu(o,i,e))}function Qc(o){return Yd.apply(this,arguments)}function Yd(){return(Yd=(0,ae.Z)(function*(o){const e=tt(o),i=ga(e);let a=e.jr.length>0?e.jr[e.jr.length-1].batchId:-1;for(;Cm(e);)try{const p=yield Tm(e.localStore,a);if(null===p){0===e.jr.length&&i.wr();break}a=p.batchId,zh(e,p)}catch(p){yield qu(e,p)}Lh(e)&&wf(e)})).apply(this,arguments)}function Cm(o){return ma(o)&&o.jr.length<10}function zh(o,e){o.jr.push(e);const i=ga(o);i.hr()&&i.Vr&&i.Sr(e.mutations)}function Lh(o){return ma(o)&&!ga(o).ur()&&o.jr.length>0}function wf(o){ga(o).start()}function Qd(o){return Gu.apply(this,arguments)}function Gu(){return(Gu=(0,ae.Z)(function*(o){ga(o).Nr()})).apply(this,arguments)}function kl(o){return Jd.apply(this,arguments)}function Jd(){return(Jd=(0,ae.Z)(function*(o){const e=ga(o);for(const i of o.jr)e.Sr(i.mutations)})).apply(this,arguments)}function ep(o,e,i){return Rh.apply(this,arguments)}function Rh(){return(Rh=(0,ae.Z)(function*(o,e,i){const a=o.jr.shift(),p=ku.from(a,e,i);yield Dh(o,()=>o.remoteSyncer.applySuccessfulWrite(p)),yield Qc(o)})).apply(this,arguments)}function Fh(o,e){return tp.apply(this,arguments)}function tp(){return(tp=(0,ae.Z)(function*(o,e){var i;e&&ga(o).Vr&&(yield(i=(0,ae.Z)(function*(a,p){if(Fp(v=p.code)&&v!==Ce.ABORTED){const T=a.jr.shift();ga(a).dr(),yield Dh(a,()=>a.remoteSyncer.rejectFailedWrite(T.batchId,p)),yield Qc(a)}var v}),function(a,p){return i.apply(this,arguments)})(o,e)),Lh(o)&&wf(o)})).apply(this,arguments)}function np(o,e){return ip.apply(this,arguments)}function ip(){return(ip=(0,ae.Z)(function*(o,e){const i=tt(o);e?(i.Wr.delete(2),yield Il(i)):e||(i.Wr.add(2),yield Qa(i),i.Hr.set("Unknown"))})).apply(this,arguments)}function Jc(o){return o.Yr||(o.Yr=function(e,i,a){const p=tt(e);return p.$r(),new mf(i,p.sr,p.credentials,p.N,a)}(o.datastore,o.asyncQueue,{Si:xf.bind(null,o),Ci:Kd.bind(null,o),Rr:Cl.bind(null,o)}),o.Gr.push(function(){var e=(0,ae.Z)(function*(i){i?(o.Yr.dr(),Al(o)?Wd(o):o.Hr.set("Unknown")):(yield o.Yr.stop(),vf(o))});return function(i){return e.apply(this,arguments)}}())),o.Yr}function ga(o){return o.Xr||(o.Xr=function(e,i,a){const p=tt(e);return p.$r(),new gf(i,p.sr,p.credentials,p.N,a)}(o.datastore,o.asyncQueue,{Si:Qd.bind(null,o),Ci:Fh.bind(null,o),Cr:kl.bind(null,o),Dr:ep.bind(null,o)}),o.Gr.push(function(){var e=(0,ae.Z)(function*(i){i?(o.Xr.dr(),yield Qc(o)):(yield o.Xr.stop(),o.jr.length>0&&(Je("RemoteStore",`Stopping write stream with ${o.jr.length} pending writes`),o.jr=[]))});return function(i){return e.apply(this,arguments)}}())),o.Xr}class rp{constructor(e,i,a,p,v){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=a,this.op=p,this.removalCallback=v,this.deferred=new Qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(T=>{})}static createAndSchedule(e,i,a,p,v){const T=Date.now()+a,M=new rp(e,i,T,p,v);return M.start(a),M}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ze(Ce.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hc(o,e){if(li("AsyncQueue",`${e}: ${o}`),Xa(o))return new Ze(Ce.UNAVAILABLE,`${e}: ${o}`);throw o}class dc{constructor(e){this.comparator=e?(i,a)=>e(i,a)||_.comparator(i.key,a.key):(i,a)=>_.comparator(i.key,a.key),this.keyedMap=ch(),this.sortedSet=new en(this.comparator)}static emptySet(e){return new dc(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,a)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof dc)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;i.hasNext();){const p=i.getNext().key,v=a.getNext().key;if(!p.isEqual(v))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,i){const a=new dc;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=i,a}}class sp{constructor(){this.Zr=new en(_.comparator)}track(e){const i=e.doc.key,a=this.Zr.get(i);a?0!==e.type&&3===a.type?this.Zr=this.Zr.insert(i,e):3===e.type&&1!==a.type?this.Zr=this.Zr.insert(i,{type:a.type,doc:e.doc}):2===e.type&&2===a.type?this.Zr=this.Zr.insert(i,{type:2,doc:e.doc}):2===e.type&&0===a.type?this.Zr=this.Zr.insert(i,{type:0,doc:e.doc}):1===e.type&&0===a.type?this.Zr=this.Zr.remove(i):1===e.type&&2===a.type?this.Zr=this.Zr.insert(i,{type:1,doc:a.doc}):0===e.type&&1===a.type?this.Zr=this.Zr.insert(i,{type:2,doc:e.doc}):dt():this.Zr=this.Zr.insert(i,e)}eo(){const e=[];return this.Zr.inorderTraversal((i,a)=>{e.push(a)}),e}}class pc{constructor(e,i,a,p,v,T,M,N){this.query=e,this.docs=i,this.oldDocs=a,this.docChanges=p,this.mutatedKeys=v,this.fromCache=T,this.syncStateChanged=M,this.excludesMetadataChanges=N}static fromInitialDocuments(e,i,a,p){const v=[];return i.forEach(T=>{v.push({type:0,doc:T})}),new pc(e,i,dc.emptySet(i),v,a,p,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ro(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,a=e.docChanges;if(i.length!==a.length)return!1;for(let p=0;p<i.length;p++)if(i[p].type!==a[p].type||!i[p].doc.isEqual(a[p].doc))return!1;return!0}}class Bh{constructor(){this.no=void 0,this.listeners=[]}}class Oh{constructor(){this.queries=new ac(e=>Za(e),Ro),this.onlineState="Unknown",this.so=new Set}}function Ja(o,e){return Nh.apply(this,arguments)}function Nh(){return(Nh=(0,ae.Z)(function*(o,e){const i=tt(o),a=e.query;let p=!1,v=i.queries.get(a);if(v||(p=!0,v=new Bh),p)try{v.no=yield i.onListen(a)}catch(T){const M=hc(T,`Initialization of query '${Cc(e.query)}' failed`);return void e.onError(M)}i.queries.set(a,v),v.listeners.push(e),e.io(i.onlineState),v.no&&e.ro(v.no)&&Vh(i)})).apply(this,arguments)}function On(o,e){return Uh.apply(this,arguments)}function Uh(){return(Uh=(0,ae.Z)(function*(o,e){const i=tt(o),a=e.query;let p=!1;const v=i.queries.get(a);if(v){const T=v.listeners.indexOf(e);T>=0&&(v.listeners.splice(T,1),p=0===v.listeners.length)}if(p)return i.queries.delete(a),i.onUnlisten(a)})).apply(this,arguments)}function bf(o,e){const i=tt(o);let a=!1;for(const p of e){const T=i.queries.get(p.query);if(T){for(const M of T.listeners)M.ro(p)&&(a=!0);T.no=p}}a&&Vh(i)}function Tf(o,e,i){const a=tt(o),p=a.queries.get(e);if(p)for(const v of p.listeners)v.onError(i);a.queries.delete(e)}function Vh(o){o.so.forEach(e=>{e.next()})}class ju{constructor(e,i,a){this.query=e,this.oo=i,this.co=!1,this.ao=null,this.onlineState="Unknown",this.options=a||{}}ro(e){if(!this.options.includeMetadataChanges){const a=[];for(const p of e.docChanges)3!==p.type&&a.push(p);e=new pc(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let i=!1;return this.co?this.uo(e)&&(this.oo.next(e),i=!0):this.ho(e,this.onlineState)&&(this.lo(e),i=!0),this.ao=e,i}onError(e){this.oo.error(e)}io(e){this.onlineState=e;let i=!1;return this.ao&&!this.co&&this.ho(this.ao,e)&&(this.lo(this.ao),i=!0),i}ho(e,i){return!e.fromCache||!(this.options.fo&&"Offline"!==i||e.docs.isEmpty()&&"Offline"!==i)}uo(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ao&&this.ao.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}lo(e){e=pc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.oo.next(e)}}class qh{constructor(e,i){this.payload=e,this.byteLength=i}wo(){return"metadata"in this.payload}}class Gh{constructor(e){this.N=e}zn(e){return Bo(this.N,e)}Hn(e){return e.metadata.exists?Up(this.N,e.document,!1):ee.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}Jn(e){return ur(e)}}class eu{constructor(e,i,a){this._o=e,this.localStore=i,this.N=a,this.queries=[],this.documents=[],this.progress=jh(e)}mo(e){this.progress.bytesLoaded+=e.byteLength;let i=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++i):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++i),i!==this.progress.documentsLoaded?(this.progress.documentsLoaded=i,Object.assign({},this.progress)):null}yo(e){const i=new Map,a=new Gh(this.N);for(const p of e)if(p.metadata.queries){const v=a.zn(p.metadata.name);for(const T of p.metadata.queries){const M=(i.get(T)||mn()).add(v);i.set(T,M)}}return i}complete(){var e=this;return(0,ae.Z)(function*(){const i=yield function(o,e,i,a){return Fd.apply(this,arguments)}(e.localStore,new Gh(e.N),e.documents,e._o.id),a=e.yo(e.documents);for(const p of e.queries)yield Bd(e.localStore,p,a.get(p.name));return e.progress.taskState="Success",new Lu(Object.assign({},e.progress),i)})()}}function jh(o){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:o.totalDocuments,totalBytes:o.totalBytes}}class Ef{constructor(e){this.key=e}}class Sf{constructor(e){this.key=e}}class op{constructor(e,i){this.query=e,this.po=i,this.To=null,this.current=!1,this.Eo=mn(),this.mutatedKeys=mn(),this.Io=Xl(e),this.Ao=new dc(this.Io)}get Ro(){return this.po}bo(e,i){const a=i?i.Po:new sp,p=i?i.Ao:this.Ao;let v=i?i.mutatedKeys:this.mutatedKeys,T=p,M=!1;const N=Ln(this.query)&&p.size===this.query.limit?p.last():null,K=_i(this.query)&&p.size===this.query.limit?p.first():null;if(e.inorderTraversal((ne,me)=>{const ke=p.get(ne),Ve=Fo(this.query,me)?me:null,et=!!ke&&this.mutatedKeys.has(ke.key),ht=!!Ve&&(Ve.hasLocalMutations||this.mutatedKeys.has(Ve.key)&&Ve.hasCommittedMutations);let Bt=!1;ke&&Ve?ke.data.isEqual(Ve.data)?et!==ht&&(a.track({type:3,doc:Ve}),Bt=!0):this.vo(ke,Ve)||(a.track({type:2,doc:Ve}),Bt=!0,(N&&this.Io(Ve,N)>0||K&&this.Io(Ve,K)<0)&&(M=!0)):!ke&&Ve?(a.track({type:0,doc:Ve}),Bt=!0):ke&&!Ve&&(a.track({type:1,doc:ke}),Bt=!0,(N||K)&&(M=!0)),Bt&&(Ve?(T=T.add(Ve),v=ht?v.add(ne):v.delete(ne)):(T=T.delete(ne),v=v.delete(ne)))}),Ln(this.query)||_i(this.query))for(;T.size>this.query.limit;){const ne=Ln(this.query)?T.last():T.first();T=T.delete(ne.key),v=v.delete(ne.key),a.track({type:1,doc:ne})}return{Ao:T,Po:a,Ln:M,mutatedKeys:v}}vo(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,a){const p=this.Ao;this.Ao=e.Ao,this.mutatedKeys=e.mutatedKeys;const v=e.Po.eo();v.sort((K,ne)=>function(me,ke){const Ve=et=>{switch(et){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return dt()}};return Ve(me)-Ve(ke)}(K.type,ne.type)||this.Io(K.doc,ne.doc)),this.Vo(a);const T=i?this.So():[],M=0===this.Eo.size&&this.current?1:0,N=M!==this.To;return this.To=M,0!==v.length||N?{snapshot:new pc(this.query,e.Ao,p,v,e.mutatedKeys,0===M,N,!1),Do:T}:{Do:T}}io(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ao:this.Ao,Po:new sp,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{Do:[]}}Co(e){return!this.po.has(e)&&!!this.Ao.has(e)&&!this.Ao.get(e).hasLocalMutations}Vo(e){e&&(e.addedDocuments.forEach(i=>this.po=this.po.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.po=this.po.delete(i)),this.current=e.current)}So(){if(!this.current)return[];const e=this.Eo;this.Eo=mn(),this.Ao.forEach(a=>{this.Co(a.key)&&(this.Eo=this.Eo.add(a.key))});const i=[];return e.forEach(a=>{this.Eo.has(a)||i.push(new Sf(a))}),this.Eo.forEach(a=>{e.has(a)||i.push(new Ef(a))}),i}No(e){this.po=e.Gn,this.Eo=mn();const i=this.bo(e.documents);return this.applyChanges(i,!0)}xo(){return pc.fromInitialDocuments(this.query,this.Ao,this.mutatedKeys,0===this.To)}}class km{constructor(e,i,a){this.query=e,this.targetId=i,this.view=a}}class If{constructor(e){this.key=e,this.ko=!1}}class ap{constructor(e,i,a,p,v,T){this.localStore=e,this.remoteStore=i,this.eventManager=a,this.sharedClientState=p,this.currentUser=v,this.maxConcurrentLimboResolutions=T,this.$o={},this.Oo=new ac(M=>Za(M),Ro),this.Fo=new Map,this.Mo=new Set,this.Lo=new en(_.comparator),this.Bo=new Map,this.Uo=new Yr,this.qo={},this.Ko=new Map,this.jo=sc.ie(),this.onlineState="Unknown",this.Qo=void 0}get isPrimaryClient(){return!0===this.Qo}}function Af(o,e){return br.apply(this,arguments)}function br(){return(br=(0,ae.Z)(function*(o,e){const i=E(o);let a,p;const v=i.Oo.get(e);if(v)a=v.targetId,i.sharedClientState.addLocalQueryTarget(a),p=v.view.xo();else{const T=yield Gc(i.localStore,vi(e)),M=i.sharedClientState.addLocalQueryTarget(T.targetId);a=T.targetId,p=yield fc(i,e,a,"current"===M),i.isPrimaryClient&&Mh(i.remoteStore,T)}return p})).apply(this,arguments)}function fc(o,e,i,a){return $h.apply(this,arguments)}function $h(){return($h=(0,ae.Z)(function*(o,e,i,a){o.Wo=(ne,me,ke)=>{return(Ve=(0,ae.Z)(function*(et,ht,Bt,Hn){let Vs=ht.view.bo(Bt);Vs.Ln&&(Vs=yield Eh(et.localStore,ht.query,!1).then(({documents:Tr})=>ht.view.bo(Tr,Vs)));const uo=Hn&&Hn.targetChanges.get(ht.targetId),Un=ht.view.applyChanges(Vs,et.isPrimaryClient,uo);return Zu(et,ht.targetId,Un.Do),Un.snapshot}),function(et,ht,Bt,Hn){return Ve.apply(this,arguments)})(o,ne,me,ke);var Ve};const p=yield Eh(o.localStore,e,!0),v=new op(e,p.Gn),T=v.bo(p.documents),M=zc.createSynthesizedTargetChangeForCurrentChange(i,a&&"Offline"!==o.onlineState),N=v.applyChanges(T,o.isPrimaryClient,M);Zu(o,i,N.Do);const K=new km(e,i,v);return o.Oo.set(e,K),o.Fo.has(i)?o.Fo.get(i).push(e):o.Fo.set(i,[e]),N.snapshot})).apply(this,arguments)}function Cf(o,e){return lp.apply(this,arguments)}function lp(){return(lp=(0,ae.Z)(function*(o,e){const i=tt(o),a=i.Oo.get(e),p=i.Fo.get(a.targetId);if(p.length>1)return i.Fo.set(a.targetId,p.filter(v=>!Ro(v,e))),void i.Oo.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(a.targetId),i.sharedClientState.isActiveQueryTarget(a.targetId)||(yield jc(i.localStore,a.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(a.targetId),Vu(i.remoteStore,a.targetId),Dl(i,a.targetId)}).catch(oc))):(Dl(i,a.targetId),yield jc(i.localStore,a.targetId,!0))})).apply(this,arguments)}function cp(){return(cp=(0,ae.Z)(function*(o,e,i){const a=I(o);try{const p=yield function(v,T){const M=tt(v),N=ki.now(),K=T.reduce((me,ke)=>me.add(ke.key),mn());let ne;return M.persistence.runTransaction("Locally write mutations","readwrite",me=>M.Qn.Pn(me,K).next(ke=>{ne=ke;const Ve=[];for(const et of T){const ht=Mc(et,ne.get(et.key));null!=ht&&Ve.push(new Or(et.key,ht,te(ht.value.mapValue),Di.exists(!0)))}return M.In.addMutationBatch(me,N,Ve,T)})).then(me=>(me.applyToLocalDocumentSet(ne),{batchId:me.batchId,changes:ne}))}(a.localStore,e);a.sharedClientState.addPendingMutation(p.batchId),function(v,T,M){let N=v.qo[v.currentUser.toKey()];N||(N=new en(Ht)),N=N.insert(T,M),v.qo[v.currentUser.toKey()]=N}(a,p.batchId,i),yield Qr(a,p.changes),yield Qc(a.remoteStore)}catch(p){const v=hc(p,"Failed to persist write");i.reject(v)}})).apply(this,arguments)}function up(o,e){return Zh.apply(this,arguments)}function Zh(){return(Zh=(0,ae.Z)(function*(o,e){const i=tt(o);try{const a=yield bm(i.localStore,e);e.targetChanges.forEach((p,v)=>{const T=i.Bo.get(v);T&&(It(p.addedDocuments.size+p.modifiedDocuments.size+p.removedDocuments.size<=1),p.addedDocuments.size>0?T.ko=!0:p.modifiedDocuments.size>0?It(T.ko):p.removedDocuments.size>0&&(It(T.ko),T.ko=!1))}),yield Qr(i,a,e)}catch(a){yield oc(a)}})).apply(this,arguments)}function hp(o,e,i){const a=tt(o);if(a.isPrimaryClient&&0===i||!a.isPrimaryClient&&1===i){const p=[];a.Oo.forEach((v,T)=>{const M=T.view.io(e);M.snapshot&&p.push(M.snapshot)}),function(v,T){const M=tt(v);M.onlineState=T;let N=!1;M.queries.forEach((K,ne)=>{for(const me of ne.listeners)me.io(T)&&(N=!0)}),N&&Vh(M)}(a.eventManager,e),p.length&&a.$o.Rr(p),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}function Mf(o,e,i){return Wh.apply(this,arguments)}function Wh(){return(Wh=(0,ae.Z)(function*(o,e,i){const a=tt(o);a.sharedClientState.updateQueryState(e,"rejected",i);const p=a.Bo.get(e),v=p&&p.key;if(v){let T=new en(_.comparator);T=T.insert(v,ee.newNoDocument(v,kt.min()));const M=mn().add(v),N=new Dc(kt.min(),new Map,new hi(Ht),T,M);yield up(a,N),a.Lo=a.Lo.remove(v),a.Bo.delete(e),Bs(a)}else yield jc(a.localStore,e,!1).then(()=>Dl(a,e,i)).catch(oc)})).apply(this,arguments)}function Pf(o,e){return Hh.apply(this,arguments)}function Hh(){return(Hh=(0,ae.Z)(function*(o,e){const i=tt(o),a=e.batch.batchId;try{const p=yield wm(i.localStore,e);$u(i,a,null),Pl(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),yield Qr(i,p)}catch(p){yield oc(p)}})).apply(this,arguments)}function Ml(o,e,i){return Kh.apply(this,arguments)}function Kh(){return(Kh=(0,ae.Z)(function*(o,e,i){const a=tt(o);try{const p=yield function(v,T){const M=tt(v);return M.persistence.runTransaction("Reject batch","readwrite-primary",N=>{let K;return M.In.lookupMutationBatch(N,T).next(ne=>(It(null!==ne),K=ne.keys(),M.In.removeMutationBatch(N,ne))).next(()=>M.In.performConsistencyCheck(N)).next(()=>M.Qn.Pn(N,K))})}(a.localStore,e);$u(a,e,i),Pl(a,e),a.sharedClientState.updateMutationState(e,"rejected",i),yield Qr(a,p)}catch(p){yield oc(p)}})).apply(this,arguments)}function dp(){return(dp=(0,ae.Z)(function*(o,e){const i=tt(o);ma(i.remoteStore)||Je("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const a=yield function(v){const T=tt(v);return T.persistence.runTransaction("Get highest unacknowledged batch id","readonly",M=>T.In.getHighestUnacknowledgedBatchId(M))}(i.localStore);if(-1===a)return void e.resolve();const p=i.Ko.get(a)||[];p.push(e),i.Ko.set(a,p)}catch(a){const p=hc(a,"Initialization of waitForPendingWrites() operation failed");e.reject(p)}})).apply(this,arguments)}function Pl(o,e){(o.Ko.get(e)||[]).forEach(i=>{i.resolve()}),o.Ko.delete(e)}function $u(o,e,i){const a=tt(o);let p=a.qo[a.currentUser.toKey()];if(p){const v=p.get(e);v&&(i?v.reject(i):v.resolve(),p=p.remove(e)),a.qo[a.currentUser.toKey()]=p}}function Dl(o,e,i=null){o.sharedClientState.removeLocalQueryTarget(e);for(const a of o.Fo.get(e))o.Oo.delete(a),i&&o.$o.Go(a,i);o.Fo.delete(e),o.isPrimaryClient&&o.Uo.cs(e).forEach(a=>{o.Uo.containsKey(a)||Vo(o,a)})}function Vo(o,e){o.Mo.delete(e.path.canonicalString());const i=o.Lo.get(e);null!==i&&(Vu(o.remoteStore,i),o.Lo=o.Lo.remove(e),o.Bo.delete(i),Bs(o))}function Zu(o,e,i){for(const a of i)a instanceof Ef?(o.Uo.addReference(a.key,e),pp(o,a)):a instanceof Sf?(Je("SyncEngine","Document no longer in limbo: "+a.key),o.Uo.removeReference(a.key,e),o.Uo.containsKey(a.key)||Vo(o,a.key)):dt()}function pp(o,e){const i=e.key,a=i.path.canonicalString();o.Lo.get(i)||o.Mo.has(a)||(Je("SyncEngine","New document in limbo: "+i),o.Mo.add(a),Bs(o))}function Bs(o){for(;o.Mo.size>0&&o.Lo.size<o.maxConcurrentLimboResolutions;){const e=o.Mo.values().next().value;o.Mo.delete(e);const i=new _(an.fromString(e)),a=o.jo.next();o.Bo.set(a,new If(i)),o.Lo=o.Lo.insert(i,a),Mh(o.remoteStore,new ua(vi(Vt(i.path)),a,2,lr.T))}}function Qr(o,e,i){return Yh.apply(this,arguments)}function Yh(){return(Yh=(0,ae.Z)(function*(o,e,i){const a=tt(o),p=[],v=[],T=[];var M;a.Oo.isEmpty()||(a.Oo.forEach((M,N)=>{T.push(a.Wo(N,e,i).then(K=>{if(K){a.isPrimaryClient&&a.sharedClientState.updateQueryState(N.targetId,K.fromCache?"not-current":"current"),p.push(K);const ne=Ru.kn(N.targetId,K);v.push(ne)}}))}),yield Promise.all(T),a.$o.Rr(p),yield(M=(0,ae.Z)(function*(N,K){const ne=tt(N);try{yield ne.persistence.runTransaction("notifyLocalViewChanges","readwrite",me=>$e.forEach(K,ke=>$e.forEach(ke.Nn,Ve=>ne.persistence.referenceDelegate.addReference(me,ke.targetId,Ve)).next(()=>$e.forEach(ke.xn,Ve=>ne.persistence.referenceDelegate.removeReference(me,ke.targetId,Ve)))))}catch(me){if(!Xa(me))throw me;Je("LocalStore","Failed to update sequence numbers: "+me)}for(const me of K){const ke=me.targetId;if(!me.fromCache){const Ve=ne.Un.get(ke),ht=Ve.withLastLimboFreeSnapshotVersion(Ve.snapshotVersion);ne.Un=ne.Un.insert(ke,ht)}}}),function(N,K){return M.apply(this,arguments)})(a.localStore,v))})).apply(this,arguments)}function Df(o,e){return tu.apply(this,arguments)}function tu(){return(tu=(0,ae.Z)(function*(o,e){const i=tt(o);if(!i.currentUser.isEqual(e)){Je("SyncEngine","User change. New user:",e.toKey());const a=yield cc(i.localStore,e);i.currentUser=e,(p=i).Ko.forEach(T=>{T.forEach(M=>{M.reject(new Ze(Ce.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),p.Ko.clear(),i.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),yield Qr(i,a.Wn)}var p})).apply(this,arguments)}function zf(o,e){const i=tt(o),a=i.Bo.get(e);if(a&&a.ko)return mn().add(a.key);{let p=mn();const v=i.Fo.get(e);if(!v)return p;for(const T of v){const M=i.Oo.get(T);p=p.unionWith(M.view.Ro)}return p}}function Lf(o,e){return fp.apply(this,arguments)}function fp(){return(fp=(0,ae.Z)(function*(o,e){const i=tt(o),a=yield Eh(i.localStore,e.query,!0),p=e.view.No(a);return i.isPrimaryClient&&Zu(i,e.targetId,p.Do),p})).apply(this,arguments)}function Rf(o){return mp.apply(this,arguments)}function mp(){return(mp=(0,ae.Z)(function*(o){const e=tt(o);return uc(e.localStore).then(i=>Qr(e,i))})).apply(this,arguments)}function gp(o,e,i,a){return Qh.apply(this,arguments)}function Qh(){return(Qh=(0,ae.Z)(function*(o,e,i,a){const p=tt(o),v=yield function(T,M){const N=tt(T),K=tt(N.In);return N.persistence.runTransaction("Lookup mutation documents","readonly",ne=>K.Xt(ne,M).next(me=>me?N.Qn.Pn(ne,me):$e.resolve(null)))}(p.localStore,e);var M;null!==v?("pending"===i?yield Qc(p.remoteStore):"acknowledged"===i||"rejected"===i?($u(p,e,a||null),Pl(p,e),M=e,tt(tt(p.localStore).In).te(M)):dt(),yield Qr(p,v)):Je("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function r(){return(r=(0,ae.Z)(function*(o,e){const i=tt(o);if(E(i),I(i),!0===e&&!0!==i.Qo){const a=i.sharedClientState.getAllActiveQueryTargets(),p=yield t(i,a.toArray());i.Qo=!0,yield np(i.remoteStore,!0);for(const v of p)Mh(i.remoteStore,v)}else if(!1===e&&!1!==i.Qo){const a=[];let p=Promise.resolve();i.Fo.forEach((v,T)=>{i.sharedClientState.isLocalQueryTarget(T)?a.push(T):p=p.then(()=>(Dl(i,T),jc(i.localStore,T,!0))),Vu(i.remoteStore,T)}),yield p,yield t(i,a),function(v){const T=tt(v);T.Bo.forEach((M,N)=>{Vu(T.remoteStore,N)}),T.Uo.us(),T.Bo=new Map,T.Lo=new en(_.comparator)}(i),i.Qo=!1,yield np(i.remoteStore,!1)}})).apply(this,arguments)}function t(o,e,i){return s.apply(this,arguments)}function s(){return(s=(0,ae.Z)(function*(o,e,i){const a=tt(o),p=[],v=[];for(const T of e){let M;const N=a.Fo.get(T);if(N&&0!==N.length){M=yield Gc(a.localStore,vi(N[0]));for(const K of N){const ne=a.Oo.get(K),me=yield Lf(a,ne);me.snapshot&&v.push(me.snapshot)}}else{const K=yield Fu(a.localStore,T);M=yield Gc(a.localStore,K),yield fc(a,l(K),T,!1)}p.push(M)}return a.$o.Rr(v),p})).apply(this,arguments)}function l(o){return An(o.path,o.collectionGroup,o.orderBy,o.filters,o.limit,"F",o.startAt,o.endAt)}function u(o){const e=tt(o);return tt(tt(e.localStore).persistence).pn()}function m(o,e,i,a){return g.apply(this,arguments)}function g(){return(g=(0,ae.Z)(function*(o,e,i,a){const p=tt(o);if(p.Qo)Je("SyncEngine","Ignoring unexpected query state notification.");else if(p.Fo.has(e))switch(i){case"current":case"not-current":{const v=yield uc(p.localStore),T=Dc.createSynthesizedRemoteEventForCurrentChange(e,"current"===i);yield Qr(p,v,T);break}case"rejected":yield jc(p.localStore,e,!0),Dl(p,e,a);break;default:dt()}})).apply(this,arguments)}function x(o,e,i){return w.apply(this,arguments)}function w(){return(w=(0,ae.Z)(function*(o,e,i){const a=E(o);if(a.Qo){for(const p of e){if(a.Fo.has(p)){Je("SyncEngine","Adding an already active target "+p);continue}const v=yield Fu(a.localStore,p),T=yield Gc(a.localStore,v);yield fc(a,l(v),T.targetId,!1),Mh(a.remoteStore,T)}for(const p of i)a.Fo.has(p)&&(yield jc(a.localStore,p,!1).then(()=>{Vu(a.remoteStore,p),Dl(a,p)}).catch(oc))}})).apply(this,arguments)}function E(o){const e=tt(o);return e.remoteStore.remoteSyncer.applyRemoteEvent=up.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Mf.bind(null,e),e.$o.Rr=bf.bind(null,e.eventManager),e.$o.Go=Tf.bind(null,e.eventManager),e}function I(o){const e=tt(o);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Pf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ml.bind(null,e),e}class R{constructor(){this.synchronizeTabs=!1}initialize(e){var i=this;return(0,ae.Z)(function*(){i.N=Uu(e.databaseInfo.databaseId),i.sharedClientState=i.Ho(e),i.persistence=i.Jo(e),yield i.persistence.start(),i.gcScheduler=i.Yo(e),i.localStore=i.Xo(e)})()}Yo(e){return null}Xo(e){return pa(this.persistence,new zd,e.initialUser,this.N)}Jo(e){return new hf(Nd.Ns,this.N)}Ho(e){return new qd}terminate(){var e=this;return(0,ae.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class B extends R{constructor(e,i,a){super(),this.Zo=e,this.cacheSizeBytes=i,this.forceOwnership=a,this.synchronizeTabs=!1}initialize(e){var i=()=>super.initialize,a=this;return(0,ae.Z)(function*(){yield i().call(a,e),yield function(o){return Rd.apply(this,arguments)}(a.localStore),yield a.Zo.initialize(a,e),yield I(a.Zo.syncEngine),yield Qc(a.Zo.remoteStore),yield a.persistence.nn(()=>(a.gcScheduler&&!a.gcScheduler.started&&a.gcScheduler.start(a.localStore),Promise.resolve()))})()}Xo(e){return pa(this.persistence,new zd,e.initialUser,this.N)}Yo(e){return new ym(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}Jo(e){const i=bh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),a=void 0!==this.cacheSizeBytes?fs.withCacheSize(this.cacheSizeBytes):fs.DEFAULT;return new Dd(this.synchronizeTabs,i,e.clientId,a,e.asyncQueue,jd(),Nu(),this.N,this.sharedClientState,!!this.forceOwnership)}Ho(e){return new qd}}class j extends B{constructor(e,i){super(e,i,!1),this.Zo=e,this.cacheSizeBytes=i,this.synchronizeTabs=!0}initialize(e){var i=()=>super.initialize,a=this;return(0,ae.Z)(function*(){yield i().call(a,e);const p=a.Zo.syncEngine;a.sharedClientState instanceof Ch&&(a.sharedClientState.syncEngine={_i:gp.bind(null,p),mi:m.bind(null,p),gi:x.bind(null,p),pn:u.bind(null,p),wi:Rf.bind(null,p)},yield a.sharedClientState.start()),yield a.persistence.nn(function(){var v=(0,ae.Z)(function*(T){yield function(o,e){return r.apply(this,arguments)}(a.Zo.syncEngine,T),a.gcScheduler&&(T&&!a.gcScheduler.started?a.gcScheduler.start(a.localStore):T||a.gcScheduler.stop())});return function(T){return v.apply(this,arguments)}}())})()}Ho(e){const i=jd();if(!Ch.bt(i))throw new Ze(Ce.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const a=bh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ch(i,e.asyncQueue,a,e.clientId,e.initialUser)}}class X{initialize(e,i){var a=this;return(0,ae.Z)(function*(){a.localStore||(a.localStore=e.localStore,a.sharedClientState=e.sharedClientState,a.datastore=a.createDatastore(i),a.remoteStore=a.createRemoteStore(i),a.eventManager=a.createEventManager(i),a.syncEngine=a.createSyncEngine(i,!e.synchronizeTabs),a.sharedClientState.onlineStateHandler=p=>hp(a.syncEngine,p,1),a.remoteStore.remoteSyncer.handleCredentialChange=Df.bind(null,a.syncEngine),yield np(a.remoteStore,a.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Oh}createDatastore(e){const i=Uu(e.databaseInfo.databaseId),a=new ff(e.databaseInfo);return new $d(e.credentials,a,i)}createRemoteStore(e){return i=this.localStore,a=this.datastore,p=e.asyncQueue,v=M=>hp(this.syncEngine,M,0),T=Gd.bt()?new Gd:new pf,new yf(i,a,p,v,T);var i,a,p,v,T}createSyncEngine(e,i){return function(a,p,v,T,M,N,K){const ne=new ap(a,p,v,T,M,N);return K&&(ne.Qo=!0),ne}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}terminate(){return(e=(0,ae.Z)(function*(i){const a=tt(i);Je("RemoteStore","RemoteStore shutting down."),a.Wr.add(5),yield Qa(a),a.zr.shutdown(),a.Hr.set("Unknown")}),function(i){return e.apply(this,arguments)})(this.remoteStore);var e}}function ie(o,e=10240){let i=0;return{read:()=>(0,ae.Z)(function*(){if(i<o.byteLength){const a={value:o.slice(i,i+e),done:!1};return i+=e,a}return{done:!0}})(),cancel:()=>(0,ae.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class he{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.tc(this.observer.next,e)}error(e){this.observer.error?this.tc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}ec(){this.muted=!0}tc(e,i){this.muted||setTimeout(()=>{this.muted||e(i)},0)}}class ye{constructor(e,i){this.nc=e,this.N=i,this.metadata=new Qn,this.buffer=new Uint8Array,this.sc=new TextDecoder("utf-8"),this.ic().then(a=>{a&&a.wo()?this.metadata.resolve(a.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==a?void 0:a.payload)}`))},a=>this.metadata.reject(a))}close(){return this.nc.cancel()}getMetadata(){var e=this;return(0,ae.Z)(function*(){return e.metadata.promise})()}zo(){var e=this;return(0,ae.Z)(function*(){return yield e.getMetadata(),e.ic()})()}ic(){var e=this;return(0,ae.Z)(function*(){const i=yield e.rc();if(null===i)return null;const a=e.sc.decode(i),p=Number(a);isNaN(p)&&e.oc(`length string (${a}) is not valid number`);const v=yield e.cc(p);return new qh(JSON.parse(v),i.length+p)})()}ac(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}rc(){var e=this;return(0,ae.Z)(function*(){for(;e.ac()<0&&!(yield e.uc()););if(0===e.buffer.length)return null;const i=e.ac();i<0&&e.oc("Reached the end of bundle when a length string is expected.");const a=e.buffer.slice(0,i);return e.buffer=e.buffer.slice(i),a})()}cc(e){var i=this;return(0,ae.Z)(function*(){for(;i.buffer.length<e;)(yield i.uc())&&i.oc("Reached the end of bundle when more is expected.");const a=i.sc.decode(i.buffer.slice(0,e));return i.buffer=i.buffer.slice(e),a})()}oc(e){throw this.nc.cancel(),new Error(`Invalid bundle format: ${e}`)}uc(){var e=this;return(0,ae.Z)(function*(){const i=yield e.nc.read();if(!i.done){const a=new Uint8Array(e.buffer.length+i.value.length);a.set(e.buffer),a.set(i.value,e.buffer.length),e.buffer=a}return i.done})()}}class _e{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var i=this;return(0,ae.Z)(function*(){if(i.ensureCommitNotCalled(),i.mutations.length>0)throw new Ze(Ce.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const a=yield(p=(0,ae.Z)(function*(v,T){const M=tt(v),N=Bc(M.N)+"/documents",K={documents:T.map(Ve=>la(M.N,Ve))},ne=yield M.Ki("BatchGetDocuments",N,K),me=new Map;ne.forEach(Ve=>{const et=function(o,e){return"found"in e?function(i,a){It(!!a.found);const p=Bo(i,a.found.name),v=ur(a.found.updateTime),T=new ue({mapValue:{fields:a.found.fields}});return ee.newFoundDocument(p,v,T)}(o,e):"missing"in e?function(i,a){It(!!a.missing),It(!!a.readTime);const p=Bo(i,a.missing),v=ur(a.readTime);return ee.newNoDocument(p,v)}(o,e):dt()}(M.N,Ve);me.set(et.key.toString(),et)});const ke=[];return T.forEach(Ve=>{const et=me.get(Ve.toString());It(!!et),ke.push(et)}),ke}),function(v,T){return p.apply(this,arguments)})(i.datastore,e);var p;return a.forEach(p=>i.recordVersion(p)),a})()}set(e,i){this.write(i.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,i){try{this.write(i.toMutation(e,this.preconditionForUpdate(e)))}catch(a){this.lastWriteError=a}this.writtenDocs.add(e.toString())}delete(e){this.write(new Tu(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,ae.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const i=e.readVersions;var a;e.mutations.forEach(a=>{i.delete(a.key.toString())}),i.forEach((a,p)=>{const v=_.fromPath(p);e.mutations.push(new cd(v,e.precondition(v)))}),yield(a=(0,ae.Z)(function*(p,v){const T=tt(p),M=Bc(T.N)+"/documents",N={writes:v.map(K=>xl(T.N,K))};yield T.Li("Commit",M,N)}),function(p,v){return a.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let i;if(e.isFoundDocument())i=e.version;else{if(!e.isNoDocument())throw dt();i=kt.min()}const a=this.readVersions.get(e.key.toString());if(a){if(!i.isEqual(a))throw new Ze(Ce.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),i)}precondition(e){const i=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&i?Di.updateTime(i):Di.none()}preconditionForUpdate(e){const i=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&i){if(i.isEqual(kt.min()))throw new Ze(Ce.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Di.updateTime(i)}return Di.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ve{constructor(e,i,a,p){this.asyncQueue=e,this.datastore=i,this.updateFunction=a,this.deferred=p,this.hc=5,this.ar=new Sl(this.asyncQueue,"transaction_retry")}run(){this.hc-=1,this.lc()}lc(){var e=this;this.ar.Xi((0,ae.Z)(function*(){const i=new _e(e.datastore),a=e.fc(i);a&&a.then(p=>{e.asyncQueue.enqueueAndForget(()=>i.commit().then(()=>{e.deferred.resolve(p)}).catch(v=>{e.dc(v)}))}).catch(p=>{e.dc(p)})}))}fc(e){try{const i=this.updateFunction(e);return!c(i)&&i.catch&&i.then?i:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(i){return this.deferred.reject(i),null}}dc(e){this.hc>0&&this.wc(e)?(this.hc-=1,this.asyncQueue.enqueueAndForget(()=>(this.lc(),Promise.resolve()))):this.deferred.reject(e)}wc(e){if("FirebaseError"===e.name){const i=e.code;return"aborted"===i||"failed-precondition"===i||!Fp(i)}return!1}}class we{constructor(e,i,a){var p=this;this.credentials=e,this.asyncQueue=i,this.databaseInfo=a,this.user=Mn.UNAUTHENTICATED,this.clientId=Kl.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(i,function(){var v=(0,ae.Z)(function*(T){Je("FirestoreClient","Received user=",T.uid),yield p.credentialListener(T),p.user=T});return function(T){return v.apply(this,arguments)}}())}getConfiguration(){var e=this;return(0,ae.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,credentials:e.credentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ze(Ce.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const i=new Qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,ae.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.credentials.shutdown(),i.resolve()}catch(a){const p=hc(a,"Failed to shutdown persistence");i.reject(p)}})),i.promise}}function xe(o,e){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,ae.Z)(function*(o,e){o.asyncQueue.verifyOperationInProgress(),Je("FirestoreClient","Initializing OfflineComponentProvider");const i=yield o.getConfiguration();yield e.initialize(i);let a=i.initialUser;o.setCredentialChangeListener(function(){var p=(0,ae.Z)(function*(v){a.isEqual(v)||(yield cc(e.localStore,v),a=v)});return function(v){return p.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>o.terminate()),o.offlineComponents=e})).apply(this,arguments)}function qe(o,e){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,ae.Z)(function*(o,e){o.asyncQueue.verifyOperationInProgress();const i=yield He(o);Je("FirestoreClient","Initializing OnlineComponentProvider");const a=yield o.getConfiguration();yield e.initialize(i,a),o.setCredentialChangeListener(p=>{return(v=(0,ae.Z)(function*(T,M){const N=tt(T);N.asyncQueue.verifyOperationInProgress(),Je("RemoteStore","RemoteStore received new credentials");const K=ma(N);N.Wr.add(3),yield Qa(N),K&&N.Hr.set("Unknown"),yield N.remoteSyncer.handleCredentialChange(M),N.Wr.delete(3),yield Il(N)}),function(T,M){return v.apply(this,arguments)})(e.remoteStore,p);var v}),o.onlineComponents=e})).apply(this,arguments)}function He(o){return ze.apply(this,arguments)}function ze(){return(ze=(0,ae.Z)(function*(o){return o.offlineComponents||(Je("FirestoreClient","Using default OfflineComponentProvider"),yield xe(o,new R)),o.offlineComponents})).apply(this,arguments)}function Re(o){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,ae.Z)(function*(o){return o.onlineComponents||(Je("FirestoreClient","Using default OnlineComponentProvider"),yield qe(o,new X)),o.onlineComponents})).apply(this,arguments)}function Pe(o){return He(o).then(e=>e.persistence)}function _t(o){return He(o).then(e=>e.localStore)}function Lt(o){return Re(o).then(e=>e.remoteStore)}function Rt(o){return Re(o).then(e=>e.syncEngine)}function bt(o){return st.apply(this,arguments)}function st(){return(st=(0,ae.Z)(function*(o){const e=yield Re(o),i=e.eventManager;return i.onListen=Af.bind(null,e.syncEngine),i.onUnlisten=Cf.bind(null,e.syncEngine),i})).apply(this,arguments)}function di(o,e,i={}){const a=new Qn;return o.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return function(p,v,T,M,N){const K=new he({next:me=>{v.enqueueAndForget(()=>On(p,ne));const ke=me.docs.has(T);!ke&&me.fromCache?N.reject(new Ze(Ce.UNAVAILABLE,"Failed to get document because the client is offline.")):ke&&me.fromCache&&M&&"server"===M.source?N.reject(new Ze(Ce.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):N.resolve(me)},error:me=>N.reject(me)}),ne=new ju(Vt(T.path),K,{includeMetadataChanges:!0,fo:!0});return Ja(p,ne)}(yield bt(o),o.asyncQueue,e,i,a)})),a.promise}function Gi(o,e,i={}){const a=new Qn;return o.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return function(p,v,T,M,N){const K=new he({next:me=>{v.enqueueAndForget(()=>On(p,ne)),me.fromCache&&"server"===M.source?N.reject(new Ze(Ce.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):N.resolve(me)},error:me=>N.reject(me)}),ne=new ju(T,K,{includeMetadataChanges:!0,fo:!0});return Ja(p,ne)}(yield bt(o),o.asyncQueue,e,i,a)})),a.promise}class Zn{constructor(e,i,a,p,v,T,M,N){this.databaseId=e,this.appId=i,this.persistenceKey=a,this.host=p,this.ssl=v,this.forceLongPolling=T,this.autoDetectLongPolling=M,this.useFetchStreams=N}}class Nn{constructor(e,i){this.projectId=e,this.database=i||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Nn&&e.projectId===this.projectId&&e.database===this.database}}const ji=new Map;function tn(o,e,i){if(!i)throw new Ze(Ce.INVALID_ARGUMENT,`Function ${o}() cannot be called with an empty ${e}.`)}function fi(o,e,i,a){if(!0===e&&!0===a)throw new Ze(Ce.INVALID_ARGUMENT,`${o} and ${i} cannot be used together.`)}function Rn(o){if(!_.isDocumentKey(o))throw new Ze(Ce.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${o} has ${o.length}.`)}function ti(o){if(_.isDocumentKey(o))throw new Ze(Ce.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${o} has ${o.length}.`)}function $i(o){if(void 0===o)return"undefined";if(null===o)return"null";if("string"==typeof o)return o.length>20&&(o=`${o.substring(0,20)}...`),JSON.stringify(o);if("number"==typeof o||"boolean"==typeof o)return""+o;if("object"==typeof o){if(o instanceof Array)return"an array";{const e=(i=o).constructor?i.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var i;return"function"==typeof o?"a function":dt()}function gt(o,e){if("_delegate"in o&&(o=o._delegate),!(o instanceof e)){if(e.name===o.constructor.name)throw new Ze(Ce.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=$i(o);throw new Ze(Ce.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return o}function ms(o,e){if(e<=0)throw new Ze(Ce.INVALID_ARGUMENT,`Function ${o}() requires a positive number, but it was: ${e}.`)}class Zi{constructor(e){var i;if(void 0===e.host){if(void 0!==e.ssl)throw new Ze(Ce.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(i=e.ssl)||void 0===i||i;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ze(Ce.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,fi("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class jt{constructor(e,i){this._credentials=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Zi({}),this._settingsFrozen=!1,e instanceof Nn?this._databaseId=e:(this._app=e,this._databaseId=function(a){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new Ze(Ce.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Nn(a.options.projectId)}(e))}get app(){if(!this._app)throw new Ze(Ce.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ze(Ce.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Zi(e),void 0!==e.credentials&&(this._credentials=function(i){if(!i)return new du;switch(i.type){case"gapi":const a=i.client;return It(!("object"!=typeof a||null===a||!a.auth||!a.auth.getAuthHeaderValueForFirstParty)),new mu(a,i.sessionIndex||"0",i.iamToken||null);case"provider":return i.client;default:throw new Ze(Ce.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const i=ji.get(e);i&&(Je("ComponentProvider","Removing Datastore"),ji.delete(e),i.terminate())}(this),Promise.resolve()}}class Xt{constructor(e,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Xt(this.firestore,e,this._key)}}class Cn{constructor(e,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Cn(this.firestore,e,this._query)}}class nr extends Cn{constructor(e,i,a){super(e,i,Vt(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Xt(this.firestore,null,new _(e))}withConverter(e){return new nr(this.firestore,e,this._path)}}function co(o,e,...i){if(o=(0,Mt.m9)(o),tn("collection","path",e),o instanceof jt){const a=an.fromString(e,...i);return ti(a),new nr(o,null,a)}{if(!(o instanceof Xt||o instanceof nr))throw new Ze(Ce.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=o._path.child(an.fromString(e,...i));return ti(a),new nr(o.firestore,null,a)}}function Os(o,e,...i){if(o=(0,Mt.m9)(o),1===arguments.length&&(e=Kl.I()),tn("doc","path",e),o instanceof jt){const a=an.fromString(e,...i);return Rn(a),new Xt(o,null,new _(a))}{if(!(o instanceof Xt||o instanceof nr))throw new Ze(Ce.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=o._path.child(an.fromString(e,...i));return Rn(a),new Xt(o.firestore,o instanceof nr?o.converter:null,new _(a))}}function dr(o,e){return o=(0,Mt.m9)(o),e=(0,Mt.m9)(e),(o instanceof Xt||o instanceof nr)&&(e instanceof Xt||e instanceof nr)&&o.firestore===e.firestore&&o.path===e.path&&o.converter===e.converter}function qo(o,e){return o=(0,Mt.m9)(o),e=(0,Mt.m9)(e),o instanceof Cn&&e instanceof Cn&&o.firestore===e.firestore&&Ro(o._query,e._query)&&o.converter===e.converter}class mc{constructor(){this._c=Promise.resolve(),this.mc=[],this.gc=!1,this.yc=[],this.Tc=null,this.Ec=!1,this.Ic=!1,this.Ac=[],this.ar=new Sl(this,"async_queue_retry"),this.Rc=()=>{const i=Nu();i&&Je("AsyncQueue","Visibility state changed to "+i.visibilityState),this.ar.tr()};const e=Nu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Rc)}get isShuttingDown(){return this.gc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.bc(),this.Pc(e)}enterRestrictedMode(e){if(!this.gc){this.gc=!0,this.Ic=e||!1;const i=Nu();i&&"function"==typeof i.removeEventListener&&i.removeEventListener("visibilitychange",this.Rc)}}enqueue(e){if(this.bc(),this.gc)return new Promise(()=>{});const i=new Qn;return this.Pc(()=>this.gc&&this.Ic?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.mc.push(e),this.vc()))}vc(){var e=this;return(0,ae.Z)(function*(){if(0!==e.mc.length){try{yield e.mc[0](),e.mc.shift(),e.ar.reset()}catch(i){if(!Xa(i))throw i;Je("AsyncQueue","Operation failed with retryable error: "+i)}e.mc.length>0&&e.ar.Xi(()=>e.vc())}})()}Pc(e){const i=this._c.then(()=>(this.Ec=!0,e().catch(a=>{throw this.Tc=a,this.Ec=!1,li("INTERNAL UNHANDLED ERROR: ",function(v){let T=v.message||"";return v.stack&&(T=v.stack.includes(v.message)?v.stack:v.message+"\n"+v.stack),T}(a)),a}).then(a=>(this.Ec=!1,a))));return this._c=i,i}enqueueAfterDelay(e,i,a){this.bc(),this.Ac.indexOf(e)>-1&&(i=0);const p=rp.createAndSchedule(this,e,i,a,v=>this.Vc(v));return this.yc.push(p),p}bc(){this.Tc&&dt()}verifyOperationInProgress(){}Sc(){var e=this;return(0,ae.Z)(function*(){let i;do{i=e._c,yield i}while(i!==e._c)})()}Dc(e){for(const i of this.yc)if(i.timerId===e)return!0;return!1}Cc(e){return this.Sc().then(()=>{this.yc.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.yc)if(i.skipDelay(),"all"!==e&&i.timerId===e)break;return this.Sc()})}Nc(e){this.Ac.push(e)}Vc(e){const i=this.yc.indexOf(e);this.yc.splice(i,1)}}function Jr(o){return function(e,i){if("object"!=typeof e||null===e)return!1;const a=e;for(const p of["next","error","complete"])if(p in a&&"function"==typeof a[p])return!0;return!1}(o)}class Wu{constructor(){this._progressObserver={},this._taskCompletionResolver=new Qn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,i,a){this._progressObserver={next:e,error:i,complete:a}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,i){return this._taskCompletionResolver.promise.then(e,i)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Wn extends jt{constructor(e,i){super(e,i),this.type="firestore",this._queue=new mc,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||es(this),this._firestoreClient.terminate()}}function Wi(o){return o._firestoreClient||es(o),o._firestoreClient.verifyNotTerminated(),o._firestoreClient}function es(o){var e;const i=o._freezeSettings(),a=(v=(null===(e=o._app)||void 0===e?void 0:e.options.appId)||"",new Zn(o._databaseId,v,o._persistenceKey,(M=i).host,M.ssl,M.experimentalForceLongPolling,M.experimentalAutoDetectLongPolling,M.useFetchStreams));var v,M;o._firestoreClient=new we(o._credentials,o._queue,a)}function Jh(o,e,i){const a=new Qn;return o.asyncQueue.enqueue((0,ae.Z)(function*(){try{yield xe(o,i),yield qe(o,e),a.resolve()}catch(p){if(!("FirebaseError"===(v=p).name?v.code===Ce.FAILED_PRECONDITION||v.code===Ce.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&v instanceof DOMException)||22===v.code||20===v.code||11===v.code))throw p;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+p),a.reject(p)}var v})).then(()=>a.promise)}function og(o){if(o._initialized||o._terminated)throw new Ze(Ce.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class yc{constructor(...e){for(let i=0;i<e.length;++i)if(0===e[i].length)throw new Ze(Ce.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Jn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Rl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Rl(Mi.fromBase64String(e))}catch(i){throw new Ze(Ce.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new Rl(Mi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ku{constructor(e){this._methodName=e}}class Nf{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Ze(Ce.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Ze(Ce.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ht(this._lat,e._lat)||Ht(this._long,e._long)}}const by=/^__.*__$/;class Ty{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return null!==this.fieldMask?new Or(e,this.data,this.fieldMask,i,this.fieldTransforms):new ro(e,this.data,i,this.fieldTransforms)}}class ag{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return new Or(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function lg(o){switch(o){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw dt()}}class Uf{constructor(e,i,a,p,v,T){this.settings=e,this.databaseId=i,this.N=a,this.ignoreUndefinedProperties=p,void 0===v&&this.xc(),this.fieldTransforms=v||[],this.fieldMask=T||[]}get path(){return this.settings.path}get kc(){return this.settings.kc}$c(e){return new Uf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Oc(e){var i;const a=null===(i=this.path)||void 0===i?void 0:i.child(e),p=this.$c({path:a,Fc:!1});return p.Mc(e),p}Lc(e){var i;const a=null===(i=this.path)||void 0===i?void 0:i.child(e),p=this.$c({path:a,Fc:!1});return p.xc(),p}Bc(e){return this.$c({path:void 0,Fc:!0})}Uc(e){return qf(e,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Kc)}contains(e){return void 0!==this.fieldMask.find(i=>e.isPrefixOf(i))||void 0!==this.fieldTransforms.find(i=>e.isPrefixOf(i.field))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Mc(this.path.get(e))}Mc(e){if(0===e.length)throw this.Uc("Document fields must not be empty");if(lg(this.kc)&&by.test(e))throw this.Uc('Document fields cannot begin and end with "__"')}}class Ey{constructor(e,i,a){this.databaseId=e,this.ignoreUndefinedProperties=i,this.N=a||Uu(e)}jc(e,i,a,p=!1){return new Uf({kc:e,methodName:i,Kc:a,path:Jn.emptyPath(),Fc:!1,qc:p},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function Xu(o){const e=o._freezeSettings(),i=Uu(o._databaseId);return new Ey(o._databaseId,!!e.ignoreUndefinedProperties,i)}function Vf(o,e,i,a,p,v={}){const T=o.jc(v.merge||v.mergeFields?2:0,e,i,p);zm("Data must be an object, but it was:",T,a);const M=hg(a,T);let N,K;if(v.merge)N=new cs(T.fieldMask),K=T.fieldTransforms;else if(v.mergeFields){const ne=[];for(const me of v.mergeFields){const ke=Lm(e,me,i);if(!T.contains(ke))throw new Ze(Ce.INVALID_ARGUMENT,`Field '${ke}' is specified in your field mask but missing from your input data.`);pg(ne,ke)||ne.push(ke)}N=new cs(ne),K=T.fieldTransforms.filter(me=>N.covers(me.field))}else N=null,K=T.fieldTransforms;return new Ty(new ue(M),N,K)}class _p extends Ku{_toFieldTransform(e){if(2!==e.kc)throw e.Uc(1===e.kc?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof _p}}function cg(o,e,i){return new Uf({kc:3,Kc:e.settings.Kc,methodName:o._methodName,Fc:i},e.databaseId,e.N,e.ignoreUndefinedProperties)}class Mm extends Ku{_toFieldTransform(e){return new no(e.path,new Yl)}isEqual(e){return e instanceof Mm}}class Sy extends Ku{constructor(e,i){super(e),this.Qc=i}_toFieldTransform(e){const i=cg(this,e,!0),a=this.Qc.map(v=>Yu(v,i)),p=new Ql(a);return new no(e.path,p)}isEqual(e){return this===e}}class Iy extends Ku{constructor(e,i){super(e),this.Qc=i}_toFieldTransform(e){const i=cg(this,e,!0),a=this.Qc.map(v=>Yu(v,i)),p=new Jl(a);return new no(e.path,p)}isEqual(e){return this===e}}class Ay extends Ku{constructor(e,i){super(e),this.Wc=i}_toFieldTransform(e){const i=new ec(e.N,ad(e.N,this.Wc));return new no(e.path,i)}isEqual(e){return this===e}}function Pm(o,e,i,a){const p=o.jc(1,e,i);zm("Data must be an object, but it was:",p,a);const v=[],T=ue.empty();zs(a,(N,K)=>{const ne=Rm(e,N,i);K=(0,Mt.m9)(K);const me=p.Lc(ne);if(K instanceof _p)v.push(ne);else{const ke=Yu(K,me);null!=ke&&(v.push(ne),T.set(ne,ke))}});const M=new cs(v);return new ag(T,M,p.fieldTransforms)}function Dm(o,e,i,a,p,v){const T=o.jc(1,e,i),M=[Lm(e,a,i)],N=[p];if(v.length%2!=0)throw new Ze(Ce.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let ke=0;ke<v.length;ke+=2)M.push(Lm(e,v[ke])),N.push(v[ke+1]);const K=[],ne=ue.empty();for(let ke=M.length-1;ke>=0;--ke)if(!pg(K,M[ke])){const Ve=M[ke];let et=N[ke];et=(0,Mt.m9)(et);const ht=T.Lc(Ve);if(et instanceof _p)K.push(Ve);else{const Bt=Yu(et,ht);null!=Bt&&(K.push(Ve),ne.set(Ve,Bt))}}const me=new cs(K);return new ag(ne,me,T.fieldTransforms)}function ug(o,e,i,a=!1){return Yu(i,o.jc(a?4:3,e))}function Yu(o,e){if(dg(o=(0,Mt.m9)(o)))return zm("Unsupported field value:",e,o),hg(o,e);if(o instanceof Ku)return function(i,a){if(!lg(a.kc))throw a.Uc(`${i._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Uc(`${i._methodName}() is not currently supported inside arrays`);const p=i._toFieldTransform(a);p&&a.fieldTransforms.push(p)}(o,e),null;if(void 0===o&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),o instanceof Array){if(e.settings.Fc&&4!==e.kc)throw e.Uc("Nested arrays are not supported");return function(i,a){const p=[];let v=0;for(const T of i){let M=Yu(T,a.Bc(v));null==M&&(M={nullValue:"NULL_VALUE"}),p.push(M),v++}return{arrayValue:{values:p}}}(o,e)}return function(i,a){if(null===(i=(0,Mt.m9)(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof i)return ad(a.N,i);if("boolean"==typeof i)return{booleanValue:i};if("string"==typeof i)return{stringValue:i};if(i instanceof Date){const p=ki.fromDate(i);return{timestampValue:Rc(a.N,p)}}if(i instanceof ki){const p=new ki(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Rc(a.N,p)}}if(i instanceof Nf)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Rl)return{bytesValue:hh(a.N,i._byteString)};if(i instanceof Xt){const p=a.databaseId,v=i.firestore._databaseId;if(!v.isEqual(p))throw a.Uc(`Document reference is for database ${v.projectId}/${v.database} but should be for database ${p.projectId}/${p.database}`);return{referenceValue:Fc(i.firestore._databaseId||a.databaseId,i._key.path)}}throw a.Uc(`Unsupported field value: ${$i(i)}`)}(o,e)}function hg(o,e){const i={};return _u(o)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zs(o,(a,p)=>{const v=Yu(p,e.Oc(a));null!=v&&(i[a]=v)}),{mapValue:{fields:i}}}function dg(o){return!("object"!=typeof o||null===o||o instanceof Array||o instanceof Date||o instanceof ki||o instanceof Nf||o instanceof Rl||o instanceof Xt||o instanceof Ku)}function zm(o,e,i){if(!dg(i)||"object"!=typeof(a=i)||null===a||Object.getPrototypeOf(a)!==Object.prototype&&null!==Object.getPrototypeOf(a)){const a=$i(i);throw e.Uc("an object"===a?o+" a custom object":o+" "+a)}var a}function Lm(o,e,i){if((e=(0,Mt.m9)(e))instanceof yc)return e._internalPath;if("string"==typeof e)return Rm(o,e);throw qf("Field path arguments must be of type string or FieldPath.",o,!1,void 0,i)}const Cy=new RegExp("[~\\*/\\[\\]]");function Rm(o,e,i){if(e.search(Cy)>=0)throw qf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,o,!1,void 0,i);try{return new yc(...e.split("."))._internalPath}catch(a){throw qf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,o,!1,void 0,i)}}function qf(o,e,i,a,p){const v=a&&!a.isEmpty(),T=void 0!==p;let M=`Function ${e}() called with invalid data`;i&&(M+=" (via `toFirestore()`)"),M+=". ";let N="";return(v||T)&&(N+=" (found",v&&(N+=` in field ${a}`),T&&(N+=` in document ${p}`),N+=")"),new Ze(Ce.INVALID_ARGUMENT,M+o+N)}function pg(o,e){return o.some(i=>i.isEqual(e))}class vp{constructor(e,i,a,p,v){this._firestore=e,this._userDataWriter=i,this._key=a,this._document=p,this._converter=v}get id(){return this._key.path.lastSegment()}get ref(){return new Xt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new ky(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(Gf("DocumentSnapshot.get",e));if(null!==i)return this._userDataWriter.convertValue(i)}}}class ky extends vp{data(){return super.data()}}function Gf(o,e){return"string"==typeof e?Rm(o,e):e instanceof yc?e._internalPath:e._delegate._internalPath}class Qu{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _c extends vp{constructor(e,i,a,p,v,T){super(e,i,a,p,T),this._firestore=e,this._firestoreImpl=e,this.metadata=v}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new xp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const a=this._document.data.field(Gf("DocumentSnapshot.get",e));if(null!==a)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class xp extends _c{data(e={}){return super.data(e)}}class nu{constructor(e,i,a,p){this._firestore=e,this._userDataWriter=i,this._snapshot=p,this.metadata=new Qu(p.hasPendingWrites,p.fromCache),this.query=a}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,i){this._snapshot.docs.forEach(a=>{e.call(i,new xp(this._firestore,this._userDataWriter,a.key,a,new Qu(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Ze(Ce.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(a,p){if(a._snapshot.oldDocs.isEmpty()){let v=0;return a._snapshot.docChanges.map(T=>({type:"added",doc:new xp(a._firestore,a._userDataWriter,T.doc.key,T.doc,new Qu(a._snapshot.mutatedKeys.has(T.doc.key),a._snapshot.fromCache),a.query.converter),oldIndex:-1,newIndex:v++}))}{let v=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(T=>p||3!==T.type).map(T=>{const M=new xp(a._firestore,a._userDataWriter,T.doc.key,T.doc,new Qu(a._snapshot.mutatedKeys.has(T.doc.key),a._snapshot.fromCache),a.query.converter);let N=-1,K=-1;return 0!==T.type&&(N=v.indexOf(T.doc.key),v=v.delete(T.doc.key)),1!==T.type&&(v=v.add(T.doc),K=v.indexOf(T.doc.key)),{type:My(T.type),doc:M,oldIndex:N,newIndex:K}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function My(o){switch(o){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return dt()}}function fg(o,e){return o instanceof _c&&e instanceof _c?o._firestore===e._firestore&&o._key.isEqual(e._key)&&(null===o._document?null===e._document:o._document.isEqual(e._document))&&o._converter===e._converter:o instanceof nu&&e instanceof nu&&o._firestore===e._firestore&&qo(o.query,e.query)&&o.metadata.isEqual(e.metadata)&&o._snapshot.isEqual(e._snapshot)}function mg(o){if(_i(o)&&0===o.explicitOrderBy.length)throw new Ze(Ce.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class wp{}function iu(o,...e){for(const i of e)o=i._apply(o);return o}class Py extends wp{constructor(e,i,a){super(),this.Gc=e,this.zc=i,this.Hc=a,this.type="where"}_apply(e){const i=Xu(e.firestore),a=function(p,v,T,M,N,K,ne){let me;if(N.isKeyField()){if("array-contains"===K||"array-contains-any"===K)throw new Ze(Ce.INVALID_ARGUMENT,`Invalid Query. You can't perform '${K}' queries on FieldPath.documentId().`);if("in"===K||"not-in"===K){wg(ne,K);const Ve=[];for(const et of ne)Ve.push(xg(M,p,et));me={arrayValue:{values:Ve}}}else me=xg(M,p,ne)}else"in"!==K&&"not-in"!==K&&"array-contains-any"!==K||wg(ne,K),me=ug(T,"where",ne,"in"===K||"not-in"===K);const ke=nt.create(N,K,me);return function(Ve,et){if(et.v()){const Bt=wr(Ve);if(null!==Bt&&!Bt.isEqual(et.field))throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${Bt.toString()}' and '${et.field.toString()}'`);const Hn=xn(Ve);null!==Hn&&bg(0,et.field,Hn)}const ht=function(Bt,Hn){for(const Vs of Bt.filters)if(Hn.indexOf(Vs.op)>=0)return Vs.op;return null}(Ve,function(Bt){switch(Bt){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(et.op));if(null!==ht)throw new Ze(Ce.INVALID_ARGUMENT,ht===et.op?`Invalid query. You cannot use more than one '${et.op.toString()}' filter.`:`Invalid query. You cannot use '${et.op.toString()}' filters with '${ht.toString()}' filters.`)}(p,ke),ke}(e._query,0,i,e.firestore._databaseId,this.Gc,this.zc,this.Hc);return new Cn(e.firestore,e.converter,function(p,v){const T=p.filters.concat([v]);return new ln(p.path,p.collectionGroup,p.explicitOrderBy.slice(),T,p.limit,p.limitType,p.startAt,p.endAt)}(e._query,a))}}class zy extends wp{constructor(e,i){super(),this.Gc=e,this.Jc=i,this.type="orderBy"}_apply(e){const i=function(a,p,v){if(null!==a.startAt)throw new Ze(Ce.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==a.endAt)throw new Ze(Ce.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const T=new Vi(p,v);return function(M,N){if(null===xn(M)){const K=wr(M);null!==K&&bg(0,K,N.field)}}(a,T),T}(e._query,this.Gc,this.Jc);return new Cn(e.firestore,e.converter,function(a,p){const v=a.explicitOrderBy.concat([p]);return new ln(a.path,a.collectionGroup,v,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(e._query,i))}}class gg extends wp{constructor(e,i,a){super(),this.type=e,this.Yc=i,this.Xc=a}_apply(e){return new Cn(e.firestore,e.converter,vu(e._query,this.Yc,this.Xc))}}class yg extends wp{constructor(e,i,a){super(),this.type=e,this.Zc=i,this.ta=a}_apply(e){const i=vg(e,this.type,this.Zc,this.ta);return new Cn(e.firestore,e.converter,(p=i,new ln((a=e._query).path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,p,a.endAt)));var a,p}}class _g extends wp{constructor(e,i,a){super(),this.type=e,this.Zc=i,this.ta=a}_apply(e){const i=vg(e,this.type,this.Zc,this.ta);return new Cn(e.firestore,e.converter,(p=i,new ln((a=e._query).path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,p)));var a,p}}function vg(o,e,i,a){if(i[0]=(0,Mt.m9)(i[0]),i[0]instanceof vp)return function(p,v,T,M,N){if(!M)throw new Ze(Ce.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${T}().`);const K=[];for(const ne of Pi(p))if(ne.field.isKeyField())K.push($(v,M.key));else{const me=M.data.field(ne.field);if(yl(me))throw new Ze(Ce.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+ne.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===me){const ke=ne.field.canonicalString();throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${ke}' (used as the orderBy) does not exist.`)}K.push(me)}return new In(K,N)}(o._query,o.firestore._databaseId,e,i[0]._document,a);{const p=Xu(o.firestore);return function(v,T,M,N,K,ne){const me=v.explicitOrderBy;if(K.length>me.length)throw new Ze(Ce.INVALID_ARGUMENT,`Too many arguments provided to ${N}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const ke=[];for(let Ve=0;Ve<K.length;Ve++){const et=K[Ve];if(me[Ve].field.isKeyField()){if("string"!=typeof et)throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${N}(), but got a ${typeof et}`);if(!us(v)&&-1!==et.indexOf("/"))throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${N}() must be a plain document ID, but '${et}' contains a slash.`);const ht=v.path.child(an.fromString(et));if(!_.isDocumentKey(ht))throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${N}() must result in a valid document path, but '${ht}' is not because it contains an odd number of segments.`);const Bt=new _(ht);ke.push($(T,Bt))}else{const ht=ug(M,N,et);ke.push(ht)}}return new In(ke,ne)}(o._query,o.firestore._databaseId,p,e,i,a)}}function xg(o,e,i){if("string"==typeof(i=(0,Mt.m9)(i))){if(""===i)throw new Ze(Ce.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!us(e)&&-1!==i.indexOf("/"))throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=e.path.child(an.fromString(i));if(!_.isDocumentKey(a))throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return $(o,new _(a))}if(i instanceof Xt)return $(o,i._key);throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${$i(i)}.`)}function wg(o,e){if(!Array.isArray(o)||0===o.length)throw new Ze(Ce.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(o.length>10)throw new Ze(Ce.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function bg(o,e,i){if(!i.isEqual(e))throw new Ze(Ce.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${i.toString()}' instead.`)}class Fm{convertValue(e,i="none"){switch(b(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ci(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes($a(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 10:return this.convertObject(e.mapValue,i);default:throw dt()}}convertObject(e,i){const a={};return zs(e.fields,(p,v)=>{a[p]=this.convertValue(v,i)}),a}convertGeoPoint(e){return new Nf(ci(e.latitude),ci(e.longitude))}convertArray(e,i){return(e.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(e,i){switch(i){case"previous":const a=d(e);return null==a?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(n(e));default:return null}}convertTimestamp(e){const i=Lo(e);return new ki(i.seconds,i.nanos)}convertDocumentKey(e,i){const a=an.fromString(e);It($p(a));const p=new Nn(a.get(1),a.get(3)),v=new _(a.popFirst(5));return p.isEqual(i)||li(`Document ${v} contains a document reference within a different database (${p.projectId}/${p.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),v}}function jf(o,e,i){let a;return a=o?i&&(i.merge||i.mergeFields)?o.toFirestore(e,i):o.toFirestore(e):e,a}class Vy extends Fm{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rl(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Xt(this.firestore,null,i)}}class Tg{constructor(e,i){this._firestore=e,this._commitHandler=i,this._mutations=[],this._committed=!1,this._dataReader=Xu(e)}set(e,i,a){this._verifyNotCommitted();const p=ru(e,this._firestore),v=jf(p.converter,i,a),T=Vf(this._dataReader,"WriteBatch.set",p._key,v,null!==p.converter,a);return this._mutations.push(T.toMutation(p._key,Di.none())),this}update(e,i,a,...p){this._verifyNotCommitted();const v=ru(e,this._firestore);let T;return T="string"==typeof(i=(0,Mt.m9)(i))||i instanceof yc?Dm(this._dataReader,"WriteBatch.update",v._key,i,a,p):Pm(this._dataReader,"WriteBatch.update",v._key,i),this._mutations.push(T.toMutation(v._key,Di.exists(!0))),this}delete(e){this._verifyNotCommitted();const i=ru(e,this._firestore);return this._mutations=this._mutations.concat(new Tu(i._key,Di.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ze(Ce.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ru(o,e){if((o=(0,Mt.m9)(o)).firestore!==e)throw new Ze(Ce.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return o}class Ju extends Fm{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rl(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Xt(this.firestore,null,i)}}function Eg(o,e,i){o=gt(o,Xt);const a=gt(o.firestore,Wn),p=jf(o.converter,e,i);return ed(a,[Vf(Xu(a),"setDoc",o._key,p,null!==o.converter,i).toMutation(o._key,Di.none())])}function Sg(o,e,i,...a){o=gt(o,Xt);const p=gt(o.firestore,Wn),v=Xu(p);let T;return T="string"==typeof(e=(0,Mt.m9)(e))||e instanceof yc?Dm(v,"updateDoc",o._key,e,i,a):Pm(v,"updateDoc",o._key,e),ed(p,[T.toMutation(o._key,Di.exists(!0))])}function Ig(o,...e){var i,a,p;o=(0,Mt.m9)(o);let v={includeMetadataChanges:!1},T=0;"object"!=typeof e[T]||Jr(e[T])||(v=e[T],T++);const M={includeMetadataChanges:v.includeMetadataChanges};if(Jr(e[T])){const me=e[T];e[T]=null===(i=me.next)||void 0===i?void 0:i.bind(me),e[T+1]=null===(a=me.error)||void 0===a?void 0:a.bind(me),e[T+2]=null===(p=me.complete)||void 0===p?void 0:p.bind(me)}let N,K,ne;if(o instanceof Xt)K=gt(o.firestore,Wn),ne=Vt(o._key.path),N={next:me=>{e[T]&&e[T](Bm(K,o,me))},error:e[T+1],complete:e[T+2]};else{const me=gt(o,Cn);K=gt(me.firestore,Wn),ne=me._query;const ke=new Ju(K);N={next:Ve=>{e[T]&&e[T](new nu(K,ke,me,Ve))},error:e[T+1],complete:e[T+2]},mg(o._query)}return function(me,ke,Ve,et){const ht=new he(et),Bt=new ju(ke,ht,Ve);return me.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return Ja(yield bt(me),Bt)})),()=>{ht.ec(),me.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return On(yield bt(me),Bt)}))}}(Wi(K),ne,M,N)}function ed(o,e){return function(i,a){const p=new Qn;return i.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return function(o,e,i){return cp.apply(this,arguments)}(yield Rt(i),a,p)})),p.promise}(Wi(o),e)}function Bm(o,e,i){const a=i.docs.get(e._key),p=new Ju(o);return new _c(o,p,e._key,a,new Qu(i.hasPendingWrites,i.fromCache),e.converter)}class Yy extends class{constructor(e,i){this._firestore=e,this._transaction=i,this._dataReader=Xu(e)}get(e){const i=ru(e,this._firestore),a=new Vy(this._firestore);return this._transaction.lookup([i._key]).then(p=>{if(!p||1!==p.length)return dt();const v=p[0];if(v.isFoundDocument())return new vp(this._firestore,a,v.key,v,i.converter);if(v.isNoDocument())return new vp(this._firestore,a,i._key,null,i.converter);throw dt()})}set(e,i,a){const p=ru(e,this._firestore),v=jf(p.converter,i,a),T=Vf(this._dataReader,"Transaction.set",p._key,v,null!==p.converter,a);return this._transaction.set(p._key,T),this}update(e,i,a,...p){const v=ru(e,this._firestore);let T;return T="string"==typeof(i=(0,Mt.m9)(i))||i instanceof yc?Dm(this._dataReader,"Transaction.update",v._key,i,a,p):Pm(this._dataReader,"Transaction.update",v._key,i),this._transaction.update(v._key,T),this}delete(e){const i=ru(e,this._firestore);return this._transaction.delete(i._key),this}}{constructor(e,i){super(e,i),this._firestore=e}get(e){const i=ru(e,this._firestore),a=new Ju(this._firestore);return super.get(e).then(p=>new _c(this._firestore,a,i._key,p._document,new Qu(!1,!1),i.converter))}}function Om(o,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Ze("invalid-argument",`Invalid options passed to function ${o}(): You cannot specify both "merge" and "mergeFields".`);return e}function Ag(){if("undefined"==typeof Uint8Array)throw new Ze("unimplemented","Uint8Arrays are not available in this environment.")}function Cg(){if("undefined"==typeof atob)throw new Ze("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(o,e=!0){Ua=Xi.SDK_VERSION,(0,Xi._registerComponent)(new Ir.wA("firestore",(i,{options:a})=>{const p=i.getProvider("app").getImmediate(),v=new Wn(p,new pu(i.getProvider("auth-internal")));return a=Object.assign({useFetchStreams:e},a),v._setSettings(a),v},"PUBLIC")),(0,Xi.registerVersion)(ra,"3.2.1",o),(0,Xi.registerVersion)(ra,"3.2.1","esm2017")}();class bp{constructor(e){this._delegate=e}static fromBase64String(e){return Cg(),new bp(Rl.fromBase64String(e))}static fromUint8Array(e){return Ag(),new bp(Rl.fromUint8Array(e))}toBase64(){return Cg(),this._delegate.toBase64()}toUint8Array(){return Ag(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Nm(o){return function(o,e){if("object"!=typeof o||null===o)return!1;const i=o;for(const a of["next","error","complete"])if(a in i&&"function"==typeof i[a])return!0;return!1}(o)}class a_{enableIndexedDbPersistence(e,i){return function(o,e){og(o=gt(o,Wn));const i=Wi(o),a=o._freezeSettings(),p=new X;return Jh(i,p,new B(p,a.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:i})}enableMultiTabIndexedDbPersistence(e){return function(o){og(o=gt(o,Wn));const e=Wi(o),i=o._freezeSettings(),a=new X;return Jh(e,a,new j(a,i.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(o){if(o._initialized&&!o._terminated)throw new Ze(Ce.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Qn;return o._queue.enqueueAndForgetEvenWhileRestricted((0,ae.Z)(function*(){try{yield(i=(0,ae.Z)(function*(a){if(!lo.bt())return Promise.resolve();const p=a+"main";yield lo.delete(p)}),function(a){return i.apply(this,arguments)})(bh(o._databaseId,o._persistenceKey)),e.resolve()}catch(i){e.reject(i)}var i})),e.promise}(e._delegate)}}class kg{constructor(e,i,a){this._delegate=i,this._persistenceProvider=a,this.INTERNAL={delete:()=>this.terminate()},e instanceof Nn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const i=this._delegate._getSettings();!e.merge&&i.host!==e.host&&zo("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},i),e)).merge,this._delegate._setSettings(e)}useEmulator(e,i,a={}){!function(o,e,i,a={}){var p;const v=(o=gt(o,jt))._getSettings();if("firestore.googleapis.com"!==v.host&&v.host!==e&&zo("Host has been set in both settings() and useEmulator(), emulator host will be used"),o._setSettings(Object.assign(Object.assign({},v),{host:`${e}:${i}`,ssl:!1})),a.mockUserToken){let T,M;if("string"==typeof a.mockUserToken)T=a.mockUserToken,M=Mn.MOCK_USER;else{T=(0,Mt.Sg)(a.mockUserToken,null===(p=o._app)||void 0===p?void 0:p.options.projectId);const N=a.mockUserToken.sub||a.mockUserToken.user_id;if(!N)throw new Ze(Ce.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");M=new Mn(N)}o._credentials=new Hl(new Wl(T,M))}}(this._delegate,e,i,a)}enableNetwork(){return function(o){return function(o){return o.asyncQueue.enqueue((0,ae.Z)(function*(){const e=yield Pe(o),i=yield Lt(o);return e.setNetworkEnabled(!0),function(a){const p=tt(a);return p.Wr.delete(0),Il(p)}(i)}))}(Wi(o=gt(o,Wn)))}(this._delegate)}disableNetwork(){return function(o){return function(o){return o.asyncQueue.enqueue((0,ae.Z)(function*(){const e=yield Pe(o),i=yield Lt(o);return e.setNetworkEnabled(!1),(a=(0,ae.Z)(function*(p){const v=tt(p);v.Wr.add(0),yield Qa(v),v.Hr.set("Offline")}),function(p){return a.apply(this,arguments)})(i);var a}))}(Wi(o=gt(o,Wn)))}(this._delegate)}enablePersistence(e){let i=!1,a=!1;return e&&(i=!!e.synchronizeTabs,a=!!e.experimentalForceOwningTab,fi("synchronizeTabs",i,"experimentalForceOwningTab",a)),i?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,a)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(o){return function(e){const i=new Qn;return e.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return function(o,e){return dp.apply(this,arguments)}(yield Rt(e),i)})),i.promise}(Wi(o=gt(o,Wn)))}(this._delegate)}onSnapshotsInSync(e){return function(o,e){return function(o,e){const i=new he(e);return o.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return a=yield bt(o),p=i,tt(a).so.add(p),void p.next();var a,p})),()=>{i.ec(),o.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return a=yield bt(o),p=i,void tt(a).so.delete(p);var a,p}))}}(Wi(o=gt(o,Wn)),Jr(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new Ze("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new td(this,co(this._delegate,e))}catch(i){throw Ns(i,"collection()","Firestore.collection()")}}doc(e){try{return new ya(this,Os(this._delegate,e))}catch(i){throw Ns(i,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Us(this,function(o,e){if(o=gt(o,jt),tn("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ze(Ce.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Cn(o,null,(i=e,new ln(an.emptyPath(),i)));var i}(this._delegate,e))}catch(i){throw Ns(i,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(o,e){return function(o,e){const i=new Qn;return o.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){const a=yield(p=o,Re(p).then(v=>v.datastore));var p;new ve(o.asyncQueue,a,e,i).run()})),i.promise}(Wi(o=gt(o,Wn)),i=>e(new Yy(o,i)))}(this._delegate,i=>e(new Mg(this,i)))}batch(){return Wi(this._delegate),new Pg(new Tg(this._delegate,e=>ed(this._delegate,e)))}loadBundle(e){return function(o,e){const i=Wi(o=gt(o,Wn)),a=new Wu;return function(o,e,i,a){const p=function(v,T){let M;return M="string"==typeof v?(new TextEncoder).encode(v):v,N=function(N,K){if(N instanceof Uint8Array)return ie(N,K);if(N instanceof ArrayBuffer)return ie(new Uint8Array(N),K);if(N instanceof ReadableStream)return N.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(M),new ye(N,T);var N}(i,Uu(e));o.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){!function(o,e,i){const a=tt(o);var p;(p=(0,ae.Z)(function*(v,T,M){try{const N=yield T.getMetadata();if(yield function(ke,Ve){const et=tt(ke),ht=ur(Ve.createTime);return et.persistence.runTransaction("hasNewerBundle","readonly",Bt=>et.Je.getBundleMetadata(Bt,Ve.id)).then(Bt=>!!Bt&&Bt.createTime.compareTo(ht)>=0)}(v.localStore,N))return yield T.close(),void M._completeWith((ke=N,{taskState:"Success",documentsLoaded:ke.totalDocuments,bytesLoaded:ke.totalBytes,totalDocuments:ke.totalDocuments,totalBytes:ke.totalBytes}));M._updateProgress(jh(N));const K=new eu(N,v.localStore,T.N);let ne=yield T.zo();for(;ne;){const ke=yield K.mo(ne);ke&&M._updateProgress(ke),ne=yield T.zo()}const me=yield K.complete();yield Qr(v,me.En,void 0),yield function(ke,Ve){const et=tt(ke);return et.persistence.runTransaction("Save bundle","readwrite",ht=>et.Je.saveBundleMetadata(ht,Ve))}(v.localStore,N),M._completeWith(me.progress)}catch(N){zo("SyncEngine",`Loading bundle failed with ${N}`),M._failWith(N)}var ke}),function(v,T,M){return p.apply(this,arguments)})(a,e,i).then(()=>{a.sharedClientState.notifyBundleLoaded()})}(yield Rt(o),p,a)}))}(i,o._databaseId,e,a),a}(this._delegate,e)}namedQuery(e){return function(o,e){return function(o,e){return o.asyncQueue.enqueue((0,ae.Z)(function*(){return function(i,a){const p=tt(i);return p.persistence.runTransaction("Get named query","readonly",v=>p.Je.getNamedQuery(v,a))}(yield _t(o),e)}))}(Wi(o=gt(o,Wn)),e).then(i=>i?new Cn(o,null,i.query):null)}(this._delegate,e).then(i=>i?new Us(this,i):null)}}class $f extends Fm{constructor(e){super(),this.firestore=e}convertBytes(e){return new bp(new Rl(e))}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return ya.forKey(i,this.firestore,null)}}class Mg{constructor(e,i){this._firestore=e,this._delegate=i,this._userDataWriter=new $f(e)}get(e){const i=th(e);return this._delegate.get(i).then(a=>new Tp(this._firestore,new _c(this._firestore._delegate,this._userDataWriter,a._key,a._document,a.metadata,i.converter)))}set(e,i,a){const p=th(e);return a?(Om("Transaction.set",a),this._delegate.set(p,i,a)):this._delegate.set(p,i),this}update(e,i,a,...p){const v=th(e);return 2===arguments.length?this._delegate.update(v,i):this._delegate.update(v,i,a,...p),this}delete(e){const i=th(e);return this._delegate.delete(i),this}}class Pg{constructor(e){this._delegate=e}set(e,i,a){const p=th(e);return a?(Om("WriteBatch.set",a),this._delegate.set(p,i,a)):this._delegate.set(p,i),this}update(e,i,a,...p){const v=th(e);return 2===arguments.length?this._delegate.update(v,i):this._delegate.update(v,i,a,...p),this}delete(e){const i=th(e);return this._delegate.delete(i),this}commit(){return this._delegate.commit()}}class eh{constructor(e,i,a){this._firestore=e,this._userDataWriter=i,this._delegate=a}fromFirestore(e,i){const a=new xp(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ep(this._firestore,a),null!=i?i:{})}toFirestore(e,i){return i?this._delegate.toFirestore(e,i):this._delegate.toFirestore(e)}static getInstance(e,i){const a=eh.INSTANCES;let p=a.get(e);p||(p=new WeakMap,a.set(e,p));let v=p.get(i);return v||(v=new eh(e,new $f(e),i),p.set(i,v)),v}}eh.INSTANCES=new WeakMap;class ya{constructor(e,i){this.firestore=e,this._delegate=i,this._userDataWriter=new $f(e)}static forPath(e,i,a){if(e.length%2!=0)throw new Ze("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new ya(i,new Xt(i._delegate,a,new _(e)))}static forKey(e,i,a){return new ya(i,new Xt(i._delegate,a,e))}get id(){return this._delegate.id}get parent(){return new td(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new td(this.firestore,co(this._delegate,e))}catch(i){throw Ns(i,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,Mt.m9)(e))instanceof Xt&&dr(this._delegate,e)}set(e,i){i=Om("DocumentReference.set",i);try{return i?Eg(this._delegate,e,i):Eg(this._delegate,e)}catch(a){throw Ns(a,"setDoc()","DocumentReference.set()")}}update(e,i,...a){try{return 1===arguments.length?Sg(this._delegate,e):Sg(this._delegate,e,i,...a)}catch(p){throw Ns(p,"updateDoc()","DocumentReference.update()")}}delete(){return function(o){return ed(gt(o.firestore,Wn),[new Tu(o._key,Di.none())])}(this._delegate)}onSnapshot(...e){const i=Dg(e),a=zg(e,p=>new Tp(this.firestore,new _c(this.firestore._delegate,this._userDataWriter,p._key,p._document,p.metadata,this._delegate.converter)));return Ig(this._delegate,i,a)}get(e){let i;return i="cache"===(null==e?void 0:e.source)?function(o){o=gt(o,Xt);const e=gt(o.firestore,Wn),i=Wi(e),a=new Ju(e);return function(o,e){const i=new Qn;return o.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return(a=(0,ae.Z)(function*(p,v,T){try{const M=yield function(N,K){const ne=tt(N);return ne.persistence.runTransaction("read document","readonly",me=>ne.Qn.An(me,K))}(p,v);M.isFoundDocument()?T.resolve(M):M.isNoDocument()?T.resolve(null):T.reject(new Ze(Ce.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(M){const N=hc(M,`Failed to get document '${v} from cache`);T.reject(N)}}),function(p,v,T){return a.apply(this,arguments)})(yield _t(o),e,i);var a})),i.promise}(i,o._key).then(p=>new _c(e,a,o._key,p,new Qu(null!==p&&p.hasLocalMutations,!0),o.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function(o){o=gt(o,Xt);const e=gt(o.firestore,Wn);return di(Wi(e),o._key,{source:"server"}).then(i=>Bm(e,o,i))}(this._delegate):function(o){o=gt(o,Xt);const e=gt(o.firestore,Wn);return di(Wi(e),o._key).then(i=>Bm(e,o,i))}(this._delegate),i.then(a=>new Tp(this.firestore,new _c(this.firestore._delegate,this._userDataWriter,a._key,a._document,a.metadata,this._delegate.converter)))}withConverter(e){return new ya(this.firestore,this._delegate.withConverter(e?eh.getInstance(this.firestore,e):null))}}function Ns(o,e,i){return o.message=o.message.replace(e,i),o}function Dg(o){for(const e of o)if("object"==typeof e&&!Nm(e))return e;return{}}function zg(o,e){var i,a;let p;return p=Nm(o[0])?o[0]:Nm(o[1])?o[1]:"function"==typeof o[0]?{next:o[0],error:o[1],complete:o[2]}:{next:o[1],error:o[2],complete:o[3]},{next:v=>{p.next&&p.next(e(v))},error:null===(i=p.error)||void 0===i?void 0:i.bind(p),complete:null===(a=p.complete)||void 0===a?void 0:a.bind(p)}}class Tp{constructor(e,i){this._firestore=e,this._delegate=i}get ref(){return new ya(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,i){return this._delegate.get(e,i)}isEqual(e){return fg(this._delegate,e._delegate)}}class Ep extends Tp{data(e){const i=this._delegate.data(e);return function(o,e){o||dt()}(void 0!==i),i}}class Us{constructor(e,i){this.firestore=e,this._delegate=i,this._userDataWriter=new $f(e)}where(e,i,a){try{return new Us(this.firestore,iu(this._delegate,function(o,e,i){const a=e,p=Gf("where",o);return new Py(p,a,i)}(e,i,a)))}catch(p){throw Ns(p,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,i){try{return new Us(this.firestore,iu(this._delegate,function(o,e="asc"){const i=e,a=Gf("orderBy",o);return new zy(a,i)}(e,i)))}catch(a){throw Ns(a,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Us(this.firestore,iu(this._delegate,function(o){return ms("limit",o),new gg("limit",o,"F")}(e)))}catch(i){throw Ns(i,"limit()","Query.limit()")}}limitToLast(e){try{return new Us(this.firestore,iu(this._delegate,function(o){return ms("limitToLast",o),new gg("limitToLast",o,"L")}(e)))}catch(i){throw Ns(i,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Us(this.firestore,iu(this._delegate,function(...o){return new yg("startAt",o,!0)}(...e)))}catch(i){throw Ns(i,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Us(this.firestore,iu(this._delegate,function(...o){return new yg("startAfter",o,!1)}(...e)))}catch(i){throw Ns(i,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Us(this.firestore,iu(this._delegate,function(...o){return new _g("endBefore",o,!0)}(...e)))}catch(i){throw Ns(i,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Us(this.firestore,iu(this._delegate,function(...o){return new _g("endAt",o,!1)}(...e)))}catch(i){throw Ns(i,"endAt()","Query.endAt()")}}isEqual(e){return qo(this._delegate,e._delegate)}get(e){let i;return i="cache"===(null==e?void 0:e.source)?function(o){o=gt(o,Cn);const e=gt(o.firestore,Wn),i=Wi(e),a=new Ju(e);return function(o,e){const i=new Qn;return o.asyncQueue.enqueueAndForget((0,ae.Z)(function*(){return(a=(0,ae.Z)(function*(p,v,T){try{const M=yield Eh(p,v,!0),N=new op(v,M.Gn),K=N.bo(M.documents),ne=N.applyChanges(K,!1);T.resolve(ne.snapshot)}catch(M){const N=hc(M,`Failed to execute query '${v} against cache`);T.reject(N)}}),function(p,v,T){return a.apply(this,arguments)})(yield _t(o),e,i);var a})),i.promise}(i,o._query).then(p=>new nu(e,a,o,p))}(this._delegate):"server"===(null==e?void 0:e.source)?function(o){o=gt(o,Cn);const e=gt(o.firestore,Wn),i=Wi(e),a=new Ju(e);return Gi(i,o._query,{source:"server"}).then(p=>new nu(e,a,o,p))}(this._delegate):function(o){o=gt(o,Cn);const e=gt(o.firestore,Wn),i=Wi(e),a=new Ju(e);return mg(o._query),Gi(i,o._query).then(p=>new nu(e,a,o,p))}(this._delegate),i.then(a=>new Um(this.firestore,new nu(this.firestore._delegate,this._userDataWriter,this._delegate,a._snapshot)))}onSnapshot(...e){const i=Dg(e),a=zg(e,p=>new Um(this.firestore,new nu(this.firestore._delegate,this._userDataWriter,this._delegate,p._snapshot)));return Ig(this._delegate,i,a)}withConverter(e){return new Us(this.firestore,this._delegate.withConverter(e?eh.getInstance(this.firestore,e):null))}}class c_{constructor(e,i){this._firestore=e,this._delegate=i}get type(){return this._delegate.type}get doc(){return new Ep(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Um{constructor(e,i){this._firestore=e,this._delegate=i}get query(){return new Us(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ep(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(i=>new c_(this._firestore,i))}forEach(e,i){this._delegate.forEach(a=>{e.call(i,new Ep(this._firestore,a))})}isEqual(e){return fg(this._delegate,e._delegate)}}class td extends Us{constructor(e,i){super(e,i),this.firestore=e,this._delegate=i}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new ya(this.firestore,e):null}doc(e){try{return new ya(this.firestore,void 0===e?Os(this._delegate):Os(this._delegate,e))}catch(i){throw Ns(i,"doc()","CollectionReference.doc()")}}add(e){return function(o,e){const i=gt(o.firestore,Wn),a=Os(o),p=jf(o.converter,e);return ed(i,[Vf(Xu(o.firestore),"addDoc",a._key,p,null!==o.converter,{}).toMutation(a._key,Di.exists(!1))]).then(()=>a)}(this._delegate,e).then(i=>new ya(this.firestore,i))}isEqual(e){return dr(this._delegate,e._delegate)}withConverter(e){return new td(this.firestore,this._delegate.withConverter(e?eh.getInstance(this.firestore,e):null))}}function th(o){return gt(o,Xt)}class Vm{constructor(...e){this._delegate=new yc(...e)}static documentId(){return new Vm(Jn.keyField().canonicalString())}isEqual(e){return(e=(0,Mt.m9)(e))instanceof yc&&this._delegate._internalPath.isEqual(e._internalPath)}}class nh{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Mm("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new nh(e)}static delete(){const e=new _p("deleteField");return e._methodName="FieldValue.delete",new nh(e)}static arrayUnion(...e){const i=function(...o){return new Sy("arrayUnion",o)}(...e);return i._methodName="FieldValue.arrayUnion",new nh(i)}static arrayRemove(...e){const i=function(...o){return new Iy("arrayRemove",o)}(...e);return i._methodName="FieldValue.arrayRemove",new nh(i)}static increment(e){const i=function(o){return new Ay("increment",o)}(e);return i._methodName="FieldValue.increment",new nh(i)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const u_={Firestore:kg,GeoPoint:Nf,Timestamp:ki,Blob:bp,Transaction:Mg,WriteBatch:Pg,DocumentReference:ya,DocumentSnapshot:Tp,Query:Us,QueryDocumentSnapshot:Ep,QuerySnapshot:Um,CollectionReference:td,FieldPath:Vm,FieldValue:nh,setLogLevel:function(o){!function(o){Do.setLogLevel(o)}(o)},CACHE_SIZE_UNLIMITED:-1};!function(o){(function(o,e){o.INTERNAL.registerComponent(new Ir.wA("firestore-compat",i=>((e,i)=>new kg(e,i,new a_))(i.getProvider("app-compat").getImmediate(),i.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},u_)))})(o),o.registerVersion("@firebase/firestore-compat","0.1.6")}(ii.Z);var Lg=ot(9765),p_=ot(6682),Sp=ot(309),su=ot(3190),f_=ot(7771),m_=ot(5319),g_=ot(7971),y_=ot(8858);class __ extends Lg.xQ{constructor(e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a){super(),this.scheduler=a,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=i<1?1:i,i===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const i=this._events;i.push(e),i.length>this._bufferSize&&i.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new v_(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const i=this._infiniteTimeWindow,a=i?this._events:this._trimBufferThenGetEvents(),p=this.scheduler,v=a.length;let T;if(this.closed)throw new g_.N;if(this.isStopped||this.hasError?T=m_.w.EMPTY:(this.observers.push(e),T=new y_.W(this,e)),p&&e.add(e=new Sp.ht(e,p)),i)for(let M=0;M<v&&!e.closed;M++)e.next(a[M]);else for(let M=0;M<v&&!e.closed;M++)e.next(a[M].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),T}_getNow(){return(this.scheduler||f_.c).now()}_trimBufferThenGetEvents(){const e=this._getNow(),i=this._bufferSize,a=this._windowTime,p=this._events,v=p.length;let T=0;for(;T<v&&!(e-p[T].time<a);)T++;return v>i&&(T=Math.max(T,v-i)),T>0&&p.splice(0,T),p}}class v_{constructor(e,i){this.time=e,this.value=i}}function Rg(o,e,i){let a;return a=o&&"object"==typeof o?o:{bufferSize:o,windowTime:e,refCount:!1,scheduler:i},p=>p.lift(function({bufferSize:o=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:i,scheduler:a}){let p,T,v=0,M=!1,N=!1;return function(ne){let me;v++,!p||M?(M=!1,p=new __(o,e,a),me=p.subscribe(this),T=ne.subscribe({next(ke){p.next(ke)},error(ke){M=!0,p.error(ke)},complete(){N=!0,T=void 0,p.complete()}}),N&&(T=void 0)):me=p.subscribe(this),this.add(()=>{v--,me.unsubscribe(),me=void 0,T&&!N&&i&&0===v&&(T.unsubscribe(),T=void 0,p=void 0)})}}(a))}var w_=ot(8049);function Fg(o,e){return e?(0,su.w)(()=>o,e):(0,su.w)(()=>o)}var qm=ot(3101);ot(127),ot(2329);const Bg=new Map,T_={activated:!1,tokenObservers:[]},E_={initialized:!1,enabled:!1};function ys(o){return Bg.get(o)||T_}function el(o,e){Bg.set(o,e)}function Zf(){return E_}class C_{constructor(e,i,a,p,v){if(this.operation=e,this.retryPolicy=i,this.getWaitDuration=a,this.lowerBound=p,this.upperBound=v,this.pending=null,this.nextErrorWaitInterval=p,p>v)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var i=this;return(0,ae.Z)(function*(){i.stop();try{i.pending=new Mt.BH,yield function(o){return new Promise(e=>{setTimeout(e,o)})}(i.getNextRun(e)),i.pending.resolve(),yield i.pending.promise,i.pending=new Mt.BH,yield i.operation(),i.pending.resolve(),yield i.pending.promise,i.process(!0).catch(()=>{})}catch(a){i.retryPolicy(a)?i.process(!1).catch(()=>{}):i.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const i=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),i}}}const _a=new Mt.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error."});function Ng(o){if(!ys(o).activated)throw _a.create("use-before-activation",{appName:o.name})}function jm(o,e){return $m.apply(this,arguments)}function $m(){return($m=(0,ae.Z)(function*({url:o,body:e},i){const a={"Content-Type":"application/json"},p=i.getImmediate({optional:!0});p&&(a["X-Firebase-Client"]=p.getPlatformInfoString());const v={method:"POST",body:JSON.stringify(e),headers:a};let T,M;try{T=yield fetch(o,v)}catch(me){throw _a.create("fetch-network-error",{originalErrorMessage:me.message})}if(200!==T.status)throw _a.create("fetch-status-error",{httpStatus:T.status});try{M=yield T.json()}catch(me){throw _a.create("fetch-parse-error",{originalErrorMessage:me.message})}const N=M.ttl.match(/^([\d.]+)(s)$/);if(!N||!N[2]||isNaN(Number(N[1])))throw _a.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${M.ttl}`});const K=1e3*Number(N[1]),ne=Date.now();return{token:M.attestationToken,expireTimeMillis:ne+K,issuedAtTimeMillis:ne}})).apply(this,arguments)}function L_(o,e){const{projectId:i,appId:a,apiKey:p}=o.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1beta/projects/${i}/apps/${a}:exchangeDebugToken?key=${p}`,body:{debug_token:e}}}const Ip="firebase-app-check-store";let Hf=null;function Vg(){return Hf||(Hf=new Promise((o,e)=>{try{const i=indexedDB.open("firebase-app-check-database",1);i.onsuccess=a=>{o(a.target.result)},i.onerror=a=>{var p;e(_a.create("storage-open",{originalErrorMessage:null===(p=a.target.error)||void 0===p?void 0:p.message}))},i.onupgradeneeded=a=>{const p=a.target.result;switch(a.oldVersion){case 0:p.createObjectStore(Ip,{keyPath:"compositeKey"})}}}catch(i){e(_a.create("storage-open",{originalErrorMessage:i.message}))}}),Hf)}function Zm(){return(Zm=(0,ae.Z)(function*(o,e){const a=(yield Vg()).transaction(Ip,"readwrite"),v=a.objectStore(Ip).put({compositeKey:o,value:e});return new Promise((T,M)=>{v.onsuccess=N=>{T()},a.onerror=N=>{var K;M(_a.create("storage-set",{originalErrorMessage:null===(K=N.target.error)||void 0===K?void 0:K.message}))}})})).apply(this,arguments)}const Kf=new Kn.Yd("@firebase/app-check");function $g(o,e){return(0,Mt.hl)()?function(o,e){return function(o,e){return Zm.apply(this,arguments)}(function(o){return`${o.options.appId}-${o.name}`}(o),e)}(o,e).catch(i=>{Kf.warn(`Failed to write token to IndexedDB. Error: ${i}`)}):Promise.resolve()}function Zg(){return Zf().enabled}function Wg(){return Xm.apply(this,arguments)}function Xm(){return(Xm=(0,ae.Z)(function*(){const o=Zf();if(o.enabled&&o.token)return o.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const j_={error:"UNKNOWN_ERROR"};function $_(o){return Mt.US.encodeString(JSON.stringify(o),!1)}function Xf(o){return Ym.apply(this,arguments)}function Ym(){return(Ym=(0,ae.Z)(function*(o,e=!1){const i=o.app;Ng(i);const a=ys(i);let v,T,p=a.token;if(!p){const M=yield a.cachedTokenPromise;M&&Ap(M)&&(p=M,el(i,Object.assign(Object.assign({},a),{token:p})),Kg(i,{token:p.token}))}if(!e&&p&&Ap(p))return{token:p.token};if(Zg()){const M=yield jm(L_(i,yield Wg()),o.platformLoggerProvider);return yield $g(i,M),el(i,Object.assign(Object.assign({},a),{token:M})),{token:M.token}}try{p=yield a.provider.getToken()}catch(M){Kf.error(M),v=M}return p?(T={token:p.token},el(i,Object.assign(Object.assign({},a),{token:p})),yield $g(i,p)):T=W_(v),Kg(i,T),T})).apply(this,arguments)}function Qm(o,e){const i=ys(o),a=i.tokenObservers.filter(p=>p.next!==e);0===a.length&&i.tokenRefresher&&i.tokenRefresher.isRunning()&&i.tokenRefresher.stop(),el(o,Object.assign(Object.assign({},i),{tokenObservers:a}))}function Kg(o,e){const i=ys(o).tokenObservers;for(const a of i)try{"EXTERNAL"===a.type&&null!=e.error?a.error(e.error):a.next(e)}catch(p){}}function Ap(o){return o.expireTimeMillis-Date.now()>0}function W_(o){return{token:$_(j_),error:o}}class H_{constructor(e,i){this.app=e,this.platformLoggerProvider=i}_delete(){const{tokenObservers:e}=ys(this.app);for(const i of e)Qm(this.app,i.next);return Promise.resolve()}}const ty="app-check-internal";(0,Xi._registerComponent)(new Ir.wA("app-check",o=>function(o,e){return new H_(o,e)}(o.getProvider("app").getImmediate(),o.getProvider("platform-logger")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,e,i)=>{o.getProvider(ty).initialize()})),(0,Xi._registerComponent)(new Ir.wA(ty,o=>function(o){return{getToken:e=>Xf(o,e),addTokenListener:e=>function(o,e,i,a){const{app:p}=o,v=ys(p),T={next:i,error:a,type:e},M=Object.assign(Object.assign({},v),{tokenObservers:[...v.tokenObservers,T]});if(!M.tokenRefresher){const N=function(o){const{app:e}=o;return new C_((0,ae.Z)(function*(){let a;if(a=ys(e).token?yield Xf(o,!0):yield Xf(o),a.error)throw a.error}),()=>!0,()=>{const i=ys(e);if(i.token){let a=i.token.issuedAtTimeMillis+.5*(i.token.expireTimeMillis-i.token.issuedAtTimeMillis)+3e5;return a=Math.min(a,i.token.expireTimeMillis-3e5),Math.max(0,a-Date.now())}return 0},3e4,96e4)}(o);M.tokenRefresher=N}if(!M.tokenRefresher.isRunning()&&v.isTokenAutoRefreshEnabled&&M.tokenRefresher.start(),v.token&&Ap(v.token)){const N=v.token;Promise.resolve().then(()=>i({token:N.token})).catch(()=>{})}else null==v.token&&v.cachedTokenPromise.then(N=>{N&&Ap(N)&&i({token:N.token})}).catch(()=>{});el(p,M)}(o,"INTERNAL",e),removeTokenListener:e=>Qm(o.app,e)}}(o.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,Xi.registerVersion)("@firebase/app-check","0.5.0");class ng{constructor(){return(0,kn.vb)("app-check")}}"undefined"!=typeof window&&window,ot(7841);const iy=new Ee.OlP("angularfire2.auth.use-emulator"),ry=new Ee.OlP("angularfire2.auth.settings"),sy=new Ee.OlP("angularfire2.auth.tenant-id"),oy=new Ee.OlP("angularfire2.auth.langugage-code"),ay=new Ee.OlP("angularfire2.auth.use-device-language"),ly=new Ee.OlP("angularfire.auth.persistence"),cy=(o,e,i,a,p,v,T,M)=>(0,nn.cc)(`${o.name}.auth`,"AngularFireAuth",o.name,()=>{const N=e.runOutsideAngular(()=>o.auth());if(i&&N.useEmulator(...i),a&&(N.tenantId=a),N.languageCode=p,v&&N.useDeviceLanguage(),T)for(const[K,ne]of Object.entries(T))N.settings[K]=ne;return M&&N.setPersistence(M),N},[i,a,p,v,T,M]);let uy=(()=>{class o{constructor(i,a,p,v,T,M,N,K,ne,me,ke,Ve){const et=new Lg.xQ,ht=(0,Ur.of)(void 0).pipe((0,Sp.QV)(T.outsideAngular),(0,su.w)(()=>v.runOutsideAngular(()=>Promise.resolve().then(ot.bind(ot,4828)))),(0,Dn.U)(()=>(0,nn.on)(i,v,a)),(0,Dn.U)(Bt=>cy(Bt,v,M,K,ne,me,N,ke)),Rg({bufferSize:1,refCount:!1}));if((0,Pt.PM)(p))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Ur.of)(null);else{ht.pipe((0,w_.P)()).subscribe();const Hn=ht.pipe((0,su.w)(Un=>Un.getRedirectResult().then(Tr=>Tr,()=>null)),kn.iC,Rg({bufferSize:1,refCount:!1})),Vs=ht.pipe((0,su.w)(Un=>new Er.y(Tr=>({unsubscribe:v.runOutsideAngular(()=>Un.onAuthStateChanged(va=>Tr.next(va),va=>Tr.error(va),()=>Tr.complete()))})))),uo=ht.pipe((0,su.w)(Un=>new Er.y(Tr=>({unsubscribe:v.runOutsideAngular(()=>Un.onIdTokenChanged(va=>Tr.next(va),va=>Tr.error(va),()=>Tr.complete()))}))));this.authState=Hn.pipe(Fg(Vs),(0,qm.R)(T.outsideAngular),(0,Sp.QV)(T.insideAngular)),this.user=Hn.pipe(Fg(uo),(0,qm.R)(T.outsideAngular),(0,Sp.QV)(T.insideAngular)),this.idToken=this.user.pipe((0,su.w)(Un=>Un?(0,mi.D)(Un.getIdToken()):(0,Ur.of)(null))),this.idTokenResult=this.user.pipe((0,su.w)(Un=>Un?(0,mi.D)(Un.getIdTokenResult()):(0,Ur.of)(null))),this.credential=(0,p_.T)(Hn,et,this.authState.pipe((0,Sr.h)(Un=>!Un))).pipe((0,Dn.U)(Un=>(null==Un?void 0:Un.user)?Un:null),(0,qm.R)(T.outsideAngular),(0,Sp.QV)(T.insideAngular))}return(0,nn.pX)(this,ht,v,{spy:{apply:(Bt,Hn,Vs)=>{(Bt.startsWith("signIn")||Bt.startsWith("createUser"))&&Vs.then(uo=>et.next(uo))}}})}}return o.\u0275fac=function(i){return new(i||o)(Ee.LFG(nn.Dh),Ee.LFG(nn.xv,8),Ee.LFG(Ee.Lbi),Ee.LFG(Ee.R0b),Ee.LFG(kn.HU),Ee.LFG(iy,8),Ee.LFG(ry,8),Ee.LFG(sy,8),Ee.LFG(oy,8),Ee.LFG(ay,8),Ee.LFG(ly,8),Ee.LFG(ng,8))},o.\u0275prov=Ee.Yz7({token:o,factory:o.\u0275fac,providedIn:"any"}),o})();function hy(o,e){return function(o,e=_s.z){return new Er.y(i=>{let a;return null!=e?e.schedule(()=>{a=o.onSnapshot({includeMetadataChanges:!0},i)}):a=o.onSnapshot({includeMetadataChanges:!0},i),()=>{null!=a&&a()}})}(o,e)}function rg(o,e){return hy(o,e).pipe((0,Dn.U)(i=>({payload:i,type:"query"})))}function Qf(o,e){return rg(o,e).pipe((0,pr.O)(void 0),(0,Me.G)(),(0,Dn.U)(([i,a])=>{const p=a.payload.docChanges(),v=p.map(T=>({type:T.type,payload:T}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(a.payload.metadata)&&a.payload.docs.forEach((T,M)=>{const N=p.find(ne=>ne.doc.ref.isEqual(T.ref)),K=null==i?void 0:i.payload.docs.find(ne=>ne.ref.isEqual(T.ref));N&&JSON.stringify(N.doc.metadata)===JSON.stringify(T.metadata)||!N&&K&&JSON.stringify(K.metadata)===JSON.stringify(T.metadata)||v.push({type:"modified",payload:{oldIndex:M,newIndex:M,type:"modified",doc:T}})}),v}))}function dy(o,e,i){return Qf(o,i).pipe((0,dn.R)((a,p)=>function(o,e,i){return e.forEach(a=>{i.indexOf(a.type)>-1&&(o=function(o,e){switch(e.type){case"added":if(!o[e.newIndex]||!o[e.newIndex].doc.ref.isEqual(e.doc.ref))return sg(o,e.newIndex,0,e);break;case"modified":if(null==o[e.oldIndex]||o[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const i=o.slice();return i.splice(e.oldIndex,1),i.splice(e.newIndex,0,e),i}return sg(o,e.newIndex,1,e)}break;case"removed":if(o[e.oldIndex]&&o[e.oldIndex].doc.ref.isEqual(e.doc.ref))return sg(o,e.oldIndex,1)}return o}(o,a))}),o}(a,p.map(v=>v.payload),e),[]),(0,gn.x)(),(0,Dn.U)(a=>a.map(p=>({type:p.type,payload:p}))))}function sg(o,e,i,...a){const p=o.slice();return p.splice(e,i,...a),p}function py(o){return(!o||0===o.length)&&(o=["added","removed","modified"]),o}class fy{constructor(e,i,a){this.ref=e,this.query=i,this.afs=a}stateChanges(e){let i=Qf(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(i=i.pipe((0,Dn.U)(a=>a.filter(p=>e.indexOf(p.type)>-1)))),i.pipe((0,pr.O)(void 0),(0,Me.G)(),(0,Sr.h)(([a,p])=>p.length>0||!a),(0,Dn.U)(([a,p])=>p),kn.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,dn.R)((i,a)=>[...i,...a],[]))}snapshotChanges(e){const i=py(e);return dy(this.query,i,this.afs.schedulers.outsideAngular).pipe(kn.iC)}valueChanges(e={}){return rg(this.query,this.afs.schedulers.outsideAngular).pipe((0,Dn.U)(i=>i.payload.docs.map(a=>e.idField?Object.assign(Object.assign({},a.data()),{[e.idField]:a.id}):a.data())),kn.iC)}get(e){return(0,mi.D)(this.query.get(e)).pipe(kn.iC)}add(e){return this.ref.add(e)}doc(e){return new my(this.ref.doc(e),this.afs)}}class my{constructor(e,i){this.ref=e,this.afs=i}set(e,i){return this.ref.set(e,i)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,i){const a=this.ref.collection(e),{ref:p,query:v}=gy(a,i);return new fy(p,v,this.afs)}snapshotChanges(){return function(o,e){return hy(o,e).pipe((0,pr.O)(void 0),(0,Me.G)(),(0,Dn.U)(([i,a])=>a.exists?(null==i?void 0:i.exists)?{payload:a,type:"modified"}:{payload:a,type:"added"}:{payload:a,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(kn.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Dn.U)(({payload:i})=>e.idField?Object.assign(Object.assign({},i.data()),{[e.idField]:i.id}):i.data()))}get(e){return(0,mi.D)(this.ref.get(e)).pipe(kn.iC)}}class x0{constructor(e,i){this.query=e,this.afs=i}stateChanges(e){return e&&0!==e.length?Qf(this.query,this.afs.schedulers.outsideAngular).pipe((0,Dn.U)(i=>i.filter(a=>e.indexOf(a.type)>-1)),(0,Sr.h)(i=>i.length>0),kn.iC):Qf(this.query,this.afs.schedulers.outsideAngular).pipe(kn.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,dn.R)((i,a)=>[...i,...a],[]))}snapshotChanges(e){const i=py(e);return dy(this.query,i,this.afs.schedulers.outsideAngular).pipe(kn.iC)}valueChanges(e={}){return rg(this.query,this.afs.schedulers.outsideAngular).pipe((0,Dn.U)(a=>a.payload.docs.map(p=>e.idField?Object.assign({[e.idField]:p.id},p.data()):p.data())),kn.iC)}get(e){return(0,mi.D)(this.query.get(e)).pipe(kn.iC)}}const w0=new Ee.OlP("angularfire2.enableFirestorePersistence"),b0=new Ee.OlP("angularfire2.firestore.persistenceSettings"),T0=new Ee.OlP("angularfire2.firestore.settings"),E0=new Ee.OlP("angularfire2.firestore.use-emulator");function gy(o,e=(i=>i)){return{query:e(o),ref:o}}let S0=(()=>{class o{constructor(i,a,p,v,T,M,N,K,ne,me,ke,Ve,et,ht,Bt,Hn,Vs){this.schedulers=N;const uo=(0,nn.on)(i,M,a),Un=ne;me&&cy(uo,M,ke,et,ht,Bt,Ve,Hn),[this.firestore,this.persistenceEnabled$]=(0,nn.cc)(`${uo.name}.firestore`,"AngularFirestore",uo.name,()=>{const Tr=M.runOutsideAngular(()=>uo.firestore());if(v&&Tr.settings(v),Un&&Tr.useEmulator(...Un),p&&!(0,Pt.PM)(T)){const va=()=>{try{return(0,mi.D)(Tr.enablePersistence(K||void 0).then(()=>!0,()=>!1))}catch(O0){return"undefined"!=typeof console&&console.warn(O0),(0,Ur.of)(!1)}};return[Tr,M.runOutsideAngular(va)]}return[Tr,(0,Ur.of)(!1)]},[v,Un,p])}collection(i,a){let p;p="string"==typeof i?this.firestore.collection(i):i;const{ref:v,query:T}=gy(p,a),M=this.schedulers.ngZone.run(()=>v);return new fy(M,T,this)}collectionGroup(i,a){const p=a||(T=>T),v=this.firestore.collectionGroup(i);return new x0(p(v),this)}doc(i){let a;a="string"==typeof i?this.firestore.doc(i):i;const p=this.schedulers.ngZone.run(()=>a);return new my(p,this)}createId(){return this.firestore.collection("_").doc().id}}return o.\u0275fac=function(i){return new(i||o)(Ee.LFG(nn.Dh),Ee.LFG(nn.xv,8),Ee.LFG(w0,8),Ee.LFG(T0,8),Ee.LFG(Ee.Lbi),Ee.LFG(Ee.R0b),Ee.LFG(kn.HU),Ee.LFG(b0,8),Ee.LFG(E0,8),Ee.LFG(uy,8),Ee.LFG(iy,8),Ee.LFG(ry,8),Ee.LFG(sy,8),Ee.LFG(oy,8),Ee.LFG(ay,8),Ee.LFG(ly,8),Ee.LFG(ng,8))},o.\u0275prov=Ee.Yz7({token:o,factory:o.\u0275fac,providedIn:"any"}),o})(),I0=(()=>{class o{constructor(i){this.angularFireStore=i,this.keyRecords="records"}addRecord(i,a){this.angularFireStore.doc(`records/${a}`).update({records:ii.Z.firestore.FieldValue.arrayUnion(i)})}deleteRecords(i){this.angularFireStore.doc(`records/${i}`).delete()}getRecords(i){return this.angularFireStore.doc(`records/${i}`).valueChanges()}}return o.\u0275fac=function(i){return new(i||o)(Ee.LFG(S0))},o.\u0275prov=Ee.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),A0=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=Ee.Xpm({type:o,selectors:[["app-nav-header"]],decls:4,vars:0,consts:[[1,"navbar","navbar-colors"],[1,"container-fluid"],[1,"navbar-brand","mb-0","h1"]],template:function(i,a){1&i&&(Ee.TgZ(0,"nav",0),Ee.TgZ(1,"div",1),Ee.TgZ(2,"span",2),Ee._uU(3,"GEOEN"),Ee.qZA(),Ee.qZA(),Ee.qZA())},styles:[".navbar-colors[_ngcontent-%COMP%]{background-color:#009cdf;color:#fff}.navbar[_ngcontent-%COMP%]{height:70px}"]}),o})();var Jf=ot(2958),C0=ot(2340);let k0=(()=>{class o{constructor(i){this.socketService=i,this.zoom=15,this.mapbox=Jf,this.style="mapbox://styles/mapbox/streets-v11",this.mapbox.accessToken=C0.N.mapboxUrl}buildMap(){this.map=new Jf.Map({container:"map",style:this.style,center:[0,0],zoom:this.zoom}),this.marker=new Jf.Marker({color:"red"}),this.map.addControl(new Jf.NavigationControl)}startToWatch(){this.socketService.receiveUserPosition().subscribe(i=>{this.map.setCenter([i.longitude,i.latitude]),this.marker.setLngLat([i.longitude,i.latitude]).addTo(this.map)})}}return o.\u0275fac=function(i){return new(i||o)(Ee.LFG(Be))},o.\u0275prov=Ee.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),M0=(()=>{class o{constructor(i,a){this.mapboxService=i,this.activedRoute=a,this.userName=""}ngOnInit(){this.userName=this.activedRoute.snapshot.params.user,this.mapboxService.buildMap(),this.mapboxService.startToWatch()}}return o.\u0275fac=function(i){return new(i||o)(Ee.Y36(k0),Ee.Y36(ts.gz))},o.\u0275cmp=Ee.Xpm({type:o,selectors:[["app-map"]],decls:4,vars:1,consts:[[1,"map-box","mb-5"],[1,"m-3"],["id","map"]],template:function(i,a){1&i&&(Ee.TgZ(0,"div",0),Ee.TgZ(1,"h4",1),Ee._uU(2),Ee.qZA(),Ee._UZ(3,"div",2),Ee.qZA()),2&i&&(Ee.xp6(2),Ee.hij("Ubicaci\xf3n actual de ",a.userName,""))},styles:[".map-box[_ngcontent-%COMP%]{width:100%;height:50vh}#map[_ngcontent-%COMP%]{width:inherit;height:inherit}"]}),o})();function P0(o,e){if(1&o&&(Ee.TgZ(0,"li"),Ee.TgZ(1,"p",11),Ee._uU(2),Ee.qZA(),Ee.qZA()),2&o){const i=e.$implicit,a=Ee.oxw(2);Ee.xp6(1),Ee.Tol(a.setClassRecord(i)),Ee.xp6(1),Ee.AsE(" ",i.hour," ",i.message," ")}}function D0(o,e){if(1&o&&(Ee.TgZ(0,"ul"),Ee.YNc(1,P0,3,4,"li",10),Ee.qZA()),2&o){const i=Ee.oxw();Ee.xp6(1),Ee.Q6J("ngForOf",i.records)}}function z0(o,e){1&o&&(Ee.TgZ(0,"h5",12),Ee._uU(1,"No hay datos para mostrar :("),Ee.qZA())}var Cp=(()=>(function(o){o.ALERT="alert",o.ANSWERED="answered",o.NOT_ANSWERED="not_answered"}(Cp||(Cp={})),Cp))();const L0=[{path:"",component:(()=>{class o{constructor(i,a,p,v){this.socketService=i,this.pushNotif=a,this.route=p,this.recordService=v,this.records=[],this.muted="muted",this.roomId=""}ngOnInit(){this.roomId=this.route.snapshot.params.id,this.pushNotif.initNotifications(),this.recordService.getRecords(this.roomId).subscribe(i=>{i&&(this.records=i.records)}),this.initSocketEvents()}setClassRecord(i){return i.typeRecord===Cp.NOT_ANSWERED||i.typeRecord===Cp.ALERT?"text-danger":"text-success"}initSocketEvents(){this.socketService.connectToRoom(this.roomId),this.socketService.finishTravel().subscribe(i=>{if(i){const a=this.getActualTime(),p=3e5;this.recordService.deleteRecords(this.roomId),this.records=[],this.records.push({hour:a,message:"El usuario ha finalizado de compartir su trayecto."}),this.activateAudio(),setTimeout(()=>{this.records=[]},p),h().fire({title:"Fin del monitoreo",text:"El usuario ha finalizado de compartir su ubicaci\xf3n",icon:"info",showCancelButton:!1,showConfirmButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Aceptar"})}}),this.socketService.receiveAlert().subscribe(i=>{this.recordService.addRecord({hour:i.hour,message:i.record,typeRecord:i.typeRecord},this.roomId),this.pushNotif.showAlertNotification(),this.activateAudio(),h().fire({title:i.title,text:i.message,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Aceptar"})}),this.socketService.receiveRecord().subscribe(i=>{i&&(this.recordService.addRecord(i,this.roomId),this.activateAudio())})}getActualTime(){let i=(new Date).getHours().toString(),a="";return a=(new Date).getMinutes()<10?a.concat("0",(new Date).getMinutes().toString()):(new Date).getMinutes().toString(),"".concat(i,":",a)}activateAudio(){const i=document.getElementById("alert-audio");this.muted="",i.play()}}return o.\u0275fac=function(i){return new(i||o)(Ee.Y36(Be),Ee.Y36(at),Ee.Y36(ts.gz),Ee.Y36(I0))},o.\u0275cmp=Ee.Xpm({type:o,selectors:[["app-monitor-view"]],decls:15,vars:4,consts:[["id","alert-audio","controls","","preload","auto","autoplay","true",3,"hidden","muted"],["src","assets/audio/alert.wav","type","audio/wav"],[1,"container-fluid"],[1,"row","mt-3","p-1"],[1,"col-lg-6","status-box","p-2"],[4,"ngIf","ngIfElse"],["showMessage",""],[1,"col-lg-6"],[1,"row","justify-content-center"],[1,"col-lg-10","bg-image"],[4,"ngFor","ngForOf"],[1,"h6"],[1,"text-info"]],template:function(i,a){if(1&i&&(Ee._UZ(0,"app-nav-header"),Ee._UZ(1,"app-map"),Ee.TgZ(2,"audio",0),Ee._UZ(3,"source",1),Ee.qZA(),Ee.TgZ(4,"div",2),Ee.TgZ(5,"div",3),Ee.TgZ(6,"div",4),Ee.TgZ(7,"h4"),Ee._uU(8,"Registros"),Ee.qZA(),Ee.YNc(9,D0,2,1,"ul",5),Ee.YNc(10,z0,2,0,"ng-template",null,6,Ee.W1O),Ee.qZA(),Ee.TgZ(12,"div",7),Ee.TgZ(13,"div",8),Ee._UZ(14,"div",9),Ee.qZA(),Ee.qZA(),Ee.qZA(),Ee.qZA()),2&i){const p=Ee.MAs(11);Ee.xp6(2),Ee.Q6J("hidden",!0)("muted",a.muted),Ee.xp6(7),Ee.Q6J("ngIf",0!=a.records.length)("ngIfElse",p)}},directives:[A0,M0,Pt.O5,Pt.sg],styles:[".status-box[_ngcontent-%COMP%]{border:1px solid black;border-radius:8px;box-shadow:2px 2px 2px 2px #d3d3d3;min-height:33vh}ul[_ngcontent-%COMP%]{list-style:none;padding:0}.bg-image[_ngcontent-%COMP%]{background-image:url(tesis.4452d54097e00370d0d3.jpg);background-repeat:no-repeat;min-height:33vh}"]}),o})()}];let R0=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=Ee.oAB({type:o}),o.\u0275inj=Ee.cJS({imports:[[ts.Bz.forChild(L0)],ts.Bz]}),o})(),F0=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=Ee.oAB({type:o}),o.\u0275inj=Ee.cJS({imports:[[Pt.ez]]}),o})(),B0=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=Ee.oAB({type:o}),o.\u0275inj=Ee.cJS({imports:[[Pt.ez,R0,F0]]}),o})()}}]);